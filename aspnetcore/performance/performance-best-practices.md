---
title: Práticas recomendadas de desempenho do ASP.NET Core
author: mjrousos
description: Dicas para aumentar o desempenho em aplicativos ASP.NET Core e evitar problemas comuns de desempenho.
monikerRange: '>= aspnetcore-1.1'
ms.author: riande
ms.date: 1/9/2019
uid: performance/performance-best-practices
ms.openlocfilehash: 25aa4c1e22ead7db4775c6e5e81b6fd627c6d7a6
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57038203"
---
# <a name="aspnet-core-performance-best-practices"></a><span data-ttu-id="557e9-103">Práticas recomendadas de desempenho do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="557e9-103">ASP.NET Core Performance Best Practices</span></span>

<span data-ttu-id="557e9-104">Por [Mike Rousos](https://github.com/mjrousos)</span><span class="sxs-lookup"><span data-stu-id="557e9-104">By [Mike Rousos](https://github.com/mjrousos)</span></span>

<span data-ttu-id="557e9-105">Este tópico fornece diretrizes para desempenho, as práticas recomendadas com o ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="557e9-105">This topic provides guidelines for performance best practices with ASP.NET Core.</span></span>

<a name="hot"></a> <span data-ttu-id="557e9-106">Neste documento, um caminho de código a quente é definido como um caminho de código que é chamado com frequência e em que grande parte do tempo de execução ocorre.</span><span class="sxs-lookup"><span data-stu-id="557e9-106">In this document, a hot code path is defined as a code path that is frequently called and where much of the execution time occurs.</span></span> <span data-ttu-id="557e9-107">Caminhos de código ativo normalmente limitam a expansão de aplicativo e o desempenho.</span><span class="sxs-lookup"><span data-stu-id="557e9-107">Hot code paths typically limit app scale-out and performance.</span></span>

## <a name="cache-aggressively"></a><span data-ttu-id="557e9-108">Armazenar em cache agressivamente</span><span class="sxs-lookup"><span data-stu-id="557e9-108">Cache aggressively</span></span>

<span data-ttu-id="557e9-109">Armazenamento em cache é discutido em várias partes deste documento.</span><span class="sxs-lookup"><span data-stu-id="557e9-109">Caching is discussed in several parts of this document.</span></span> <span data-ttu-id="557e9-110">Para obter mais informações, consulte <xref:performance/caching/response>.</span><span class="sxs-lookup"><span data-stu-id="557e9-110">For more information, see <xref:performance/caching/response>.</span></span>

## <a name="avoid-blocking-calls"></a><span data-ttu-id="557e9-111">Evitar chamadas de bloqueio</span><span class="sxs-lookup"><span data-stu-id="557e9-111">Avoid blocking calls</span></span>

<span data-ttu-id="557e9-112">Aplicativos ASP.NET Core devem ser projetados para processar muitas solicitações simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="557e9-112">ASP.NET Core apps should be designed to process many requests simultaneously.</span></span> <span data-ttu-id="557e9-113">APIs assíncronas permitem que um pequeno pool de threads para lidar com milhares de solicitações simultâneas por não aguardando chamadas de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="557e9-113">Asynchronous APIs allow a small pool of threads to handle thousands of concurrent requests by not waiting on blocking calls.</span></span> <span data-ttu-id="557e9-114">Em vez de esperar em uma tarefa de longa execução síncrona para ser concluída, o thread pode trabalhar em outra solicitação.</span><span class="sxs-lookup"><span data-stu-id="557e9-114">Rather than waiting on a long-running synchronous task to complete, the thread can work on another request.</span></span>

<span data-ttu-id="557e9-115">Um problema de desempenho comuns em aplicativos ASP.NET Core está bloqueando chamadas que poderiam ser assíncronas.</span><span class="sxs-lookup"><span data-stu-id="557e9-115">A common performance problem in ASP.NET Core apps is blocking calls that could be asynchronous.</span></span> <span data-ttu-id="557e9-116">Muitas chamadas de bloqueio síncronas leva à [privação de Pool de threads](https://blogs.msdn.microsoft.com/vancem/2018/10/16/diagnosing-net-core-threadpool-starvation-with-perfview-why-my-service-is-not-saturating-all-cores-or-seems-to-stall/) e prejudicar os tempos de resposta.</span><span class="sxs-lookup"><span data-stu-id="557e9-116">Many synchronous blocking calls leads to [Thread Pool starvation](https://blogs.msdn.microsoft.com/vancem/2018/10/16/diagnosing-net-core-threadpool-starvation-with-perfview-why-my-service-is-not-saturating-all-cores-or-seems-to-stall/) and degrading response times.</span></span>

<span data-ttu-id="557e9-117">**Não**:</span><span class="sxs-lookup"><span data-stu-id="557e9-117">**Do not**:</span></span>

* <span data-ttu-id="557e9-118">Bloquear a execução assíncrona chamando [Task. wait](/dotnet/api/system.threading.tasks.task.wait) ou [Task. Result](/dotnet/api/system.threading.tasks.task-1.result).</span><span class="sxs-lookup"><span data-stu-id="557e9-118">Block asynchronous execution by calling [Task.Wait](/dotnet/api/system.threading.tasks.task.wait) or [Task.Result](/dotnet/api/system.threading.tasks.task-1.result).</span></span>
* <span data-ttu-id="557e9-119">Adquira bloqueios em caminhos de código comum.</span><span class="sxs-lookup"><span data-stu-id="557e9-119">Acquire locks in common code paths.</span></span> <span data-ttu-id="557e9-120">Aplicativos ASP.NET Core são mais eficazes quando projetado para executar código em paralelo.</span><span class="sxs-lookup"><span data-stu-id="557e9-120">ASP.NET Core apps are most performant when architected to run code in parallel.</span></span>

<span data-ttu-id="557e9-121">**Fazer**:</span><span class="sxs-lookup"><span data-stu-id="557e9-121">**Do**:</span></span>

* <span data-ttu-id="557e9-122">Tornar [hot caminhos de código](#hot) assíncrona.</span><span class="sxs-lookup"><span data-stu-id="557e9-122">Make [hot code paths](#hot) asynchronous.</span></span>
* <span data-ttu-id="557e9-123">Chame APIs de operações de longa execução e de acesso a dados de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="557e9-123">Call data access and long-running operations APIs asynchronously.</span></span>
* <span data-ttu-id="557e9-124">Tornar o controlador/Razor ações de página assíncrono.</span><span class="sxs-lookup"><span data-stu-id="557e9-124">Make controller/Razor Page actions asynchronous.</span></span> <span data-ttu-id="557e9-125">A pilha de chamadas inteira precisa ser assíncrono para se beneficiar da [async/await](/dotnet/csharp/programming-guide/concepts/async/) padrões.</span><span class="sxs-lookup"><span data-stu-id="557e9-125">The entire call stack needs to be asynchronous in order to benefit from [async/await](/dotnet/csharp/programming-guide/concepts/async/) patterns.</span></span>

<span data-ttu-id="557e9-126">Como um criador de perfil [PerfView](https://github.com/Microsoft/perfview) pode ser usado para procurar por segmentos com frequência que está sendo adicionados para o [Pool de threads](/windows/desktop/procthread/thread-pool).</span><span class="sxs-lookup"><span data-stu-id="557e9-126">A profiler like [PerfView](https://github.com/Microsoft/perfview) can be used to look for threads frequently being added to the [Thread Pool](/windows/desktop/procthread/thread-pool).</span></span> <span data-ttu-id="557e9-127">O `Microsoft-Windows-DotNETRuntime/ThreadPoolWorkerThread/Start` evento indica que um thread que está sendo adicionado ao pool de threads.</span><span class="sxs-lookup"><span data-stu-id="557e9-127">The `Microsoft-Windows-DotNETRuntime/ThreadPoolWorkerThread/Start` event indicates a thread being added to the thread pool.</span></span> <!--  For more information, see [async guidance docs](TBD-Link_To_Davifowl_Doc  -->

## <a name="minimize-large-object-allocations"></a><span data-ttu-id="557e9-128">Minimizar as alocações de objeto grande</span><span class="sxs-lookup"><span data-stu-id="557e9-128">Minimize large object allocations</span></span>

<span data-ttu-id="557e9-129"><!-- TODO review Bill - replaced original .NET language below with .NET Core since this targets .NET Core --> O [coletor de lixo do .NET Core](/dotnet/standard/garbage-collection/) gerencia a alocação e liberação de memória automaticamente em aplicativos ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="557e9-129"><!-- TODO review Bill - replaced original .NET language below with .NET Core since this targets .NET Core --> The [.NET Core garbage collector](/dotnet/standard/garbage-collection/) manages allocation and release of memory automatically in ASP.NET Core apps.</span></span> <span data-ttu-id="557e9-130">Coleta de lixo automática geralmente significa que os desenvolvedores não precisam se preocupar sobre como ou quando a memória é liberada.</span><span class="sxs-lookup"><span data-stu-id="557e9-130">Automatic garbage collection generally means that developers don't need to worry about how or when memory is freed.</span></span> <span data-ttu-id="557e9-131">No entanto, limpeza de objetos não referenciados leva tempo de CPU, portanto, os desenvolvedores devem minimizar alocando objetos no [hot caminhos de código](#hot).</span><span class="sxs-lookup"><span data-stu-id="557e9-131">However, cleaning up unreferenced objects takes CPU time, so developers should minimize allocating objects in [hot code paths](#hot).</span></span> <span data-ttu-id="557e9-132">Coleta de lixo é especialmente dispendiosa em objetos grandes (> 85 mil bytes).</span><span class="sxs-lookup"><span data-stu-id="557e9-132">Garbage collection is especially expensive on large objects (> 85 K bytes).</span></span> <span data-ttu-id="557e9-133">Objetos grandes são armazenados na [heap de objeto grande](/dotnet/standard/garbage-collection/large-object-heap) e exigem uma completa (geração 2) a coleta de lixo para limpar.</span><span class="sxs-lookup"><span data-stu-id="557e9-133">Large objects are stored on the [large object heap](/dotnet/standard/garbage-collection/large-object-heap) and require a full (generation 2) garbage collection to clean up.</span></span> <span data-ttu-id="557e9-134">Ao contrário de geração 0 e coletas da geração 1, uma coleta de geração 2 requer a execução do aplicativo ser temporariamente suspenso.</span><span class="sxs-lookup"><span data-stu-id="557e9-134">Unlike generation 0 and generation 1 collections, a generation 2 collection requires app execution to be temporarily suspended.</span></span> <span data-ttu-id="557e9-135">Frequente alocação e desalocação de objetos grandes podem causar inconsistência do desempenho.</span><span class="sxs-lookup"><span data-stu-id="557e9-135">Frequent allocation and de-allocation of large objects can cause inconsistent performance.</span></span>

<span data-ttu-id="557e9-136">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="557e9-136">Recommendations:</span></span>

* <span data-ttu-id="557e9-137">**Fazer** armazenar em cache os objetos grandes que são usados com frequência.</span><span class="sxs-lookup"><span data-stu-id="557e9-137">**Do** consider caching large objects that are frequently used.</span></span> <span data-ttu-id="557e9-138">O cache de objetos grandes evita alocações caras.</span><span class="sxs-lookup"><span data-stu-id="557e9-138">Caching large objects prevents expensive allocations.</span></span>
* <span data-ttu-id="557e9-139">**Fazer** pool de buffers usando um [ `ArrayPool<T>` ](/dotnet/api/system.buffers.arraypool-1) para armazenar as matrizes grandes.</span><span class="sxs-lookup"><span data-stu-id="557e9-139">**Do** pool buffers by using an [`ArrayPool<T>`](/dotnet/api/system.buffers.arraypool-1) to store large arrays.</span></span>
* <span data-ttu-id="557e9-140">**Não o fazem** alocar curta duração, muitos objetos grandes na [hot caminhos de código](#hot).</span><span class="sxs-lookup"><span data-stu-id="557e9-140">**Do not** allocate many, short-lived large objects on [hot code paths](#hot).</span></span>

<span data-ttu-id="557e9-141">Problemas de memória, como anterior pode ser diagnosticado ao examinar estatísticas de (GC) coleta de lixo na [PerfView](https://github.com/Microsoft/perfview) e examinando:</span><span class="sxs-lookup"><span data-stu-id="557e9-141">Memory issues like the preceding can be diagnosed by reviewing garbage collection (GC) stats in [PerfView](https://github.com/Microsoft/perfview) and examining:</span></span>

* <span data-ttu-id="557e9-142">Tempo de pausa da coleta de lixo.</span><span class="sxs-lookup"><span data-stu-id="557e9-142">Garbage collection pause time.</span></span>
* <span data-ttu-id="557e9-143">Qual é a porcentagem do tempo do processador é gasto na coleta de lixo.</span><span class="sxs-lookup"><span data-stu-id="557e9-143">What percentage of the processor time is spent in garbage collection.</span></span>
* <span data-ttu-id="557e9-144">Quantas coletas de lixo são a geração 0, 1 e 2.</span><span class="sxs-lookup"><span data-stu-id="557e9-144">How many garbage collections are generation 0, 1, and 2.</span></span>

<span data-ttu-id="557e9-145">Para obter mais informações, consulte [coleta de lixo e desempenho](/dotnet/standard/garbage-collection/performance).</span><span class="sxs-lookup"><span data-stu-id="557e9-145">For more information, see [Garbage Collection and Performance](/dotnet/standard/garbage-collection/performance).</span></span>

## <a name="optimize-data-access"></a><span data-ttu-id="557e9-146">Otimizar o acesso a dados</span><span class="sxs-lookup"><span data-stu-id="557e9-146">Optimize Data Access</span></span>

<span data-ttu-id="557e9-147">Interações com um armazenamento de dados ou outros serviços remotos costumam ser a parte mais lenta de um aplicativo ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="557e9-147">Interactions with a data store or other remote services are often the slowest part of an ASP.NET Core app.</span></span> <span data-ttu-id="557e9-148">Ler e gravar dados com eficiência é essencial para um bom desempenho.</span><span class="sxs-lookup"><span data-stu-id="557e9-148">Reading and writing data efficiently is critical for good performance.</span></span>

<span data-ttu-id="557e9-149">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="557e9-149">Recommendations:</span></span>

* <span data-ttu-id="557e9-150">**Fazer** chamar APIs de acesso a todos os dados de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="557e9-150">**Do** call all data access APIs asynchronously.</span></span>
* <span data-ttu-id="557e9-151">**Não** recuperar mais dados do que é necessário.</span><span class="sxs-lookup"><span data-stu-id="557e9-151">**Do not** retrieve more data than is necessary.</span></span> <span data-ttu-id="557e9-152">Escreva consultas para retornar apenas os dados que é necessários para a solicitação HTTP atual.</span><span class="sxs-lookup"><span data-stu-id="557e9-152">Write queries to return just the data that is necessary for the current HTTP request.</span></span>
* <span data-ttu-id="557e9-153">**Fazer** considere cache frequentemente acessado dados recuperados de um banco de dados ou serviço remoto, se for aceitável para os dados sejam um pouco desatualizadas.</span><span class="sxs-lookup"><span data-stu-id="557e9-153">**Do** consider caching frequently accessed data retrieved from a database or remote service if it is acceptable for the data to be slightly out-of-date.</span></span> <span data-ttu-id="557e9-154">Dependendo do cenário, você pode usar um [MemoryCache](xref:performance/caching/memory) ou um [DistributedCache](xref:performance/caching/distributed).</span><span class="sxs-lookup"><span data-stu-id="557e9-154">Depending on the scenario, you might use a [MemoryCache](xref:performance/caching/memory) or a [DistributedCache](xref:performance/caching/distributed).</span></span> <span data-ttu-id="557e9-155">Para obter mais informações, consulte <xref:performance/caching/response>.</span><span class="sxs-lookup"><span data-stu-id="557e9-155">For more information, see <xref:performance/caching/response>.</span></span>
* <span data-ttu-id="557e9-156">Minimizar viagens de ida e volta de rede.</span><span class="sxs-lookup"><span data-stu-id="557e9-156">Minimize network round trips.</span></span> <span data-ttu-id="557e9-157">O objetivo é recuperar todos os dados que serão necessários em uma única chamada, em vez de várias chamadas.</span><span class="sxs-lookup"><span data-stu-id="557e9-157">The goal is to retrieve all the data that will be needed in a single call rather than several calls.</span></span>
* <span data-ttu-id="557e9-158">**Fazer** usar [consultas sem controle](/ef/core/querying/tracking#no-tracking-queries) no Entity Framework Core ao acessar dados para propósitos de somente leitura.</span><span class="sxs-lookup"><span data-stu-id="557e9-158">**Do** use [no-tracking queries](/ef/core/querying/tracking#no-tracking-queries) in Entity Framework Core when accessing data for read-only purposes.</span></span> <span data-ttu-id="557e9-159">O EF Core pode retornar os resultados de consultas sem controle com mais eficiência.</span><span class="sxs-lookup"><span data-stu-id="557e9-159">EF Core can return the results of no-tracking queries more efficiently.</span></span>
* <span data-ttu-id="557e9-160">**Fazer** filtro e consultas de agregação LINQ (com `.Where`, `.Select`, ou `.Sum` instruções, por exemplo) para que a filtragem é feita pelo banco de dados.</span><span class="sxs-lookup"><span data-stu-id="557e9-160">**Do** filter and aggregate LINQ queries (with `.Where`, `.Select`, or `.Sum` statements, for example) so that the filtering is done by the database.</span></span>
* <span data-ttu-id="557e9-161">**Fazer** considerar que o EF Core resolve alguns operadores de consulta no cliente, que pode levar à execução de consulta ineficiente.</span><span class="sxs-lookup"><span data-stu-id="557e9-161">**Do** consider that EF Core resolves some query operators on the client, which may lead to inefficient query execution.</span></span> <span data-ttu-id="557e9-162">Para obter mais informações, consulte [problemas de desempenho de avaliação do cliente](/ef/core/querying/client-eval#client-evaluation-performance-issues)</span><span class="sxs-lookup"><span data-stu-id="557e9-162">For more information, see [Client evaluation performance issues](/ef/core/querying/client-eval#client-evaluation-performance-issues)</span></span>
* <span data-ttu-id="557e9-163">**Não** usar consultas de projeção em coleções, que podem resultar na execução de "N + 1" consultas SQL.</span><span class="sxs-lookup"><span data-stu-id="557e9-163">**Do not** use projection queries on collections, which can result in executing "N + 1" SQL queries.</span></span> <span data-ttu-id="557e9-164">Para obter mais informações, consulte [otimização de subconsultas correlacionadas](/ef/core/what-is-new/ef-core-2.1#optimization-of-correlated-subqueries).</span><span class="sxs-lookup"><span data-stu-id="557e9-164">For more information, see [Optimization of correlated subqueries](/ef/core/what-is-new/ef-core-2.1#optimization-of-correlated-subqueries).</span></span>

<span data-ttu-id="557e9-165">Ver [EF alto desempenho](/ef/core/what-is-new/ef-core-2.0#explicitly-compiled-queries) para abordagens que podem melhorar o desempenho em aplicativos de alta escala:</span><span class="sxs-lookup"><span data-stu-id="557e9-165">See [EF High Performance](/ef/core/what-is-new/ef-core-2.0#explicitly-compiled-queries) for approaches that may improve performance in high-scale apps:</span></span>

* [<span data-ttu-id="557e9-166">Pool de DbContext</span><span class="sxs-lookup"><span data-stu-id="557e9-166">DbContext pooling</span></span>](/ef/core/what-is-new/ef-core-2.0#dbcontext-pooling)
* [<span data-ttu-id="557e9-167">Consultas explicitamente compiladas</span><span class="sxs-lookup"><span data-stu-id="557e9-167">Explicitly compiled queries</span></span>](/ef/core/what-is-new/ef-core-2.0#explicitly-compiled-queries)

<span data-ttu-id="557e9-168">É recomendável que você mede o impacto das abordagens de alto desempenho anteriores antes de confirmar sua base de código.</span><span class="sxs-lookup"><span data-stu-id="557e9-168">We recommend you measure the impact of the preceding high-performance approaches before committing to your code base.</span></span> <span data-ttu-id="557e9-169">A complexidade adicional de consultas compiladas pode não justificar a melhoria de desempenho.</span><span class="sxs-lookup"><span data-stu-id="557e9-169">The additional complexity of compiled queries may not justify the performance improvement.</span></span>

<span data-ttu-id="557e9-170">Consulta problemas podem ser detectados, examinando o tempo gasto acesso a dados com [Application Insights](/azure/application-insights/app-insights-overview) ou com ferramentas de criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="557e9-170">Query issues can be detected by reviewing time spent accessing data with [Application Insights](/azure/application-insights/app-insights-overview) or with profiling tools.</span></span> <span data-ttu-id="557e9-171">A maioria dos bancos de dados também disponibilizar as estatísticas relacionadas a consultas executadas com frequência.</span><span class="sxs-lookup"><span data-stu-id="557e9-171">Most databases also make statistics available concerning frequently executed queries.</span></span>

## <a name="pool-http-connections-with-httpclientfactory"></a><span data-ttu-id="557e9-172">HTTP do pool de conexões com HttpClientFactory</span><span class="sxs-lookup"><span data-stu-id="557e9-172">Pool HTTP connections with HttpClientFactory</span></span>

<span data-ttu-id="557e9-173">Embora [HttpClient](/dotnet/api/system.net.http.httpclient?view=netstandard-2.0) implementa o `IDisposable` interface, que ele foi projetado para ser reutilizado.</span><span class="sxs-lookup"><span data-stu-id="557e9-173">Although [HttpClient](/dotnet/api/system.net.http.httpclient?view=netstandard-2.0) implements the `IDisposable` interface, it's meant to be reused.</span></span> <span data-ttu-id="557e9-174">Fechado `HttpClient` instâncias deixe soquetes abertos no `TIME_WAIT` estado por um curto período de tempo.</span><span class="sxs-lookup"><span data-stu-id="557e9-174">Closed `HttpClient` instances leave sockets open in the `TIME_WAIT` state for a short period of time.</span></span> <span data-ttu-id="557e9-175">Consequentemente, se um caminho de código que cria e descarta `HttpClient` objetos é usado com frequência, o aplicativo pode esgotar soquetes disponíveis.</span><span class="sxs-lookup"><span data-stu-id="557e9-175">Consequently, if a code path that creates and disposes of `HttpClient` objects is frequently used, the app may exhaust available sockets.</span></span> <span data-ttu-id="557e9-176">[HttpClientFactory](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests) foi introduzido no ASP.NET Core 2.1 como uma solução para esse problema.</span><span class="sxs-lookup"><span data-stu-id="557e9-176">[HttpClientFactory](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests) was introduced in ASP.NET Core 2.1 as a solution to this problem.</span></span> <span data-ttu-id="557e9-177">Ele lida com o pooling de conexões de HTTP para otimizar o desempenho e confiabilidade.</span><span class="sxs-lookup"><span data-stu-id="557e9-177">It handles pooling HTTP connections to optimize performance and reliability.</span></span>

<span data-ttu-id="557e9-178">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="557e9-178">Recommendations:</span></span>

* <span data-ttu-id="557e9-179">**Não o fazem** criar e descartar `HttpClient` instâncias diretamente.</span><span class="sxs-lookup"><span data-stu-id="557e9-179">**Do not** create and dispose of `HttpClient` instances directly.</span></span>
* <span data-ttu-id="557e9-180">**Fazer** usar [HttpClientFactory](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests) recuperar `HttpClient` instâncias.</span><span class="sxs-lookup"><span data-stu-id="557e9-180">**Do** use [HttpClientFactory](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests) to retrieve `HttpClient` instances.</span></span> <span data-ttu-id="557e9-181">Para obter mais informações, consulte [HttpClientFactory de uso para implementar as solicitações HTTP resilientes](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests).</span><span class="sxs-lookup"><span data-stu-id="557e9-181">For more information, see [Use HttpClientFactory to implement resilient HTTP requests](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests).</span></span>

## <a name="keep-common-code-paths-fast"></a><span data-ttu-id="557e9-182">Manter os caminhos de código comuns rápidos</span><span class="sxs-lookup"><span data-stu-id="557e9-182">Keep common code paths fast</span></span>

<span data-ttu-id="557e9-183">Você deseja que todos os seus códigos para ser rápido, mas caminhos de código chamado com frequência são mais importantes para otimizar:</span><span class="sxs-lookup"><span data-stu-id="557e9-183">You want all of your code to be fast, but frequently called code paths are the most critical to optimize:</span></span>

* <span data-ttu-id="557e9-184">Componentes de middleware no pipeline de processamento de solicitação do aplicativo, especialmente middleware executado no início do pipeline.</span><span class="sxs-lookup"><span data-stu-id="557e9-184">Middleware components in the app's request processing pipeline, especially middleware run early in the pipeline.</span></span> <span data-ttu-id="557e9-185">Esses componentes têm um grande impacto no desempenho.</span><span class="sxs-lookup"><span data-stu-id="557e9-185">These components have a large impact on performance.</span></span>
* <span data-ttu-id="557e9-186">Código que é executado para cada solicitação ou várias vezes por solicitação.</span><span class="sxs-lookup"><span data-stu-id="557e9-186">Code that is executed for every request or multiple times per request.</span></span> <span data-ttu-id="557e9-187">Por exemplo, registro em log personalizado, manipuladores de autorização ou inicialização de serviços temporários.</span><span class="sxs-lookup"><span data-stu-id="557e9-187">For example, custom logging, authorization handlers, or initialization of transient services.</span></span>

<span data-ttu-id="557e9-188">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="557e9-188">Recommendations:</span></span>

* <span data-ttu-id="557e9-189">**Não** usar componentes de middleware personalizado com tarefas de longa execução.</span><span class="sxs-lookup"><span data-stu-id="557e9-189">**Do not** use custom middleware components with long-running tasks.</span></span>
* <span data-ttu-id="557e9-190">**Fazer** usar ferramentas de criação de perfil de desempenho (como [ferramentas de diagnóstico Visual Studio](/visualstudio/profiling/profiling-feature-tour) ou [PerfView](https://github.com/Microsoft/perfview)) para identificar [hot caminhos de código](#hot).</span><span class="sxs-lookup"><span data-stu-id="557e9-190">**Do** use performance profiling tools (like [Visual Studio Diagnostic Tools](/visualstudio/profiling/profiling-feature-tour) or [PerfView](https://github.com/Microsoft/perfview)) to identify [hot code paths](#hot).</span></span>

## <a name="complete-long-running-tasks-outside-of-http-requests"></a><span data-ttu-id="557e9-191">Concluir tarefas de execução longa fora de solicitações HTTP</span><span class="sxs-lookup"><span data-stu-id="557e9-191">Complete long-running Tasks outside of HTTP requests</span></span>

<span data-ttu-id="557e9-192">A maioria das solicitações para um aplicativo ASP.NET Core podem ser tratadas por um controlador ou o modelo de página chamando serviços necessários e retornando uma resposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="557e9-192">Most requests to an ASP.NET Core app can be handled by a controller or page model calling necessary services and returning an HTTP response.</span></span> <span data-ttu-id="557e9-193">Para algumas solicitações que envolvem tarefas de longa execução, é melhor tornar o processo de solicitação-resposta inteira assíncrona.</span><span class="sxs-lookup"><span data-stu-id="557e9-193">For some requests that involve long-running tasks, it's better to make the entire request-response process asynchronous.</span></span>

<span data-ttu-id="557e9-194">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="557e9-194">Recommendations:</span></span>

* <span data-ttu-id="557e9-195">**Não** Aguarde até que as tarefas de longa execução ser concluída como parte do processamento de solicitação HTTP comuns.</span><span class="sxs-lookup"><span data-stu-id="557e9-195">**Do not** wait for long-running tasks to complete as part of ordinary HTTP request processing.</span></span>
* <span data-ttu-id="557e9-196">**Fazer** considere a manipulação de solicitações de execução longa com [serviços em segundo plano](/aspnet/core/fundamentals/host/hosted-services) ou fora do processo com um [Azure Function](/azure/azure-functions/).</span><span class="sxs-lookup"><span data-stu-id="557e9-196">**Do** consider handling long-running requests with [background services](/aspnet/core/fundamentals/host/hosted-services) or out of process with an [Azure Function](/azure/azure-functions/).</span></span> <span data-ttu-id="557e9-197">A conclusão do trabalho fora do processo é especialmente útil para tarefas de uso intensivo de CPU.</span><span class="sxs-lookup"><span data-stu-id="557e9-197">Completing work out-of-process is especially beneficial for CPU-intensive tasks.</span></span>
* <span data-ttu-id="557e9-198">**Fazer** use opções de comunicação em tempo real, como [SignalR](xref:signalr/introduction) para se comunicar com clientes de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="557e9-198">**Do** use real-time communication options like [SignalR](xref:signalr/introduction) to communicate with clients asynchronously.</span></span>

## <a name="minify-client-assets"></a><span data-ttu-id="557e9-199">Minificar ativos do cliente</span><span class="sxs-lookup"><span data-stu-id="557e9-199">Minify client assets</span></span>

<span data-ttu-id="557e9-200">Aplicativos ASP.NET Core com front-ends complexos com frequência servem muitos JavaScript, CSS ou arquivos de imagem.</span><span class="sxs-lookup"><span data-stu-id="557e9-200">ASP.NET Core apps with complex front-ends frequently serve many JavaScript, CSS, or image files.</span></span> <span data-ttu-id="557e9-201">Desempenho de solicitações de carga inicial pode ser melhorado por:</span><span class="sxs-lookup"><span data-stu-id="557e9-201">Performance of initial load requests can be improved by:</span></span>

* <span data-ttu-id="557e9-202">O agrupamento, que combina vários arquivos em um.</span><span class="sxs-lookup"><span data-stu-id="557e9-202">Bundling, which combines multiple files into one.</span></span>
* <span data-ttu-id="557e9-203">Minificação, que reduz o tamanho dos arquivos por.</span><span class="sxs-lookup"><span data-stu-id="557e9-203">Minifying, which reduces the size of files by.</span></span>

<span data-ttu-id="557e9-204">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="557e9-204">Recommendations:</span></span>

* <span data-ttu-id="557e9-205">**Fazer** usar o ASP.NET Core [suporte interno](xref:client-side/bundling-and-minification) para agrupamento e minificação de ativos de cliente.</span><span class="sxs-lookup"><span data-stu-id="557e9-205">**Do** use ASP.NET Core's [built-in support](xref:client-side/bundling-and-minification) for bundling and minifying client assets.</span></span>
* <span data-ttu-id="557e9-206">**Fazer** considerar outras ferramentas de terceiros, como [Gulp](uid:client-side/bundling-and-minification#consume-bundleconfigjson-from-gulp) ou [Webpack](https://webpack.js.org/) para gerenciamento de ativos mais complexo do cliente.</span><span class="sxs-lookup"><span data-stu-id="557e9-206">**Do** consider other third-party tools like [Gulp](uid:client-side/bundling-and-minification#consume-bundleconfigjson-from-gulp) or [Webpack](https://webpack.js.org/) for more complex client asset management.</span></span>

## <a name="compress-responses"></a><span data-ttu-id="557e9-207">Compactar respostas</span><span class="sxs-lookup"><span data-stu-id="557e9-207">Compress responses</span></span>

 <span data-ttu-id="557e9-208">Reduzindo o tamanho da resposta geralmente aumenta a capacidade de resposta de um aplicativo, muitas vezes drasticamente.</span><span class="sxs-lookup"><span data-stu-id="557e9-208">Reducing the size of the response usually increases the responsiveness of an app, often dramatically.</span></span> <span data-ttu-id="557e9-209">É uma maneira de reduzir os tamanhos do conteúdo compactar respostas do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="557e9-209">One way to reduce payload sizes is to compress an app's responses.</span></span> <span data-ttu-id="557e9-210">Para obter mais informações, consulte [compactação de resposta](xref:performance/response-compression).</span><span class="sxs-lookup"><span data-stu-id="557e9-210">For more information, see [Response compression](xref:performance/response-compression).</span></span>

## <a name="use-the-latest-aspnet-core-release"></a><span data-ttu-id="557e9-211">Use a versão mais recente do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="557e9-211">Use the latest ASP.NET Core release</span></span>

<span data-ttu-id="557e9-212">Cada nova versão do ASP.NET inclui aprimoramentos de desempenho.</span><span class="sxs-lookup"><span data-stu-id="557e9-212">Each new release of ASP.NET includes performance improvements.</span></span> <span data-ttu-id="557e9-213">Otimizações no .NET Core e ASP.NET Core significam que versões mais recentes superará as versões mais antigas.</span><span class="sxs-lookup"><span data-stu-id="557e9-213">Optimizations in .NET Core and ASP.NET Core mean that newer versions will outperform older versions.</span></span> <span data-ttu-id="557e9-214">Por exemplo, o .NET Core 2.1 adicionado suporte para expressões regulares compiladas e se beneficiaram [ `Span<T>` ](https://msdn.microsoft.com/magazine/mt814808.aspx).</span><span class="sxs-lookup"><span data-stu-id="557e9-214">For example, .NET Core 2.1 added support for compiled regular expressions and benefitted from [`Span<T>`](https://msdn.microsoft.com/magazine/mt814808.aspx).</span></span> <span data-ttu-id="557e9-215">Suporte do ASP.NET Core 2.2 adicionado para HTTP/2.</span><span class="sxs-lookup"><span data-stu-id="557e9-215">ASP.NET Core 2.2 added support for HTTP/2.</span></span> <span data-ttu-id="557e9-216">Se o desempenho for uma prioridade, considere atualizar para a versão mais atual do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="557e9-216">If performance is a priority, consider upgrading to the most current version of ASP.NET Core.</span></span>

<!-- TODO review link and taking advantage of new [performance features](#TBD)
Maybe skip this TBD link as each version will have perf improvements -->

## <a name="minimize-exceptions"></a><span data-ttu-id="557e9-217">Minimizar as exceções</span><span class="sxs-lookup"><span data-stu-id="557e9-217">Minimize exceptions</span></span>

<span data-ttu-id="557e9-218">As exceções devem ser raras.</span><span class="sxs-lookup"><span data-stu-id="557e9-218">Exceptions should be rare.</span></span> <span data-ttu-id="557e9-219">Lançar e capturar exceções são lento em relação a outros padrões de fluxo de código.</span><span class="sxs-lookup"><span data-stu-id="557e9-219">Throwing and catching exceptions is slow relative to other code flow patterns.</span></span> <span data-ttu-id="557e9-220">Por causa disso, as exceções não devem ser usadas para controlar o fluxo normal do programa.</span><span class="sxs-lookup"><span data-stu-id="557e9-220">Because of this, exceptions should not be used to control normal program flow.</span></span>

<span data-ttu-id="557e9-221">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="557e9-221">Recommendations:</span></span>

* <span data-ttu-id="557e9-222">**Não** uso gerar ou capturar exceções como um meio de fluxo normal do programa, especialmente em caminhos de código a quente.</span><span class="sxs-lookup"><span data-stu-id="557e9-222">**Do not** use throwing or catching exceptions as a means of normal program flow, especially in hot code paths.</span></span>
* <span data-ttu-id="557e9-223">**Fazer** incluir lógica no aplicativo para detectar e lidar com condições que poderiam causar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="557e9-223">**Do** include logic in the app to detect and handle conditions that would cause an exception.</span></span>
* <span data-ttu-id="557e9-224">**Fazer** lançar ou capturar exceções para condições incomuns ou inesperadas.</span><span class="sxs-lookup"><span data-stu-id="557e9-224">**Do** throw or catch exceptions for unusual or unexpected conditions.</span></span>

<span data-ttu-id="557e9-225">Ferramentas de diagnóstico de aplicativo (como o Application Insights) podem ajudar a identificar exceções comuns em um aplicativo que podem afetar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="557e9-225">App diagnostic tools (like Application Insights) can help to identify common exceptions in an application which may affect performance.</span></span>
