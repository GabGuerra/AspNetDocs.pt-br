---
title: Validação de modelo no ASP.NET Core MVC
author: tdykstra
description: Saiba mais sobre a validação do modelo no ASP.NET Core MVC.
ms.author: riande
ms.custom: mvc
ms.date: 01/14/2019
uid: mvc/models/validation
ms.openlocfilehash: ca7ee54b8e6b6ae5091b0cb133e448ad9c04da8f
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57049063"
---
# <a name="model-validation-in-aspnet-core-mvc"></a><span data-ttu-id="ec6a2-103">Validação de modelo no ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="ec6a2-103">Model validation in ASP.NET Core MVC</span></span>

<span data-ttu-id="ec6a2-104">Por [Rachel Appel](https://github.com/rachelappel)</span><span class="sxs-lookup"><span data-stu-id="ec6a2-104">By [Rachel Appel](https://github.com/rachelappel)</span></span>

## <a name="introduction-to-model-validation"></a><span data-ttu-id="ec6a2-105">Introdução à validação do modelo</span><span class="sxs-lookup"><span data-stu-id="ec6a2-105">Introduction to model validation</span></span>

<span data-ttu-id="ec6a2-106">Antes que um aplicativo armazene dados em um banco de dados, ele deve validá-los.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-106">Before an app stores data in a database, the app must validate the data.</span></span> <span data-ttu-id="ec6a2-107">Os dados precisam ser verificados quanto a possíveis ameaças de segurança, se estão formatados corretamente por tipo e tamanho e precisam estar em conformidade com as regras.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-107">Data must be checked for potential security threats, verified that it's appropriately formatted by type and size, and it must conform to your rules.</span></span> <span data-ttu-id="ec6a2-108">A validação é necessária, embora possa ser redundante e monótona de ser implementada.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-108">Validation is necessary although it can be redundant and tedious to implement.</span></span> <span data-ttu-id="ec6a2-109">No MVC, a validação ocorre no cliente e no servidor.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-109">In MVC, validation happens on both the client and server.</span></span>

<span data-ttu-id="ec6a2-110">Felizmente, o .NET abstraiu a validação para atributos de validação.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-110">Fortunately, .NET has abstracted validation into validation attributes.</span></span> <span data-ttu-id="ec6a2-111">Esses atributos contêm o código de validação, reduzindo a quantidade de código que precisa ser escrita.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-111">These attributes contain validation code, thereby reducing the amount of code you must write.</span></span>

<span data-ttu-id="ec6a2-112">No ASP.NET Core 2.2 e posterior, o tempo de execução do ASP.NET Core encurta a validação (ignora) se puder determinar que um determinado gráfico de modelo não requer validação.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-112">In ASP.NET Core 2.2 and later, the ASP.NET Core runtime short-circuits (skips) validation if it can determine that a given model graph doesn't require validation.</span></span> <span data-ttu-id="ec6a2-113">Ignorar a validação pode fornecer melhorias significativas no desempenho ao validar modelos que não podem ou não tem nenhum validador associado.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-113">Skipping validation can provide significant performance improvements when validating models that cannot or do not have any associated validators.</span></span> <span data-ttu-id="ec6a2-114">A validação ignorada inclui objetos, como coleções de primitivos (`byte[]`, `string[]`, `Dictionary<string, string>` etc.) ou grafos de objeto complexo sem nenhum validador.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-114">The skipped validation includes objects such as collections of primitives (`byte[]`, `string[]`, `Dictionary<string, string>`, etc.), or complex object graphs without any validators.</span></span>

<span data-ttu-id="ec6a2-115">[Exibir ou baixar amostra do GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span><span class="sxs-lookup"><span data-stu-id="ec6a2-115">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span></span>

## <a name="validation-attributes"></a><span data-ttu-id="ec6a2-116">Atributos de validação</span><span class="sxs-lookup"><span data-stu-id="ec6a2-116">Validation Attributes</span></span>

<span data-ttu-id="ec6a2-117">Os atributos de validação são uma maneira de configurar a validação do modelo; portanto, é conceitualmente semelhante à validação em campos de tabelas de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-117">Validation attributes are a way to configure model validation so it's similar conceptually to validation on fields in database tables.</span></span> <span data-ttu-id="ec6a2-118">Isso inclui restrições, como atribuição de tipos de dados ou campos obrigatórios.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-118">This includes constraints such as assigning data types or required fields.</span></span> <span data-ttu-id="ec6a2-119">Outros tipos de validação incluem a aplicação de padrões a dados para impor regras de negócio, como um cartão de crédito, número de telefone ou endereço de email.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-119">Other types of validation include applying patterns to data to enforce business rules, such as a credit card, phone number, or email address.</span></span> <span data-ttu-id="ec6a2-120">Os atributos de validação simplificam e facilitam o uso da imposição desses requisitos.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-120">Validation attributes make enforcing these requirements much simpler and easier to use.</span></span>

<span data-ttu-id="ec6a2-121">Os atributos de validação são especificados no nível da propriedade:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-121">Validation attributes are specified at the property level:</span></span> 

```csharp
[Required]
public string MyProperty { get; set; }
```

<span data-ttu-id="ec6a2-122">Veja abaixo um modelo `Movie` anotado de um aplicativo que armazena informações sobre filmes e programas de TV.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-122">Below is an annotated `Movie` model from an app that stores information about movies and TV shows.</span></span> <span data-ttu-id="ec6a2-123">A maioria das propriedades é obrigatória e várias propriedades de cadeia de caracteres têm requisitos de tamanho.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-123">Most of the properties are required and several string properties have length requirements.</span></span> <span data-ttu-id="ec6a2-124">Além disso, há uma restrição de intervalo numérico em vigor para a propriedade `Price` de 0 a US$ 999,99, juntamente com um atributo de validação personalizado.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-124">Additionally, there's a numeric range restriction in place for the `Price` property from 0 to $999.99, along with a custom validation attribute.</span></span>

[!code-csharp[](validation/sample/Movie.cs?range=6-29)]

<span data-ttu-id="ec6a2-125">A simples leitura do modelo revela as regras sobre os dados para esse aplicativo, facilitando a manutenção do código.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-125">Simply reading through the model reveals the rules about data for this app, making it easier to maintain the code.</span></span> <span data-ttu-id="ec6a2-126">Veja abaixo vários atributos de validação internos populares:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-126">Below are several popular built-in validation attributes:</span></span>

* <span data-ttu-id="ec6a2-127">`[CreditCard]`: valida se a propriedade tem um formato de cartão de crédito.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-127">`[CreditCard]`: Validates the property has a credit card format.</span></span>

* <span data-ttu-id="ec6a2-128">`[Compare]`: valida se duas propriedades em um modelo são correspondentes.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-128">`[Compare]`: Validates two properties in a model match.</span></span>

* <span data-ttu-id="ec6a2-129">`[EmailAddress]`: valida se a propriedade tem um formato de email.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-129">`[EmailAddress]`: Validates the property has an email format.</span></span>

* <span data-ttu-id="ec6a2-130">`[Phone]`: valida se a propriedade tem um formato de telefone.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-130">`[Phone]`: Validates the property has a telephone format.</span></span>

* <span data-ttu-id="ec6a2-131">`[Range]`: valida se o valor da propriedade está dentro do intervalo especificado.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-131">`[Range]`: Validates the property value falls within the given range.</span></span>

* <span data-ttu-id="ec6a2-132">`[RegularExpression]`: valida se os dados correspondem à expressão regular especificada.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-132">`[RegularExpression]`: Validates that the data matches the specified regular expression.</span></span>

* <span data-ttu-id="ec6a2-133">`[Required]`: torna uma propriedade obrigatória.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-133">`[Required]`: Makes a property required.</span></span>

* <span data-ttu-id="ec6a2-134">`[StringLength]`: valida se uma propriedade de cadeia de caracteres tem, no máximo, o tamanho máximo especificado.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-134">`[StringLength]`: Validates that a string property has at most the given maximum length.</span></span>

* <span data-ttu-id="ec6a2-135">`[Url]`: valida se a propriedade tem um formato de URL.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-135">`[Url]`: Validates the property has a URL format.</span></span>

<span data-ttu-id="ec6a2-136">O MVC dá suporte a qualquer atributo derivado de `ValidationAttribute` para fins de validação.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-136">MVC supports any attribute that derives from `ValidationAttribute` for validation purposes.</span></span> <span data-ttu-id="ec6a2-137">Muitos atributos de validação úteis podem ser encontrados no namespace [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations).</span><span class="sxs-lookup"><span data-stu-id="ec6a2-137">Many useful validation attributes can be found in the [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations) namespace.</span></span>

<span data-ttu-id="ec6a2-138">Pode haver ocasiões em que você precisa de mais recursos do que os atributos internos fornecem.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-138">There may be instances where you need more features than built-in attributes provide.</span></span> <span data-ttu-id="ec6a2-139">Para essas ocasiões, é possível criar atributos de validação personalizados pela derivação de `ValidationAttribute` ou alteração do modelo para implementar `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-139">For those times, you can create custom validation attributes by deriving from `ValidationAttribute` or changing your model to implement `IValidatableObject`.</span></span>

## <a name="notes-on-the-use-of-the-required-attribute"></a><span data-ttu-id="ec6a2-140">Observações sobre o uso do atributo Required</span><span class="sxs-lookup"><span data-stu-id="ec6a2-140">Notes on the use of the Required attribute</span></span>

<span data-ttu-id="ec6a2-141">Os [tipos de valor](/dotnet/csharp/language-reference/keywords/value-types) que não permitem valores nulos (como `decimal`, `int`, `float` e `DateTime`) são inerentemente necessários e não precisam do atributo `Required`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-141">Non-nullable [value types](/dotnet/csharp/language-reference/keywords/value-types) (such as `decimal`, `int`, `float`, and `DateTime`) are inherently required and don't need the `Required` attribute.</span></span> <span data-ttu-id="ec6a2-142">O aplicativo não executa nenhuma verificação de validação do lado do servidor para tipos que não permitem valor nulo marcados como `Required`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-142">The app performs no server-side validation checks for non-nullable types that are marked `Required`.</span></span>

<span data-ttu-id="ec6a2-143">O model binding do MVC, que não está preocupado com a validação nem com atributos de validação, rejeita o envio de um campo de formulário que contém um valor ausente ou espaço em branco para um tipo que não permite valor nulo.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-143">MVC model binding, which isn't concerned with validation and validation attributes, rejects a form field submission containing a missing value or whitespace for a non-nullable type.</span></span> <span data-ttu-id="ec6a2-144">Na ausência de um atributo `BindRequired` na propriedade de destino, o model binding ignora dados ausentes para tipos que não permitem valor nulo, nos quais o campo de formulário está ausente nos dados de formulário de entrada.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-144">In the absence of a `BindRequired` attribute on the target property, model binding ignores missing data for non-nullable types, where the form field is absent from the incoming form data.</span></span>

<span data-ttu-id="ec6a2-145">O [atributo BindRequired](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (veja também <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) é útil para garantir que os dados do formulário sejam preenchidos.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-145">The [BindRequired attribute](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (also see <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) is useful to ensure form data is complete.</span></span> <span data-ttu-id="ec6a2-146">Quando aplicado a uma propriedade, o sistema de model binding exige um valor para essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-146">When applied to a property, the model binding system requires a value for that property.</span></span> <span data-ttu-id="ec6a2-147">Quando aplicado a um tipo, o sistema de model binding exige valores para todas as propriedades desse tipo.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-147">When applied to a type, the model binding system requires values for all of the properties of that type.</span></span>

<span data-ttu-id="ec6a2-148">Quando você usa um tipo [Nullable\<T>](/dotnet/csharp/programming-guide/nullable-types/) (por exemplo, `decimal?` ou `System.Nullable<decimal>`) e marca-o como `Required`, é realizada uma verificação de validação do lado do servidor, como se a propriedade fosse um tipo que permite valor nulo padrão (para exemplo, uma `string`).</span><span class="sxs-lookup"><span data-stu-id="ec6a2-148">When you use a [Nullable\<T> type](/dotnet/csharp/programming-guide/nullable-types/) (for example, `decimal?` or `System.Nullable<decimal>`) and mark it `Required`, a server-side validation check is performed as if the property were a standard nullable type (for example, a `string`).</span></span>

<span data-ttu-id="ec6a2-149">A validação do lado do cliente exige um valor para um campo de formulário que corresponde a uma propriedade de modelo que foi marcada como `Required` e para uma propriedade de tipo que não permite valor nulo que ainda não foi marcada como `Required`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-149">Client-side validation requires a value for a form field that corresponds to a model property that you've marked `Required` and for a non-nullable type property that you haven't marked `Required`.</span></span> <span data-ttu-id="ec6a2-150">`Required` pode ser usado para controlar a mensagem de erro de validação do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-150">`Required` can be used to control the client-side validation error message.</span></span>

::: moniker range=">= aspnetcore-2.1"

## <a name="top-level-node-validation"></a><span data-ttu-id="ec6a2-151">Validação de nó de nível superior</span><span class="sxs-lookup"><span data-stu-id="ec6a2-151">Top-level node validation</span></span>

<span data-ttu-id="ec6a2-152">Os nós de nível superior incluem:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-152">Top-level nodes include:</span></span>

* <span data-ttu-id="ec6a2-153">Parâmetros de ação</span><span class="sxs-lookup"><span data-stu-id="ec6a2-153">Action parameters</span></span>
* <span data-ttu-id="ec6a2-154">Propriedades do controlador</span><span class="sxs-lookup"><span data-stu-id="ec6a2-154">Controller properties</span></span>
* <span data-ttu-id="ec6a2-155">Parâmetros do manipulador de página</span><span class="sxs-lookup"><span data-stu-id="ec6a2-155">Page handler parameters</span></span>
* <span data-ttu-id="ec6a2-156">Propriedades do modelo de página</span><span class="sxs-lookup"><span data-stu-id="ec6a2-156">Page model properties</span></span>

<span data-ttu-id="ec6a2-157">Os nós de nível superior associados ao modelo são validados além de validar as propriedades do modelo.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-157">Model-bound top-level nodes are validated in addition to validating model properties.</span></span> <span data-ttu-id="ec6a2-158">No exemplo a seguir do aplicativo de exemplo, o método `VerifyPhone` usa o <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> para validar os dados de usuário no campo de telefone de um formulário:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-158">In the following example from the sample app, the `VerifyPhone` method uses the <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> to validate the user data in the Phone field of a form:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyPhone)]

<span data-ttu-id="ec6a2-159">Os nós de nível superior podem usar <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> com atributos de validação.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-159">Top-level nodes can use <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> with validation attributes.</span></span> <span data-ttu-id="ec6a2-160">No exemplo a seguir do aplicativo de exemplo, o método `CheckAge` especifica que o parâmetro `age` deve ser associado da cadeia de caracteres de consulta quando o formulário é enviado:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-160">In the following example from the sample app, the `CheckAge` method specifies that the `age` parameter must be bound from the query string when the form is submitted:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_CheckAge)]

<span data-ttu-id="ec6a2-161">Na página Verificar Idade (*CheckAge.cshtml*), há dois formulários.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-161">In the Check Age page (*CheckAge.cshtml*), there are two forms.</span></span> <span data-ttu-id="ec6a2-162">O primeiro formulário envia um valor `Age` de `99` como uma cadeia de caracteres de consulta: `https://localhost:5001/Users/CheckAge?Age=99`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-162">The first form submits an `Age` value of `99` as a query string: `https://localhost:5001/Users/CheckAge?Age=99`.</span></span>

<span data-ttu-id="ec6a2-163">Quando um parâmetro `age` formatado corretamente da cadeia de caracteres de consulta é enviado, o formulário é validado.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-163">When a properly formatted `age` parameter from the query string is submitted, the form validates.</span></span>

<span data-ttu-id="ec6a2-164">O segundo formulário na página Verificar Idade envia o valor `Age` no corpo da solicitação e a validação falha.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-164">The second form on the Check Age page submits the `Age` value in the body of the request, and validation fails.</span></span> <span data-ttu-id="ec6a2-165">A associação falha porque o parâmetro `age` deve vir de uma cadeia de caracteres de consulta.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-165">Binding fails because the `age` parameter must come from a query string.</span></span>

<span data-ttu-id="ec6a2-166">A validação é habilitada por padrão e é controlada pela propriedade <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> de <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-166">Validation is enabled by default and controlled by the <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> property of <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span></span> <span data-ttu-id="ec6a2-167">Para desabilitar a validação do nó de nível superior, defina `AllowValidatingTopLevelNodes` como `false` nas opções de MVC (`Startup.ConfigureServices`):</span><span class="sxs-lookup"><span data-stu-id="ec6a2-167">To disable top-level node validation, set `AllowValidatingTopLevelNodes` to `false` in MVC options (`Startup.ConfigureServices`):</span></span>

[!code-csharp[](validation/sample_snapshot/Startup.cs?name=snippet_AddMvc&highlight=4)]

::: moniker-end

## <a name="model-state"></a><span data-ttu-id="ec6a2-168">Estado do modelo</span><span class="sxs-lookup"><span data-stu-id="ec6a2-168">Model State</span></span>

<span data-ttu-id="ec6a2-169">O estado do modelo representa erros de validação nos valores de formulário HTML enviados.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-169">Model state represents validation errors in submitted HTML form values.</span></span>

<span data-ttu-id="ec6a2-170">O MVC continuará validando campos até atingir o número máximo de erros (200 por padrão).</span><span class="sxs-lookup"><span data-stu-id="ec6a2-170">MVC will continue validating fields until it reaches the maximum number of errors (200 by default).</span></span> <span data-ttu-id="ec6a2-171">Você pode configurar esse número com o seguinte código no `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-171">You can configure this number with the following code in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](validation/sample/Startup.cs?name=snippet_MaxModelValidationErrors)]

## <a name="handle-model-state-errors"></a><span data-ttu-id="ec6a2-172">Erros de estado do modelo do identificador</span><span class="sxs-lookup"><span data-stu-id="ec6a2-172">Handle Model State errors</span></span>

<span data-ttu-id="ec6a2-173">A validação de modelo ocorre antes da execução de uma ação de controlador.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-173">Model validation occurs before the execution of a controller action.</span></span> <span data-ttu-id="ec6a2-174">É responsabilidade da ação inspecionar `ModelState.IsValid` e reagir adequadamente.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-174">It's the action's responsibility to inspect `ModelState.IsValid` and react appropriately.</span></span> <span data-ttu-id="ec6a2-175">Em muitos casos, a resposta apropriada é retornar uma resposta de erro, de preferência, fornecendo detalhes sobre o motivo pelo qual houve falha na validação do modelo.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-175">In many cases, the appropriate reaction is to return an error response, ideally detailing the reason why model validation failed.</span></span>

::: moniker range=">= aspnetcore-2.1"

<span data-ttu-id="ec6a2-176">Quando `ModelState.IsValid` for avaliada como `false` em controladores de API Web usando o atributo `[ApiController]`, uma resposta automática HTTP 400 contendo detalhes do problema será retornada.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-176">When `ModelState.IsValid` evaluates to `false` in web API controllers using the `[ApiController]` attribute, an automatic HTTP 400 response containing issue details is returned.</span></span> <span data-ttu-id="ec6a2-177">Para obter mais informações, veja [Respostas automáticas HTTP 400](xref:web-api/index#automatic-http-400-responses).</span><span class="sxs-lookup"><span data-stu-id="ec6a2-177">For more information, see [Automatic HTTP 400 responses](xref:web-api/index#automatic-http-400-responses).</span></span>

::: moniker-end

<span data-ttu-id="ec6a2-178">Alguns aplicativos optarão por seguir uma convenção padrão para lidar com erros de validação do modelo, caso em que um filtro pode ser um local adequado para implementar uma política como essa.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-178">Some apps will choose to follow a standard convention for dealing with model validation errors, in which case a filter may be an appropriate place to implement such a policy.</span></span> <span data-ttu-id="ec6a2-179">É necessário testar o comportamento das ações com estados de modelo válidos e inválidos.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-179">You should test how your actions behave with valid and invalid model states.</span></span>

## <a name="manual-validation"></a><span data-ttu-id="ec6a2-180">Validação manual</span><span class="sxs-lookup"><span data-stu-id="ec6a2-180">Manual validation</span></span>

<span data-ttu-id="ec6a2-181">Após a conclusão da validação e de model binding, recomendamos repetir partes disso.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-181">After model binding and validation are complete, you may want to repeat parts of it.</span></span> <span data-ttu-id="ec6a2-182">Por exemplo, um usuário pode ter inserido um texto em um campo que espera um inteiro ou talvez você precise calcular um valor da propriedade de um modelo.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-182">For example, a user may have entered text in a field expecting an integer, or you may need to compute a value for a model's property.</span></span>

<span data-ttu-id="ec6a2-183">Talvez seja necessário executar a validação manualmente.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-183">You may need to run validation manually.</span></span> <span data-ttu-id="ec6a2-184">Para fazer isso, chame o método `TryValidateModel`, conforme mostrado aqui:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-184">To do so, call the `TryValidateModel` method, as shown here:</span></span>

[!code-csharp[](validation/sample/MoviesController.cs?name=snippet_TryValidateModel)]

## <a name="custom-validation"></a><span data-ttu-id="ec6a2-185">Validação personalizada</span><span class="sxs-lookup"><span data-stu-id="ec6a2-185">Custom validation</span></span>

<span data-ttu-id="ec6a2-186">Os atributos de validação funcionam para a maior parte das necessidades de validação.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-186">Validation attributes work for most validation needs.</span></span> <span data-ttu-id="ec6a2-187">No entanto, algumas regras de validação são específicas ao negócio.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-187">However, some validation rules are specific to your business.</span></span> <span data-ttu-id="ec6a2-188">As regras podem não ser técnicas comuns de validação de dados, como garantir que um campo seja obrigatório ou que ele esteja em conformidade com um intervalo de valores.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-188">Your rules might not be common data validation techniques such as ensuring a field is required or that it conforms to a range of values.</span></span> <span data-ttu-id="ec6a2-189">Para esses cenários, os atributos de validação personalizados são uma ótima solução.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-189">For these scenarios, custom validation attributes are a great solution.</span></span> <span data-ttu-id="ec6a2-190">É fácil criar seus próprios atributos de validação personalizados no MVC.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-190">Creating your own custom validation attributes in MVC is easy.</span></span> <span data-ttu-id="ec6a2-191">Basta herdar do `ValidationAttribute` e substituir o método `IsValid`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-191">Just inherit from the `ValidationAttribute`, and override the `IsValid` method.</span></span> <span data-ttu-id="ec6a2-192">O método `IsValid` aceita dois parâmetros: o primeiro é um objeto chamado *value* e o segundo é um objeto `ValidationContext` chamado *validationContext*.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-192">The `IsValid` method accepts two parameters, the first is an object named *value* and the second is a `ValidationContext` object named *validationContext*.</span></span> <span data-ttu-id="ec6a2-193">*Value* refere-se ao valor real do campo que o validador personalizado está validando.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-193">*Value* refers to the actual value from the field that your custom validator is validating.</span></span>

<span data-ttu-id="ec6a2-194">Na amostra a seguir, uma regra de negócios indica que os usuários não podem definir o gênero como *Clássico* para um filme lançado após 1960.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-194">In the following sample, a business rule states that users may not set the genre to *Classic* for a movie released after 1960.</span></span> <span data-ttu-id="ec6a2-195">O atributo `[ClassicMovie]` verifica o gênero primeiro e, se ele for um clássico, verificará a data de lançamento para ver se ela é posterior a 1960.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-195">The `[ClassicMovie]` attribute checks the genre first, and if it's a classic, then it checks the release date to see that it's later than 1960.</span></span> <span data-ttu-id="ec6a2-196">Se ele tiver sido lançado após 1960, a validação falhará.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-196">If it's released after 1960, validation fails.</span></span> <span data-ttu-id="ec6a2-197">O atributo aceita um parâmetro de inteiro que representa o ano que pode ser usado para validar os dados.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-197">The attribute accepts an integer parameter representing the year that you can use to validate data.</span></span> <span data-ttu-id="ec6a2-198">Capture o valor do parâmetro no construtor do atributo, conforme mostrado aqui:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-198">You can capture the value of the parameter in the attribute's constructor, as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_ClassicMovieAttribute)]

<span data-ttu-id="ec6a2-199">A variável `movie` acima representa um objeto `Movie` que contém os dados do envio do formulário a serem validados.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-199">The `movie` variable above represents a `Movie` object that contains the data from the form submission to validate.</span></span> <span data-ttu-id="ec6a2-200">Nesse caso, o código de validação verifica a data e o gênero no método `IsValid` da classe `ClassicMovieAttribute` de acordo com as regras.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-200">In this case, the validation code checks the date and genre in the `IsValid` method of the `ClassicMovieAttribute` class as per the rules.</span></span> <span data-ttu-id="ec6a2-201">Após a validação bem-sucedida, o `IsValid` retorna um código `ValidationResult.Success`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-201">Upon successful validation ,`IsValid` returns a `ValidationResult.Success` code.</span></span> <span data-ttu-id="ec6a2-202">Quando a validação falha, um `ValidationResult` com uma mensagem erro será retornado:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-202">When validation fails, a `ValidationResult` with an error message is returned:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_GetErrorMessage)]

<span data-ttu-id="ec6a2-203">Quando um usuário modificar o campo `Genre` e enviar o formulário, o método `IsValid` da `ClassicMovieAttribute` verificará se o filme é um clássico.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-203">When a user modifies the `Genre` field and submits the form, the `IsValid` method of the `ClassicMovieAttribute` will verify whether the movie is a classic.</span></span> <span data-ttu-id="ec6a2-204">Como qualquer atributo interno, aplique o atributo `ClassicMovieAttribute` a uma propriedade como `ReleaseDate` para garantir que a validação ocorra, conforme mostrado no exemplo de código anterior.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-204">Like any built-in attribute, apply the `ClassicMovieAttribute` to a property such as `ReleaseDate` to ensure validation happens, as shown in the previous code sample.</span></span> <span data-ttu-id="ec6a2-205">Como o exemplo funciona apenas com tipos `Movie`, a melhor opção é usar `IValidatableObject`, conforme mostrado no parágrafo a seguir.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-205">Since the example works only with `Movie` types, a better option is to use `IValidatableObject` as shown in the following paragraph.</span></span>

<span data-ttu-id="ec6a2-206">Como alternativa, esse mesmo código pode ser colocado no modelo implementando o método `Validate` na interface `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-206">Alternatively, this same code could be placed in the model by implementing the `Validate` method on the `IValidatableObject` interface.</span></span> <span data-ttu-id="ec6a2-207">Embora os atributos de validação personalizados funcionem bem para validar propriedades individuais, a implementação de `IValidatableObject` pode ser usada para implementar a validação no nível da classe:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-207">While custom validation attributes work well for validating individual properties, implementing `IValidatableObject` can be used to implement class-level validation:</span></span>

[!code-csharp[](validation/sample/MovieIValidatable.cs?name=snippet&highlight=1,26-34)]

## <a name="client-side-validation"></a><span data-ttu-id="ec6a2-208">Validação do lado do cliente</span><span class="sxs-lookup"><span data-stu-id="ec6a2-208">Client side validation</span></span>

<span data-ttu-id="ec6a2-209">A validação do lado do cliente é uma ótima conveniência para usuários.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-209">Client side validation is a great convenience for users.</span></span> <span data-ttu-id="ec6a2-210">Ela economiza tempo que de outra forma seria gasto aguardando uma viagem de ida e volta para o servidor.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-210">It saves time they would otherwise spend waiting for a round trip to the server.</span></span> <span data-ttu-id="ec6a2-211">Em termos de negócios, até mesmo algumas frações de segundos multiplicados por centenas de vezes por dia chega a ser muito tempo, despesa e frustração.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-211">In business terms, even a few fractions of seconds multiplied hundreds of times each day adds up to be a lot of time, expense, and frustration.</span></span> <span data-ttu-id="ec6a2-212">A validação imediata e simples permite que os usuários trabalhem com mais eficiência e façam contribuições e produzam entradas e saídas de melhor qualidade.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-212">Straightforward and immediate validation enables users to work more efficiently and produce better quality input and output.</span></span>

<span data-ttu-id="ec6a2-213">É necessário ter uma exibição com as referências de script JavaScript corretas em vigor para a validação do lado do cliente para que ela funcione como visto aqui.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-213">You must have a view with the proper JavaScript script references in place for client-side validation to work as you see here.</span></span>

[!code-cshtml[](validation/sample/Views/Shared/_Layout.cshtml?name=snippet_ScriptTag)]

[!code-cshtml[](validation/sample/Views/Shared/_ValidationScriptsPartial.cshtml)]

<span data-ttu-id="ec6a2-214">O script do [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive) é uma biblioteca de front-end personalizada da Microsoft que se baseia no popular plug-in [jQuery Validate](https://jqueryvalidation.org/).</span><span class="sxs-lookup"><span data-stu-id="ec6a2-214">The [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive) script is a custom Microsoft front-end library that builds on the popular [jQuery Validate](https://jqueryvalidation.org/) plugin.</span></span> <span data-ttu-id="ec6a2-215">Sem o jQuery Unobtrusive Validation, você precisará codificar a mesma lógica de validação em dois locais: uma vez nos atributos de validação do lado do servidor nas propriedades do modelo e, em seguida, novamente nos scripts do lado do cliente (os exemplos para o método [`validate()`](https://jqueryvalidation.org/validate/) do jQuery Validate mostram a complexidade que isso pode gerar).</span><span class="sxs-lookup"><span data-stu-id="ec6a2-215">Without jQuery Unobtrusive Validation, you would have to code the same validation logic in two places: once in the server side validation attributes on model properties, and then again in client side scripts (the examples for jQuery Validate's [`validate()`](https://jqueryvalidation.org/validate/) method shows how complex this could become).</span></span> <span data-ttu-id="ec6a2-216">Em vez disso, os [Auxiliares de Marca](xref:mvc/views/tag-helpers/intro) e os [Auxiliares HTML](xref:mvc/views/overview) do MVC podem usar os atributos de validação e os metadados de tipo das propriedades do modelo para renderizar [atributos de dados](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) HTML 5 nos elementos de formulário que precisam de validação.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-216">Instead, MVC's [Tag Helpers](xref:mvc/views/tag-helpers/intro) and [HTML helpers](xref:mvc/views/overview) are able to use the validation attributes and type metadata from model properties to render HTML 5 [data- attributes](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) in the form elements that need validation.</span></span> <span data-ttu-id="ec6a2-217">O MVC gera os atributos `data-` para atributos internos e personalizados.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-217">MVC generates the `data-` attributes for both built-in and custom attributes.</span></span> <span data-ttu-id="ec6a2-218">O jQuery Unobtrusive Validation analisa os atributos `data-` e passa a lógica para o jQuery Validate, "copiando" efetivamente a lógica de validação do lado do servidor para o cliente.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-218">jQuery Unobtrusive Validation then parses the `data-` attributes and passes the logic to jQuery Validate, effectively "copying" the server side validation logic to the client.</span></span> <span data-ttu-id="ec6a2-219">Exiba erros de validação no cliente usando os auxiliares de marca relevantes, conforme mostrado aqui:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-219">You can display validation errors on the client using the relevant tag helpers as shown here:</span></span>

[!code-cshtml[](validation/sample/Views/Movies/Create.cshtml?name=snippet_ReleaseDate&highlight=4-5)]

<span data-ttu-id="ec6a2-220">Os auxiliares de marca acima renderizam o HTML abaixo.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-220">The tag helpers above render the HTML below.</span></span> <span data-ttu-id="ec6a2-221">Observe que os atributos `data-` na saída HTML correspondem aos atributos de validação da propriedade `ReleaseDate`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-221">Notice that the `data-` attributes in the HTML output correspond to the validation attributes for the `ReleaseDate` property.</span></span> <span data-ttu-id="ec6a2-222">O atributo `data-val-required` abaixo contém uma mensagem de erro a ser exibida se o usuário não preencher o campo de data de lançamento.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-222">The `data-val-required` attribute below contains an error message to display if the user doesn't fill in the release date field.</span></span> <span data-ttu-id="ec6a2-223">O jQuery Unobtrusive Validation passa esse valor para o método [`required()`](https://jqueryvalidation.org/required-method/) do jQuery Validate, que, por sua vez, exibe essa mensagem no elemento **\<span>** complementar.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-223">jQuery Unobtrusive Validation passes this value to the jQuery Validate [`required()`](https://jqueryvalidation.org/required-method/) method, which then displays that message in the accompanying **\<span>** element.</span></span>

```html
<form action="/Movies/Create" method="post">
    <div class="form-horizontal">
        <h4>Movie</h4>
        <div class="text-danger"></div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="ReleaseDate">ReleaseDate</label>
            <div class="col-md-10">
                <input class="form-control" type="datetime"
                data-val="true" data-val-required="The ReleaseDate field is required."
                id="ReleaseDate" name="ReleaseDate" value="" />
                <span class="text-danger field-validation-valid"
                data-valmsg-for="ReleaseDate" data-valmsg-replace="true"></span>
            </div>
        </div>
    </div>
</form>
```

<span data-ttu-id="ec6a2-224">A validação do lado do cliente impede o envio até que o formulário seja válido.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-224">Client-side validation prevents submission until the form is valid.</span></span> <span data-ttu-id="ec6a2-225">O botão Enviar executa o JavaScript que envia o formulário ou exibe mensagens de erro.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-225">The Submit button runs JavaScript that either submits the form or displays error messages.</span></span>

<span data-ttu-id="ec6a2-226">O MVC determina os valores de atributo de tipo com base no tipo de dados .NET de uma propriedade, possivelmente, substituído com o uso de atributos `[DataType]`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-226">MVC determines type attribute values based on the .NET data type of a property, possibly overridden using `[DataType]` attributes.</span></span> <span data-ttu-id="ec6a2-227">O atributo `[DataType]` base não faz nenhuma validação real do lado do servidor.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-227">The base `[DataType]` attribute does no real server-side validation.</span></span> <span data-ttu-id="ec6a2-228">Os navegadores escolhem suas próprias mensagens de erro e exibem esses erros da maneira desejada. No entanto, o pacote Unobtrusive Validation do jQuery pode substituir as mensagens e exibi-las de forma consistente com as outras.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-228">Browsers choose their own error messages and display those errors as they wish, however the jQuery Validation Unobtrusive package can override the messages and display them consistently with others.</span></span> <span data-ttu-id="ec6a2-229">Isso ocorre de forma mais evidente quando os usuários aplicam subclasses `[DataType]`, como `[EmailAddress]`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-229">This happens most obviously when users apply `[DataType]` subclasses such as `[EmailAddress]`.</span></span>

### <a name="add-validation-to-dynamic-forms"></a><span data-ttu-id="ec6a2-230">Adicionar validação a formulários dinâmicos</span><span class="sxs-lookup"><span data-stu-id="ec6a2-230">Add Validation to Dynamic Forms</span></span>

<span data-ttu-id="ec6a2-231">Como o jQuery Unobtrusive Validation passa parâmetros e a lógica de validação para o jQuery Validate quando a página é carregada pela primeira vez, os formulários gerados dinamicamente não exibem a validação de forma automática.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-231">Because jQuery Unobtrusive Validation passes validation logic and parameters to jQuery Validate when the page first loads, dynamically generated forms won't automatically exhibit validation.</span></span> <span data-ttu-id="ec6a2-232">Em vez disso, é necessário instruir o jQuery Unobtrusive Validation a analisar o formulário dinâmico imediatamente depois de criá-lo.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-232">Instead, you must tell jQuery Unobtrusive Validation to parse the dynamic form immediately after creating it.</span></span> <span data-ttu-id="ec6a2-233">Por exemplo, o código abaixo mostra como você pode configurar a validação do lado do cliente em um formulário adicionado por meio do AJAX.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-233">For example, the code below shows how you might set up client side validation on a form added via AJAX.</span></span>

```js
$.get({
    url: "https://url/that/returns/a/form",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add form. " + errorThrown);
    },
    success: function(newFormHTML) {
        var container = document.getElementById("form-container");
        container.insertAdjacentHTML("beforeend", newFormHTML);
        var forms = container.getElementsByTagName("form");
        var newForm = forms[forms.length - 1];
        $.validator.unobtrusive.parse(newForm);
    }
})
```

<span data-ttu-id="ec6a2-234">O método `$.validator.unobtrusive.parse()` aceita um seletor do jQuery para um argumento seu.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-234">The `$.validator.unobtrusive.parse()` method accepts a jQuery selector for its one argument.</span></span> <span data-ttu-id="ec6a2-235">Esse método instrui o jQuery Unobtrusive Validation a analisar os atributos `data-` de formulários nesse seletor.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-235">This method tells jQuery Unobtrusive Validation to parse the `data-` attributes of forms within that selector.</span></span> <span data-ttu-id="ec6a2-236">Os valores desses atributos são então passados para o plug-in jQuery Validate, de modo que o formulário exiba as regras de validação do lado do cliente desejadas.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-236">The values of those attributes are then passed to the jQuery Validate plugin so that the form exhibits the desired client side validation rules.</span></span>

### <a name="add-validation-to-dynamic-controls"></a><span data-ttu-id="ec6a2-237">Adicionar validação a controles dinâmicos</span><span class="sxs-lookup"><span data-stu-id="ec6a2-237">Add Validation to Dynamic Controls</span></span>

<span data-ttu-id="ec6a2-238">Também atualize as regras de validação em um formulário quando controles individuais, como `<input/>`s e `<select/>`s, são gerados dinamicamente.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-238">You can also update the validation rules on a form when individual controls, such as `<input/>`s and `<select/>`s, are dynamically generated.</span></span> <span data-ttu-id="ec6a2-239">Não é possível passar seletores para esses elementos para o método `parse()` diretamente, porque o formulário adjacente já foi analisado e não será atualizado.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-239">You cannot pass selectors for these elements to the `parse()` method directly because the surrounding form has already been parsed and won't update.</span></span> <span data-ttu-id="ec6a2-240">Em vez disso, primeiro remova os dados de validação existentes e, em seguida, analise novamente todo o formulário, conforme mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-240">Instead, you first remove the existing validation data, then reparse the entire form, as shown below:</span></span>

```js
$.get({
    url: "https://url/that/returns/a/control",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add control. " + errorThrown);
    },
    success: function(newInputHTML) {
        var form = document.getElementById("my-form");
        form.insertAdjacentHTML("beforeend", newInputHTML);
        $(form).removeData("validator")    // Added by jQuery Validate
               .removeData("unobtrusiveValidation");   // Added by jQuery Unobtrusive Validation
        $.validator.unobtrusive.parse(form);
    }
})
```

## <a name="iclientmodelvalidator"></a><span data-ttu-id="ec6a2-241">IClientModelValidator</span><span class="sxs-lookup"><span data-stu-id="ec6a2-241">IClientModelValidator</span></span>

<span data-ttu-id="ec6a2-242">Você pode criar uma lógica do lado do cliente para o atributo personalizado, e o [unobtrusive validation](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html), que cria um adaptador para a [validação do jQuery](http://jqueryvalidation.org/documentation/), será executado no cliente automaticamente como parte da validação.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-242">You may create client side logic for your custom attribute, and [unobtrusive validation](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) which creates an adapter to [jquery validation](http://jqueryvalidation.org/documentation/) will execute it on the client for you automatically as part of validation.</span></span> <span data-ttu-id="ec6a2-243">A primeira etapa é controlar quais atributos de dados são adicionados, pela implementação da interface `IClientModelValidator`, conforme mostrado aqui:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-243">The first step is to control what data- attributes are added by implementing the `IClientModelValidator` interface as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_AddValidation)]

<span data-ttu-id="ec6a2-244">Atributos que implementam essa interface podem adicionar atributos HTML a campos gerados.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-244">Attributes that implement this interface can add HTML attributes to generated fields.</span></span> <span data-ttu-id="ec6a2-245">O exame da saída do elemento `ReleaseDate` revela um HTML semelhante ao exemplo anterior, exceto que agora há um atributo `data-val-classicmovie` que foi definido no método `AddValidation` de `IClientModelValidator`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-245">Examining the output for the `ReleaseDate` element reveals HTML that's similar to the previous example, except now there's a `data-val-classicmovie` attribute that was defined in the `AddValidation` method of `IClientModelValidator`.</span></span>

```html
<input class="form-control" type="datetime"
    data-val="true"
    data-val-classicmovie="Classic movies must have a release year earlier than 1960."
    data-val-classicmovie-year="1960"
    data-val-required="The ReleaseDate field is required."
    id="ReleaseDate" name="ReleaseDate" value="" />
```

<span data-ttu-id="ec6a2-246">A validação não invasiva usa os dados nos atributos `data-` para exibir mensagens de erro.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-246">Unobtrusive validation uses the data in the `data-` attributes to display error messages.</span></span> <span data-ttu-id="ec6a2-247">No entanto, o jQuery não reconhece regras ou mensagens até que você adicione-as ao objeto `validator` do jQuery.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-247">However, jQuery doesn't know about rules or messages until you add them to jQuery's `validator` object.</span></span> <span data-ttu-id="ec6a2-248">Isso é mostrado no exemplo a seguir, que adiciona um método de validação de cliente `classicmovie` personalizado ao objeto `validator` do jQuery.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-248">This is shown in the following example, which adds a custom `classicmovie` client validation method to the jQuery `validator` object.</span></span> <span data-ttu-id="ec6a2-249">Para obter uma explicação sobre o método `unobtrusive.adapters.add`, confira [Unobtrusive Client Validation no ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span><span class="sxs-lookup"><span data-stu-id="ec6a2-249">For an explanation of the `unobtrusive.adapters.add` method, see [Unobtrusive Client Validation in ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span></span>

[!code-javascript[](validation/sample/Views/Movies/Create.cshtml?name=snippet_UnobtrusiveValidation)]

<span data-ttu-id="ec6a2-250">Com o código anterior, o método `classicmovie` executa a validação do lado do cliente na data de lançamento do filme.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-250">With the preceding code, the `classicmovie` method performs client-side validation on the movie release date.</span></span> <span data-ttu-id="ec6a2-251">A mensagem de erro é exibida se o método retornar `false`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-251">The error message displays if the method returns `false`.</span></span>

## <a name="remote-validation"></a><span data-ttu-id="ec6a2-252">Validação remota</span><span class="sxs-lookup"><span data-stu-id="ec6a2-252">Remote validation</span></span>

<span data-ttu-id="ec6a2-253">A validação remota é um ótimo recurso a ser usado quando você precisa validar os dados no cliente em relação aos dados no servidor.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-253">Remote validation is a great feature to use when you need to validate data on the client against data on the server.</span></span> <span data-ttu-id="ec6a2-254">Por exemplo, o aplicativo pode precisar verificar se um email ou nome de usuário já está em uso e precisa consultar uma grande quantidade de dados para fazer isso.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-254">For example, your app may need to verify whether an email or user name is already in use, and it must query a large amount of data to do so.</span></span> <span data-ttu-id="ec6a2-255">O download de conjuntos de dados grandes para validar um ou alguns campos consome muitos recursos.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-255">Downloading large sets of data for validating one or a few fields consumes too many resources.</span></span> <span data-ttu-id="ec6a2-256">Isso também pode expor informações confidenciais.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-256">It may also expose sensitive information.</span></span> <span data-ttu-id="ec6a2-257">Uma alternativa é fazer uma solicitação de ida e volta para validar um campo.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-257">An alternative is to make a round-trip request to validate a field.</span></span>

<span data-ttu-id="ec6a2-258">Implemente a validação remota em um processo de duas etapas.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-258">You can implement remote validation in a two step process.</span></span> <span data-ttu-id="ec6a2-259">Primeiro, é necessário anotar o modelo com o atributo `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-259">First, you must annotate your model with the `[Remote]` attribute.</span></span> <span data-ttu-id="ec6a2-260">O atributo `[Remote]` aceita várias sobrecargas que podem ser usadas para direcionar o JavaScript do lado do cliente para o código apropriado a ser chamado.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-260">The `[Remote]` attribute accepts multiple overloads you can use to direct client side JavaScript to the appropriate code to call.</span></span> <span data-ttu-id="ec6a2-261">O exemplo abaixo aponta para o método de ação `VerifyEmail` do controlador `Users`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-261">The example below points to the `VerifyEmail` action method of the `Users` controller.</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserEmailProperty)]

<span data-ttu-id="ec6a2-262">A segunda etapa é colocar o código de validação no método de ação correspondente, conforme definido no atributo `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-262">The second step is putting the validation code in the corresponding action method as defined in the `[Remote]` attribute.</span></span> <span data-ttu-id="ec6a2-263">De acordo com a documentação do método jQuery Validate[remoto](https://jqueryvalidation.org/remote-method/), a resposta do servidor deve ser uma cadeia JSON que seja:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-263">According to the jQuery Validate [remote](https://jqueryvalidation.org/remote-method/) method documentation, the server response must be a JSON string that's either:</span></span>

* <span data-ttu-id="ec6a2-264">`"true"` para elementos válidos.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-264">`"true"` for valid elements.</span></span>
* <span data-ttu-id="ec6a2-265">`"false"`, `undefined` ou `null` para elementos inválidos, usando a mensagem de erro padrão.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-265">`"false"`, `undefined`, or `null` for invalid elements, using the default error message.</span></span>

<span data-ttu-id="ec6a2-266">Se a resposta do servidor for uma cadeia de caracteres (por exemplo, `"That name is already taken, try peter123 instead"`), a cadeia de caracteres é exibida como uma mensagem de erro personalizada no lugar da cadeia de caracteres padrão.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-266">If the server response is a string (for example, `"That name is already taken, try peter123 instead"`), the string is displayed as a custom error message in place of the default string.</span></span>

<span data-ttu-id="ec6a2-267">A definição do método `VerifyEmail` segue essas regras, conforme mostrado abaixo.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-267">The definition of the `VerifyEmail` method follows these rules, as shown below.</span></span> <span data-ttu-id="ec6a2-268">Ela retorna uma mensagem de erro de validação se o email já está sendo usado ou `true` se o email está livre e encapsula o resultado em um objeto `JsonResult`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-268">It returns a validation error message if the email is taken, or `true` if the email is free, and wraps the result in a `JsonResult` object.</span></span> <span data-ttu-id="ec6a2-269">O lado do cliente pode então usar o valor retornado para continuar ou exibir o erro, se necessário.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-269">The client side can then use the returned value to proceed or display the error if needed.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyEmail)]

<span data-ttu-id="ec6a2-270">Agora, quando os usuários inserem um email, o JavaScript na exibição faz uma chamada remota para ver se o email já está sendo usado e, em caso afirmativo, exibe a mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-270">Now when users enter an email, JavaScript in the view makes a remote call to see if that email has been taken and, if so, displays the error message.</span></span> <span data-ttu-id="ec6a2-271">Caso contrário, o usuário pode enviar o formulário como de costume.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-271">Otherwise, the user can submit the form as usual.</span></span>

<span data-ttu-id="ec6a2-272">A propriedade `AdditionalFields` do atributo `[Remote]` é útil para validação de combinações de campos em relação aos dados no servidor.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-272">The `AdditionalFields` property of the `[Remote]` attribute is useful for validating combinations of fields against data on the server.</span></span> <span data-ttu-id="ec6a2-273">Por exemplo, se o modelo `User` acima tiver duas propriedades adicionais chamadas `FirstName` e `LastName`, é recomendável verificar se não há usuários que já têm esse par de nomes.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-273">For example, if the `User` model from above had two additional properties called `FirstName` and `LastName`, you might want to verify that no existing users already have that pair of names.</span></span> <span data-ttu-id="ec6a2-274">Defina as novas propriedades, conforme mostrado no seguinte código:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-274">You define the new properties as shown in the following code:</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserNameProperties)]

<span data-ttu-id="ec6a2-275">`AdditionalFields` poderia ter sido definido de forma explícita com as cadeias de caracteres `"FirstName"` e `"LastName"`, mas o uso do operador [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) dessa forma, simplifica a refatoração posterior.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-275">`AdditionalFields` could've been set explicitly to the strings `"FirstName"` and `"LastName"`, but using the [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) operator like this simplifies later refactoring.</span></span> <span data-ttu-id="ec6a2-276">Em seguida, o método de ação para executar a validação precisa aceitar dois argumentos, um para o valor de `FirstName` e outro para o valor de `LastName`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-276">The action method to perform the validation must then accept two arguments, one for the value of `FirstName` and one for the value of `LastName`.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyName)]

<span data-ttu-id="ec6a2-277">Agora, quando os usuários inserem um nome e sobrenome, o JavaScript:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-277">Now when users enter a first and last name, JavaScript:</span></span>

* <span data-ttu-id="ec6a2-278">Faz uma chamada remota para ver se esse par de nomes já está sendo usado.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-278">Makes a remote call to see if that pair of names has been taken.</span></span>
* <span data-ttu-id="ec6a2-279">Se o par já está sendo usado, uma mensagem de erro é exibida.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-279">If the pair has been taken, an error message is displayed.</span></span>
* <span data-ttu-id="ec6a2-280">Caso contrário, o usuário pode enviar o formulário.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-280">If not taken, the user can submit the form.</span></span>

<span data-ttu-id="ec6a2-281">Se você precisa validar dois ou mais campos adicionais com o atributo `[Remote]`, forneça-os como uma lista delimitada por vírgula.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-281">If you need to validate two or more additional fields with the `[Remote]` attribute, you provide them as a comma-delimited list.</span></span> <span data-ttu-id="ec6a2-282">Por exemplo, para adicionar uma propriedade `MiddleName` ao modelo, defina o atributo `[Remote]`, conforme mostrado no seguinte código:</span><span class="sxs-lookup"><span data-stu-id="ec6a2-282">For example, to add a `MiddleName` property to the model, set the `[Remote]` attribute as shown in the following code:</span></span>

```cs
[Remote(action: "VerifyName", controller: "Users", AdditionalFields = nameof(FirstName) + "," + nameof(LastName))]
public string MiddleName { get; set; }
```

<span data-ttu-id="ec6a2-283">`AdditionalFields`, como todos os argumentos de atributo, deve ser uma expressão de constante.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-283">`AdditionalFields`, like all attribute arguments, must be a constant expression.</span></span> <span data-ttu-id="ec6a2-284">Portanto, você não deve usar uma [cadeia de caracteres interpolada](/dotnet/csharp/language-reference/keywords/interpolated-strings) ou chamar <xref:System.String.Join*> para inicializar `AdditionalFields`.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-284">Therefore, you must not use an [interpolated string](/dotnet/csharp/language-reference/keywords/interpolated-strings) or call <xref:System.String.Join*> to initialize `AdditionalFields`.</span></span> <span data-ttu-id="ec6a2-285">Para cada campo adicional adicionado ao atributo `[Remote]`, é necessário adicionar outro argumento ao método de ação do controlador correspondente.</span><span class="sxs-lookup"><span data-stu-id="ec6a2-285">For every additional field that you add to the `[Remote]` attribute, you must add another argument to the corresponding controller action method.</span></span>
