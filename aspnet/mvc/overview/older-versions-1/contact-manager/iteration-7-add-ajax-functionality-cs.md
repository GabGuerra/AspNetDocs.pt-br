---
uid: mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
title: 'Iteração #7 – adicionar funcionalidade do Ajax (c#) | Microsoft Docs'
author: microsoft
description: A sétima iteração, podemos melhorar a capacidade de resposta e o desempenho do nosso aplicativo, adicionando suporte para Ajax.
ms.author: riande
ms.date: 02/20/2009
ms.assetid: f1b0809e-8909-444e-b6bb-a5cd1dea3f72
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
msc.type: authoredcontent
ms.openlocfilehash: a51713e57872ccfc3a76cf91fec728fdb6fa1eac
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57060593"
---
<a name="iteration-7--add-ajax-functionality-c"></a><span data-ttu-id="5da4c-103">Iteração #7 – adicionar funcionalidade do Ajax (c#)</span><span class="sxs-lookup"><span data-stu-id="5da4c-103">Iteration #7 – Add Ajax functionality (C#)</span></span>
====================
<span data-ttu-id="5da4c-104">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="5da4c-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="5da4c-105">Baixar o código</span><span class="sxs-lookup"><span data-stu-id="5da4c-105">Download Code</span></span>](iteration-7-add-ajax-functionality-cs/_static/contactmanager_7_cs1.zip)

> <span data-ttu-id="5da4c-106">A sétima iteração, podemos melhorar a capacidade de resposta e o desempenho do nosso aplicativo, adicionando suporte para Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-106">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>


## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="5da4c-107">Criando um aplicativo ASP.NET MVC de gerenciamento de contatos (c#)</span><span class="sxs-lookup"><span data-stu-id="5da4c-107">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="5da4c-108">Esta série de tutoriais, vamos criar um aplicativo de gerenciamento de contatos inteiro do início ao fim.</span><span class="sxs-lookup"><span data-stu-id="5da4c-108">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="5da4c-109">O aplicativo Gerenciador de contatos permite que você armazene informações de contato - nomes, números de telefone e endereços de email - para obter uma lista de pessoas.</span><span class="sxs-lookup"><span data-stu-id="5da4c-109">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="5da4c-110">Criamos o aplicativo ao longo de várias iterações.</span><span class="sxs-lookup"><span data-stu-id="5da4c-110">We build the application over multiple iterations.</span></span> <span data-ttu-id="5da4c-111">Com cada iteração, podemos melhorar gradualmente o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5da4c-111">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="5da4c-112">A meta dessa abordagem de iteração vários é que você possa entender o motivo para cada alteração.</span><span class="sxs-lookup"><span data-stu-id="5da4c-112">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="5da4c-113">Iteração #1 - criar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5da4c-113">Iteration #1 - Create the application.</span></span> <span data-ttu-id="5da4c-114">A primeira iteração, podemos criar o Gerenciador de contatos da maneira mais simples possível.</span><span class="sxs-lookup"><span data-stu-id="5da4c-114">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="5da4c-115">Adicionamos suporte para operações de banco de dados básico: Criar, ler, atualizar e excluir (CRUD).</span><span class="sxs-lookup"><span data-stu-id="5da4c-115">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="5da4c-116">Iteração #2 - tornar o aplicativo interessante.</span><span class="sxs-lookup"><span data-stu-id="5da4c-116">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="5da4c-117">Nesta iteração, podemos melhorar a aparência do aplicativo modificando a página mestra do ASP.NET MVC exibição padrão e em cascata de folha de estilos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-117">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="5da4c-118">Iteração #3 - adicionar validação de formulário.</span><span class="sxs-lookup"><span data-stu-id="5da4c-118">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="5da4c-119">Na terceira iteração, podemos adicionar validação de formulário básico.</span><span class="sxs-lookup"><span data-stu-id="5da4c-119">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="5da4c-120">Podemos impedir que pessoas enviando um formulário sem preencher os campos obrigatórios do formulário.</span><span class="sxs-lookup"><span data-stu-id="5da4c-120">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="5da4c-121">Podemos também validar endereços de email e números de telefone.</span><span class="sxs-lookup"><span data-stu-id="5da4c-121">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="5da4c-122">Iteração #4 – tornar o aplicativo fracamente acoplado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-122">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="5da4c-123">Nesta quarta iteração, podemos tirar proveito dos diversos padrões de design de software para facilitar a manutenção e modificar o aplicativo Gerenciador de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-123">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="5da4c-124">Por exemplo, podemos refatorar nosso aplicativo para usar o padrão de repositório e o padrão de injeção de dependência.</span><span class="sxs-lookup"><span data-stu-id="5da4c-124">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="5da4c-125">Iteração #5 - criar testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="5da4c-125">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="5da4c-126">Na quinta iteração, podemos tornar nosso aplicativo mais fácil de manter e modificar adicionando testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="5da4c-126">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="5da4c-127">Vamos simular a nossas classes de modelo de dados e criar testes de unidade para nossos controladores e lógica de validação.</span><span class="sxs-lookup"><span data-stu-id="5da4c-127">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="5da4c-128">Iteração #6 – usar desenvolvimento controlado por teste.</span><span class="sxs-lookup"><span data-stu-id="5da4c-128">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="5da4c-129">Essa iteração sexta, adicionamos novas funcionalidades ao nosso aplicativo escrevendo testes de unidade pela primeira vez e escrever código contra os testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="5da4c-129">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="5da4c-130">Essa iteração, adicionamos os grupos de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-130">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="5da4c-131">Iteração #7 - adicionar a funcionalidade do Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-131">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="5da4c-132">A sétima iteração, podemos melhorar a capacidade de resposta e o desempenho do nosso aplicativo, adicionando suporte para Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-132">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="5da4c-133">Essa iteração</span><span class="sxs-lookup"><span data-stu-id="5da4c-133">This Iteration</span></span>

<span data-ttu-id="5da4c-134">Essa iteração do aplicativo Contact Manager, podemos refatorar nosso aplicativo para fazer uso do Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-134">In this iteration of the Contact Manager application, we refactor our application to make use of Ajax.</span></span> <span data-ttu-id="5da4c-135">Ao tirar proveito do Ajax, podemos fazer nosso aplicativo mais ágil na resposta.</span><span class="sxs-lookup"><span data-stu-id="5da4c-135">By taking advantage of Ajax, we make our application more responsive.</span></span> <span data-ttu-id="5da4c-136">Podemos pode evitar a renderização de uma página inteira quando precisamos atualizar somente uma determinada região em uma página.</span><span class="sxs-lookup"><span data-stu-id="5da4c-136">We can avoid rendering an entire page when we need to update only a certain region in a page.</span></span>

<span data-ttu-id="5da4c-137">Podemos refatorar nosso modo de exibição de índice, de modo que podemos don precisa exibir novamente a página inteira sempre que alguém seleciona um novo grupo de contato.</span><span class="sxs-lookup"><span data-stu-id="5da4c-137">We'll refactor our Index view so that we don t need to redisplay the entire page whenever someone selects a new contact group.</span></span> <span data-ttu-id="5da4c-138">Em vez disso, quando alguém clica em um grupo de contatos, vou atualizar a lista de contatos e deixe o restante da página sozinho.</span><span class="sxs-lookup"><span data-stu-id="5da4c-138">Instead, when someone clicks a contact group, we'll just update the list of contacts and leave the rest of the page alone.</span></span>

<span data-ttu-id="5da4c-139">Também vamos alterar a maneira de nossa excluir link funciona.</span><span class="sxs-lookup"><span data-stu-id="5da4c-139">We'll also change the way our delete link works.</span></span> <span data-ttu-id="5da4c-140">Em vez de exibir uma página de confirmação separado, vamos exibir uma caixa de diálogo de confirmação de JavaScript.</span><span class="sxs-lookup"><span data-stu-id="5da4c-140">Instead of displaying a separate confirmation page, we'll display a JavaScript confirmation dialog.</span></span> <span data-ttu-id="5da4c-141">Se você confirmar que você deseja excluir um contato, uma operação HTTP DELETE é executada em relação ao servidor para excluir o registro de contato do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5da4c-141">If you confirm that you want to delete a contact, an HTTP DELETE operation is performed against the server to delete the contact record from the database.</span></span>

<span data-ttu-id="5da4c-142">Além disso, podemos aproveitará do jQuery para adicionar efeitos de animação à nossa exibição índice.</span><span class="sxs-lookup"><span data-stu-id="5da4c-142">Furthermore, we will take advantage of jQuery to add animation effects to our Index view.</span></span> <span data-ttu-id="5da4c-143">Vamos exibir uma animação quando a nova lista de contatos é que está sendo procurada do servidor.</span><span class="sxs-lookup"><span data-stu-id="5da4c-143">We'll display an animation when the new list of contacts is being fetched from the server.</span></span>

<span data-ttu-id="5da4c-144">Por fim, vamos dar vantagem do suporte do ASP.NET AJAX framework para gerenciar o histórico do navegador.</span><span class="sxs-lookup"><span data-stu-id="5da4c-144">Finally, we'll take advantage of the ASP.NET AJAX framework support for managing browser history.</span></span> <span data-ttu-id="5da4c-145">Vamos criar pontos de histórico sempre que executamos uma chamada Ajax para atualizar a lista de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-145">We'll create history points whenever we perform an Ajax call to update the contact list.</span></span> <span data-ttu-id="5da4c-146">Dessa forma, o navegador com versões anteriores e posteriores botões irá funcionar.</span><span class="sxs-lookup"><span data-stu-id="5da4c-146">That way, the browser backward and forward buttons will work.</span></span>

## <a name="why-use-ajax"></a><span data-ttu-id="5da4c-147">Por que usar o Ajax?</span><span class="sxs-lookup"><span data-stu-id="5da4c-147">Why use Ajax?</span></span>

<span data-ttu-id="5da4c-148">Usando Ajax traz muitos benefícios.</span><span class="sxs-lookup"><span data-stu-id="5da4c-148">Using Ajax has many benefits.</span></span> <span data-ttu-id="5da4c-149">Em primeiro lugar, adicionando funcionalidade Ajax a resultados um aplicativo em uma melhor experiência de usuário.</span><span class="sxs-lookup"><span data-stu-id="5da4c-149">First, adding Ajax functionality to an application results in a better user experience.</span></span> <span data-ttu-id="5da4c-150">De um aplicativo web normal, a página inteira deve ser publicada no servidor cada vez que um usuário executa uma ação.</span><span class="sxs-lookup"><span data-stu-id="5da4c-150">In a normal web application, the entire page must be posted back to the server each and every time a user performs an action.</span></span> <span data-ttu-id="5da4c-151">Sempre que você executar uma ação, os bloqueios de navegador e o usuário devem aguardar até que a página inteira seja buscada e exibida novamente.</span><span class="sxs-lookup"><span data-stu-id="5da4c-151">Whenever you perform an action, the browser locks and the user must wait until the entire page is fetched and redisplayed.</span></span>

<span data-ttu-id="5da4c-152">Isso seria uma experiência inaceitável no caso de um aplicativo da área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="5da4c-152">This would be an unacceptable experience in the case of a desktop application.</span></span> <span data-ttu-id="5da4c-153">No entanto, tradicionalmente, vivemos com essa experiência de usuário incorreta no caso de um aplicativo web porque nós não sabia que podemos fazer melhor.</span><span class="sxs-lookup"><span data-stu-id="5da4c-153">But, traditionally, we lived with this bad user experience in the case of a web application because we did not know that we could do any better.</span></span> <span data-ttu-id="5da4c-154">Achamos que era uma limitação de aplicativos da web quando, na realidade, ele era apenas uma limitação de nossa imaginação.</span><span class="sxs-lookup"><span data-stu-id="5da4c-154">We thought it was a limitation of web applications when, in actuality, it was just a limitation of our imaginations.</span></span>

<span data-ttu-id="5da4c-155">Em um aplicativo Ajax, você não precisa para trazer a experiência do usuário para interromper apenas para atualizar uma página.</span><span class="sxs-lookup"><span data-stu-id="5da4c-155">In an Ajax application, you don t need to bring the user experience to a halt just to update a page.</span></span> <span data-ttu-id="5da4c-156">Em vez disso, você pode executar uma solicitação assíncrona em segundo plano para atualizar a página.</span><span class="sxs-lookup"><span data-stu-id="5da4c-156">Instead, you can perform an asynchronous request in the background to update the page.</span></span> <span data-ttu-id="5da4c-157">Você não forçar t, o usuário esperar enquanto a parte da página é atualizada.</span><span class="sxs-lookup"><span data-stu-id="5da4c-157">You don t force the user to wait while part of the page gets updated.</span></span>

<span data-ttu-id="5da4c-158">Ao tirar proveito do Ajax, você também pode melhorar o desempenho do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5da4c-158">By taking advantage of Ajax, you also can improve the performance of your application.</span></span> <span data-ttu-id="5da4c-159">Considere como o aplicativo Gerenciador de contatos agora funciona sem a funcionalidade do Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-159">Consider how the Contact Manager application works right now without Ajax functionality.</span></span> <span data-ttu-id="5da4c-160">Quando você clica em um grupo de contatos, toda a exibição de índice deve ser exibida novamente.</span><span class="sxs-lookup"><span data-stu-id="5da4c-160">When you click a contact group, the entire Index view must be redisplayed.</span></span> <span data-ttu-id="5da4c-161">A lista de contatos e lista de grupos de contato devem ser recuperadas do servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5da4c-161">The list of contacts and list of contact groups must be retrieved from the database server.</span></span> <span data-ttu-id="5da4c-162">Todos esses dados devem ser passados pela conexão do servidor web para o navegador da web.</span><span class="sxs-lookup"><span data-stu-id="5da4c-162">All of this data must be passed across the wire from web server to web browser.</span></span>

<span data-ttu-id="5da4c-163">Depois de adicionar funcionalidade do Ajax ao nosso aplicativo, no entanto, podemos evitar exibir novamente a página inteira quando um usuário clica em um grupo de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-163">After we add Ajax functionality to our application, however, we can avoid redisplaying the entire page when a user clicks a contact group.</span></span> <span data-ttu-id="5da4c-164">Não precisamos mais pegar os grupos de contato do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5da4c-164">We no longer need to grab the contact groups from the database.</span></span> <span data-ttu-id="5da4c-165">Podemos também don precisa enviar por push toda a exibição de índice na transmissão.</span><span class="sxs-lookup"><span data-stu-id="5da4c-165">We also don t need to push the entire Index view across the wire.</span></span> <span data-ttu-id="5da4c-166">Ao tirar proveito do Ajax, podemos reduzir a quantidade de trabalho que nosso servidor de banco de dados deve executar e podemos reduzir a quantidade de tráfego de rede exigida pelo nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5da4c-166">By taking advantage of Ajax, we reduce the amount of work that our database server must perform and we reduce the amount of network traffic required by our application.</span></span>

## <a name="don-t-be-afraid-of-ajax"></a><span data-ttu-id="5da4c-167">Don t ser medo do Ajax</span><span class="sxs-lookup"><span data-stu-id="5da4c-167">Don t be Afraid of Ajax</span></span>

<span data-ttu-id="5da4c-168">Alguns desenvolvedores Evite usar Ajax, pois eles se preocupar sobre navegadores de nível inferior.</span><span class="sxs-lookup"><span data-stu-id="5da4c-168">Some developers avoid using Ajax because they worry about downlevel browsers.</span></span> <span data-ttu-id="5da4c-169">Eles querem garantir que seus aplicativos da web ainda funcionará quando acessado por um navegador que não oferece suporte a JavaScript.</span><span class="sxs-lookup"><span data-stu-id="5da4c-169">They want to make sure that their web applications will still work when accessed by a browser that does not support JavaScript.</span></span> <span data-ttu-id="5da4c-170">Como Ajax depende de JavaScript, alguns desenvolvedores evitar usando Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-170">Because Ajax depends on JavaScript, some developers avoid using Ajax.</span></span>

<span data-ttu-id="5da4c-171">No entanto, se você for cuidadoso sobre como implementar o Ajax, em seguida, você pode criar aplicativos que funcionam com navegadores uplevel e de nível inferior.</span><span class="sxs-lookup"><span data-stu-id="5da4c-171">However, if you are careful about how you implement Ajax then you can build applications that work with both uplevel and downlevel browsers.</span></span> <span data-ttu-id="5da4c-172">Nosso aplicativo Contact Manager funcionará com navegadores que oferecem suporte a JavaScript e navegadores que não.</span><span class="sxs-lookup"><span data-stu-id="5da4c-172">Our Contact Manager application will work with browsers that support JavaScript and browsers that do not.</span></span>

<span data-ttu-id="5da4c-173">Se você usar o aplicativo Gerenciador de contatos com um navegador que dê suporte a JavaScript, em seguida, você terá uma melhor experiência do usuário.</span><span class="sxs-lookup"><span data-stu-id="5da4c-173">If you use the Contact Manager application with a browser that supports JavaScript then you will have a better user experience.</span></span> <span data-ttu-id="5da4c-174">Por exemplo, quando você clica em um grupo de contatos, somente a região da página que exibe os contatos será atualizada.</span><span class="sxs-lookup"><span data-stu-id="5da4c-174">For example, when you click a contact group, only the region of the page that displays contacts will be updated.</span></span>

<span data-ttu-id="5da4c-175">Se, por outro lado, usar o aplicativo Gerenciador de contatos com um navegador que não oferece suporte a JavaScript (ou que tenha o JavaScript desabilitado), em seguida, você terá uma experiência do usuário ligeiramente menos desejável.</span><span class="sxs-lookup"><span data-stu-id="5da4c-175">If, on the other hand, you use the Contact Manager application with a browser that does not support JavaScript (or that has JavaScript disabled) then you will have a slightly less desirable user experience.</span></span> <span data-ttu-id="5da4c-176">Por exemplo, quando você clica em um grupo de contatos, toda a exibição de índice deve ser lançada ao navegador para exibir a lista correspondente de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-176">For example, when you click a contact group, the entire Index view must be posted back to the browser in order to display the matching list of contacts.</span></span>

## <a name="adding-the-required-javascript-files"></a><span data-ttu-id="5da4c-177">Adicionar os arquivos JavaScript necessário</span><span class="sxs-lookup"><span data-stu-id="5da4c-177">Adding the Required JavaScript Files</span></span>

<span data-ttu-id="5da4c-178">Precisaremos usar três arquivos de JavaScript para adicionar funcionalidade do Ajax ao nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5da4c-178">We'll need to use three JavaScript files to add Ajax functionality to our application.</span></span> <span data-ttu-id="5da4c-179">Todos os três desses arquivos são incluídos na pasta de Scripts de um novo aplicativo ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="5da4c-179">All three of these files are included in the Scripts folder of a new ASP.NET MVC application.</span></span>

<span data-ttu-id="5da4c-180">Se você planeja usar o Ajax em várias páginas em seu aplicativo, em seguida, faz sentido para incluir os arquivos necessários do JavaScript em sua página do aplicativo s modo de exibição mestre.</span><span class="sxs-lookup"><span data-stu-id="5da4c-180">If you plan to use Ajax in multiple pages in your application then it makes sense to include the required JavaScript files in your application s view master page.</span></span> <span data-ttu-id="5da4c-181">Dessa forma, os JavaScript arquivos serão incluídos em todas as páginas em seu aplicativo automaticamente.</span><span class="sxs-lookup"><span data-stu-id="5da4c-181">That way, the JavaScript files will be included in all of the pages in your application automatically.</span></span>

<span data-ttu-id="5da4c-182">Adicione o seguinte JavaScript inclui dentro de &lt;head&gt; marca da sua página de exibição mestre:</span><span class="sxs-lookup"><span data-stu-id="5da4c-182">Add the following JavaScript includes inside the &lt;head&gt; tag of your view master page:</span></span>

[!code-html[Main](iteration-7-add-ajax-functionality-cs/samples/sample1.html)]

## <a name="refactoring-the-index-view-to-use-ajax"></a><span data-ttu-id="5da4c-183">A exibição de índice para usar o Ajax de refatoração</span><span class="sxs-lookup"><span data-stu-id="5da4c-183">Refactoring the Index View to use Ajax</span></span>

<span data-ttu-id="5da4c-184">Permitir que o s comece modificando nossa exibição de índice, de modo que apenas clicando em um grupo de contatos atualiza a região da exibição que exibe os contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-184">Let s start by modifying our Index view so that clicking a contact group only updates the region of the view that displays contacts.</span></span> <span data-ttu-id="5da4c-185">A caixa vermelha na Figura 1 contém a região que queremos atualizar.</span><span class="sxs-lookup"><span data-stu-id="5da4c-185">The red box in Figure 1 contains the region that we want to update.</span></span>


<span data-ttu-id="5da4c-186">[![Atualizar somente os contatos](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5da4c-186">[![Updating only contacts](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span></span>

<span data-ttu-id="5da4c-187">**Figura 01**: Atualizar somente os contatos ([clique para exibir a imagem em tamanho normal](iteration-7-add-ajax-functionality-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="5da4c-187">**Figure 01**: Updating only contacts([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image2.png))</span></span>


<span data-ttu-id="5da4c-188">A primeira etapa é separar a parte do modo de exibição que desejamos atualize de forma assíncrona em um parcial separado (controle de usuário do modo de exibição).</span><span class="sxs-lookup"><span data-stu-id="5da4c-188">The first step is to separate the part of the view that we want to update asynchronously into a separate partial (view user control).</span></span> <span data-ttu-id="5da4c-189">A seção da exibição índice que exibe a tabela de contatos foi movida para parcial na listagem 1.</span><span class="sxs-lookup"><span data-stu-id="5da4c-189">The section of the Index view that displays the table of contacts has been moved into the partial in Listing 1.</span></span>

<span data-ttu-id="5da4c-190">**Listagem 1 - Views\Contact\ContactList.ascx**</span><span class="sxs-lookup"><span data-stu-id="5da4c-190">**Listing 1 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample2.aspx)]

<span data-ttu-id="5da4c-191">Observe que a parcial na listagem 1 tem um modelo diferente do que o modo de exibição de índice.</span><span class="sxs-lookup"><span data-stu-id="5da4c-191">Notice that the partial in Listing 1 has a different model than the Index view.</span></span> <span data-ttu-id="5da4c-192">O *Inherits* atributo na &lt;% @ Page %&gt; diretiva especifica que a parcial herda o ViewUserControl&lt;grupo&gt; classe.</span><span class="sxs-lookup"><span data-stu-id="5da4c-192">The *Inherits* attribute in the &lt;%@ Page %&gt; directive specifies that the partial inherits from the ViewUserControl&lt;Group&gt; class.</span></span>

<span data-ttu-id="5da4c-193">O modo de exibição de índice atualizado está contido na listagem 2.</span><span class="sxs-lookup"><span data-stu-id="5da4c-193">The updated Index view is contained in Listing 2.</span></span>

<span data-ttu-id="5da4c-194">**Listagem 2 - Views\Contact\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="5da4c-194">**Listing 2 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample3.aspx)]

<span data-ttu-id="5da4c-195">Há duas coisas que você deve observar sobre o modo de exibição atualizado na listagem 2.</span><span class="sxs-lookup"><span data-stu-id="5da4c-195">There are two things that you should notice about the updated view in Listing 2.</span></span> <span data-ttu-id="5da4c-196">Primeiro, observe que todo o conteúdo movido para parcial é substituído por uma chamada para Html.RenderPartial().</span><span class="sxs-lookup"><span data-stu-id="5da4c-196">First, notice that all of the content moved into the partial is replaced with a call to Html.RenderPartial().</span></span> <span data-ttu-id="5da4c-197">O método Html.RenderPartial() é chamado quando o modo de exibição de índice é solicitado pela primeira vez para exibir o conjunto inicial de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-197">The Html.RenderPartial() method is called when the Index view is first requested in order to display the initial set of contacts.</span></span>

<span data-ttu-id="5da4c-198">Em segundo lugar, observe que o Html.ActionLink() usado para exibir grupos de contatos foi substituído por um Ajax.ActionLink().</span><span class="sxs-lookup"><span data-stu-id="5da4c-198">Second, notice that the Html.ActionLink() used to display contact groups has been replaced with an Ajax.ActionLink().</span></span> <span data-ttu-id="5da4c-199">O Ajax.ActionLink() é chamado com os seguintes parâmetros:</span><span class="sxs-lookup"><span data-stu-id="5da4c-199">The Ajax.ActionLink() is called with the following parameters:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample4.aspx)]

<span data-ttu-id="5da4c-200">O primeiro parâmetro representa o texto a ser exibida para o link, o segundo parâmetro representa os valores de rota e o terceiro parâmetro representa as opções de Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-200">The first parameter represents the text to display for the link, the second parameter represents the route values, and the third parameter represents the Ajax options.</span></span> <span data-ttu-id="5da4c-201">Nesse caso, usamos a opção UpdateTargetId Ajax para apontar para o HTML &lt;div&gt; marca que queremos atualizar após a solicitação Ajax é concluída.</span><span class="sxs-lookup"><span data-stu-id="5da4c-201">In this case, we use the UpdateTargetId Ajax option to point to the HTML &lt;div&gt; tag that we want to update after the Ajax request completes.</span></span> <span data-ttu-id="5da4c-202">Queremos atualizar o &lt;div&gt; marca com a nova lista de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-202">We want to update the &lt;div&gt; tag with the new list of contacts.</span></span>

<span data-ttu-id="5da4c-203">O método Index () atualizado do controlador contato está contido na listagem 3.</span><span class="sxs-lookup"><span data-stu-id="5da4c-203">The updated Index() method of the Contact controller is contained in Listing 3.</span></span>

<span data-ttu-id="5da4c-204">**Listagem 3 - Controllers\ContactController.cs (método de índice)**</span><span class="sxs-lookup"><span data-stu-id="5da4c-204">**Listing 3 - Controllers\ContactController.cs (Index method)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample5.cs)]

<span data-ttu-id="5da4c-205">A ação atualizada de Index () retorna condicionalmente uma das duas coisas.</span><span class="sxs-lookup"><span data-stu-id="5da4c-205">The updated Index() action conditionally returns one of two things.</span></span> <span data-ttu-id="5da4c-206">Se a ação Index () é invocada por uma solicitação Ajax, em seguida, o controlador retorna um parcial.</span><span class="sxs-lookup"><span data-stu-id="5da4c-206">If the Index() action is invoked by an Ajax request then the controller returns a partial.</span></span> <span data-ttu-id="5da4c-207">Caso contrário, a ação de Index () retorna uma exibição inteira.</span><span class="sxs-lookup"><span data-stu-id="5da4c-207">Otherwise, the Index() action returns an entire view.</span></span>

<span data-ttu-id="5da4c-208">Observe que a ação Index () não precisa retornar a quantidade de dados quando invocado por uma solicitação Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-208">Notice that the Index() action does not need to return as much data when invoked by an Ajax request.</span></span> <span data-ttu-id="5da4c-209">No contexto de uma solicitação normal, a ação de índice retorna uma lista de todos os grupos de contato e o grupo de contato selecionado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-209">In the context of a normal request, the Index action returns a list of all of the contact groups and the selected contact group.</span></span> <span data-ttu-id="5da4c-210">No contexto de uma solicitação Ajax, a ação de Index () retorna somente o grupo selecionado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-210">In the context of an Ajax request, the Index() action returns only the selected group.</span></span> <span data-ttu-id="5da4c-211">AJAX significa menos trabalho em seu servidor de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5da4c-211">Ajax means less work on your database server.</span></span>

<span data-ttu-id="5da4c-212">Nossa exibição índice modificado funciona no caso de navegadores uplevel e de nível inferior.</span><span class="sxs-lookup"><span data-stu-id="5da4c-212">Our modified Index view works in the case of both uplevel and downlevel browsers.</span></span> <span data-ttu-id="5da4c-213">Se você clicar em um grupo de contatos e o navegador dá suporte a JavaScript, somente a região da exibição que contém a lista de contatos é atualizada.</span><span class="sxs-lookup"><span data-stu-id="5da4c-213">If you click a contact group, and your browser supports JavaScript, then only the region of the view that contains the list of contacts is updated.</span></span> <span data-ttu-id="5da4c-214">Se, por outro lado, o seu navegador não dá suporte a JavaScript, toda a exibição é atualizada.</span><span class="sxs-lookup"><span data-stu-id="5da4c-214">If, on the other hand, your browser does not support JavaScript, then the entire view is updated.</span></span>


<span data-ttu-id="5da4c-215">Nossa exibição atualizada do índice tem um problema.</span><span class="sxs-lookup"><span data-stu-id="5da4c-215">Our updated Index view has one problem.</span></span> <span data-ttu-id="5da4c-216">Quando você clica em um grupo de contatos, o grupo selecionado não é realçado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-216">When you click a contact group, the selected group is not highlighted.</span></span> <span data-ttu-id="5da4c-217">Como a lista de grupos é exibida fora da região que é atualizada durante uma solicitação Ajax, o grupo correto não obter realçado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-217">Because the list of groups is displayed outside of the region that is updated during an Ajax request, the right group does not get highlighted.</span></span> <span data-ttu-id="5da4c-218">Corrigiremos esse problema na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="5da4c-218">We'll fix this issue in the next section.</span></span>


## <a name="adding-jquery-animation-effects"></a><span data-ttu-id="5da4c-219">A adição de efeitos de animação do jQuery</span><span class="sxs-lookup"><span data-stu-id="5da4c-219">Adding jQuery Animation Effects</span></span>

<span data-ttu-id="5da4c-220">Normalmente, quando você clica em um link em uma página da web, você pode usar a barra de progresso do navegador para detectar se o navegador está ativamente buscando o conteúdo atualizado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-220">Normally, when you click a link in a web page, you can use the browser progress bar to detect whether or not the browser is actively fetching the updated content.</span></span> <span data-ttu-id="5da4c-221">Ao executar uma solicitação Ajax, por outro lado, a barra de progresso do navegador não mostra nenhum progresso.</span><span class="sxs-lookup"><span data-stu-id="5da4c-221">When performing an Ajax request, on the other hand, the browser progress bar does not show any progress.</span></span> <span data-ttu-id="5da4c-222">Isso pode tornar os usuários preocupados.</span><span class="sxs-lookup"><span data-stu-id="5da4c-222">This can make users nervous.</span></span> <span data-ttu-id="5da4c-223">Como saber se o navegador tem congelado?</span><span class="sxs-lookup"><span data-stu-id="5da4c-223">How do you know whether the browser has frozen?</span></span>

<span data-ttu-id="5da4c-224">Há várias maneiras que você pode indicar a um usuário que o trabalho está sendo executado durante a execução de uma solicitação Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-224">There are several ways that you can indicate to a user that work is being performed while performing an Ajax request.</span></span> <span data-ttu-id="5da4c-225">Uma abordagem é exibir uma animação simples.</span><span class="sxs-lookup"><span data-stu-id="5da4c-225">One approach is to display a simple animation.</span></span> <span data-ttu-id="5da4c-226">Por exemplo, você pode esmaecer uma região quando uma solicitação Ajax começa e aplicar fade-in da região quando a solicitação é concluída.</span><span class="sxs-lookup"><span data-stu-id="5da4c-226">For example, you can fade out a region when an Ajax request begins and fade in the region when the request completes.</span></span>

<span data-ttu-id="5da4c-227">Vamos usar a biblioteca jQuery, que é incluída com a estrutura Microsoft ASP.NET MVC, para criar os efeitos de animação.</span><span class="sxs-lookup"><span data-stu-id="5da4c-227">We'll use the jQuery library which is included with the Microsoft ASP.NET MVC framework, to create the animation effects.</span></span> <span data-ttu-id="5da4c-228">O modo de exibição de índice atualizado está contido na listagem 4.</span><span class="sxs-lookup"><span data-stu-id="5da4c-228">The updated Index view is contained in Listing 4.</span></span>

<span data-ttu-id="5da4c-229">**Listagem 4 - Views\Contact\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="5da4c-229">**Listing 4 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample6.aspx)]

<span data-ttu-id="5da4c-230">Observe que o modo de exibição atualizado do índice contém três novas funções de JavaScript.</span><span class="sxs-lookup"><span data-stu-id="5da4c-230">Notice that the updated Index view contains three new JavaScript functions.</span></span> <span data-ttu-id="5da4c-231">As duas primeiras funções usarem jQuery para esmaecer e aplicar fade-in a lista de contatos quando você clica em um novo grupo de contato.</span><span class="sxs-lookup"><span data-stu-id="5da4c-231">The first two functions use jQuery to fade out and fade in the list of contacts when you click a new contact group.</span></span> <span data-ttu-id="5da4c-232">A terceira função exibe uma mensagem de erro quando uma solicitação do Ajax resulta em um erro (por exemplo, tempo limite de rede).</span><span class="sxs-lookup"><span data-stu-id="5da4c-232">The third function displays an error message when an Ajax request results in an error (for example, network timeout).</span></span>

<span data-ttu-id="5da4c-233">A primeira função também se encarrega de realce o grupo selecionado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-233">The first function also takes care of highlighting the selected group.</span></span> <span data-ttu-id="5da4c-234">Uma classe = atributo selecionado é adicionado ao elemento pai (o elemento LI) do elemento clicado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-234">A class= selected attribute is added to the parent element (the LI element) of the element clicked.</span></span> <span data-ttu-id="5da4c-235">Novamente, o jQuery facilita a seleção do elemento certo e adicione a classe CSS.</span><span class="sxs-lookup"><span data-stu-id="5da4c-235">Again, jQuery makes it easy to select the right element and add the CSS class.</span></span>

<span data-ttu-id="5da4c-236">Esses scripts estão vinculados aos links de grupo com a Ajuda do parâmetro Ajax.ActionLink() AjaxOptions.</span><span class="sxs-lookup"><span data-stu-id="5da4c-236">These scripts are tied to the group links with the help of the Ajax.ActionLink() AjaxOptions parameter.</span></span> <span data-ttu-id="5da4c-237">A chamada de método Ajax.ActionLink() atualizada tem esta aparência:</span><span class="sxs-lookup"><span data-stu-id="5da4c-237">The updated Ajax.ActionLink() method call looks like this:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample7.aspx)]

## <a name="adding-browser-history-support"></a><span data-ttu-id="5da4c-238">Adicionar suporte de histórico do navegador</span><span class="sxs-lookup"><span data-stu-id="5da4c-238">Adding Browser History Support</span></span>

<span data-ttu-id="5da4c-239">Normalmente, quando você clica em um link para uma página de atualização, o histórico do navegador é atualizado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-239">Normally, when you click a link to update a page, your browser history is updated.</span></span> <span data-ttu-id="5da4c-240">Dessa forma, você pode clicar o botão Voltar do navegador para voltar no tempo para o estado anterior da página.</span><span class="sxs-lookup"><span data-stu-id="5da4c-240">That way, you can click the browser Back button to move back in time to the previous state of the page.</span></span> <span data-ttu-id="5da4c-241">Por exemplo, se você clique no grupo de contato de amigos e, em seguida, clique no grupo de contato de negócios, você pode clicar o botão Voltar do navegador para navegar de volta para o estado da página quando o grupo de contato de amigos foi selecionado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-241">For example, if you click the Friends contact group and then click the Business contact group, you can click the browser Back button to navigate back to the state of the page when the Friends contact group was selected.</span></span>

<span data-ttu-id="5da4c-242">Infelizmente, executar uma solicitação Ajax não atualiza o histórico do navegador automaticamente.</span><span class="sxs-lookup"><span data-stu-id="5da4c-242">Unfortunately, performing an Ajax request does not update browser history automatically.</span></span> <span data-ttu-id="5da4c-243">Se você clicar em um grupo de contatos e a lista de contatos correspondentes é recuperada com uma solicitação Ajax, o histórico do navegador não é atualizado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-243">If you click a contact group, and the list of matching contacts is retrieved with an Ajax request, then the browser history is not updated.</span></span> <span data-ttu-id="5da4c-244">Você não pode usar o botão Voltar do navegador para navegar de volta para um grupo de contatos depois de selecionar um novo grupo de contato.</span><span class="sxs-lookup"><span data-stu-id="5da4c-244">You cannot use the browser Back button to navigate back to a contact group after selecting a new contact group.</span></span>

<span data-ttu-id="5da4c-245">Se você quiser que os usuários possam usar o navegador de volta botão depois de executar as solicitações Ajax, em seguida, você precisa executar um pouco mais trabalho.</span><span class="sxs-lookup"><span data-stu-id="5da4c-245">If you want users to be able to use the browser Back button after performing Ajax requests then you need to perform a little more work.</span></span> <span data-ttu-id="5da4c-246">Você precisa aproveitar a funcionalidade de gerenciamento de histórico do navegador criada na estrutura ASP.NET AJAX.</span><span class="sxs-lookup"><span data-stu-id="5da4c-246">You need to take advantage of the browser history management functionality built in the ASP.NET AJAX Framework.</span></span>

<span data-ttu-id="5da4c-247">Histórico do navegador ASP.NET AJAX, você precisa fazer três coisas:</span><span class="sxs-lookup"><span data-stu-id="5da4c-247">ASP.NET AJAX browser history, you need to do three things:</span></span>

1. <span data-ttu-id="5da4c-248">Habilite o histórico do navegador, definindo a propriedade enableBrowserHistory como true.</span><span class="sxs-lookup"><span data-stu-id="5da4c-248">Enable Browser History by setting the enableBrowserHistory property to true.</span></span>
2. <span data-ttu-id="5da4c-249">Salve pontos de histórico quando muda o estado de uma exibição chamando o método addHistoryPoint().</span><span class="sxs-lookup"><span data-stu-id="5da4c-249">Save history points when the state of a view changes by calling the addHistoryPoint() method.</span></span>
3. <span data-ttu-id="5da4c-250">Reconstrua o estado da exibição quando o evento navigate é gerado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-250">Reconstruct the state of the view when the navigate event is raised.</span></span>

<span data-ttu-id="5da4c-251">O modo de exibição de índice atualizado está contido na listagem 5.</span><span class="sxs-lookup"><span data-stu-id="5da4c-251">The updated Index view is contained in Listing 5.</span></span>

<span data-ttu-id="5da4c-252">**Listagem 5 - Views\Contact\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="5da4c-252">**Listing 5 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample8.aspx)]

<span data-ttu-id="5da4c-253">Na listagem 5, o histórico do navegador é habilitado na função pageInit().</span><span class="sxs-lookup"><span data-stu-id="5da4c-253">In Listing 5, Browser History is enabled in the pageInit() function.</span></span> <span data-ttu-id="5da4c-254">A função pageInit() também é usada para definir um manipulador de eventos para o evento navigate.</span><span class="sxs-lookup"><span data-stu-id="5da4c-254">The pageInit() function is also used to set up the event handler for the navigate event.</span></span> <span data-ttu-id="5da4c-255">O evento navigate é gerado sempre que o botão Voltar ou Avançar do navegador faz com que o estado da página para alterar.</span><span class="sxs-lookup"><span data-stu-id="5da4c-255">The navigate event is raised whenever the browser Forward or Back button causes the state of the page to change.</span></span>

<span data-ttu-id="5da4c-256">O método beginContactList() é chamado quando você clica em um grupo de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-256">The beginContactList() method is called when you click a contact group.</span></span> <span data-ttu-id="5da4c-257">Esse método cria um novo ponto de histórico, chamando o método addHistoryPoint().</span><span class="sxs-lookup"><span data-stu-id="5da4c-257">This method creates a new history point by calling the addHistoryPoint() method.</span></span> <span data-ttu-id="5da4c-258">A id do grupo de contatos clicado é adicionada ao histórico.</span><span class="sxs-lookup"><span data-stu-id="5da4c-258">The id of the contact group clicked is added to history.</span></span>

<span data-ttu-id="5da4c-259">A id do grupo é recuperada de um atributo expando no link contato do grupo.</span><span class="sxs-lookup"><span data-stu-id="5da4c-259">The group id is retrieved from an expando attribute on the contact group link.</span></span> <span data-ttu-id="5da4c-260">O link é renderizado com a seguinte chamada para Ajax.ActionLink().</span><span class="sxs-lookup"><span data-stu-id="5da4c-260">The link is rendered with the following call to Ajax.ActionLink().</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample9.aspx)]

<span data-ttu-id="5da4c-261">O último parâmetro passado para o Ajax.ActionLink() adiciona um atributo expando chamado groupid o link (letras minúsculas para compatibilidade XHTML).</span><span class="sxs-lookup"><span data-stu-id="5da4c-261">The last parameter passed to the Ajax.ActionLink() adds an expando attribute named groupid to the link (lowercase for XHTML compatibility).</span></span>

<span data-ttu-id="5da4c-262">Quando um usuário pressiona o botão Avançar ou voltar do navegador, o evento navigate é gerado e o método navigate() é chamado.</span><span class="sxs-lookup"><span data-stu-id="5da4c-262">When a user hits the browser Back or Forward button, the navigate event is raised and the navigate() method is called.</span></span> <span data-ttu-id="5da4c-263">Esse método atualiza os contatos exibidos na página para coincidir com o estado da página que corresponde ao passado para o método navigate do ponto de histórico do navegador.</span><span class="sxs-lookup"><span data-stu-id="5da4c-263">This method updates the contacts displayed in the page to match the state of the page that corresponds to the browser history point passed to the navigate method.</span></span>

## <a name="performing-ajax-deletes"></a><span data-ttu-id="5da4c-264">Executar o Ajax exclui</span><span class="sxs-lookup"><span data-stu-id="5da4c-264">Performing Ajax Deletes</span></span>

<span data-ttu-id="5da4c-265">No momento, para excluir um contato, você precisa clicar no link excluir e, em seguida, clique no botão de exclusão exibido na página de confirmação de exclusão (veja a Figura 2).</span><span class="sxs-lookup"><span data-stu-id="5da4c-265">Currently, in order to delete a contact, you need to click on the Delete link and then click the Delete button displayed in the delete confirmation page (see Figure 2).</span></span> <span data-ttu-id="5da4c-266">Isso parece muito de solicitações de página para fazer algo simples, como a exclusão de um registro de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5da4c-266">This seems like a lot of page requests to do something simple like deleting a database record.</span></span>


<span data-ttu-id="5da4c-267">[![A página de confirmação de exclusão](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="5da4c-267">[![The delete confirmation page](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span></span>

<span data-ttu-id="5da4c-268">**Figura 02**: A página de confirmação de exclusão ([clique para exibir a imagem em tamanho normal](iteration-7-add-ajax-functionality-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="5da4c-268">**Figure 02**: The delete confirmation page([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image4.png))</span></span>


<span data-ttu-id="5da4c-269">É tentador para ignorar a página de confirmação de exclusão e excluir um contato diretamente da exibição índice.</span><span class="sxs-lookup"><span data-stu-id="5da4c-269">It is tempting to skip the delete confirmation page and delete a contact directly from the Index view.</span></span> <span data-ttu-id="5da4c-270">Você deve evitar essa tentação porque essa abordagem abre seu aplicativo para brechas de segurança.</span><span class="sxs-lookup"><span data-stu-id="5da4c-270">You should avoid this temptation because taking this approach opens your application to security holes.</span></span> <span data-ttu-id="5da4c-271">Em geral, don t deseja executar uma operação HTTP GET ao invocar uma ação que modifica o estado do seu aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="5da4c-271">In general, you don t want to perform an HTTP GET operation when invoking an action that modifies the state of your web application.</span></span> <span data-ttu-id="5da4c-272">Quando executar um delete, que você deseja executar um HTTP POST, ou melhor ainda, uma operação HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="5da4c-272">When performing a delete, you want to perform an HTTP POST, or better yet, an HTTP DELETE operation.</span></span>

<span data-ttu-id="5da4c-273">O link excluir está contido no ContactList parcial.</span><span class="sxs-lookup"><span data-stu-id="5da4c-273">The Delete link is contained in the ContactList partial.</span></span> <span data-ttu-id="5da4c-274">Uma versão atualizada do ContactList parcial está contida na listagem 6.</span><span class="sxs-lookup"><span data-stu-id="5da4c-274">An updated version of the ContactList partial is contained in Listing 6.</span></span>

<span data-ttu-id="5da4c-275">**Listagem 6 - Views\Contact\ContactList.ascx**</span><span class="sxs-lookup"><span data-stu-id="5da4c-275">**Listing 6 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample10.aspx)]

<span data-ttu-id="5da4c-276">O link de exclusão é renderizado com a seguinte chamada para o método Ajax.ImageActionLink():</span><span class="sxs-lookup"><span data-stu-id="5da4c-276">The Delete link is rendered with the following call to the Ajax.ImageActionLink() method:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample11.aspx)]

> [!NOTE] 
> 
> <span data-ttu-id="5da4c-277">O Ajax.ImageActionLink() não é uma parte padrão da estrutura MVC do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5da4c-277">The Ajax.ImageActionLink() is not a standard part of the ASP.NET MVC framework.</span></span> <span data-ttu-id="5da4c-278">O Ajax.ImageActionLink() é um método auxiliar personalizado incluído no projeto do Gerenciador de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-278">The Ajax.ImageActionLink() is a custom helper methods included in the Contact Manager project.</span></span>


<span data-ttu-id="5da4c-279">O parâmetro AjaxOptions tem duas propriedades.</span><span class="sxs-lookup"><span data-stu-id="5da4c-279">The AjaxOptions parameter has two properties.</span></span> <span data-ttu-id="5da4c-280">Em primeiro lugar, a propriedade confirmar é usada para exibir uma caixa de diálogo de confirmação de JavaScript do pop-up.</span><span class="sxs-lookup"><span data-stu-id="5da4c-280">First, the Confirm property is used to display a popup JavaScript confirmation dialog.</span></span> <span data-ttu-id="5da4c-281">Em segundo lugar, a propriedade HttpMethod é usada para executar uma operação HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="5da4c-281">Second, the HttpMethod property is used to perform an HTTP DELETE operation.</span></span>

<span data-ttu-id="5da4c-282">Listagem 7 contém uma nova ação de AjaxDelete() que foi adicionada ao controlador de contato.</span><span class="sxs-lookup"><span data-stu-id="5da4c-282">Listing 7 contains a new AjaxDelete() action that has been added to the Contact controller.</span></span>

<span data-ttu-id="5da4c-283">**Listagem 7 - Controllers\ContactController.cs (AjaxDelete)**</span><span class="sxs-lookup"><span data-stu-id="5da4c-283">**Listing 7 - Controllers\ContactController.cs (AjaxDelete)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample12.cs)]

<span data-ttu-id="5da4c-284">A ação AjaxDelete() é decorada com um atributo AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="5da4c-284">The AjaxDelete() action is decorated with an AcceptVerbs attribute.</span></span> <span data-ttu-id="5da4c-285">Esse atributo impede que a ação seja chamado, exceto por qualquer operação de HTTP diferente de uma operação HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="5da4c-285">This attribute prevents the action from being invoked except by any HTTP operation other than an HTTP DELETE operation.</span></span> <span data-ttu-id="5da4c-286">Em particular, você não pode chamar a ação com um HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="5da4c-286">In particular, you cannot invoke this action with an HTTP GET.</span></span>

<span data-ttu-id="5da4c-287">Depois de excluir o registro de banco de dados, você precisa exibir a lista atualizada de contatos que não contém o registro excluído.</span><span class="sxs-lookup"><span data-stu-id="5da4c-287">After you delete database record, you need to display the updated list of contacts that does not contain the deleted record.</span></span> <span data-ttu-id="5da4c-288">O método AjaxDelete() retorna o ContactList parcial e a lista atualizada de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-288">The AjaxDelete() method returns the ContactList partial and the updated list of contacts.</span></span>

## <a name="summary"></a><span data-ttu-id="5da4c-289">Resumo</span><span class="sxs-lookup"><span data-stu-id="5da4c-289">Summary</span></span>

<span data-ttu-id="5da4c-290">Essa iteração, adicionamos a funcionalidade do Ajax ao nosso aplicativo Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="5da4c-290">In this iteration, we added Ajax functionality to our Contact Manager application.</span></span> <span data-ttu-id="5da4c-291">Nós usamos o Ajax para melhorar a capacidade de resposta e o desempenho do nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5da4c-291">We used Ajax to improve the responsiveness and performance of our application.</span></span>

<span data-ttu-id="5da4c-292">Primeiro, podemos refatorar a exibição índice de modo que clicar em um grupo de contato não atualiza a exibição inteira.</span><span class="sxs-lookup"><span data-stu-id="5da4c-292">First, we refactored the Index view so that clicking a contact group does not update the entire view.</span></span> <span data-ttu-id="5da4c-293">Em vez disso, clicar em um grupo de contato somente atualiza a lista de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-293">Instead, clicking a contact group only updates the list of contacts.</span></span>

<span data-ttu-id="5da4c-294">Em seguida, usamos efeitos de animação do jQuery para esmaecer e aplicar fade-in a lista de contatos.</span><span class="sxs-lookup"><span data-stu-id="5da4c-294">Next, we used jQuery animation effects to fade out and fade in the list of contacts.</span></span> <span data-ttu-id="5da4c-295">Adicionando animação a um aplicativo Ajax pode ser usado para fornecer aos usuários do aplicativo com o equivalente de uma barra de progresso do navegador.</span><span class="sxs-lookup"><span data-stu-id="5da4c-295">Adding animation to an Ajax application can be used to provide users of the application with the equivalent of a browser progress bar.</span></span>

<span data-ttu-id="5da4c-296">Também adicionamos suporte ao histórico de navegador para o nosso aplicativo Ajax.</span><span class="sxs-lookup"><span data-stu-id="5da4c-296">We also added browser history support to our Ajax application.</span></span> <span data-ttu-id="5da4c-297">Habilitamos a usuários, clique novamente no navegador e encaminhar os botões para alterar o estado da exibição índice.</span><span class="sxs-lookup"><span data-stu-id="5da4c-297">We enabled users to click the browser Back and Forward buttons to change the state of the Index view.</span></span>

<span data-ttu-id="5da4c-298">Por fim, criamos um link de exclusão que dá suporte a operações HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="5da4c-298">Finally, we created a delete link that supports HTTP DELETE operations.</span></span> <span data-ttu-id="5da4c-299">Ao realizar exclusões de Ajax, podemos permitir que os usuários excluir registros de banco de dados sem exigir que o usuário solicitar uma página de confirmação de exclusão adicionais.</span><span class="sxs-lookup"><span data-stu-id="5da4c-299">By performing Ajax deletes, we enable users to delete database records without requiring the user to request an additional delete confirmation page.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5da4c-300">[Anterior](iteration-6-use-test-driven-development-cs.md)
> [Próximo](iteration-1-create-the-application-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5da4c-300">[Previous](iteration-6-use-test-driven-development-cs.md)
[Next](iteration-1-create-the-application-vb.md)</span></span>
