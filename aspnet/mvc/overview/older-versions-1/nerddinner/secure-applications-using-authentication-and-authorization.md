---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Proteger aplicativos usando a autenticação e autorização | Microsoft Docs
author: microsoft
description: Etapa 9 mostra como adicionar autenticação e autorização para proteger o nosso aplicativo NerdDinner, para que os usuários precisam registrar e faça logon no site para criar...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 8d509c5f15bb4d5014e53b8dc2a736454238e72c
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65122222"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="97aeb-103">Proteger aplicativos usando autenticação e autorização</span><span class="sxs-lookup"><span data-stu-id="97aeb-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="97aeb-104">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="97aeb-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="97aeb-105">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="97aeb-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="97aeb-106">Esta é a etapa 9 do grátis [aplicativo "NerdDinner"](introducing-the-nerddinner-tutorial.md) que orienta-through como criar um pequeno, mas concluir, o aplicativo web usando ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="97aeb-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="97aeb-107">Etapa 9 mostra como adicionar autenticação e autorização para proteger o nosso aplicativo NerdDinner, para que os usuários precisam registrar e faça logon no site para criar novo jantares e somente o usuário que está hospedando um jantar pode editá-lo mais tarde.</span><span class="sxs-lookup"><span data-stu-id="97aeb-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="97aeb-108">Se você estiver usando o ASP.NET MVC 3, recomendamos que você siga a [obtendo iniciado com o MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [Store de música do MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutoriais.</span><span class="sxs-lookup"><span data-stu-id="97aeb-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="97aeb-109">NerdDinner etapa 9: Autenticação e autorização</span><span class="sxs-lookup"><span data-stu-id="97aeb-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="97aeb-110">No momento a nosso NerdDinner aplicativo concede a qualquer pessoa que visitar o site a capacidade de criar e editar os detalhes de qualquer jantar.</span><span class="sxs-lookup"><span data-stu-id="97aeb-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="97aeb-111">Vamos alterar isso para que os usuários precisam registrar e faça logon no site para criar novo jantares e adicionar uma restrição de modo que somente o usuário que está hospedando um jantar pode editá-lo mais tarde.</span><span class="sxs-lookup"><span data-stu-id="97aeb-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="97aeb-112">Para habilitar isso, usaremos a autenticação e autorização para proteger o nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="97aeb-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="97aeb-113">Noções básicas sobre autenticação e autorização</span><span class="sxs-lookup"><span data-stu-id="97aeb-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="97aeb-114">*Autenticação* é o processo de identificar e validar a identidade de um cliente acessando um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="97aeb-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="97aeb-115">Em termos mais simples, é sobre como identificar "quem é o usuário final é quando eles visitam um site da Web".</span><span class="sxs-lookup"><span data-stu-id="97aeb-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="97aeb-116">ASP.NET oferece suporte a várias maneiras de autenticar os usuários do navegador.</span><span class="sxs-lookup"><span data-stu-id="97aeb-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="97aeb-117">Para aplicativos da web da Internet, a abordagem mais comum de autenticação usada é chamada de "Autenticação de formulários".</span><span class="sxs-lookup"><span data-stu-id="97aeb-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="97aeb-118">Autenticação de formulários permite que um desenvolvedor criar um formulário de logon HTML dentro de seu aplicativo e, em seguida, validar o nome de usuário/senha de que um usuário final envia em relação a um banco de dados ou outro armazenamento de credenciais de senha.</span><span class="sxs-lookup"><span data-stu-id="97aeb-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="97aeb-119">Se a combinação de nome de usuário/senha estiver correta, o desenvolvedor pode, em seguida, peça ao ASP.NET para emitir um cookie HTTP criptografado para identificar o usuário entre as solicitações futuras.</span><span class="sxs-lookup"><span data-stu-id="97aeb-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="97aeb-120">Vamos usar a autenticação de formulários com nosso aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="97aeb-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="97aeb-121">*Autorização* é o processo de determinar se um usuário autenticado tem permissão para acessar um recurso/URL específico ou para realizar alguma ação.</span><span class="sxs-lookup"><span data-stu-id="97aeb-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="97aeb-122">Por exemplo, dentro do nosso aplicativo NerdDinner, desejaremos autorizar que somente os usuários que estão conectados podem acessar o *jantares/criar* URL e criar novos jantares.</span><span class="sxs-lookup"><span data-stu-id="97aeb-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="97aeb-123">Podemos também desejará adicionar lógica de autorização para que somente o usuário que está hospedando um jantar possa editá-lo – e negar acesso de edição para todos os outros usuários.</span><span class="sxs-lookup"><span data-stu-id="97aeb-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="97aeb-124">Autenticação de formulários e a AccountController</span><span class="sxs-lookup"><span data-stu-id="97aeb-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="97aeb-125">O modelo de projeto do Visual Studio padrão para o ASP.NET MVC automaticamente habilita a autenticação de formulários quando novos aplicativos ASP.NET MVC são criados.</span><span class="sxs-lookup"><span data-stu-id="97aeb-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="97aeb-126">Ele também adicionará automaticamente uma implementação de página de logon de conta criado previamente para o projeto – o que torna muito fácil integrar a segurança dentro de um site.</span><span class="sxs-lookup"><span data-stu-id="97aeb-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="97aeb-127">Página mestra padrão Master exibe um link "Fazer logon" na parte superior direita do site quando o usuário acessá-los não for autenticado:</span><span class="sxs-lookup"><span data-stu-id="97aeb-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="97aeb-128">Ao clicar no link "Fazer logon" leva a um usuário para o */conta/LogOn* URL:</span><span class="sxs-lookup"><span data-stu-id="97aeb-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="97aeb-129">Os visitantes que ainda não registrou podem fazer isso clicando no link "Registrar" – que o levará para o */conta/registro* URL e permitir que eles Insira detalhes da conta:</span><span class="sxs-lookup"><span data-stu-id="97aeb-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="97aeb-130">Clicar no botão "Registrar" criar um novo usuário no sistema de associação do ASP.NET e autenticar o usuário no site usando a autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="97aeb-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="97aeb-131">Quando um usuário estiver conectado, o site altera o canto superior direito da página para gerar um "Bem-vindo [username]!"</span><span class="sxs-lookup"><span data-stu-id="97aeb-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="97aeb-132">mensagem e processa um "fazer logoff" link em vez de um "fazer logon" um.</span><span class="sxs-lookup"><span data-stu-id="97aeb-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="97aeb-133">Ao clicar no link "Fazer logoff" faz logoff do usuário:</span><span class="sxs-lookup"><span data-stu-id="97aeb-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="97aeb-134">A funcionalidade de login, logout e registro acima é implementada na classe AccountController que foi adicionada ao nosso projeto pelo Visual Studio quando ele criou o projeto.</span><span class="sxs-lookup"><span data-stu-id="97aeb-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="97aeb-135">A interface do usuário para o AccountController é implementado usando modelos de exibição dentro do diretório \Views\Account:</span><span class="sxs-lookup"><span data-stu-id="97aeb-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="97aeb-136">A classe AccountController usa o sistema de autenticação de formulários ASP.NET para emitir cookies de autenticação criptografado e a API Membership do ASP.NET para armazenar e validar os nomes de usuário/senhas.</span><span class="sxs-lookup"><span data-stu-id="97aeb-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="97aeb-137">A API Membership do ASP.NET é extensível e permite que qualquer armazenamento de credenciais de senha a ser usado.</span><span class="sxs-lookup"><span data-stu-id="97aeb-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="97aeb-138">ASP.NET é fornecido com implementações do provedor de associação interna que armazena o nome de usuário/senha dentro de um banco de dados SQL ou dentro do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="97aeb-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="97aeb-139">Podemos configurar qual provedor de associação que nosso aplicativo NerdDinner deve usar abrindo o arquivo Web. config"na raiz do projeto e procurando o &lt;associação&gt; seção dentro dele.</span><span class="sxs-lookup"><span data-stu-id="97aeb-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="97aeb-140">Registra o provedor de associação SQL Web. config padrão adicionada quando o projeto foi criado e configura-o para usar uma cadeia de conexão nomeada "ApplicationServices" para especificar o local do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="97aeb-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="97aeb-141">A cadeia de conexão padrão "ApplicationServices" (que é especificado dentro de &lt;connectionStrings&gt; seção do arquivo Web. config) está configurado para usar o SQL Express.</span><span class="sxs-lookup"><span data-stu-id="97aeb-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="97aeb-142">Ele aponta para um banco de dados do SQL Express chamado "ASPNETDB. Arquivos MDF"sob o aplicativo" aplicativo\_dados "directory.</span><span class="sxs-lookup"><span data-stu-id="97aeb-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="97aeb-143">Se esse banco de dados não existir na primeira vez em que a API de associação é usada dentro do aplicativo, o ASP.NET será criar o banco de dados automaticamente e provisione o esquema de banco de dados de associação apropriado dentro dele:</span><span class="sxs-lookup"><span data-stu-id="97aeb-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="97aeb-144">Se, em vez de usar o SQL Express queríamos usar uma instância completa do SQL Server (ou se conectar a um banco de dados remoto), tudo o que seria necessário tarefas pendentes é atualizar a cadeia de conexão "ApplicationServices" dentro do arquivo Web. config e certifique-se de que o esquema de associação apropriado foi adicionado ao banco de dados que aponta para ele.</span><span class="sxs-lookup"><span data-stu-id="97aeb-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="97aeb-145">Você pode executar o "aspnet\_regsql.exe" utilitário dentro do diretório \Windows\Microsoft.NET\Framework\v2.0.50727\ para adicionar o esquema apropriado para a associação e outros serviços do aplicativo ASP.NET a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="97aeb-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="97aeb-146">Autorização de URL jantares/criar usando o filtro [Authorize]</span><span class="sxs-lookup"><span data-stu-id="97aeb-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="97aeb-147">Não temos de escrever nenhum código para habilitar uma autenticação segura e a implementação de gerenciamento de conta para o aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="97aeb-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="97aeb-148">Os usuários podem registrar novas contas com nosso aplicativo e logon/logoff do site.</span><span class="sxs-lookup"><span data-stu-id="97aeb-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="97aeb-149">Agora podemos adicionar lógica de autorização para o aplicativo e usar o status de autenticação e o nome de usuário de visitantes para controlar o que eles podem e não podem fazer dentro do site.</span><span class="sxs-lookup"><span data-stu-id="97aeb-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="97aeb-150">Vamos começar pela adição de lógica de autorização para os métodos de ação de "Criar" da nossa classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="97aeb-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="97aeb-151">Especificamente, será exigido que os usuários que acessam o *jantares/criar* URL deve estar conectado.</span><span class="sxs-lookup"><span data-stu-id="97aeb-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="97aeb-152">Se eles não são registrados nós será redirecioná-las para a página de logon para que eles possam entrar no.</span><span class="sxs-lookup"><span data-stu-id="97aeb-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="97aeb-153">Implementar essa lógica é muito fácil.</span><span class="sxs-lookup"><span data-stu-id="97aeb-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="97aeb-154">Tudo que precisamos de tarefas pendentes é adicionar um atributo de filtro [Authorize] para nossos métodos de ação de criar da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="97aeb-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="97aeb-155">ASP.NET MVC suporta a capacidade de criar "filtros de ação" que podem ser usados para implementar a lógica reutilizável que pode ser aplicada declarativamente aos métodos de ação.</span><span class="sxs-lookup"><span data-stu-id="97aeb-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="97aeb-156">O filtro [Authorize] é um dos filtros de ação integrada fornecidos pelo ASP.NET MVC, e ele permite que um desenvolvedor declarativamente aplicar regras de autorização para métodos de ação e as classes do controlador.</span><span class="sxs-lookup"><span data-stu-id="97aeb-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="97aeb-157">Quando aplicado sem parâmetros (como acima) o filtro [Authorize] impõe que o usuário que fez a solicitação do método de ação deve estar conectado – e ele será redirecionado automaticamente o navegador para a URL de logon se eles não forem.</span><span class="sxs-lookup"><span data-stu-id="97aeb-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="97aeb-158">Ao realizar esse redirecionamento, a URL solicitada originalmente é passada como um argumento de cadeia de consulta (por exemplo: / conta/LogOn? ReturnUrl = % 2fDinners % 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="97aeb-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="97aeb-159">O AccountController, em seguida, redirecione o usuário para a URL solicitada originalmente depois que ele faça logon.</span><span class="sxs-lookup"><span data-stu-id="97aeb-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="97aeb-160">O filtro [Authorize] ofereça suporte opcionalmente a capacidade de especificar uma propriedade "Usuários" ou "Funções" que pode ser usada para exigir que o usuário ambos registrado no e dentro de uma lista de usuários permitidos ou um membro de uma função de segurança permitidos.</span><span class="sxs-lookup"><span data-stu-id="97aeb-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="97aeb-161">Por exemplo, o código a seguir somente permite que dois usuários específicos, "scottgu" e "billg" acessar a URL de jantares/criar:</span><span class="sxs-lookup"><span data-stu-id="97aeb-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="97aeb-162">Inserir nomes de usuário específicos dentro do código tende a ser muito não passível de manutenção no entanto.</span><span class="sxs-lookup"><span data-stu-id="97aeb-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="97aeb-163">Uma abordagem melhor é definir "funções" de nível mais altos que o código verifica contra e, então, mapear os usuários na função usando um banco de dados ou o sistema do Active Directory (habilitando a lista de mapeamento de usuário real a ser armazenada externamente do código).</span><span class="sxs-lookup"><span data-stu-id="97aeb-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="97aeb-164">O ASP.NET inclui uma API de gerenciamento de função interna, bem como um conjunto interno de provedores de função (incluindo aqueles para SQL e Active Directory) que podem ajudar a realizar esse mapeamento de função/usuário.</span><span class="sxs-lookup"><span data-stu-id="97aeb-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="97aeb-165">Em seguida, podemos foi possível atualizar o código para permitir que somente usuários dentro de uma função específica "admin" acessar a URL de jantares/criar:</span><span class="sxs-lookup"><span data-stu-id="97aeb-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="97aeb-166">Usando a propriedade User.Identity.Name durante a criação de jantares</span><span class="sxs-lookup"><span data-stu-id="97aeb-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="97aeb-167">Podemos recuperar o nome de usuário do usuário conectado no momento de uma solicitação usando a propriedade User.Identity.Name exposta na classe base do controlador.</span><span class="sxs-lookup"><span data-stu-id="97aeb-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="97aeb-168">Anteriores quando implementamos a versão do HTTP POST do nosso método de ação Create () tínhamos codificado a propriedade "HostedBy" de jantar para uma cadeia de caracteres estática.</span><span class="sxs-lookup"><span data-stu-id="97aeb-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="97aeb-169">Podemos pode agora atualizar esse código em vez de usar a propriedade User.Identity.Name, bem como adicionar automaticamente uma confirmação de presença para o host criando o jantar:</span><span class="sxs-lookup"><span data-stu-id="97aeb-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="97aeb-170">Como adicionamos um atributo [autorizar] ao método Create (), ASP.NET MVC garante que o método de ação é executada apenas se o usuário visitar a URL de jantares/criar estiver conectado no site.</span><span class="sxs-lookup"><span data-stu-id="97aeb-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="97aeb-171">Como tal, o valor da propriedade User.Identity.Name sempre conterá um nome de usuário válido.</span><span class="sxs-lookup"><span data-stu-id="97aeb-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="97aeb-172">Usando a propriedade User.Identity.Name ao editar jantares</span><span class="sxs-lookup"><span data-stu-id="97aeb-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="97aeb-173">Agora, vamos adicionar alguma lógica de autorização que restringe os usuários para que eles só podem editar as propriedades de jantares que eles mesmos estão hospedando.</span><span class="sxs-lookup"><span data-stu-id="97aeb-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="97aeb-174">Para ajudar com isso, vamos primeiro adicionar um método auxiliar de "IsHostedBy(username)" ao nosso objeto de jantar (dentro da classe parcial do Dinner.cs que criamos anteriormente).</span><span class="sxs-lookup"><span data-stu-id="97aeb-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="97aeb-175">Esse método auxiliar retorna true ou false dependendo se um nome de usuário fornecido corresponde à propriedade HostedBy jantar e encapsula a lógica necessária executar uma comparação de cadeia de caracteres de maiusculas e minúsculas delas:</span><span class="sxs-lookup"><span data-stu-id="97aeb-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="97aeb-176">Em seguida, adicionaremos um atributo [autorizar] para os métodos de ação Edit () dentro de nossa classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="97aeb-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="97aeb-177">Isso garantirá que os usuários devem estar conectados a solicitação de um */Dinners/Editar / [id]* URL.</span><span class="sxs-lookup"><span data-stu-id="97aeb-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="97aeb-178">Em seguida, podemos adicionar código para nossos métodos de edição que usa o método auxiliar Dinner.IsHostedBy(username) para verificar se o usuário conectado corresponde ao host do jantar.</span><span class="sxs-lookup"><span data-stu-id="97aeb-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="97aeb-179">Se o usuário não é o host, vamos mostrar uma exibição de "InvalidOwner" e encerrar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="97aeb-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="97aeb-180">O código para fazer isso se parece com abaixo:</span><span class="sxs-lookup"><span data-stu-id="97aeb-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="97aeb-181">Podemos, em seguida, clique com botão direito no diretório \Views\Dinners e escolha Add -&gt;exibir comando de menu para criar uma nova exibição de "InvalidOwner".</span><span class="sxs-lookup"><span data-stu-id="97aeb-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="97aeb-182">Podemos irá preenchê-lo com a mensagem de erro abaixo:</span><span class="sxs-lookup"><span data-stu-id="97aeb-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="97aeb-183">E agora quando um usuário de tenta editar um jantar não possuem, ele obterá uma mensagem de erro:</span><span class="sxs-lookup"><span data-stu-id="97aeb-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="97aeb-184">Podemos pode repetir as mesmas etapas para os métodos de ação Delete () dentro do nosso controlador para bloquear a permissão para excluir os jantares também e, em seguida, certifique-se de que somente o host de um jantar poderá excluí-lo.</span><span class="sxs-lookup"><span data-stu-id="97aeb-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="97aeb-185">Mostrar/ocultar editar e excluir Links</span><span class="sxs-lookup"><span data-stu-id="97aeb-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="97aeb-186">Podemos está vinculando o método de ação de edição e exclusão de nossa classe DinnersController da nossa URL de detalhes:</span><span class="sxs-lookup"><span data-stu-id="97aeb-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="97aeb-187">No momento, estamos mostrando os links de ação de editar e excluir, independentemente se o visitante para a URL de detalhes é o host do jantar.</span><span class="sxs-lookup"><span data-stu-id="97aeb-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="97aeb-188">Vamos alterar isso para que os links serão exibidos somente se o usuário visitante é o proprietário do jantar.</span><span class="sxs-lookup"><span data-stu-id="97aeb-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="97aeb-189">O método de ação Details() dentro do nosso DinnersController recupera um objeto de jantar e, em seguida, passa-lo como o objeto de modelo para nosso modelo de exibição:</span><span class="sxs-lookup"><span data-stu-id="97aeb-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="97aeb-190">Podemos atualizar nosso modelo de exibição para condicionalmente Mostrar/ocultar os links Edit e Delete usando o Dinner.IsHostedBy() método auxiliar como abaixo:</span><span class="sxs-lookup"><span data-stu-id="97aeb-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="97aeb-191">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="97aeb-191">Next Steps</span></span>

<span data-ttu-id="97aeb-192">Agora vejamos como podemos pode permitir que usuários autenticados RSVP para jantares usando AJAX.</span><span class="sxs-lookup"><span data-stu-id="97aeb-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="97aeb-193">[Anterior](implement-efficient-data-paging.md)
> [Próximo](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="97aeb-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
