---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Habilitar o teste de unidade automatizado | Microsoft Docs
author: microsoft
description: Etapa 12 mostra como desenvolver um conjunto de testes de unidade automatizados que verifique nossa funcionalidade NerdDinner, e que nos fornecerá a confiança necessária para fazer alterações...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: b0c9cd7ab36a8414e0d7d50a68b05bb09a5f24f1
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59387900"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="9e08c-103">Habilitar o teste de unidade automatizado</span><span class="sxs-lookup"><span data-stu-id="9e08c-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="9e08c-104">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="9e08c-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="9e08c-105">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="9e08c-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="9e08c-106">Esta é a etapa 12 do grátis [aplicativo "NerdDinner"](introducing-the-nerddinner-tutorial.md) que orienta-through como criar um pequeno, mas concluir, o aplicativo web usando ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="9e08c-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="9e08c-107">Etapa 12 mostra como desenvolver um conjunto de testes de unidade automatizados que verifique nossa funcionalidade NerdDinner, e que nos fornecerá a confiança para fazer alterações e aprimoramentos para o aplicativo no futuro.</span><span class="sxs-lookup"><span data-stu-id="9e08c-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="9e08c-108">Se você estiver usando o ASP.NET MVC 3, recomendamos que você siga a [obtendo iniciado com o MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [Store de música do MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutoriais.</span><span class="sxs-lookup"><span data-stu-id="9e08c-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="9e08c-109">Etapa 12 do NerdDinner: Teste de unidade</span><span class="sxs-lookup"><span data-stu-id="9e08c-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="9e08c-110">Vamos desenvolver um conjunto de testes de unidade automatizados que verifique nossa funcionalidade NerdDinner, e que nos fornecerá a confiança para fazer alterações e aprimoramentos para o aplicativo no futuro.</span><span class="sxs-lookup"><span data-stu-id="9e08c-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="9e08c-111">Por que teste de unidade?</span><span class="sxs-lookup"><span data-stu-id="9e08c-111">Why Unit Test?</span></span>

<span data-ttu-id="9e08c-112">Na unidade em uma manhã de trabalho, você tem um flash repentino de inspiração sobre um aplicativo que você está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="9e08c-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="9e08c-113">Você percebe que há uma alteração que você pode implementar o que tornará significativamente melhor o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="9e08c-114">Pode ser uma refatoração que limpa o código, adiciona um novo recurso ou corrige um bug.</span><span class="sxs-lookup"><span data-stu-id="9e08c-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="9e08c-115">A pergunta que confronts você quando você chega ao seu computador é – "o nível de segurança é tornar essa melhoria?"</span><span class="sxs-lookup"><span data-stu-id="9e08c-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="9e08c-116">E se a fazer a alteração tem efeitos colaterais ou quebras de algo?</span><span class="sxs-lookup"><span data-stu-id="9e08c-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="9e08c-117">A alteração pode ser simples e levar apenas alguns minutos para implementar, mas e se levar horas para testar manualmente todos os cenários de aplicativo?</span><span class="sxs-lookup"><span data-stu-id="9e08c-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="9e08c-118">E se você se esqueça de abordar um cenário e um aplicativo danificado entra em produção?</span><span class="sxs-lookup"><span data-stu-id="9e08c-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="9e08c-119">Está fazendo essa melhoria realmente vale todo o esforço?</span><span class="sxs-lookup"><span data-stu-id="9e08c-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="9e08c-120">Testes de unidade automatizados podem fornecer uma rede de segurança que permite aprimorar continuamente seus aplicativos e evitar sendo teme que o código que você está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="9e08c-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="9e08c-121">Ter testes automatizados que verificar rapidamente a funcionalidade permite que você desenvolva com confiança – e capacitá-lo a fazer melhorias que você talvez caso contrário, não têm sentido à vontade fazendo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="9e08c-122">Eles também ajudam a criar soluções de manutenção mais fácil e têm um tempo de vida maior - que leva a um maior retorno do investimento.</span><span class="sxs-lookup"><span data-stu-id="9e08c-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="9e08c-123">O ASP.NET MVC Framework torna fácil e natural para a funcionalidade do aplicativo de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="9e08c-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="9e08c-124">Ele também permite que um fluxo de trabalho de teste controlado por TDD (desenvolvimento) que permite o desenvolvimento de test-first com base.</span><span class="sxs-lookup"><span data-stu-id="9e08c-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="9e08c-125">Projeto NerdDinner.Tests</span><span class="sxs-lookup"><span data-stu-id="9e08c-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="9e08c-126">Quando criamos nosso aplicativo NerdDinner no início deste tutorial, fomos solicitados com uma caixa de diálogo perguntando se queríamos criar um projeto de teste de unidade para acompanharem o projeto de aplicativo:</span><span class="sxs-lookup"><span data-stu-id="9e08c-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="9e08c-127">Mantivemos o "Sim, criar um projeto de teste de unidade" botão de opção selecionado – que resultou em um projeto de "NerdDinner.Tests" que está sendo adicionado à nossa solução:</span><span class="sxs-lookup"><span data-stu-id="9e08c-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="9e08c-128">O projeto NerdDinner.Tests faz referência ao assembly do projeto de aplicativo NerdDinner e nos permite adicionar facilmente os testes automatizados a ele que verificam a funcionalidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="9e08c-129">Criando testes de unidade para nossa classe de modelo de jantar</span><span class="sxs-lookup"><span data-stu-id="9e08c-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="9e08c-130">Vamos adicionar alguns testes ao nosso projeto NerdDinner.Tests que verificam se a classe Dinner que criamos quando criamos nossa camada de modelo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="9e08c-131">Vamos começar criando uma nova pasta dentro do nosso projeto de teste chamado "Modelos" em que vamos colocar nossos testes relacionados ao modelo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="9e08c-132">Vamos, em seguida, clique com botão direito na pasta e escolha o **Add -&gt;novo teste** comando de menu.</span><span class="sxs-lookup"><span data-stu-id="9e08c-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="9e08c-133">Isso abrirá a caixa de diálogo "Add New Test".</span><span class="sxs-lookup"><span data-stu-id="9e08c-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="9e08c-134">Vamos escolher criar um teste de unidade"" e nomeie-a como "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="9e08c-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="9e08c-135">Quando clicamos no botão "okey" Visual Studio irá adicionar (e abrir) um arquivo DinnerTest.cs ao projeto:</span><span class="sxs-lookup"><span data-stu-id="9e08c-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="9e08c-136">O modelo de teste de unidade do Visual Studio padrão tem um monte de código clichê clichê dentro dele que considero um pouco confuso.</span><span class="sxs-lookup"><span data-stu-id="9e08c-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="9e08c-137">Vamos limpá-lo para conter apenas o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="9e08c-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="9e08c-138">O atributo [TestClass] na classe DinnerTest acima identifica como uma classe que contém testes, bem como inicialização de teste opcional e código de desmontagem.</span><span class="sxs-lookup"><span data-stu-id="9e08c-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="9e08c-139">Podemos definir testes dentro dele com a adição de métodos públicos que têm um atributo [TestMethod] neles.</span><span class="sxs-lookup"><span data-stu-id="9e08c-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="9e08c-140">Abaixo estão o primeiro dos dois testes, adicionaremos que exercitam nossa classe Dinner.</span><span class="sxs-lookup"><span data-stu-id="9e08c-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="9e08c-141">O primeiro teste verifica que nossos jantar é inválido, se um jantar novo é criado sem todas as propriedades que estão sendo definidas corretamente.</span><span class="sxs-lookup"><span data-stu-id="9e08c-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="9e08c-142">O segundo teste verifica que nossos jantar é válido quando um jantar tem todas as propriedades definidas com valores válidos:</span><span class="sxs-lookup"><span data-stu-id="9e08c-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="9e08c-143">Você notará acima que nossos nomes de teste são bastante explícito (e pouco detalhado).</span><span class="sxs-lookup"><span data-stu-id="9e08c-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="9e08c-144">Estamos fazendo isso porque podemos terminar a criação de centenas ou milhares de testes de pequena e queremos tornar mais fácil de determinar rapidamente a intenção e o comportamento de cada um deles (especialmente quando estamos buscando por meio de uma lista de falhas em um executor de teste).</span><span class="sxs-lookup"><span data-stu-id="9e08c-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="9e08c-145">Os nomes de teste devem ser nomeados depois a funcionalidade que estão testando.</span><span class="sxs-lookup"><span data-stu-id="9e08c-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="9e08c-146">Acima estamos usando um "substantivo\_deve\_verbo" padrão de nomenclatura.</span><span class="sxs-lookup"><span data-stu-id="9e08c-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="9e08c-147">Nós são estruturar os testes usando o teste padrão – o que significa "Arrange, Act, Assert" "AAA":</span><span class="sxs-lookup"><span data-stu-id="9e08c-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="9e08c-148">Organize: Configurar a unidade que está sendo testada</span><span class="sxs-lookup"><span data-stu-id="9e08c-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="9e08c-149">ACT: Exercício a unidade sob teste e capturar resultados</span><span class="sxs-lookup"><span data-stu-id="9e08c-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="9e08c-150">Assert: Verificar o comportamento</span><span class="sxs-lookup"><span data-stu-id="9e08c-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="9e08c-151">Ao escrever testes que queremos evitar que os testes individuais fazer muito mais.</span><span class="sxs-lookup"><span data-stu-id="9e08c-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="9e08c-152">Em vez disso, cada teste deve verificar somente um único conceito (que torna muito mais fácil de identificar a causa de falhas).</span><span class="sxs-lookup"><span data-stu-id="9e08c-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="9e08c-153">É uma boa diretriz tentar e ter apenas uma única instrução para cada teste de asserção.</span><span class="sxs-lookup"><span data-stu-id="9e08c-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="9e08c-154">Se você tiver mais de uma instrução em um método de teste de asserção, certifique-se de que eles são todos os que estão sendo usados para testar o mesmo conceito.</span><span class="sxs-lookup"><span data-stu-id="9e08c-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="9e08c-155">Em caso de dúvida, faça outro teste.</span><span class="sxs-lookup"><span data-stu-id="9e08c-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="9e08c-156">Executando testes</span><span class="sxs-lookup"><span data-stu-id="9e08c-156">Running Tests</span></span>

<span data-ttu-id="9e08c-157">Visual Studio 2008 Professional (e edições superiores) incluem um executor de teste internos que pode ser usado para executar projetos dentro do IDE do Visual Studio de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="9e08c-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="9e08c-158">Podemos selecionar o **Test -&gt;Run -&gt;todos os testes na solução** menu comando (ou digite Ctrl-R, uma) para executar todos os nossos testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="9e08c-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="9e08c-159">Ou como alternativa, podemos posicionar o cursor de dentro de um método de teste ou classe de teste específico e usar o **Test -&gt;Run -&gt;testes no contexto atual** comando de menu (ou digite Ctrl R, T) para executar um subconjunto dos testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="9e08c-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="9e08c-160">Vamos posicionar nosso cursor dentro da classe DinnerTest e digite "Ctrl R, T" para executar os dois testes que acabamos de definir.</span><span class="sxs-lookup"><span data-stu-id="9e08c-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="9e08c-161">Quando fazemos isso uma janela de "Test Results" serão exibido dentro do Visual Studio e vamos ver os resultados de nosso teste listado dentro dele:</span><span class="sxs-lookup"><span data-stu-id="9e08c-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

*<span data-ttu-id="9e08c-162">Observação: A janela de resultados de teste do VS não mostra a coluna de nome de classe por padrão.</span><span class="sxs-lookup"><span data-stu-id="9e08c-162">Note: The VS test results window does not show the Class Name column by default.</span></span> <span data-ttu-id="9e08c-163">Você pode adicionar isso clicando duas vezes dentro da janela de resultados de teste e usando o comando de menu Adicionar/remover colunas.</span><span class="sxs-lookup"><span data-stu-id="9e08c-163">You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.</span></span>*

<span data-ttu-id="9e08c-164">Nossos dois testes levaram apenas uma fração de segundo para executar – e como você pode ver ambos passados.</span><span class="sxs-lookup"><span data-stu-id="9e08c-164">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="9e08c-165">Agora podemos ir e aumentá-las com a criação de testes adicionais que verifique se as validações de regra específica, bem como abordam os dois métodos auxiliares - IsUserHost() e IsUserRegistered() – que adicionamos à classe Dinner.</span><span class="sxs-lookup"><span data-stu-id="9e08c-165">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="9e08c-166">Ter todos esses testes em vigor para a classe Dinner tornará muito mais fácil e segura adicionar novas regras de negócio e as validações a ela no futuro.</span><span class="sxs-lookup"><span data-stu-id="9e08c-166">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="9e08c-167">Podemos adicionar nossa nova lógica de regra para o jantar e, em seguida, em segundos, verifique se que ele ainda não dividido qualquer um dos nossos funcionalidade lógica anterior.</span><span class="sxs-lookup"><span data-stu-id="9e08c-167">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="9e08c-168">Observe como usando um nome descritivo de teste torna mais fácil entender rapidamente o que cada teste é verificar.</span><span class="sxs-lookup"><span data-stu-id="9e08c-168">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="9e08c-169">É recomendável usar o **ferramentas -&gt;opções** comando de menu, abrindo a testar ferramentas -&gt;tela de configuração de execução de teste e verificação de "duas vezes em um resultado de teste de unidade com falha ou inconclusivo exibe o ponto de falha no teste de"caixa de seleção.</span><span class="sxs-lookup"><span data-stu-id="9e08c-169">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="9e08c-170">Isso permitirá que você clique duas vezes em uma falha na janela de resultados do teste e ir imediatamente para a falha de assert.</span><span class="sxs-lookup"><span data-stu-id="9e08c-170">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="9e08c-171">Criando testes de unidade DinnersController</span><span class="sxs-lookup"><span data-stu-id="9e08c-171">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="9e08c-172">Agora, vamos criar alguns testes de unidade que verifique a nossa funcionalidade DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9e08c-172">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="9e08c-173">Vamos começar pelo botão direito do mouse na pasta "Controladores de" dentro do nosso projeto de teste e, em seguida, escolha o **Add -&gt;novo teste** comando de menu.</span><span class="sxs-lookup"><span data-stu-id="9e08c-173">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="9e08c-174">Vamos criar um teste de unidade"" e nomeie-a como "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="9e08c-174">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="9e08c-175">Vamos criar dois métodos de teste que verificam se o método de ação Details() sobre o DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9e08c-175">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="9e08c-176">O primeiro verificará que uma exibição é retornada quando um jantar existente é solicitada.</span><span class="sxs-lookup"><span data-stu-id="9e08c-176">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="9e08c-177">O segundo verificará que um modo de exibição de "NotFound" é retornado quando um jantar inexistente é solicitado:</span><span class="sxs-lookup"><span data-stu-id="9e08c-177">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="9e08c-178">O código acima é compilado limpo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-178">The above code compiles clean.</span></span> <span data-ttu-id="9e08c-179">Quando executamos os testes, no entanto, ocorre falha em ambos:</span><span class="sxs-lookup"><span data-stu-id="9e08c-179">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="9e08c-180">Se observarmos as mensagens de erro, veremos que o motivo da falharam de testes foi porque nossa classe DinnersRepository não pôde se conectar a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="9e08c-180">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="9e08c-181">Nosso aplicativo NerdDinner está usando uma cadeia de conexão para um arquivo local do SQL Server Express que reside sob o \App\_diretório de dados do projeto de aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="9e08c-181">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="9e08c-182">Como nosso projeto NerdDinner.Tests compila e executa-o em um diretório diferente, em seguida, o projeto de aplicativo, o local do caminho relativo da nossa cadeia de conexão está incorreto.</span><span class="sxs-lookup"><span data-stu-id="9e08c-182">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="9e08c-183">Estamos *poderia* corrigir esse problema, copiando o arquivo de banco de dados SQL Express para nosso projeto de teste e, em seguida, adicione uma cadeia de conexão de teste apropriadas a ele no App. config do nosso projeto de teste.</span><span class="sxs-lookup"><span data-stu-id="9e08c-183">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="9e08c-184">Isso teria os testes acima desbloqueado e em execução.</span><span class="sxs-lookup"><span data-stu-id="9e08c-184">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="9e08c-185">Unidade testando o código usando um banco de dados real, no entanto, traz uma série de desafios.</span><span class="sxs-lookup"><span data-stu-id="9e08c-185">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="9e08c-186">Especificamente:</span><span class="sxs-lookup"><span data-stu-id="9e08c-186">Specifically:</span></span>

- <span data-ttu-id="9e08c-187">Ele diminui significativamente o tempo de execução de testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="9e08c-187">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="9e08c-188">Quanto mais tempo que leva para executar testes, menos provavelmente são para executá-los com frequência.</span><span class="sxs-lookup"><span data-stu-id="9e08c-188">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="9e08c-189">O ideal é que você deseja que seus testes de unidade para poder ser executado em segundos – e tê-lo algo que você fazer como naturalmente como compilar o projeto.</span><span class="sxs-lookup"><span data-stu-id="9e08c-189">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="9e08c-190">Ele complica a lógica de instalação e limpeza em testes.</span><span class="sxs-lookup"><span data-stu-id="9e08c-190">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="9e08c-191">Você deseja que cada teste de unidade seja isolada e independente de outras pessoas (com sem efeitos colaterais ou dependências).</span><span class="sxs-lookup"><span data-stu-id="9e08c-191">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="9e08c-192">Ao trabalhar em relação a um banco de dados real, que você precisa estar atento a estado e redefini-lo entre os testes.</span><span class="sxs-lookup"><span data-stu-id="9e08c-192">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="9e08c-193">Vamos examinar um padrão de design chamado "injeção de dependência" que pode ajudar a resolver esses problemas e evitar a necessidade de usar um banco de dados real com nossos testes.</span><span class="sxs-lookup"><span data-stu-id="9e08c-193">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="9e08c-194">Injeção de dependência</span><span class="sxs-lookup"><span data-stu-id="9e08c-194">Dependency Injection</span></span>

<span data-ttu-id="9e08c-195">No momento DinnersController "acoplamento rígido" com a classe de DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9e08c-195">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="9e08c-196">"Acoplamento" refere-se a uma situação em que uma classe explicitamente se baseia em outra classe para trabalhar:</span><span class="sxs-lookup"><span data-stu-id="9e08c-196">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="9e08c-197">Como a classe DinnerRepository requer acesso a um banco de dados, a dependência rigidamente acoplada a classe DinnersController tem nas extremidades DinnerRepository a necessidade de ter um banco de dados para que os métodos de ação DinnersController a ser testado.</span><span class="sxs-lookup"><span data-stu-id="9e08c-197">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="9e08c-198">Podemos contornar isso, empregando um padrão de design chamado "injeção de dependência –" que é uma abordagem em que dependências (como classes de repositório que fornecem acesso a dados) não é mais implicitamente são criadas dentro de classes que usá-los.</span><span class="sxs-lookup"><span data-stu-id="9e08c-198">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="9e08c-199">Em vez disso, as dependências podem ser passadas explicitamente para a classe que usa-os usando argumentos de construtor.</span><span class="sxs-lookup"><span data-stu-id="9e08c-199">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="9e08c-200">Se as dependências são definidas usando interfaces, em seguida, temos a flexibilidade para passar em implementações de dependência "falsificação" para cenários de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="9e08c-200">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="9e08c-201">Isso nos permite criar implementações de dependência específica de teste que, na verdade, não exigem acesso a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="9e08c-201">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="9e08c-202">Para ver isso em ação, vamos implementar injeção de dependência com nosso DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9e08c-202">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="9e08c-203">Extraindo uma interface de IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="9e08c-203">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="9e08c-204">Nossa primeira etapa será criar uma nova interface de IDinnerRepository que encapsula o contrato de repositório que nossos controladores exigem para recuperar e atualizar os jantares.</span><span class="sxs-lookup"><span data-stu-id="9e08c-204">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="9e08c-205">Podemos definir este contrato de interface manualmente clicando duas vezes na pasta \Models e, em seguida, escolhendo a **Add -&gt;Novo Item** comando de menu e criar uma nova interface chamada IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="9e08c-205">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="9e08c-206">Como alternativa, podemos usar a extração de refatoração de ferramentas integrado no Visual Studio Professional (e edições superiores) automaticamente e criar uma interface para nós de nossa classe DinnerRepository existente.</span><span class="sxs-lookup"><span data-stu-id="9e08c-206">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="9e08c-207">Para extrair essa interface usando o VS, simplesmente posicione o cursor no editor de texto na classe DinnerRepository e, em seguida, clique com botão direito e escolha o **refatorar -&gt;extrair Interface** comando de menu:</span><span class="sxs-lookup"><span data-stu-id="9e08c-207">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="9e08c-208">Isso iniciará a caixa de diálogo "Extrair Interface" e nos solicita o nome da interface para criar.</span><span class="sxs-lookup"><span data-stu-id="9e08c-208">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="9e08c-209">Ele será IDinnerRepository como padrão e selecionar automaticamente todos os métodos públicos na classe DinnerRepository existente para adicionar à interface:</span><span class="sxs-lookup"><span data-stu-id="9e08c-209">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="9e08c-210">Quando clicamos no botão "okey", o Visual Studio adicionará uma nova interface de IDinnerRepository ao nosso aplicativo:</span><span class="sxs-lookup"><span data-stu-id="9e08c-210">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="9e08c-211">E nossa classe DinnerRepository existente será atualizado para que ele implementa a interface:</span><span class="sxs-lookup"><span data-stu-id="9e08c-211">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="9e08c-212">Atualizando o DinnersController para dar suporte à injeção de construtor</span><span class="sxs-lookup"><span data-stu-id="9e08c-212">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="9e08c-213">Agora atualizaremos a classe DinnersController para usar a nova interface.</span><span class="sxs-lookup"><span data-stu-id="9e08c-213">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="9e08c-214">No momento DinnersController é embutido em código, de modo que seu campo "dinnerRepository" sempre é uma classe de DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="9e08c-214">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="9e08c-215">Vamos alterá-lo para que o campo "dinnerRepository" é do tipo IDinnerRepository, em vez de DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9e08c-215">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="9e08c-216">Em seguida, adicionaremos dois construtores públicos de DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9e08c-216">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="9e08c-217">Um dos construtores permite que um IDinnerRepository a ser passado como um argumento.</span><span class="sxs-lookup"><span data-stu-id="9e08c-217">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="9e08c-218">O outro é um construtor padrão que usa nossa implementação de DinnerRepository existente:</span><span class="sxs-lookup"><span data-stu-id="9e08c-218">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="9e08c-219">Como ASP.NET MVC, por padrão cria classes de controlador usando construtores padrão, o nosso DinnersController em tempo de execução continuará a usar a classe de DinnerRepository para executar o acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="9e08c-219">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="9e08c-220">Agora podemos atualizar nossos testes de unidade, no entanto, para passar em uma implementação de repositório de jantar "falsificação" usando o parâmetro de construtor.</span><span class="sxs-lookup"><span data-stu-id="9e08c-220">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="9e08c-221">Esse repositório de jantar "falsificação" não exigirão acesso a um banco de dados real e em vez disso, usará dados de exemplo na memória.</span><span class="sxs-lookup"><span data-stu-id="9e08c-221">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="9e08c-222">Criando a classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="9e08c-222">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="9e08c-223">Vamos criar uma classe FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9e08c-223">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="9e08c-224">Vamos começar criando um diretório "Fakes" dentro do nosso projeto NerdDinner.Tests e, em seguida, adicione uma nova classe de FakeDinnerRepository a ele (clique com botão direito na pasta e escolha **Add -&gt;nova classe**):</span><span class="sxs-lookup"><span data-stu-id="9e08c-224">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="9e08c-225">Vamos atualizar o código para que a classe FakeDinnerRepository implementa a interface de IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9e08c-225">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="9e08c-226">Podemos, em seguida, clique com botão direito nele e escolha o comando de menu de contexto "Implementar interface IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="9e08c-226">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="9e08c-227">Isso fará com que o Visual Studio adicionar automaticamente todos os membros de interface de IDinnerRepository à nossa classe FakeDinnerRepository com implementações padrão de "criar stub":</span><span class="sxs-lookup"><span data-stu-id="9e08c-227">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="9e08c-228">Em seguida, atualizamos a implementação de FakeDinnerRepository trabalhar fora de uma lista na memória&lt;Dinner&gt; coleção passado para ele como um argumento de construtor:</span><span class="sxs-lookup"><span data-stu-id="9e08c-228">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="9e08c-229">Agora temos uma implementação falsa de IDinnerRepository que não requer um banco de dados e, em vez disso, pode ser executado fora de uma lista na memória de objetos de jantar.</span><span class="sxs-lookup"><span data-stu-id="9e08c-229">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="9e08c-230">Usando o FakeDinnerRepository com testes de unidade</span><span class="sxs-lookup"><span data-stu-id="9e08c-230">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="9e08c-231">Vamos retornar para os testes de unidade DinnersController que falhou anteriormente porque o banco de dados não estava disponível.</span><span class="sxs-lookup"><span data-stu-id="9e08c-231">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="9e08c-232">Podemos atualizar os métodos de teste para usar um FakeDinnerRepository preenchido com dados de jantar de na memória de exemplo para o DinnersController usando o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="9e08c-232">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="9e08c-233">E agora ao executar esses testes ambos passam:</span><span class="sxs-lookup"><span data-stu-id="9e08c-233">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="9e08c-234">O melhor de tudo, eles ocupam apenas uma fração de segundo para executar e não exigem qualquer lógica de instalação/limpeza complicada.</span><span class="sxs-lookup"><span data-stu-id="9e08c-234">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="9e08c-235">Podemos agora teste de unidade todo o nosso código de método de ação DinnersController (incluindo listagem, paginação, detalhes, criar, atualizar e excluir) sem nunca precisarem se conectar a um banco de dados real.</span><span class="sxs-lookup"><span data-stu-id="9e08c-235">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| **<span data-ttu-id="9e08c-236">Tópico de lado: Estruturas de injeção de dependência</span><span class="sxs-lookup"><span data-stu-id="9e08c-236">Side Topic: Dependency Injection Frameworks</span></span>** |
| --- |
| <span data-ttu-id="9e08c-237">Execução de injeção de dependência manual (como acima) funciona bem, mas se tornará mais difícil de manter como o número de dependências e componentes em um aplicativo aumenta.</span><span class="sxs-lookup"><span data-stu-id="9e08c-237">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="9e08c-238">Existem várias estruturas de injeção de dependência para .NET que pode ajudar a fornecer mais flexibilidade de gerenciamento de dependência.</span><span class="sxs-lookup"><span data-stu-id="9e08c-238">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="9e08c-239">Essas estruturas, também chamadas de contêineres de "Inversão de controle" (IoC), fornecem mecanismos que permitem que um nível adicional de suporte de configuração para especificar e passar as dependências para objetos em tempo de execução (geralmente usando injeção de construtor ).</span><span class="sxs-lookup"><span data-stu-id="9e08c-239">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="9e08c-240">Alguns da injeção de dependência de software livre mais populares / IOC estruturas no .NET incluem: AutoFac, Ninject, Spring.NET, StructureMap e Windsor.</span><span class="sxs-lookup"><span data-stu-id="9e08c-240">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="9e08c-241">ASP.NET MVC expõe APIs que permitem que os desenvolvedores a participarem na resolução e instanciação dos controladores, e que permite a injeção de dependência de extensibilidade / estruturas IoC seja integrada corretamente dentro desse processo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-241">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="9e08c-242">Usar uma estrutura DI/IOC seria também nos permitem remover o construtor padrão do nosso DinnersController – o que seria remover completamente o acoplamento entre ele e o DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9e08c-242">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="9e08c-243">Não será utilizada uma injeção de dependência / estrutura IOC com nosso aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="9e08c-243">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="9e08c-244">Mas é algo que podemos considerar a possibilidade para o futuro se os recursos e a base de código do NerdDinner cresceram.</span><span class="sxs-lookup"><span data-stu-id="9e08c-244">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="9e08c-245">Criando testes de unidade de ação Editar</span><span class="sxs-lookup"><span data-stu-id="9e08c-245">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="9e08c-246">Agora, vamos criar alguns testes de unidade que verificam a funcionalidade de edição do DinnersController.</span><span class="sxs-lookup"><span data-stu-id="9e08c-246">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="9e08c-247">Vamos começar Testando a versão de HTTP GET do nosso Editar ação:</span><span class="sxs-lookup"><span data-stu-id="9e08c-247">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="9e08c-248">Vamos criar um teste que verifica que um modo de exibição apoiado por um objeto DinnerFormViewModel será renderizado novamente quando um jantar válido é solicitado:</span><span class="sxs-lookup"><span data-stu-id="9e08c-248">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="9e08c-249">Quando executamos o teste, no entanto, podemos encontrará falhar porque uma exceção de referência nula é lançada quando o método de edição acessa a propriedade User.Identity.Name para executar a verificação de Dinner.IsHostedBy().</span><span class="sxs-lookup"><span data-stu-id="9e08c-249">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="9e08c-250">O objeto de usuário na classe base do controlador encapsula os detalhes sobre o usuário conectado e é populado pelo ASP.NET MVC, quando ele cria o controlador em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="9e08c-250">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="9e08c-251">Porque estamos testando o DinnersController fora de um ambiente de servidor web, o objeto de usuário não está definido (portanto, a exceção de referência nula).</span><span class="sxs-lookup"><span data-stu-id="9e08c-251">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="9e08c-252">A propriedade User.Identity.Name de simulação</span><span class="sxs-lookup"><span data-stu-id="9e08c-252">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="9e08c-253">Estruturas fictícias facilitam os testes, permitindo-nos criar dinamicamente falsas versões de objetos dependentes que dão suporte a nossos testes.</span><span class="sxs-lookup"><span data-stu-id="9e08c-253">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="9e08c-254">Por exemplo, podemos usar uma estrutura de simulação em nosso teste de ação de edição para criar dinamicamente um objeto de usuário que nosso DinnersController pode usar para pesquisar um nome de usuário simulada.</span><span class="sxs-lookup"><span data-stu-id="9e08c-254">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="9e08c-255">Isso evitará uma referência nula sejam lançadas quando executamos nosso teste.</span><span class="sxs-lookup"><span data-stu-id="9e08c-255">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="9e08c-256">Há muitos .NET estruturas que podem ser usadas com o ASP.NET MVC de simulação (você pode ver uma lista deles aqui: [ http://www.mockframeworks.com/ ](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="9e08c-256">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="9e08c-257">Para testar nosso aplicativo NerdDinner, usaremos uma estrutura chamada "Moq" de simulação de software livre, que pode ser baixado gratuitamente do [ http://www.mockframeworks.com/moq ](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="9e08c-257">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="9e08c-258">Após o download, vamos adicionar uma referência em nosso projeto NerdDinner.Tests ao assembly Moq.dll:</span><span class="sxs-lookup"><span data-stu-id="9e08c-258">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="9e08c-259">Em seguida, adicionaremos um método auxiliar de "CreateDinnersControllerAs(username)" à nossa classe de teste que usa um nome de usuário como um parâmetro e que, em seguida, "mocks" a propriedade User.Identity.Name na instância DinnersController:</span><span class="sxs-lookup"><span data-stu-id="9e08c-259">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="9e08c-260">Acima Moq estamos usando para criar um objeto de simulação que simula um objeto ControllerContext (que é o que passa o ASP.NET MVC para classes do controlador para expor objetos de tempo de execução como usuário, a solicitação, a resposta e a sessão).</span><span class="sxs-lookup"><span data-stu-id="9e08c-260">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="9e08c-261">Podemos está chamando o método de "SetupGet" na simulação para indicar que a propriedade HttpContext.User.Identity.Name em ControllerContext deve retornar a cadeia de caracteres de nome de usuário que são passados para o método auxiliar.</span><span class="sxs-lookup"><span data-stu-id="9e08c-261">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="9e08c-262">Podemos pode simular qualquer número de métodos e propriedades ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="9e08c-262">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="9e08c-263">Para ilustrar isso também adicionei uma chamada SetupGet() para a propriedade Request.IsAuthenticated (que, na verdade, não é necessário para os testes abaixo – mas que ajuda a ilustrar como você pode simular propriedades de solicitação).</span><span class="sxs-lookup"><span data-stu-id="9e08c-263">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="9e08c-264">Quando terminamos nós atribuímos uma instância da imitação ControllerContext ao DinnersController nosso método auxiliar é retornado.</span><span class="sxs-lookup"><span data-stu-id="9e08c-264">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="9e08c-265">Agora podemos escrever testes de unidade que usam esse método auxiliar para testar cenários de edição que envolvem diferentes usuários:</span><span class="sxs-lookup"><span data-stu-id="9e08c-265">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="9e08c-266">E agora, quando executamos os testes passam:</span><span class="sxs-lookup"><span data-stu-id="9e08c-266">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="9e08c-267">Cenários de teste UpdateModel()</span><span class="sxs-lookup"><span data-stu-id="9e08c-267">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="9e08c-268">Nós criamos testes que abrangem a versão HTTP-GET da ação de edição.</span><span class="sxs-lookup"><span data-stu-id="9e08c-268">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="9e08c-269">Agora, vamos criar alguns testes que verificam a versão do HTTP POST da ação Editar:</span><span class="sxs-lookup"><span data-stu-id="9e08c-269">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="9e08c-270">O cenário de teste de interessante novos para nosso suporte com esse método de ação é seu uso do método auxiliar UpdateModel() na classe base do controlador.</span><span class="sxs-lookup"><span data-stu-id="9e08c-270">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="9e08c-271">Estamos usando esse método auxiliar para associar valores de postagem de formulário a nossa instância de objeto do jantar.</span><span class="sxs-lookup"><span data-stu-id="9e08c-271">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="9e08c-272">Abaixo estão dois testes que demonstra como podemos fornecer de formulário postados valores para o método auxiliar UpdateModel() usado.</span><span class="sxs-lookup"><span data-stu-id="9e08c-272">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="9e08c-273">Vamos fazer isso criando e preenchendo um objeto FormCollection e, em seguida, atribuí-lo à propriedade "ValueProvider" no controlador.</span><span class="sxs-lookup"><span data-stu-id="9e08c-273">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="9e08c-274">O primeiro teste verifica que, em Salvar com êxito, o navegador é redirecionado para a ação de detalhes.</span><span class="sxs-lookup"><span data-stu-id="9e08c-274">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="9e08c-275">O segundo teste verifica quando uma entrada inválida é lançada a ação exibe novamente a exibição de edição novamente com uma mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="9e08c-275">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>


[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="9e08c-276">Teste de encerramento</span><span class="sxs-lookup"><span data-stu-id="9e08c-276">Testing Wrap-Up</span></span>

<span data-ttu-id="9e08c-277">Já abordamos os conceitos básicos envolvidos nas classes de controlador de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="9e08c-277">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="9e08c-278">Podemos usar essas técnicas para criar facilmente centenas de testes simples que verificam o comportamento do nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-278">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="9e08c-279">Como nosso controlador e os testes de modelo não exigem um banco de dados real, elas são extremamente rápido e fácil de ser executado.</span><span class="sxs-lookup"><span data-stu-id="9e08c-279">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="9e08c-280">Poderemos executar centenas de testes automatizados em segundos e imediatamente obter feedback se uma alteração que são feitas rompeu algo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-280">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="9e08c-281">Isso ajudará a fornecer a confiança para melhorar, refatoração, continuamente e refinar o nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="9e08c-281">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="9e08c-282">Abordamos a testar como o último tópico neste capítulo – mas não porque o teste é algo que você deve fazer no final de um processo de desenvolvimento!</span><span class="sxs-lookup"><span data-stu-id="9e08c-282">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="9e08c-283">Ao contrário, você deve escrever testes automatizados mais cedo possível no processo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="9e08c-283">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="9e08c-284">Fazer então permite que você obtenha comentários imediatos à medida que desenvolve, ajuda você a pensar cuidadosamente sobre cenários de caso de uso do seu aplicativo e orienta você a projetar seu aplicativo com limpa disposição em camadas e acoplamento em mente.</span><span class="sxs-lookup"><span data-stu-id="9e08c-284">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="9e08c-285">Discutir um capítulo posterior no catálogo de desenvolvimento controlado por testes (TDD) e como usá-lo com o ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="9e08c-285">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="9e08c-286">TDD é uma prática de codificação iterativa no qual você primeiro escreve os testes que atenderão o código resultante.</span><span class="sxs-lookup"><span data-stu-id="9e08c-286">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="9e08c-287">Com o TDD comece cada recurso Criando um teste que verifica a funcionalidade que você está prestes a implementar.</span><span class="sxs-lookup"><span data-stu-id="9e08c-287">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="9e08c-288">Escrevendo a unidade de teste primeiro ajuda a garantir que você entenda claramente o recurso e como ele deve para funcionar.</span><span class="sxs-lookup"><span data-stu-id="9e08c-288">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="9e08c-289">Somente depois que o teste é gravado (e você verificou que ele falha) você em seguida, implementar a funcionalidade real que o teste verifica.</span><span class="sxs-lookup"><span data-stu-id="9e08c-289">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="9e08c-290">Porque você já tenha tempo pensando sobre o caso de uso de como o recurso deve para funcionar, você terá uma melhor compreensão dos requisitos e a melhor maneira de implementá-los.</span><span class="sxs-lookup"><span data-stu-id="9e08c-290">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="9e08c-291">Quando você terminar com a implementação, você pode executar novamente o teste – e obtenha comentários imediatos ao como se o recurso funciona corretamente.</span><span class="sxs-lookup"><span data-stu-id="9e08c-291">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="9e08c-292">Abordaremos o TDD mais no capítulo 10.</span><span class="sxs-lookup"><span data-stu-id="9e08c-292">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="9e08c-293">Próxima etapa</span><span class="sxs-lookup"><span data-stu-id="9e08c-293">Next Step</span></span>

<span data-ttu-id="9e08c-294">Alguns final quebra automática de linha para cima de comentários.</span><span class="sxs-lookup"><span data-stu-id="9e08c-294">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9e08c-295">[Anterior](use-ajax-to-implement-mapping-scenarios.md)
> [Próximo](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="9e08c-295">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
