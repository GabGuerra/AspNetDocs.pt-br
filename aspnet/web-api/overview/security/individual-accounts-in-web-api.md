---
uid: web-api/overview/security/individual-accounts-in-web-api
title: Proteger uma API Web com contas individuais e logon Local na API Web ASP.NET 2.2 | Microsoft Docs
author: MikeWasson
description: Este tópico mostra como proteger uma API web usando OAuth2 para autenticar em relação a um banco de dados de associação. Versões de software usadas no tutorial 201 Visual do Studio...
ms.author: riande
ms.date: 10/15/2014
ms.assetid: 92c84846-f0ea-4b5e-94b6-5004874eb060
msc.legacyurl: /web-api/overview/security/individual-accounts-in-web-api
msc.type: authoredcontent
ms.openlocfilehash: 29c3670ad7ab93acb0be878e5bd961d0ea446eee
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59396220"
---
# <a name="secure-a-web-api-with-individual-accounts-and-local-login-in-aspnet-web-api-22"></a><span data-ttu-id="8cb0e-104">Proteger uma API Web com contas individuais e logon Local na API Web ASP.NET 2.2</span><span class="sxs-lookup"><span data-stu-id="8cb0e-104">Secure a Web API with Individual Accounts and Local Login in ASP.NET Web API 2.2</span></span>

<span data-ttu-id="8cb0e-105">por [Mike Wasson](https://github.com/MikeWasson)</span><span class="sxs-lookup"><span data-stu-id="8cb0e-105">by [Mike Wasson](https://github.com/MikeWasson)</span></span>

[<span data-ttu-id="8cb0e-106">Baixe o aplicativo de exemplo</span><span class="sxs-lookup"><span data-stu-id="8cb0e-106">Download Sample App</span></span>](https://github.com/MikeWasson/LocalAccountsApp)

> <span data-ttu-id="8cb0e-107">Este tópico mostra como proteger uma API web usando OAuth2 para autenticar em relação a um banco de dados de associação.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-107">This topic shows how to secure a web API using OAuth2 to authenticate against a membership database.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="8cb0e-108">Versões de software usadas no tutorial</span><span class="sxs-lookup"><span data-stu-id="8cb0e-108">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="8cb0e-109">Visual Studio 2013 Atualização 3</span><span class="sxs-lookup"><span data-stu-id="8cb0e-109">Visual Studio 2013 Update 3</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - [<span data-ttu-id="8cb0e-110">API Web 2.2</span><span class="sxs-lookup"><span data-stu-id="8cb0e-110">Web API 2.2</span></span>](../releases/whats-new-in-aspnet-web-api-22.md)
> - [<span data-ttu-id="8cb0e-111">Identidade do ASP.NET 2.1</span><span class="sxs-lookup"><span data-stu-id="8cb0e-111">ASP.NET Identity 2.1</span></span>](../../../identity/index.md)


<span data-ttu-id="8cb0e-112">No Visual Studio 2013, o modelo de projeto de API Web fornece três opções para autenticação:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-112">In Visual Studio 2013, the Web API project template gives you three options for authentication:</span></span>

- <span data-ttu-id="8cb0e-113">**Contas individuais.**</span><span class="sxs-lookup"><span data-stu-id="8cb0e-113">**Individual accounts.**</span></span> <span data-ttu-id="8cb0e-114">O aplicativo usa um banco de dados de associação.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-114">The app uses a membership database.</span></span>
- <span data-ttu-id="8cb0e-115">**Contas organizacionais.**</span><span class="sxs-lookup"><span data-stu-id="8cb0e-115">**Organizational accounts.**</span></span> <span data-ttu-id="8cb0e-116">Os usuários entram com suas do Active Directory do Azure, Office 365 ou as credenciais do Active Directory local.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-116">Users sign in with their Azure Active Directory, Office 365, or on-premise Active Directory credentials.</span></span>
- <span data-ttu-id="8cb0e-117">**Autenticação do Windows.**</span><span class="sxs-lookup"><span data-stu-id="8cb0e-117">**Windows authentication.**</span></span> <span data-ttu-id="8cb0e-118">Essa opção destina-se a aplicativos de Intranet e usa o módulo do IIS de autenticação do Windows.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-118">This option is intended for Intranet applications, and uses the Windows Authentication IIS module.</span></span>

<span data-ttu-id="8cb0e-119">Para obter mais detalhes sobre essas opções, consulte [Criando projetos Web do ASP.NET no Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-119">For more details about these options, see [Creating ASP.NET Web Projects in Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span></span>

<span data-ttu-id="8cb0e-120">Contas individuais fornecem duas maneiras para um usuário faça logon:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-120">Individual accounts provide two ways for a user to log in:</span></span>

- <span data-ttu-id="8cb0e-121">**Logon local**.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-121">**Local login**.</span></span> <span data-ttu-id="8cb0e-122">O usuário se registra no site, inserir um nome de usuário e senha.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-122">The user registers at the site, entering a username and password.</span></span> <span data-ttu-id="8cb0e-123">O aplicativo armazena o hash de senha no banco de dados de associação.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-123">The app stores the password hash in the membership database.</span></span> <span data-ttu-id="8cb0e-124">Quando o usuário fizer logon, o sistema ASP.NET Identity verificará a senha.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-124">When the user logs in, the ASP.NET Identity system verifies the password.</span></span>
- <span data-ttu-id="8cb0e-125">**Logon social**.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-125">**Social login**.</span></span> <span data-ttu-id="8cb0e-126">O usuário entra com um serviço externo, como Facebook, Microsoft ou Google.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-126">The user signs in with an external service, such as Facebook, Microsoft, or Google.</span></span> <span data-ttu-id="8cb0e-127">O aplicativo ainda cria uma entrada para o usuário no banco de dados de associação, mas não armazena credenciais.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-127">The app still creates an entry for the user in the membership database, but does not store any credentials.</span></span> <span data-ttu-id="8cb0e-128">O usuário é autenticado depois de entrar em um serviço externo.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-128">The user authenticates by signing into the external service.</span></span>

<span data-ttu-id="8cb0e-129">Este artigo aborda o cenário de logon local.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-129">This article looks at the local login scenario.</span></span> <span data-ttu-id="8cb0e-130">Para logon local e social, API Web usa OAuth2 para autenticar solicitações.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-130">For both local and social login, Web API uses OAuth2 to authenticate requests.</span></span> <span data-ttu-id="8cb0e-131">No entanto, os fluxos de credencial são diferentes para logon social e local.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-131">However, the credential flows are different for local and social login.</span></span>

<span data-ttu-id="8cb0e-132">Neste artigo, demonstrarei um aplicativo simples que permite que o usuário faça logon e enviar chamadas AJAX autenticadas para uma API da web.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-132">In this article, I'll demonstrate a simple app that lets the user log in and send authenticated AJAX calls to a web API.</span></span> <span data-ttu-id="8cb0e-133">Você pode baixar o código de exemplo [aqui](https://github.com/MikeWasson/LocalAccountsApp).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-133">You can download the sample code [here](https://github.com/MikeWasson/LocalAccountsApp).</span></span> <span data-ttu-id="8cb0e-134">O arquivo leiame descreve como criar o exemplo do zero no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-134">The readme describes how to create the sample from scratch in Visual Studio.</span></span>

[![](individual-accounts-in-web-api/_static/image2.png)](individual-accounts-in-web-api/_static/image1.png)

<span data-ttu-id="8cb0e-135">O aplicativo de exemplo usa o Knockout. js para vinculação de dados e jQuery para enviar solicitações AJAX.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-135">The sample app uses Knockout.js for data-binding and jQuery for sending AJAX requests.</span></span> <span data-ttu-id="8cb0e-136">O foco será nas chamadas AJAX, portanto você não precisa saber o Knockout. js para este artigo.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-136">I'll be focusing on the AJAX calls, so you don't need to know Knockout.js for this article.</span></span>

<span data-ttu-id="8cb0e-137">Ao longo do caminho, que descreverei:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-137">Along the way, I'll describe:</span></span>

- <span data-ttu-id="8cb0e-138">O que o aplicativo está fazendo no lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-138">What the app is doing on the client side.</span></span>
- <span data-ttu-id="8cb0e-139">O que está acontecendo no servidor.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-139">What's happening on the server.</span></span>
- <span data-ttu-id="8cb0e-140">O tráfego HTTP no meio.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-140">The HTTP traffic in the middle.</span></span>

<span data-ttu-id="8cb0e-141">Primeiro, precisamos definir algumas terminologias OAuth2.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-141">First, we need to define some OAuth2 terminology.</span></span>

- <span data-ttu-id="8cb0e-142">*Recurso*.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-142">*Resource*.</span></span> <span data-ttu-id="8cb0e-143">Alguma parte dos dados que podem ser protegidos.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-143">Some piece of data that can be protected.</span></span>
- <span data-ttu-id="8cb0e-144">*Servidor de recurso*.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-144">*Resource server*.</span></span> <span data-ttu-id="8cb0e-145">O servidor que hospeda o recurso.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-145">The server that hosts the resource.</span></span>
- <span data-ttu-id="8cb0e-146">*Proprietário do recurso*.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-146">*Resource owner*.</span></span> <span data-ttu-id="8cb0e-147">A entidade que pode conceder permissão para acessar um recurso.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-147">The entity that can grant permission to access a resource.</span></span> <span data-ttu-id="8cb0e-148">(Normalmente o usuário.)</span><span class="sxs-lookup"><span data-stu-id="8cb0e-148">(Typically the user.)</span></span>
- <span data-ttu-id="8cb0e-149">*Cliente*: O aplicativo que deseja acessar o recurso.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-149">*Client*: The app that wants access to the resource.</span></span> <span data-ttu-id="8cb0e-150">Neste artigo, o cliente é um navegador da web.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-150">In this article, the client is a web browser.</span></span>
- <span data-ttu-id="8cb0e-151">*Token de acesso*.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-151">*Access token*.</span></span> <span data-ttu-id="8cb0e-152">Um token que concede acesso a um recurso.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-152">A token that grants access to a resource.</span></span>
- <span data-ttu-id="8cb0e-153">*Token de portador*.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-153">*Bearer token*.</span></span> <span data-ttu-id="8cb0e-154">Um determinado tipo de token de acesso, com a propriedade que qualquer pessoa pode usar o token.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-154">A particular type of access token, with the property that anyone can use the token.</span></span> <span data-ttu-id="8cb0e-155">Em outras palavras, um cliente não precisa de uma chave de criptografia ou outro segredo para usar um token de portador.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-155">In other words, a client doesn't need a cryptographic key or other secret to use a bearer token.</span></span> <span data-ttu-id="8cb0e-156">Por esse motivo, os tokens de portador só devem ser usados por um HTTPS e devem ter tempos de expiração relativamente curto.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-156">For that reason, bearer tokens should only be used over a HTTPS, and should have relatively short expiration times.</span></span>
- <span data-ttu-id="8cb0e-157">*Servidor de autorização*.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-157">*Authorization server*.</span></span> <span data-ttu-id="8cb0e-158">Um servidor que fornece tokens de acesso.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-158">A server that gives out access tokens.</span></span>

<span data-ttu-id="8cb0e-159">Um aplicativo pode agir como servidor de autorização e o servidor de recursos.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-159">An application can act as both authorization server and resource server.</span></span> <span data-ttu-id="8cb0e-160">O modelo de projeto de Web API segue esse padrão.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-160">The Web API project template follows this pattern.</span></span>

## <a name="local-login-credential-flow"></a><span data-ttu-id="8cb0e-161">Fluxo de credenciais de logon local</span><span class="sxs-lookup"><span data-stu-id="8cb0e-161">Local Login Credential Flow</span></span>

<span data-ttu-id="8cb0e-162">Para logon local, API Web usa a [fluxo de senha de proprietário do recurso](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) definidos no OAuth2.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-162">For local login, Web API uses the [resource owner password flow](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) defined in OAuth2.</span></span>

1. <span data-ttu-id="8cb0e-163">O usuário insere um nome e uma senha para o cliente.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-163">The user enters a name and password into the client.</span></span>
2. <span data-ttu-id="8cb0e-164">O cliente envia essas credenciais para o servidor de autorização.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-164">The client sends these credentials to the authorization server.</span></span>
3. <span data-ttu-id="8cb0e-165">O servidor de autorização autentica as credenciais e retorna um token de acesso.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-165">The authorization server authenticates the credentials and returns an access token.</span></span>
4. <span data-ttu-id="8cb0e-166">Para acessar um recurso protegido, o cliente inclui o token de acesso no cabeçalho de autorização da solicitação HTTP.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-166">To access a protected resource, the client includes the access token in the Authorization header of the HTTP request.</span></span>

![](individual-accounts-in-web-api/_static/image3.png)

<span data-ttu-id="8cb0e-167">Quando você seleciona **contas individuais** no modelo de projeto de API da Web, o projeto inclui um servidor de autorização que valida as credenciais do usuário e emite tokens.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-167">When you select **Individual accounts** in the Web API project template, the project includes an authorization server that validates user credentials and issues tokens.</span></span> <span data-ttu-id="8cb0e-168">O diagrama a seguir mostra o mesmo fluxo de credenciais em termos de componentes de API da Web.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-168">The following diagram shows the same credential flow in terms of Web API components.</span></span>

![](individual-accounts-in-web-api/_static/image4.png)

<span data-ttu-id="8cb0e-169">Nesse cenário, os controladores de API Web atuam como servidores de recurso.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-169">In this scenario, Web API controllers act as resource servers.</span></span> <span data-ttu-id="8cb0e-170">Um filtro de autenticação valida os tokens de acesso e o **[autorizar]** atributo é usado para proteger um recurso.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-170">An authentication filter validates access tokens, and the **[Authorize]** attribute is used to protect a resource.</span></span> <span data-ttu-id="8cb0e-171">Quando um controlador ou ação tem o **[autorizar]** de atributo, todas as solicitações para esse controlador ou ação deve ser autenticada.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-171">When a controller or action has the **[Authorize]** attribute, all requests to that controller or action must be authenticated.</span></span> <span data-ttu-id="8cb0e-172">Caso contrário, a autorização é negada e API Web retorna um erro de 401 (não autorizado).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-172">Otherwise, authorization is denied, and Web API returns a 401 (Unauthorized) error.</span></span>

<span data-ttu-id="8cb0e-173">O servidor de autorização e o filtro de autenticação que chamam em uma [middleware OWIN](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) componente que manipula os detalhes do OAuth2.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-173">The authorization server and the authentication filter both call into an [OWIN middleware](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) component that handles the details of OAuth2.</span></span> <span data-ttu-id="8cb0e-174">Descreverei o design em mais detalhes posteriormente neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-174">I'll describe the design in more detail later in this tutorial.</span></span>

## <a name="sending-an-unauthorized-request"></a><span data-ttu-id="8cb0e-175">Enviando uma solicitação não autorizada</span><span class="sxs-lookup"><span data-stu-id="8cb0e-175">Sending an Unauthorized Request</span></span>

<span data-ttu-id="8cb0e-176">Para começar, execute o aplicativo e clique no **chamar a API** botão.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-176">To get started, run the app and click the **Call API** button.</span></span> <span data-ttu-id="8cb0e-177">Quando a solicitação for concluída, você verá uma mensagem de erro no **resultado** caixa.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-177">When the request completes, you should see an error message in the **Result** box.</span></span> <span data-ttu-id="8cb0e-178">Isso ocorre porque a solicitação não contém um token de acesso, portanto, a solicitação é autorizada.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-178">That's because the request does not contain an access token, so the request is unauthorized.</span></span>

[![](individual-accounts-in-web-api/_static/image6.png)](individual-accounts-in-web-api/_static/image5.png)

<span data-ttu-id="8cb0e-179">O **chamar a API** botão envia uma solicitação AJAX ao ~/api/valores, que invoca uma ação do controlador de API da Web.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-179">The **Call API** button sends an AJAX request to ~/api/values, which invokes a Web API controller action.</span></span> <span data-ttu-id="8cb0e-180">Aqui está a seção de código JavaScript que envia a solicitação AJAX.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-180">Here is the section of JavaScript code that sends the AJAX request.</span></span> <span data-ttu-id="8cb0e-181">No aplicativo de exemplo, todo o código de aplicativo do JavaScript está localizado no arquivo Scripts\app.js.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-181">In the sample app, all of the JavaScript app code is located in the Scripts\app.js file.</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample1.js)]

<span data-ttu-id="8cb0e-182">Até que o usuário fizer logon, há nenhum token de portador e, portanto, nenhum cabeçalho de autorização na solicitação.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-182">Until the user logs in, there is no bearer token, and therefore no Authorization header in the request.</span></span> <span data-ttu-id="8cb0e-183">Isso faz com que a solicitação para retornar um erro 401.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-183">This causes the request to return a 401 error.</span></span>

<span data-ttu-id="8cb0e-184">Aqui está a solicitação HTTP.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-184">Here is the HTTP request.</span></span> <span data-ttu-id="8cb0e-185">(Eu usei [Fiddler](http://www.telerik.com/fiddler) para capturar o tráfego HTTP.)</span><span class="sxs-lookup"><span data-stu-id="8cb0e-185">(I used [Fiddler](http://www.telerik.com/fiddler) to capture the HTTP traffic.)</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample2.cmd)]

<span data-ttu-id="8cb0e-186">Resposta HTTP:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-186">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample3.cmd?highlight=1,4)]

<span data-ttu-id="8cb0e-187">Observe que a resposta inclui um cabeçalho Www-Authenticate com o desafio definido como portador.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-187">Notice that the response includes a Www-Authenticate header with the challenge set to Bearer.</span></span> <span data-ttu-id="8cb0e-188">Que indica que o servidor espera que um token de portador.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-188">That indicates the server expects a bearer token.</span></span>

## <a name="register-a-user"></a><span data-ttu-id="8cb0e-189">Registrar um usuário</span><span class="sxs-lookup"><span data-stu-id="8cb0e-189">Register a User</span></span>

<span data-ttu-id="8cb0e-190">No **registre** seção do aplicativo, insira um email e senha e clique no **registrar** botão.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-190">In the **Register** section of the app, enter an email and password, and click the **Register** button.</span></span>

<span data-ttu-id="8cb0e-191">Você não precisa usar um endereço de email válido para este exemplo, mas um aplicativo real deve confirmar o endereço.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-191">You don't need to use a valid email address for this sample, but a real app would confirm the address.</span></span> <span data-ttu-id="8cb0e-192">(Consulte [criar um aplicativo de web do ASP.NET MVC 5 seguro com logon, redefinição de senha e de confirmação de email](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) A senha, use algo como "Password1!", com uma letra maiuscula, letra minúscula, número e caractere não alfanumérico.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-192">(See [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) For the password, use something like "Password1!", with an upper case letter, lower case letter, number, and non-alpha-numeric character.</span></span> <span data-ttu-id="8cb0e-193">Para manter o aplicativo simples, eu deixei de fora a validação do lado do cliente, portanto, se houver um problema com o formato da senha, você obterá um erro 400 (solicitação incorreta).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-193">To keep the app simple, I left out client-side validation, so if there is a problem with the password format, you'll get a 400 (Bad Request) error.</span></span>

[![](individual-accounts-in-web-api/_static/image8.png)](individual-accounts-in-web-api/_static/image7.png)

<span data-ttu-id="8cb0e-194">O **registrar** botão envia uma solicitação POST para ~/api/Account/Register /.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-194">The **Register** button sends a POST request to ~/api/Account/Register/.</span></span> <span data-ttu-id="8cb0e-195">O corpo da solicitação é um objeto JSON que contém o nome e senha.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-195">The request body is a JSON object that holds the name and password.</span></span> <span data-ttu-id="8cb0e-196">Aqui está o código JavaScript que envia a solicitação:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-196">Here is the JavaScript code that sends the request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample4.js)]

<span data-ttu-id="8cb0e-197">Solicitação HTTP:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-197">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample5.cmd?highlight=5,10)]

<span data-ttu-id="8cb0e-198">Resposta HTTP:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-198">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample6.cmd)]

<span data-ttu-id="8cb0e-199">Essa solicitação é tratada pelo `AccountController` classe.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-199">This request is handled by the `AccountController` class.</span></span> <span data-ttu-id="8cb0e-200">Internamente, `AccountController` usa a identidade do ASP.NET para gerenciar o banco de dados de associação.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-200">Internally, `AccountController` uses ASP.NET Identity to manage the membership database.</span></span>

<span data-ttu-id="8cb0e-201">Se você executar o aplicativo localmente no Visual Studio, as contas de usuário são armazenadas no LocalDB, na tabela AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-201">If you run the app locally from Visual Studio, user accounts are stored in LocalDB, in the AspNetUsers table.</span></span> <span data-ttu-id="8cb0e-202">Para exibir as tabelas no Visual Studio, clique o **modo de exibição** menu, selecione **Gerenciador de servidores**, em seguida, expanda **conexões de dados**.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-202">To view the tables in Visual Studio, click the **View** menu, select **Server Explorer**, then expand **Data Connections**.</span></span>

![](individual-accounts-in-web-api/_static/image9.png)

## <a name="get-an-access-token"></a><span data-ttu-id="8cb0e-203">Obter um acesso de Token</span><span class="sxs-lookup"><span data-stu-id="8cb0e-203">Get an Access Token</span></span>

<span data-ttu-id="8cb0e-204">Até agora não fizemos nenhum OAuth, mas agora veremos o servidor de autorização do OAuth em ação, quando solicitamos um token de acesso.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-204">So far we have not done any OAuth, but now we'll see the OAuth authorization server in action, when we request an access token.</span></span> <span data-ttu-id="8cb0e-205">No **fazer logon** área do aplicativo de exemplo, insira o email e senha e clique em **Log In**.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-205">In the **Log In** area of the sample app, enter the email and password and click **Log In**.</span></span>

[![](individual-accounts-in-web-api/_static/image11.png)](individual-accounts-in-web-api/_static/image10.png)

<span data-ttu-id="8cb0e-206">O **fazer logon** botão envia uma solicitação para o ponto de extremidade de token.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-206">The **Log In** button sends a request to the token endpoint.</span></span> <span data-ttu-id="8cb0e-207">O corpo da solicitação contém os dados codificados de url do formulário a seguir:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-207">The body of the request contains the following form-url-encoded data:</span></span>

- <span data-ttu-id="8cb0e-208">grant\_type: "password"</span><span class="sxs-lookup"><span data-stu-id="8cb0e-208">grant\_type: "password"</span></span>
- <span data-ttu-id="8cb0e-209">nome de usuário: &lt;o email do usuário&gt;</span><span class="sxs-lookup"><span data-stu-id="8cb0e-209">username: &lt;the user's email&gt;</span></span>
- <span data-ttu-id="8cb0e-210">senha: &lt;senha&gt;</span><span class="sxs-lookup"><span data-stu-id="8cb0e-210">password: &lt;password&gt;</span></span>

<span data-ttu-id="8cb0e-211">Aqui está o código JavaScript que envia a solicitação AJAX:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-211">Here is the JavaScript code that sends the AJAX request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample7.js?highlight=14)]

<span data-ttu-id="8cb0e-212">Se a solicitação for bem-sucedida, o servidor de autorização retorna um token de acesso no corpo da resposta.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-212">If the request succeeds, the authorization server returns an access token in the response body.</span></span> <span data-ttu-id="8cb0e-213">Observe que podemos armazenar o token no armazenamento de sessão, para usar mais tarde ao enviar solicitações para a API.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-213">Notice that we store the token in session storage, to use later when sending requests to the API.</span></span> <span data-ttu-id="8cb0e-214">Ao contrário de algumas formas de autenticação (como a autenticação baseada em cookie), o navegador não incluirá automaticamente o token de acesso em solicitações subsequentes.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-214">Unlike some forms of authentication (such as cookie-based authentication), the browser will not automatically include the access token in subsequent requests.</span></span> <span data-ttu-id="8cb0e-215">O aplicativo deve fazer isso explicitamente.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-215">The application must do so explicitly.</span></span> <span data-ttu-id="8cb0e-216">Isso é algo bom, porque limita [vulnerabilidades CSRF](preventing-cross-site-request-forgery-csrf-attacks.md).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-216">That's a good thing, because it limits [CSRF vulnerabilities](preventing-cross-site-request-forgery-csrf-attacks.md).</span></span>

<span data-ttu-id="8cb0e-217">Solicitação HTTP:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-217">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample8.cmd?highlight=5,10)]

<span data-ttu-id="8cb0e-218">Você pode ver que a solicitação contém as credenciais do usuário.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-218">You can see that the request contains the user's credentials.</span></span> <span data-ttu-id="8cb0e-219">Você *deve* usar HTTPS para fornecer segurança de camada de transporte.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-219">You *must* use HTTPS to provide transport layer security.</span></span>

<span data-ttu-id="8cb0e-220">Resposta HTTP:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-220">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample9.cmd?highlight=8)]

<span data-ttu-id="8cb0e-221">Para facilitar a leitura, eu recuada o JSON e truncado o token de acesso, que é muito longo.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-221">For readability, I indented the JSON and truncated the access token, which is a quite long.</span></span>

<span data-ttu-id="8cb0e-222">O `access_token`, `token_type`, e `expires_in` propriedades são definidas pela especificação OAuth2. As outras propriedades (`userName`, `.issued`, e `.expires`) são apenas para fins informativos.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-222">The `access_token`, `token_type`, and `expires_in` properties are defined by the OAuth2 spec. The other properties (`userName`, `.issued`, and `.expires`) are just for informational purposes.</span></span> <span data-ttu-id="8cb0e-223">Você pode encontrar o código que adiciona essas propriedades adicionais no `TokenEndpoint` método, no arquivo /Providers/ApplicationOAuthProvider.cs.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-223">You can find the code that adds those additional properties in the `TokenEndpoint` method, in the /Providers/ApplicationOAuthProvider.cs file.</span></span>

## <a name="send-an-authenticated-request"></a><span data-ttu-id="8cb0e-224">Enviar uma solicitação autenticada</span><span class="sxs-lookup"><span data-stu-id="8cb0e-224">Send an Authenticated Request</span></span>

<span data-ttu-id="8cb0e-225">Agora que temos um token de portador, fazemos uma solicitação autenticada para a API.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-225">Now that we have a bearer token, we can make an authenticated request to the API.</span></span> <span data-ttu-id="8cb0e-226">Isso é feito definindo o cabeçalho de autorização na solicitação.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-226">This is done by setting the Authorization header in the request.</span></span> <span data-ttu-id="8cb0e-227">Clique o **chamar a API** botão novamente para vê-lo.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-227">Click the **Call API** button again to see this.</span></span>

[![](individual-accounts-in-web-api/_static/image13.png)](individual-accounts-in-web-api/_static/image12.png)

<span data-ttu-id="8cb0e-228">Solicitação HTTP:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-228">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample10.cmd?highlight=5)]

<span data-ttu-id="8cb0e-229">Resposta HTTP:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-229">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample11.cmd)]

## <a name="log-out"></a><span data-ttu-id="8cb0e-230">Fazer logoff</span><span class="sxs-lookup"><span data-stu-id="8cb0e-230">Log Out</span></span>

<span data-ttu-id="8cb0e-231">Porque o navegador não armazena em cache as credenciais ou o token de acesso, fazer logoff é simplesmente uma questão de "esquecer" o token, removendo-o do armazenamento de sessão:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-231">Because the browser does not cache the credentials or the access token, logging out is simply a matter of "forgetting" the token, by removing it from session storage:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample12.js)]

## <a name="understanding-the-individual-accounts-project-template"></a><span data-ttu-id="8cb0e-232">Noções básicas sobre o modelo de projeto contas individuais</span><span class="sxs-lookup"><span data-stu-id="8cb0e-232">Understanding the Individual Accounts Project Template</span></span>

<span data-ttu-id="8cb0e-233">Quando você seleciona **contas individuais** no modelo de projeto de aplicativo Web ASP.NET, o projeto inclui:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-233">When you select **Individual Accounts** in the ASP.NET Web Application project template, the project includes:</span></span>

- <span data-ttu-id="8cb0e-234">Um servidor de autorização OAuth2.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-234">An OAuth2 authorization server.</span></span>
- <span data-ttu-id="8cb0e-235">Um ponto de extremidade de API da Web para gerenciar contas de usuário</span><span class="sxs-lookup"><span data-stu-id="8cb0e-235">A Web API endpoint for managing user accounts</span></span>
- <span data-ttu-id="8cb0e-236">Um modelo do EF para armazenar contas de usuário.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-236">An EF model for storing user accounts.</span></span>

<span data-ttu-id="8cb0e-237">Aqui estão as classes de aplicativo principal que implementam esses recursos:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-237">Here are the main application classes that implement these features:</span></span>

- <span data-ttu-id="8cb0e-238">`AccountController`.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-238">`AccountController`.</span></span> <span data-ttu-id="8cb0e-239">Fornece um ponto de extremidade de API da Web para gerenciar contas de usuário.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-239">Provides a Web API endpoint for managing user accounts.</span></span> <span data-ttu-id="8cb0e-240">O `Register` ação é a única que usamos neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-240">The `Register` action is the only one that we used in this tutorial.</span></span> <span data-ttu-id="8cb0e-241">Outros métodos na classe dão suporte a redefinição de senha, os logons sociais e outras funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-241">Other methods on the class support password reset, social logins, and other functionality.</span></span>
- <span data-ttu-id="8cb0e-242">`ApplicationUser`, definido em /Models/IdentityModels.cs.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-242">`ApplicationUser`, defined in /Models/IdentityModels.cs.</span></span> <span data-ttu-id="8cb0e-243">Essa classe é o modelo do EF para contas de usuário no banco de dados de associação.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-243">This class is the EF model for user accounts in the membership database.</span></span>
- <span data-ttu-id="8cb0e-244">`ApplicationUserManager`, definido no /App\_Start/IdentityConfig.cs essa classe deriva [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) e executa operações em contas de usuário, como a criação de um novo usuário, verificando as senhas e assim por diante e persiste automaticamente alterações no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-244">`ApplicationUserManager`, defined in /App\_Start/IdentityConfig.cs This class derives from [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) and performs operations on user accounts, such as creating a new user, verifying passwords, and so forth, and automatically persists changes to the database.</span></span>
- <span data-ttu-id="8cb0e-245">`ApplicationOAuthProvider`.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-245">`ApplicationOAuthProvider`.</span></span> <span data-ttu-id="8cb0e-246">Esse objeto se vincula ao middleware OWIN e processa os eventos gerados pelo middleware.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-246">This object plugs into the OWIN middleware, and processes events raised by the middleware.</span></span> <span data-ttu-id="8cb0e-247">Ele deriva [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-247">It derives from [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span></span>

![](individual-accounts-in-web-api/_static/image14.png)

### <a name="configuring-the-authorization-server"></a><span data-ttu-id="8cb0e-248">Configurando o servidor de autorização</span><span class="sxs-lookup"><span data-stu-id="8cb0e-248">Configuring the Authorization Server</span></span>

<span data-ttu-id="8cb0e-249">StartupAuth.cs, o código a seguir configura o servidor de autorização OAuth2.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-249">In StartupAuth.cs, the following code configures the OAuth2 authorization server.</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample13.cs)]

<span data-ttu-id="8cb0e-250">O `TokenEndpointPath` propriedade é o caminho de URL para o ponto de extremidade do servidor de autorização.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-250">The `TokenEndpointPath` property is the URL path to the authorization server endpoint.</span></span> <span data-ttu-id="8cb0e-251">Essa é a URL que o aplicativo usa para obter os tokens de portador.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-251">That's the URL that app uses to get the bearer tokens.</span></span>

<span data-ttu-id="8cb0e-252">O `Provider` propriedade especifica um provedor que se vincula ao middleware OWIN e processa os eventos gerados pelo middleware.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-252">The `Provider` property specifies a provider that plugs into the OWIN middleware, and processes events raised by the middleware.</span></span>

<span data-ttu-id="8cb0e-253">Aqui está o fluxo básico quando o aplicativo deseja obter um token:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-253">Here is the basic flow when the app wants to get a token:</span></span>

1. <span data-ttu-id="8cb0e-254">Para obter um token de acesso, o aplicativo envia uma solicitação para ~ / Token.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-254">To get an access token, the app sends a request to ~/Token.</span></span>
2. <span data-ttu-id="8cb0e-255">As chamadas de middleware OAuth `GrantResourceOwnerCredentials` no provedor.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-255">The OAuth middleware calls `GrantResourceOwnerCredentials` on the provider.</span></span>
3. <span data-ttu-id="8cb0e-256">O provedor chamar o `ApplicationUserManager` para validar as credenciais e criar uma identidade baseada em declarações.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-256">The provider calls the `ApplicationUserManager` to validate the credentials and create a claims identity.</span></span>
4. <span data-ttu-id="8cb0e-257">Se isso ocorrer, o provedor cria um tíquete de autenticação, que é usado para gerar o token.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-257">If that succeeds, the provider creates an authentication ticket, which is used to generate the token.</span></span>

[![](individual-accounts-in-web-api/_static/image16.png)](individual-accounts-in-web-api/_static/image15.png)

<span data-ttu-id="8cb0e-258">O middleware OAuth não sabe nada sobre as contas de usuário.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-258">The OAuth middleware doesn't know anything about the user accounts.</span></span> <span data-ttu-id="8cb0e-259">O provedor se comunica entre a identidade do ASP.NET e middleware.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-259">The provider communicates between the middleware and ASP.NET Identity.</span></span> <span data-ttu-id="8cb0e-260">Para obter mais informações sobre como implementar o servidor de autorização, consulte [servidor de autorização OAuth 2.0 OWIN](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-260">For more information about implementing the authorization server, see [OWIN OAuth 2.0 Authorization Server](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span></span>

### <a name="configuring-web-api-to-use-bearer-tokens"></a><span data-ttu-id="8cb0e-261">Configurando a API da Web para usar os Tokens de portador</span><span class="sxs-lookup"><span data-stu-id="8cb0e-261">Configuring Web API to use Bearer Tokens</span></span>

<span data-ttu-id="8cb0e-262">No `WebApiConfig.Register` método, o código a seguir configura a autenticação para o pipeline da API da Web:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-262">In the `WebApiConfig.Register` method, the following code sets up authentication for the Web API pipeline:</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample14.cs)]

<span data-ttu-id="8cb0e-263">O **HostAuthenticationFilter** classe permite a autenticação usando tokens de portador.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-263">The **HostAuthenticationFilter** class enables authentication using bearer tokens.</span></span>

<span data-ttu-id="8cb0e-264">O **SuppressDefaultHostAuthentication** método informa a API da Web para ignorar qualquer autenticação que acontece antes que a solicitação atinja o pipeline da API Web por IIS ou o middleware do OWIN.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-264">The **SuppressDefaultHostAuthentication** method tells Web API to ignore any authentication that happens before the request reaches the Web API pipeline, either by IIS or by OWIN middleware.</span></span> <span data-ttu-id="8cb0e-265">Dessa forma, podemos pode restringir a API da Web para autenticar usando apenas tokens de portador.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-265">That way, we can restrict Web API to authenticate only using bearer tokens.</span></span>

> [!NOTE]
> <span data-ttu-id="8cb0e-266">Em particular, a parte MVC do seu aplicativo pode usar a autenticação de formulários, que armazena as credenciais em um cookie.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-266">In particular, the MVC portion of your app might use forms authentication, which stores credentials in a cookie.</span></span> <span data-ttu-id="8cb0e-267">Autenticação baseada em cookie requer o uso de tokens antifalsificação, para evitar ataques de CSRF.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-267">Cookie-based authentication requires the use of anti-forgery tokens, to prevent CSRF attacks.</span></span> <span data-ttu-id="8cb0e-268">Isso é um problema para APIs web, porque não há nenhuma maneira conveniente para a API da web para enviar o token antifalsificação ao cliente.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-268">That's a problem for web APIs, because there is no convenient way for the web API to send the anti-forgery token to the client.</span></span> <span data-ttu-id="8cb0e-269">(Para obter mais informações sobre esse problema, consulte [impedindo ataques de CSRF na API Web](preventing-cross-site-request-forgery-csrf-attacks.md).) Chamando **SuppressDefaultHostAuthentication** garante que a API da Web não está vulnerável a ataques de CSRF de credenciais armazenadas em cookies.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-269">(For more background on this issue, see [Preventing CSRF Attacks in Web API](preventing-cross-site-request-forgery-csrf-attacks.md).) Calling **SuppressDefaultHostAuthentication** ensures that Web API is not vulnerable to CSRF attacks from credentials stored in cookies.</span></span>


<span data-ttu-id="8cb0e-270">Quando o cliente solicita um recurso protegido, aqui está o que acontece no pipeline da API Web:</span><span class="sxs-lookup"><span data-stu-id="8cb0e-270">When the client requests a protected resource, here is what happens in the Web API pipeline:</span></span>

1. <span data-ttu-id="8cb0e-271">O **HostAuthentication** filtro chama o middleware de OAuth para validar o token.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-271">The **HostAuthentication** filter calls the OAuth middleware to validate the token.</span></span>
2. <span data-ttu-id="8cb0e-272">O middleware converte o token em uma identidade baseada em declarações.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-272">The middleware converts the token into a claims identity.</span></span>
3. <span data-ttu-id="8cb0e-273">Neste ponto, a solicitação é *autenticado* , mas não *autorizado*.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-273">At this point, the request is *authenticated* but not *authorized*.</span></span>
4. <span data-ttu-id="8cb0e-274">O filtro de autorização examina a identidade baseada em declarações.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-274">The authorization filter examines the claims identity.</span></span> <span data-ttu-id="8cb0e-275">Se as declarações de autorizam o usuário para esse recurso, a solicitação é autorizada.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-275">If the claims authorize the user for that resource, the request is authorized.</span></span> <span data-ttu-id="8cb0e-276">Por padrão, o **[autorizar]** atributo autorizará qualquer solicitação que é autenticada.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-276">By default, the **[Authorize]** attribute will authorize any request that is authenticated.</span></span> <span data-ttu-id="8cb0e-277">No entanto, você pode autorizar por função ou por outras declarações.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-277">However, you can authorize by role or by other claims.</span></span> <span data-ttu-id="8cb0e-278">Para obter mais informações, consulte [autenticação e autorização na API Web](authentication-and-authorization-in-aspnet-web-api.md).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-278">For more information, see [Authentication and Authorization in Web API](authentication-and-authorization-in-aspnet-web-api.md).</span></span>
5. <span data-ttu-id="8cb0e-279">Se as etapas anteriores forem bem-sucedidas, o controlador retorna o recurso protegido.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-279">If the previous steps are successful, the controller returns the protected resource.</span></span> <span data-ttu-id="8cb0e-280">Caso contrário, o cliente recebe um erro de 401 (não autorizado).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-280">Otherwise, the client receives a 401 (Unauthorized) error.</span></span>

[![](individual-accounts-in-web-api/_static/image18.png)](individual-accounts-in-web-api/_static/image17.png)

## <a name="additional-resources"></a><span data-ttu-id="8cb0e-281">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="8cb0e-281">Additional Resources</span></span>

- [<span data-ttu-id="8cb0e-282">Identidade do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="8cb0e-282">ASP.NET Identity</span></span>](../../../identity/index.md)
- <span data-ttu-id="8cb0e-283">[Noções básicas sobre os recursos de segurança no modelo do SPA para VS2013 RC](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-283">[Understanding Security Features in the SPA Template for VS2013 RC](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span></span> <span data-ttu-id="8cb0e-284">Postagem do blog do MSDN por Hongye Sun.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-284">MSDN blog post by Hongye Sun.</span></span>
- <span data-ttu-id="8cb0e-285">[Dissecando o Web API indivíduo contas modelo – parte 2: Contas locais](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-285">[Dissecting the Web API Individual Accounts Template–Part 2: Local Accounts](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span></span> <span data-ttu-id="8cb0e-286">Postagem de blog de Dominick Baier.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-286">Blog post by Dominick Baier.</span></span>
- <span data-ttu-id="8cb0e-287">[Hospedar a autenticação e a API Web com OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-287">[Host authentication and Web API with OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span></span> <span data-ttu-id="8cb0e-288">Uma boa explicação sobre `SuppressDefaultHostAuthentication` e `HostAuthenticationFilter` por Brock Allen.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-288">A good explanation of `SuppressDefaultHostAuthentication` and `HostAuthenticationFilter` by Brock Allen.</span></span>
- <span data-ttu-id="8cb0e-289">[Personalizando informações de perfil no ASP.NET Identity em modelos do VS 2013](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-289">[Customizing profile information in ASP.NET Identity in VS 2013 templates](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span></span> <span data-ttu-id="8cb0e-290">Postagem de blog do MSDN de Pranav Rastogi.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-290">MSDN blog post by Pranav Rastogi.</span></span>
- <span data-ttu-id="8cb0e-291">[Por gerenciamento de tempo de vida de solicitação para a classe UserManager no ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="8cb0e-291">[Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span> <span data-ttu-id="8cb0e-292">Postagem de blog do MSDN de Suhas Joshi, com uma boa explicação sobre o `UserManager` classe.</span><span class="sxs-lookup"><span data-stu-id="8cb0e-292">MSDN blog post by Suhas Joshi, with a good explanation of the `UserManager` class.</span></span>
