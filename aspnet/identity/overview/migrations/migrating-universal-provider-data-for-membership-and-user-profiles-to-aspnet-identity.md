---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: Migrando dados do provedor Universal para associações e perfis de usuário para a identidade do ASP.NET (C#)-ASP.NET 4.x
author: rustd
description: Este tutorial descreve as etapas necessárias migrar dados de função e de usuários e dados de perfil de usuário criados usando provedores universais de um aplicativo existente...
ms.author: riande
ms.date: 12/13/2013
ms.custom: seoapril2019
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 1043dce4cdd62f94ae9d2344a9301c1b03426f3d
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59422259"
---
# <a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="d1e43-103">Migração de dados de Associação e Perfis de usuário do provedor universal para a Identidade do ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="d1e43-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>

<span data-ttu-id="d1e43-104">por [Pranav Rastogi](https://github.com/rustd), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="d1e43-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="d1e43-105">Este tutorial descreve as etapas necessárias migrar dados de perfil de usuário criados usando provedores universais de um aplicativo existente para o modelo de identidade do ASP.NET e de usuário e dados de função.</span><span class="sxs-lookup"><span data-stu-id="d1e43-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="d1e43-106">A abordagem mencionada aqui migrar dados de perfil do usuário pode ser usados em um aplicativo com a associação do SQL também.</span><span class="sxs-lookup"><span data-stu-id="d1e43-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>


<span data-ttu-id="d1e43-107">Com o lançamento do Visual Studio 2013, a equipe do ASP.NET introduziu um novo sistema ASP.NET Identity, e você pode ler mais sobre essa versão [aqui](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="d1e43-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="d1e43-108">Dando o artigo para migrar aplicativos web contra [associação de SQL para o novo sistema de identidade](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), este artigo ilustra as etapas para migrar aplicativos existentes que seguem o modelo de provedores para o gerenciamento de usuário e a função para o novo modelo de identidade.</span><span class="sxs-lookup"><span data-stu-id="d1e43-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="d1e43-109">O foco deste tutorial será principalmente sobre como migrar os dados de perfil do usuário para perfeitamente vinculá-lo no novo sistema.</span><span class="sxs-lookup"><span data-stu-id="d1e43-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="d1e43-110">Migração de informações de usuário e a função é semelhante para a associação do SQL.</span><span class="sxs-lookup"><span data-stu-id="d1e43-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="d1e43-111">A abordagem seguida para migrar dados de perfil pode ser usada em um aplicativo com a associação do SQL também.</span><span class="sxs-lookup"><span data-stu-id="d1e43-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="d1e43-112">Por exemplo, vamos começar com um aplicativo web criado usando o Visual Studio 2012 usa o modelo de provedores.</span><span class="sxs-lookup"><span data-stu-id="d1e43-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="d1e43-113">Podemos será, em seguida, adicione código para gerenciamento de perfil, registrar um usuário, adicionar dados de perfil para os usuários, migrar o esquema de banco de dados e, em seguida, altere o aplicativo para usar o sistema de identidade para o gerenciamento de usuário e a função.</span><span class="sxs-lookup"><span data-stu-id="d1e43-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="d1e43-114">Como um teste de migração, os usuários criados usando provedores Universal devem ser capazes de fazer logon e novos usuários devem ser capazes de se registrar.</span><span class="sxs-lookup"><span data-stu-id="d1e43-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="d1e43-115">Você pode encontrar o exemplo completo em [ https://github.com/suhasj/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="d1e43-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>


## <a name="profile-data-migration-summary"></a><span data-ttu-id="d1e43-116">Resumo de migração de dados de perfil</span><span class="sxs-lookup"><span data-stu-id="d1e43-116">Profile data migration summary</span></span>

<span data-ttu-id="d1e43-117">Antes de iniciar com as migrações, vamos examine a experiência de armazenar dados de perfil no modelo de provedores.</span><span class="sxs-lookup"><span data-stu-id="d1e43-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="d1e43-118">Dados de perfil para o aplicativo que os usuários podem ser armazenados de várias maneiras, mais comum entre eles sendo usando os provedores de perfis internos enviados junto com os provedores universais.</span><span class="sxs-lookup"><span data-stu-id="d1e43-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="d1e43-119">Incluem as etapas</span><span class="sxs-lookup"><span data-stu-id="d1e43-119">The steps would include</span></span>

1. <span data-ttu-id="d1e43-120">Adicione uma classe que tem as propriedades usadas para armazenar dados de perfil.</span><span class="sxs-lookup"><span data-stu-id="d1e43-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="d1e43-121">Adicione uma classe que estende 'ProfileBase' e implementa métodos para obter os dados de perfil acima para o usuário.</span><span class="sxs-lookup"><span data-stu-id="d1e43-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="d1e43-122">Habilitar o uso de provedores de perfil de padrão na *Web. config* de arquivo e definir a classe declarada na etapa 2 # a ser usado ao acessar informações de perfil.</span><span class="sxs-lookup"><span data-stu-id="d1e43-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="d1e43-123">As informações de perfil são armazenadas como dados binários na tabela 'Perfis' no banco de dados e de xml serializado.</span><span class="sxs-lookup"><span data-stu-id="d1e43-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="d1e43-124">Depois de migrar o aplicativo para usar o novo sistema ASP.NET Identity, as informações de perfil são desserializadas e armazenadas como propriedades da classe de usuário.</span><span class="sxs-lookup"><span data-stu-id="d1e43-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="d1e43-125">Cada propriedade, em seguida, pode ser mapeada para colunas na tabela do usuário.</span><span class="sxs-lookup"><span data-stu-id="d1e43-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="d1e43-126">A vantagem aqui é que as propriedades podem ser trabalhadas diretamente usando a classe de usuário, além de não precisar serializar/desserializar informações de dados cada vez quando ela é acessada.</span><span class="sxs-lookup"><span data-stu-id="d1e43-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="d1e43-127">Guia de Introdução</span><span class="sxs-lookup"><span data-stu-id="d1e43-127">Getting Started</span></span>

1. <span data-ttu-id="d1e43-128">Crie um novo aplicativo de Web Forms do ASP.NET 4.5 no Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="d1e43-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="d1e43-129">A amostra atual usa o modelo de Web Forms, mas você pode usar o aplicativo MVC também.</span><span class="sxs-lookup"><span data-stu-id="d1e43-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="d1e43-130">Criar uma nova pasta de modelos para armazenar informações de perfil</span><span class="sxs-lookup"><span data-stu-id="d1e43-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="d1e43-131">Como exemplo, vamos armazene a data de nascimento, cidade, altura e peso do usuário no perfil.</span><span class="sxs-lookup"><span data-stu-id="d1e43-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="d1e43-132">A altura e peso são armazenados como uma classe personalizada chamada 'PersonalStats'.</span><span class="sxs-lookup"><span data-stu-id="d1e43-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="d1e43-133">Para armazenar e recuperar o perfil, precisamos de uma classe que estende 'ProfileBase'.</span><span class="sxs-lookup"><span data-stu-id="d1e43-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="d1e43-134">Vamos criar uma nova classe AppProfile para obter e armazenar informações de perfil.</span><span class="sxs-lookup"><span data-stu-id="d1e43-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="d1e43-135">Habilitar o perfil na *Web. config* arquivo.</span><span class="sxs-lookup"><span data-stu-id="d1e43-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="d1e43-136">Insira o nome da classe a ser usado para armazenar/recuperar informações do usuário criadas na etapa 3 do #.</span><span class="sxs-lookup"><span data-stu-id="d1e43-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="d1e43-137">Adicione uma página web forms na pasta 'Conta' para obter os dados de perfil do usuário e armazená-lo.</span><span class="sxs-lookup"><span data-stu-id="d1e43-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="d1e43-138">Clique com botão direito no projeto e selecione "Adicionar Novo Item".</span><span class="sxs-lookup"><span data-stu-id="d1e43-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="d1e43-139">Adicione uma nova página de formulários da Web com a página mestra 'AddProfileData.aspx'.</span><span class="sxs-lookup"><span data-stu-id="d1e43-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="d1e43-140">Copie o seguinte na seção 'MainContent':</span><span class="sxs-lookup"><span data-stu-id="d1e43-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

   <span data-ttu-id="d1e43-141">Adicione o seguinte código no code-behind:</span><span class="sxs-lookup"><span data-stu-id="d1e43-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

   <span data-ttu-id="d1e43-142">Adicione o namespace no qual AppProfile classe é definida para remover os erros de compilação.</span><span class="sxs-lookup"><span data-stu-id="d1e43-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="d1e43-143">Execute o aplicativo e criar um novo usuário com nome de usuário '**olduser'.**</span><span class="sxs-lookup"><span data-stu-id="d1e43-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="d1e43-144">Navegue até a página 'AddProfileData' e adicione informações de perfil do usuário.</span><span class="sxs-lookup"><span data-stu-id="d1e43-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="d1e43-145">Você pode verificar que os dados são armazenados como xml serializado na tabela 'Perfis' usando a janela do Gerenciador de servidores.</span><span class="sxs-lookup"><span data-stu-id="d1e43-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="d1e43-146">No Visual Studio, no menu 'Exibir', escolha 'Gerenciador de servidores'.</span><span class="sxs-lookup"><span data-stu-id="d1e43-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="d1e43-147">Deve haver uma conexão de dados para o banco de dados definido na *Web. config* arquivo.</span><span class="sxs-lookup"><span data-stu-id="d1e43-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="d1e43-148">Clicar na conexão de dados mostra diferentes subcategorias.</span><span class="sxs-lookup"><span data-stu-id="d1e43-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="d1e43-149">Expanda as tabelas para mostrar as tabelas diferentes no banco de dados, em seguida, clique com botão direito em 'Perfis' e escolha 'Mostrar dados da tabela' para exibir os dados de perfil armazenados na tabela de perfis.</span><span class="sxs-lookup"><span data-stu-id="d1e43-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="d1e43-150">Migrar o esquema de banco de dados</span><span class="sxs-lookup"><span data-stu-id="d1e43-150">Migrating database schema</span></span>

<span data-ttu-id="d1e43-151">Para tornar o banco de dados existente para trabalhar com o sistema de identidade, precisamos atualizar o esquema no banco de dados de identidade para dar suporte os campos que adicionamos ao banco de dados original.</span><span class="sxs-lookup"><span data-stu-id="d1e43-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="d1e43-152">Isso pode ser feito usando os scripts SQL para criar novas tabelas e copiar as informações existentes.</span><span class="sxs-lookup"><span data-stu-id="d1e43-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="d1e43-153">Na janela do 'Gerenciador de servidores ', expanda 'DefaultConnection' para exibir as tabelas.</span><span class="sxs-lookup"><span data-stu-id="d1e43-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="d1e43-154">Tabelas de clique com botão direito e selecione 'Nova consulta'</span><span class="sxs-lookup"><span data-stu-id="d1e43-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="d1e43-155">Cole o script SQL a partir [ https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt ](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) e executá-lo.</span><span class="sxs-lookup"><span data-stu-id="d1e43-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="d1e43-156">Se o DefaultConnection for atualizado, podemos ver que as novas tabelas são adicionadas.</span><span class="sxs-lookup"><span data-stu-id="d1e43-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="d1e43-157">Você pode verificar os dados dentro de tabelas para verificar se as informações foram migradas.</span><span class="sxs-lookup"><span data-stu-id="d1e43-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="d1e43-158">Migrar o aplicativo para usar a identidade do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="d1e43-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="d1e43-159">Instale os pacotes Nuget necessários para a identidade do ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="d1e43-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="d1e43-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="d1e43-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="d1e43-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="d1e43-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="d1e43-162">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="d1e43-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="d1e43-163">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="d1e43-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="d1e43-164">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="d1e43-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="d1e43-165">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="d1e43-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="d1e43-166">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="d1e43-166">Microsoft.Owin.Security.Twitter</span></span>

   <span data-ttu-id="d1e43-167">Para obter mais informações sobre como gerenciar pacotes Nuget podem ser encontradas [aqui](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span><span class="sxs-lookup"><span data-stu-id="d1e43-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="d1e43-168">Para trabalhar com dados existentes na tabela, precisamos criar classes de modelo que mapeiam para as tabelas e conectá-las no sistema de identidade.</span><span class="sxs-lookup"><span data-stu-id="d1e43-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="d1e43-169">Como parte do contrato de identidade, as classes de modelo devem implementam as interfaces definidas na dll Identity.Core ou podem estender a implementação existente dessas interfaces disponíveis no EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="d1e43-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="d1e43-170">Vamos usar as classes existentes para a função, os logons de usuário e declarações de usuário.</span><span class="sxs-lookup"><span data-stu-id="d1e43-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="d1e43-171">Precisamos usar um usuário personalizado em nosso exemplo.</span><span class="sxs-lookup"><span data-stu-id="d1e43-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="d1e43-172">Clique com botão direito no projeto e criar nova pasta 'IdentityModels'.</span><span class="sxs-lookup"><span data-stu-id="d1e43-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="d1e43-173">Adicione uma nova classe de 'User', conforme mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="d1e43-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

   <span data-ttu-id="d1e43-174">Observe que o 'ProfileInfo' agora é uma propriedade na classe de usuário.</span><span class="sxs-lookup"><span data-stu-id="d1e43-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="d1e43-175">Portanto, podemos usar a classe de usuário para trabalhar diretamente com os dados de perfil.</span><span class="sxs-lookup"><span data-stu-id="d1e43-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="d1e43-176">Copie os arquivos a **IdentityModels** e **IdentityAccount** pastas da fonte de download ( [ https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="d1e43-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="d1e43-177">Eles têm as classes de modelo restantes e as novas páginas necessárias para o usuário e gerenciamento de função usando as APIs de identidade do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d1e43-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="d1e43-178">A abordagem usada é semelhante à associação de SQL e a explicação detalhada pode ser encontrada [aqui](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="d1e43-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="d1e43-179">Copiando dados de perfil para as novas tabelas</span><span class="sxs-lookup"><span data-stu-id="d1e43-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="d1e43-180">Como mencionado anteriormente, é necessário desserializar os dados xml nas tabelas de perfis e armazená-los nas colunas da tabela AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="d1e43-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="d1e43-181">As novas colunas foram criadas na tabela users na etapa anterior, portanto, tudo o que resta é preencher as colunas com os dados necessários.</span><span class="sxs-lookup"><span data-stu-id="d1e43-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="d1e43-182">Para fazer isso, usaremos um aplicativo de console que é executado uma vez para preencher as colunas recém-criadas na tabela users.</span><span class="sxs-lookup"><span data-stu-id="d1e43-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="d1e43-183">Crie um novo aplicativo de console na solução existente.</span><span class="sxs-lookup"><span data-stu-id="d1e43-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="d1e43-184">Instale a versão mais recente do pacote do Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="d1e43-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="d1e43-185">Adicione o aplicativo web criado acima como uma referência para o aplicativo de console.</span><span class="sxs-lookup"><span data-stu-id="d1e43-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="d1e43-186">Para fazer isso clique com botão direito no projeto, 'Add References', em seguida, a solução, em seguida, clique no projeto e clicar em Okey.</span><span class="sxs-lookup"><span data-stu-id="d1e43-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="d1e43-187">Copie o código na classe Program.cs abaixo.</span><span class="sxs-lookup"><span data-stu-id="d1e43-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="d1e43-188">Essa lógica lê os dados de perfil para cada usuário, serializa-lo como 'ProfileInfo' objeto e o armazena no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d1e43-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

   <span data-ttu-id="d1e43-189">Alguns modelos usados são definidos na pasta 'IdentityModels' do projeto de aplicativo web, portanto, você deve incluir os namespaces correspondentes.</span><span class="sxs-lookup"><span data-stu-id="d1e43-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="d1e43-190">O código acima funciona no arquivo de banco de dados no aplicativo\_pasta de dados do projeto de aplicativo web criado nas etapas anteriores.</span><span class="sxs-lookup"><span data-stu-id="d1e43-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="d1e43-191">Para fazer referência a ele, atualize a cadeia de caracteres de conexão no arquivo App. config do aplicativo de console com a cadeia de conexão no Web. config do aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="d1e43-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="d1e43-192">Também fornecem o caminho físico completo na propriedade 'AttachDbFilename'.</span><span class="sxs-lookup"><span data-stu-id="d1e43-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="d1e43-193">Abra um prompt de comando e navegue até a pasta bin do aplicativo de console acima.</span><span class="sxs-lookup"><span data-stu-id="d1e43-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="d1e43-194">Execute o executável e examine a saída de log, conforme mostrado na imagem a seguir.</span><span class="sxs-lookup"><span data-stu-id="d1e43-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="d1e43-195">Abra a tabela 'AspNetUsers' no Gerenciador de servidores e verifique se os dados nas novas colunas que contêm as propriedades.</span><span class="sxs-lookup"><span data-stu-id="d1e43-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="d1e43-196">Eles devem ser atualizados com os valores de propriedade correspondentes.</span><span class="sxs-lookup"><span data-stu-id="d1e43-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="d1e43-197">Verificar a funcionalidade</span><span class="sxs-lookup"><span data-stu-id="d1e43-197">Verify functionality</span></span>

<span data-ttu-id="d1e43-198">Use as páginas de associação adicionados recentemente que são implementadas usando a identidade do ASP.NET para fazer logon de um usuário de banco de dados antigo.</span><span class="sxs-lookup"><span data-stu-id="d1e43-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="d1e43-199">O usuário deve ser capaz de fazer logon usando as mesmas credenciais.</span><span class="sxs-lookup"><span data-stu-id="d1e43-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="d1e43-200">Experimente outras funcionalidades, como adicionar OAuth, criando um novo usuário, alterar uma senha, adição de funções, adicione usuários a funções, etc.</span><span class="sxs-lookup"><span data-stu-id="d1e43-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="d1e43-201">Os dados de perfil para o usuário antigo e novos usuários devem ser recuperados e armazenados na tabela users.</span><span class="sxs-lookup"><span data-stu-id="d1e43-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="d1e43-202">A tabela antiga não deve ser referenciada.</span><span class="sxs-lookup"><span data-stu-id="d1e43-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="d1e43-203">Conclusão</span><span class="sxs-lookup"><span data-stu-id="d1e43-203">Conclusion</span></span>

<span data-ttu-id="d1e43-204">O artigo descreveu o processo de migração de aplicativos web que usasse o modelo de provedor para associação de identidade do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d1e43-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="d1e43-205">Além disso, o artigo descritas migrando dados de perfil para os usuários a ser conectado o sistema de identidade.</span><span class="sxs-lookup"><span data-stu-id="d1e43-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="d1e43-206">Deixe comentários abaixo para perguntas e problemas encontrados ao migrar seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d1e43-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="d1e43-207">*Graças ao Rick Anderson e Robert McMurray revisão do artigo.*</span><span class="sxs-lookup"><span data-stu-id="d1e43-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
