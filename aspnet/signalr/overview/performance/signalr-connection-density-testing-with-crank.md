---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: Densidade de Conexão do SignalR testes com Crank | Microsoft Docs
author: bradygaster
description: Testes de densidade de conexão do SignalR com Crank
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: bb8a7da1080dc325c0479b337d114b8dcdf6e102
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59390058"
---
# <a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="ae5b3-103">Testes de densidade de conexão do SignalR com Crank</span><span class="sxs-lookup"><span data-stu-id="ae5b3-103">SignalR Connection Density Testing with Crank</span></span>

<span data-ttu-id="ae5b3-104">por [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="ae5b3-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="ae5b3-105">Este artigo descreve como usar a ferramenta manivela para testar um aplicativo com vários clientes simulados.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>


<span data-ttu-id="ae5b3-106">Quando seu aplicativo estiver em execução no seu ambiente de hospedagem (Azure uma função, IIS, web ou auto-hospedados usando Owin), você pode testar a resposta do aplicativo para um alto nível de densidade de conexão usando a ferramenta manivela.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="ae5b3-107">O ambiente de hospedagem pode ser um servidor de serviços de informações da Internet (IIS), um host Owin ou uma função web do Azure.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="ae5b3-108">(Observação: Contadores de desempenho não estão disponíveis em aplicativos de Web de serviço de aplicativo do Azure, portanto, não será capaz de obter dados de desempenho de um teste de densidade de conexão.)</span><span class="sxs-lookup"><span data-stu-id="ae5b3-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="ae5b3-109">Densidade de Conexão refere-se ao número de conexões TCP simultâneas que podem ser estabelecidas em um servidor.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="ae5b3-110">Cada conexão TCP resulta em sua própria sobrecarga e abrindo um grande número de conexões ociosas, eventualmente, criar um afunilamento de memória.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="ae5b3-111">[O SignalR codebase](https://github.com/signalr/signalr) inclui uma ferramenta de teste de carga chamada **Crank**.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="ae5b3-112">A versão mais recente do manivela pode ser encontrada no [ramificação Dev](https://github.com/SignalR/signalr/tree/dev) no GitHub.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="ae5b3-113">Você pode baixar um Zip de base de código do arquivo morto de ramificação de desenvolvimento do SignalR [aqui](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="ae5b3-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="ae5b3-114">Crank pode ser usado para saturar totalmente a memória do servidor para calcular o número total de conexões ociosas possíveis no hardware do servidor.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="ae5b3-115">Como alternativa, você também pode usar manivela para teste de carga do servidor em uma determinada quantidade de pressão de memória, por aumentando gradualmente conexões até que uma contagem específica ou um limite de memória específica seja atingido.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="ae5b3-116">Durante o teste, é importante usar clientes remotos para evitar qualquer competição por recursos (ou seja, as conexões TCP e memória).</span><span class="sxs-lookup"><span data-stu-id="ae5b3-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="ae5b3-117">Monitore clientes para garantir que eles não estão atingindo gargalos que podem impedir que o servidor atingir sua capacidade total (CPU ou memória).</span><span class="sxs-lookup"><span data-stu-id="ae5b3-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="ae5b3-118">Talvez você precise aumentar o número de clientes para carregar totalmente o servidor.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="ae5b3-119">Executando um teste de densidade de Conexão</span><span class="sxs-lookup"><span data-stu-id="ae5b3-119">Running a Connection Density Test</span></span>

<span data-ttu-id="ae5b3-120">Esta seção descreve as etapas necessárias para executar um teste de densidade de conexão em um aplicativo do SignalR.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="ae5b3-121">Baixe e compile o [base de código da ramificação de desenvolvimento do SignalR](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="ae5b3-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="ae5b3-122">No prompt de comando, navegue até &lt;diretório do projeto&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="ae5b3-123">Implante seu aplicativo em seu ambiente de hospedagem pretendido.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="ae5b3-124">Anote o ponto de extremidade que usa seu aplicativo; Por exemplo, no aplicativo criado na [tutorial de Introdução](../getting-started/tutorial-getting-started-with-signalr.md), o ponto de extremidade `http://<yourhost>:8080/signalr`.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="ae5b3-125">Instale [contadores de desempenho do SignalR](signalr-performance.md#perfcounters) no servidor.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="ae5b3-126">Se seu aplicativo estiver em execução no Azure, consulte [contadores de desempenho usando o SignalR em uma função da Web do Azure](using-signalr-performance-counters-in-an-azure-web-role.md).</span><span class="sxs-lookup"><span data-stu-id="ae5b3-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="ae5b3-127">Depois que você baixou e criou a base de código e contadores de desempenho instalados em seu host, a ferramenta de linha de comando manivela pode ser encontrada no `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` pasta.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="ae5b3-128">As opções disponíveis para a ferramenta manivela incluem:</span><span class="sxs-lookup"><span data-stu-id="ae5b3-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="ae5b3-129">**/?**: Mostra a tela de Ajuda.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="ae5b3-130">As opções disponíveis são exibidas também se o **Url** parâmetro for omitido.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="ae5b3-131">**/Url**: A URL para conexões do SignalR.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="ae5b3-132">Este parâmetro é necessário.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-132">This parameter is required.</span></span> <span data-ttu-id="ae5b3-133">Para um aplicativo de SignalR usando o mapeamento padrão, o caminho será encerrada em "/ signalr".</span><span class="sxs-lookup"><span data-stu-id="ae5b3-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="ae5b3-134">**/ Transporte**: O nome do transporte usado.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="ae5b3-135">O padrão é `auto`, que seleciona o melhor protocolo disponível.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="ae5b3-136">As opções incluem `WebSockets`, `ServerSentEvents`, e `LongPolling` (`ForeverFrame` não é uma opção para manivela, desde que o cliente do .NET em vez do Internet Explorer é usado).</span><span class="sxs-lookup"><span data-stu-id="ae5b3-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="ae5b3-137">Para obter mais informações sobre como o SignalR seleciona transportes, consulte [transportes e Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span><span class="sxs-lookup"><span data-stu-id="ae5b3-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="ae5b3-138">**/BatchSize**: O número de clientes adicionados em cada lote.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="ae5b3-139">O padrão é 50.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-139">The default is 50.</span></span>
- <span data-ttu-id="ae5b3-140">**/ConnectInterval**: O intervalo em milissegundos entre a adição de conexões.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="ae5b3-141">O padrão é 500.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-141">The default is 500.</span></span>
- <span data-ttu-id="ae5b3-142">**/ Conexões**: O número de conexões usado para o aplicativo de teste de carga.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="ae5b3-143">O padrão é 100.000.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-143">The default is 100,000.</span></span>
- <span data-ttu-id="ae5b3-144">**/ConnectTimeout**: O tempo limite em segundos antes de anular o teste.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="ae5b3-145">O padrão é 300.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-145">The default is 300.</span></span>
- <span data-ttu-id="ae5b3-146">**MinServerMBytes**: Os megabytes mínima do servidor para alcançar.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="ae5b3-147">O padrão é 500.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-147">The default is 500.</span></span>
- <span data-ttu-id="ae5b3-148">**SendBytes**: O tamanho da carga enviada para o servidor em bytes.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="ae5b3-149">O padrão é 0.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-149">The default is 0.</span></span>
- <span data-ttu-id="ae5b3-150">**SendInterval**: O atraso em milissegundos entre as mensagens para o servidor.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="ae5b3-151">O padrão é 500.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-151">The default is 500.</span></span>
- <span data-ttu-id="ae5b3-152">**SendTimeout**: O tempo limite em milissegundos para mensagens para o servidor.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="ae5b3-153">O padrão é 300.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-153">The default is 300.</span></span>
- <span data-ttu-id="ae5b3-154">**ControllerUrl**: A Url em que um cliente hospedará um hub de controlador.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="ae5b3-155">O padrão é null (hub de controlador).</span><span class="sxs-lookup"><span data-stu-id="ae5b3-155">The default is null (no controller hub).</span></span> <span data-ttu-id="ae5b3-156">O hub de controlador é iniciado no início da sessão de manivela; Nenhum outro contato entre o hub de controlador e uma manivela é feito.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="ae5b3-157">**NumClients**: O número de clientes simulados para se conectar ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="ae5b3-158">O padrão é um.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-158">The default is one.</span></span>
- <span data-ttu-id="ae5b3-159">**Arquivo de log**: O nome do arquivo para o arquivo de log para a execução de teste.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="ae5b3-160">O padrão é `crank.csv`.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="ae5b3-161">**SampleInterval**: O tempo em milissegundos entre as amostras de contador de desempenho.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="ae5b3-162">O padrão é 1000.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-162">The default is 1000.</span></span>
- <span data-ttu-id="ae5b3-163">**SignalRInstance**: O nome da instância dos contadores de desempenho no servidor.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="ae5b3-164">O padrão é usar o estado de conexão do cliente.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="ae5b3-165">Exemplo</span><span class="sxs-lookup"><span data-stu-id="ae5b3-165">Example</span></span>

<span data-ttu-id="ae5b3-166">O comando a seguir irá testar um site chamado `pfsignalr` no Azure que hospeda um aplicativo na porta 8080 com um hub chamado "ControllerHub", usando 100 conexões.</span><span class="sxs-lookup"><span data-stu-id="ae5b3-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
