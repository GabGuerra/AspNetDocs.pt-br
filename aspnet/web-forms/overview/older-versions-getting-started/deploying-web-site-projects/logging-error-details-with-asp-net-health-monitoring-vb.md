---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-vb
title: Registro em log os detalhes do erro com (VB) de monitoramento de integridade do ASP.NET | Microsoft Docs
author: rick-anderson
description: Sistema de monitoramento de integridade da Microsoft fornece uma maneira fácil e personalizável para fazer logon de vários eventos da web, incluindo as exceções sem tratamento. Este tutorial orienta sua...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 09a6c74e-936a-4c04-8547-5bb313a4e4a3
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-vb
msc.type: authoredcontent
ms.openlocfilehash: a9dd4268ef20b58b674f8ec8313132398fc5f19d
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59413120"
---
# <a name="logging-error-details-with-aspnet-health-monitoring-vb"></a><span data-ttu-id="fbddd-104">Registro em log de detalhes de erros com o monitoramento de integridade do ASP.NET (VB)</span><span class="sxs-lookup"><span data-stu-id="fbddd-104">Logging Error Details with ASP.NET Health Monitoring (VB)</span></span>

<span data-ttu-id="fbddd-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="fbddd-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="fbddd-106">[Baixar o código](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_VB.zip) ou [baixar PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="fbddd-106">[Download Code](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_VB.zip) or [Download PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_vb.pdf)</span></span>

> <span data-ttu-id="fbddd-107">Sistema de monitoramento de integridade da Microsoft fornece uma maneira fácil e personalizável para fazer logon de vários eventos da web, incluindo as exceções sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="fbddd-107">Microsoft's health monitoring system provides an easy and customizable way to log various web events, including unhandled exceptions.</span></span> <span data-ttu-id="fbddd-108">Este tutorial orienta pela configuração de sistema de monitoramento de integridade para registrar exceções sem tratamento para um banco de dados e notificar os desenvolvedores por meio de uma mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="fbddd-108">This tutorial walks through setting up the health monitoring system to log unhandled exceptions to a database and to notify developers via an email message.</span></span>


## <a name="introduction"></a><span data-ttu-id="fbddd-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="fbddd-109">Introduction</span></span>

<span data-ttu-id="fbddd-110">Registro em log é uma ferramenta útil para monitorar a integridade de um aplicativo implantado e para diagnosticar quaisquer problemas que possam surgir.</span><span class="sxs-lookup"><span data-stu-id="fbddd-110">Logging is a useful tool for monitoring the health of a deployed application and for diagnosing any problems that may arise.</span></span> <span data-ttu-id="fbddd-111">É especialmente importante registrar erros que ocorrem em um aplicativo implantado, de modo que eles podem ser corrigidos.</span><span class="sxs-lookup"><span data-stu-id="fbddd-111">It is especially important to log errors that occur in a deployed application so that they can be remedied.</span></span> <span data-ttu-id="fbddd-112">O `Error` é gerado sempre que uma exceção não tratada ocorre em um aplicativo ASP.NET; a [tutorial anterior](processing-unhandled-exceptions-vb.md) mostrou como notificar um desenvolvedor de um erro e seus detalhes de log com a criação de um manipulador de eventos para o `Error` eventos.</span><span class="sxs-lookup"><span data-stu-id="fbddd-112">The `Error` event is raised whenever an unhandled exception occurs in an ASP.NET application; the [preceding tutorial](processing-unhandled-exceptions-vb.md) showed how to notify a developer of an error and log its details by creating an event handler for the `Error` event.</span></span> <span data-ttu-id="fbddd-113">No entanto, criando um `Error` manipulador de eventos para registrar em log os detalhes do erro e notificar um desenvolvedor é desnecessária, que essa tarefa pode ser realizada pelo ASP. Do NET *sistema de monitoramento de integridade*.</span><span class="sxs-lookup"><span data-stu-id="fbddd-113">However, creating an `Error` event handler to log the error's details and notify a developer is unnecessary, as this task can be performed by ASP.NET's *health monitoring system*.</span></span>

<span data-ttu-id="fbddd-114">O sistema de monitoramento de integridade foi introduzida no ASP.NET 2.0 e é projetada para monitorar a integridade de um aplicativo ASP.NET implantado pelo log de eventos que ocorrem durante o tempo de vida da solicitação ou o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="fbddd-114">The health monitoring system was introduced in ASP.NET 2.0 and is designed to monitor the health of a deployed ASP.NET application by logging events that occur during the application or request's lifetime.</span></span> <span data-ttu-id="fbddd-115">Os eventos registrados pelo sistema de monitoramento de integridade são denominados *eventos de monitoramento de integridade* ou *eventos da Web*e incluem:</span><span class="sxs-lookup"><span data-stu-id="fbddd-115">The events logged by the health monitoring system are referred to as *health monitoring events* or *Web events*, and include:</span></span>

- <span data-ttu-id="fbddd-116">Eventos de tempo de vida do aplicativo, como quando um aplicativo inicia ou interrompe</span><span class="sxs-lookup"><span data-stu-id="fbddd-116">Application lifetime events, such as when an application starts or stops</span></span>
- <span data-ttu-id="fbddd-117">Eventos de segurança, incluindo tentativas de logon e falha nas solicitações de autorização de URL</span><span class="sxs-lookup"><span data-stu-id="fbddd-117">Security events, including failed login attempts and failed URL authorization requests</span></span>
- <span data-ttu-id="fbddd-118">Erros de aplicativo, incluindo sem tratamento de exceções, exceções, as exceções de validação de solicitação e erros de compilação, entre outros tipos de erros de análise de estado de exibição.</span><span class="sxs-lookup"><span data-stu-id="fbddd-118">Application errors, including unhandled exceptions, view state parsing exceptions, request validation exceptions, and compilation errors, among other types of errors.</span></span>

<span data-ttu-id="fbddd-119">Quando uma integridade de monitoramento de evento é gerado pode ser registrado para qualquer número de especificado *fontes de log*.</span><span class="sxs-lookup"><span data-stu-id="fbddd-119">When a health monitoring event is raised it can be logged to any number of specified *log sources*.</span></span> <span data-ttu-id="fbddd-120">O sistema de monitoramento de integridade é fornecido com fontes de log que o log de eventos da Web para um banco de dados do Microsoft SQL Server, o Log de eventos do Windows, ou por meio de uma mensagem de email, entre outros.</span><span class="sxs-lookup"><span data-stu-id="fbddd-120">The health monitoring system ships with log sources that log Web events to a Microsoft SQL Server database, to the Windows Event Log, or via an email message, among others.</span></span> <span data-ttu-id="fbddd-121">Você também pode criar suas próprias fontes de log.</span><span class="sxs-lookup"><span data-stu-id="fbddd-121">You can also create your own log sources.</span></span>

<span data-ttu-id="fbddd-122">Os eventos de logs de sistema de monitoramento de integridade, juntamente com as fontes de log usadas, são definidos em `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="fbddd-122">The events the health monitoring system logs, along with the log sources used, are defined in `Web.config`.</span></span> <span data-ttu-id="fbddd-123">Com algumas linhas de marcação de configuração, você pode usar para fazer todas as exceções sem tratamento para um banco de dados e para notificar você sobre a exceção por email de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="fbddd-123">With a few lines of configuration markup you can use health monitoring to log all unhandled exceptions to a database and to notify you of the exception via email.</span></span>

## <a name="exploring-the-health-monitoring-systems-configuration"></a><span data-ttu-id="fbddd-124">Explorando a configuração do sistema de monitoramento de integridade</span><span class="sxs-lookup"><span data-stu-id="fbddd-124">Exploring the Health Monitoring System's Configuration</span></span>

<span data-ttu-id="fbddd-125">O comportamento do sistema de monitoramento de integridade é definida por suas informações de configuração, que estão localizadas na [ `<healthMonitoring>` elemento](https://msdn.microsoft.com/library/2fwh2ss9.aspx) em `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="fbddd-125">The health monitoring system's behavior is defined by its configuration information, which is located in the [`<healthMonitoring>` element](https://msdn.microsoft.com/library/2fwh2ss9.aspx) in `Web.config`.</span></span> <span data-ttu-id="fbddd-126">Esta seção de configuração define, entre outras coisas, as três partes importantes de informações a seguir:</span><span class="sxs-lookup"><span data-stu-id="fbddd-126">This configuration section defines, among other things, the following three important pieces of information:</span></span>

1. <span data-ttu-id="fbddd-127">Eventos de monitoramento de integridade que, quando gerado, devem ser registrados em log,</span><span class="sxs-lookup"><span data-stu-id="fbddd-127">The health monitoring events that, when raised, should be logged,</span></span>
2. <span data-ttu-id="fbddd-128">As fontes de log, e</span><span class="sxs-lookup"><span data-stu-id="fbddd-128">The log sources, and</span></span>
3. <span data-ttu-id="fbddd-129">Como cada evento definido em (1) de monitoramento de integridade é mapeada para as fontes de log definidos em (2).</span><span class="sxs-lookup"><span data-stu-id="fbddd-129">How each health monitoring event defined in (1) is mapped to the log sources defined in (2).</span></span>

<span data-ttu-id="fbddd-130">Essas informações são especificadas por meio de elementos de configuração de três filhos: [ `<eventMappings>` ](https://msdn.microsoft.com/library/yc5yk01w.aspx), [ `<providers>` ](https://msdn.microsoft.com/library/zaa41kz1.aspx), e [ `<rules>` ](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectivamente.</span><span class="sxs-lookup"><span data-stu-id="fbddd-130">This information is specified through three children configuration elements: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx), and [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectively.</span></span>

<span data-ttu-id="fbddd-131">Informações de configuração do sistema de monitoramento de integridade de padrão pode ser encontrada na `Web.config` arquivo `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` pasta.</span><span class="sxs-lookup"><span data-stu-id="fbddd-131">The default health monitoring system configuration information can be found in the `Web.config` file in `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` folder.</span></span> <span data-ttu-id="fbddd-132">Essas informações de configuração padrão, com algumas marcações removida por questão de brevidade, são mostradas abaixo:</span><span class="sxs-lookup"><span data-stu-id="fbddd-132">This default configuration information, with some markup removed for brevity, is shown below:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample1.xml)]

<span data-ttu-id="fbddd-133">A integridade de monitoramento de eventos de interesse são definidos na `<eventMappings>` elemento, que fornece um nome amigável a humanos para uma classe de eventos de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="fbddd-133">The health monitoring events of interest are defined in the `<eventMappings>` element, which gives a human-friendly name to a class of health monitoring events.</span></span> <span data-ttu-id="fbddd-134">Na marcação acima, o `<eventMappings>` elemento atribui o nome amigável a humanos "Todos os erros" para eventos de tipo de monitoramento de integridade `WebBaseErrorEvent` e o nome "auditorias de falhas" para eventos de tipo de monitoramento de integridade `WebFailureAuditEvent`.</span><span class="sxs-lookup"><span data-stu-id="fbddd-134">In the markup above, the `<eventMappings>` element assigns the human-friendly name "All Errors" to the health monitoring events of type `WebBaseErrorEvent` and the name "Failure Audits" to health monitoring events of type `WebFailureAuditEvent`.</span></span>

<span data-ttu-id="fbddd-135">O `<providers>` elemento define as fontes de log, dando-lhes um nome amigável a humanos e especificando as informações de configuração de específico da fonte do log.</span><span class="sxs-lookup"><span data-stu-id="fbddd-135">The `<providers>` element defines the log sources, giving them a human-friendly name and specifying any log source-specific configuration information.</span></span> <span data-ttu-id="fbddd-136">A primeira `<add>` elemento define o provedor de "EventLogProvider", que registra eventos de uso de monitoramento de integridade especificada o `EventLogWebEventProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="fbddd-136">The first `<add>` element defines the "EventLogProvider" provider, which logs the specified health monitoring events using the `EventLogWebEventProvider` class.</span></span> <span data-ttu-id="fbddd-137">O `EventLogWebEventProvider` classe registra o evento no Log de eventos do Windows.</span><span class="sxs-lookup"><span data-stu-id="fbddd-137">The `EventLogWebEventProvider` class logs the event to the Windows Event Log.</span></span> <span data-ttu-id="fbddd-138">A segunda `<add>` elemento define o provedor de "SqlWebEventProvider", que registra eventos de um banco de dados do Microsoft SQL Server por meio de `SqlWebEventProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="fbddd-138">The second `<add>` element defines the "SqlWebEventProvider" provider, which logs events to a Microsoft SQL Server database via the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="fbddd-139">A configuração de "SqlWebEventProvider" Especifica a cadeia de caracteres de conexão do banco de dados (`connectionStringName`) entre outras opções de configuração.</span><span class="sxs-lookup"><span data-stu-id="fbddd-139">The "SqlWebEventProvider" configuration specifies the database's connection string (`connectionStringName`) among other configuration options.</span></span>

<span data-ttu-id="fbddd-140">O `<rules>` elemento é mapeado para os eventos especificados na `<eventMappings>` elemento entrar fontes a `<providers>` elemento.</span><span class="sxs-lookup"><span data-stu-id="fbddd-140">The `<rules>` element maps the events specified in the `<eventMappings>` element to log sources in the `<providers>` element.</span></span> <span data-ttu-id="fbddd-141">Por padrão, os aplicativos web ASP.NET registra todas as exceções sem tratamento e falhas no Log de eventos do Windows.</span><span class="sxs-lookup"><span data-stu-id="fbddd-141">By default, ASP.NET web applications log all unhandled exceptions and audit failures to the Windows Event Log.</span></span>

## <a name="logging-events-to-a-database"></a><span data-ttu-id="fbddd-142">Log de eventos para um banco de dados</span><span class="sxs-lookup"><span data-stu-id="fbddd-142">Logging Events to a Database</span></span>

<span data-ttu-id="fbddd-143">A configuração padrão do sistema de monitoramento de integridade pode ser personalizada em uma base de aplicativo por aplicativo web, adicionando um `<healthMonitoring>` seção para o aplicativo `Web.config` arquivo.</span><span class="sxs-lookup"><span data-stu-id="fbddd-143">The health monitoring system's default configuration can be customized on a web application-by-web application basis by adding a `<healthMonitoring>` section to the application's `Web.config` file.</span></span> <span data-ttu-id="fbddd-144">Você pode incluir elementos adicionais na `<eventMappings>`, `<providers>`, e `<rules>` seções usando o `<add>` elemento.</span><span class="sxs-lookup"><span data-stu-id="fbddd-144">You can include additional elements in the `<eventMappings>`, `<providers>`, and `<rules>` sections by using the `<add>` element.</span></span> <span data-ttu-id="fbddd-145">Para remover uma configuração da configuração padrão, use o `<remove>` elemento ou use `<clear />` para remover todos os valores padrão de uma dessas seções.</span><span class="sxs-lookup"><span data-stu-id="fbddd-145">To remove a setting from the default configuration use the `<remove>` element, or use `<clear />` to remove all default values from one of these sections.</span></span> <span data-ttu-id="fbddd-146">Vamos configurar o aplicativo web de resenhas de livros para registrar exceções não tratadas em um banco de dados do Microsoft SQL Server usando o `SqlWebEventProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="fbddd-146">Let's configure the Book Reviews web application to log all unhandled exceptions to a Microsoft SQL Server database using the `SqlWebEventProvider` class.</span></span>

<span data-ttu-id="fbddd-147">O `SqlWebEventProvider` classe faz parte do sistema de monitoramento de integridade e registra uma evento para um banco de dados do SQL Server especificado de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="fbddd-147">The `SqlWebEventProvider` class is part of the health monitoring system and logs a health monitoring event to a specified SQL Server database.</span></span> <span data-ttu-id="fbddd-148">O `SqlWebEventProvider` classe espera que o banco de dados especificado inclui um procedimento armazenado denominado `aspnet_WebEvent_LogEvent`.</span><span class="sxs-lookup"><span data-stu-id="fbddd-148">The `SqlWebEventProvider` class expects that the specified database includes a stored procedure named `aspnet_WebEvent_LogEvent`.</span></span> <span data-ttu-id="fbddd-149">Esse procedimento armazenado é passado os detalhes do evento e é encarregado de armazenar os detalhes do evento.</span><span class="sxs-lookup"><span data-stu-id="fbddd-149">This stored procedure is passed the details of the event and is tasked with storing the event details.</span></span> <span data-ttu-id="fbddd-150">A boa notícia é que você não precisa criar esse procedimento nem a tabela para armazenar os detalhes do evento.</span><span class="sxs-lookup"><span data-stu-id="fbddd-150">The good news is that you do not need to create this stored procedure nor the table to store the event details.</span></span> <span data-ttu-id="fbddd-151">Você pode adicionar esses objetos para o seu banco de dados usando o `aspnet_regsql.exe` ferramenta.</span><span class="sxs-lookup"><span data-stu-id="fbddd-151">You can add these objects to your database using the `aspnet_regsql.exe` tool.</span></span>

> [!NOTE]
> <span data-ttu-id="fbddd-152">O `aspnet_regsql.exe` ferramenta foi discutida em de [ *Configurando um site que usa serviços de aplicativos* tutorial](configuring-a-website-that-uses-application-services-vb.md) quando adicionamos suporte para ASP. Serviços de aplicativos do NET.</span><span class="sxs-lookup"><span data-stu-id="fbddd-152">The `aspnet_regsql.exe` tool was discussed back in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-vb.md) when we added support for ASP.NET's application services.</span></span> <span data-ttu-id="fbddd-153">Consequentemente, o banco de dados do site resenhas de livros já contém o `aspnet_WebEvent_LogEvent` procedimento armazenado, que armazena as informações de evento em uma tabela chamada `aspnet_WebEvent_Events`.</span><span class="sxs-lookup"><span data-stu-id="fbddd-153">Consequently, the Book Reviews website's database already contains the `aspnet_WebEvent_LogEvent` stored procedure, which stores the event information into a table named `aspnet_WebEvent_Events`.</span></span>


<span data-ttu-id="fbddd-154">Depois que o procedimento armazenado necessário e a tabela adicionada ao seu banco de dados, tudo o que resta é instruir para registrar em log todas as exceções sem tratamento no banco de dados de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="fbddd-154">Once you have the necessary stored procedure and table added to your database, all that remains is to instruct health monitoring to log all unhandled exceptions to the database.</span></span> <span data-ttu-id="fbddd-155">Fazer isso, adicione a seguinte marcação ao seu site `Web.config` arquivo:</span><span class="sxs-lookup"><span data-stu-id="fbddd-155">Accomplish this by adding the following markup to your website's `Web.config` file:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample2.xml)]

<span data-ttu-id="fbddd-156">Marcação de configuração acima usa de monitoramento de integridade `<clear />` elementos a apagar as informações de configuração de monitoramento de integridade predefinida a `<eventMappings>`, `<providers>`, e `<rules>` seções.</span><span class="sxs-lookup"><span data-stu-id="fbddd-156">The health monitoring configuration markup above uses `<clear />` elements to wipe the pre-defined health monitoring configuration information from the `<eventMappings>`, `<providers>`, and `<rules>` sections.</span></span> <span data-ttu-id="fbddd-157">Em seguida, ele adiciona uma única entrada para cada uma dessas seções.</span><span class="sxs-lookup"><span data-stu-id="fbddd-157">It then adds a single entry to each of these sections.</span></span>

- <span data-ttu-id="fbddd-158">O `<eventMappings>` elemento define uma única evento de interesse nomeado "Todos os erros", que é gerado sempre que ocorrer uma exceção sem tratamento de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="fbddd-158">The `<eventMappings>` element defines a single health monitoring event of interest named "All Errors", which is raised whenever an unhandled exception occurs.</span></span>
- <span data-ttu-id="fbddd-159">O `<providers>` elemento define uma fonte de log único chamada "SqlWebEventProvider" que usa o `SqlWebEventProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="fbddd-159">The `<providers>` element defines a single log source named "SqlWebEventProvider" that uses the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="fbddd-160">O `connectionStringName` atributo foi definido como "ReviewsConnectionString", que é o nome da nossa conexão cadeia de caracteres definida no `<connectionStrings>` seção.</span><span class="sxs-lookup"><span data-stu-id="fbddd-160">The `connectionStringName` attribute has been set to "ReviewsConnectionString", which is the name of our connection string defined in the `<connectionStrings>` section.</span></span>
- <span data-ttu-id="fbddd-161">Por fim, o &lt;regras&gt; elemento indica que quando um evento de "Todos os erros" ocorre que ele deve ser registrado usando o provedor "SqlWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="fbddd-161">Finally, the &lt;rules&gt; element indicates that when an "All Errors" event transpires that it should be logged using the "SqlWebEventProvider" provider.</span></span>

<span data-ttu-id="fbddd-162">Essas informações de configuração instrui o sistema para registrar em log todas as exceções sem tratamento no banco de dados de resenhas de livros de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="fbddd-162">This configuration information instructs the health monitoring system to log all unhandled exceptions to the Book Reviews database.</span></span>

> [!NOTE]
> <span data-ttu-id="fbddd-163">O `WebBaseErrorEvent` evento é gerado apenas para erros de servidor; ele não será gerado para erros HTTP, como uma solicitação para um recurso do ASP.NET que não foi encontrado.</span><span class="sxs-lookup"><span data-stu-id="fbddd-163">The `WebBaseErrorEvent` event is only raised for server errors; it is not raised for HTTP errors, such as a request for an ASP.NET resource that is not found.</span></span> <span data-ttu-id="fbddd-164">Isso é diferente do comportamento do `HttpApplication` da classe `Error` evento, que é gerado para o servidor e erros de HTTP.</span><span class="sxs-lookup"><span data-stu-id="fbddd-164">This differs from the behavior of the `HttpApplication` class's `Error` event, which is raised for both server and HTTP errors.</span></span>


<span data-ttu-id="fbddd-165">Para ver o sistema em ação de monitoramento de integridade, visite o site e gerar um erro de tempo de execução visitando `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="fbddd-165">To see the health monitoring system in action, visit the website and generate a runtime error by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="fbddd-166">Você verá a página de erro apropriado - a exceção detalhes amarelo tela da morte (quando visitar localmente) ou a página de erro personalizada (quando visitar o site em produção).</span><span class="sxs-lookup"><span data-stu-id="fbddd-166">You should see the appropriate error page - either the Exception Details Yellow Screen of Death (when visiting locally) or the custom error page (when visiting the site in production).</span></span> <span data-ttu-id="fbddd-167">Nos bastidores, o sistema de monitoramento de integridade registradas as informações de erro no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="fbddd-167">Behind the scenes, the health monitoring system logged the error information to the database.</span></span> <span data-ttu-id="fbddd-168">Deve haver um registro na `aspnet_WebEvent_Events` tabela (consulte **Figura 1**); esse registro contém informações sobre o erro de tempo de execução que acabou de ocorrer.</span><span class="sxs-lookup"><span data-stu-id="fbddd-168">There should be one record in the `aspnet_WebEvent_Events` table (see **Figure 1**); this record contains information about the runtime error that just occurred.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-vb/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-vb/_static/image1.png)

<span data-ttu-id="fbddd-169">**Figura 1**: Os detalhes de erro foram registrados para o `aspnet_WebEvent_Events` tabela</span><span class="sxs-lookup"><span data-stu-id="fbddd-169">**Figure 1**: The Error Details Were Logged to the `aspnet_WebEvent_Events` Table</span></span>  
<span data-ttu-id="fbddd-170">([Clique para exibir a imagem em tamanho normal](logging-error-details-with-asp-net-health-monitoring-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="fbddd-170">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-vb/_static/image3.png))</span></span>

### <a name="displaying-the-error-log-in-a-web-page"></a><span data-ttu-id="fbddd-171">Exibindo o Log de erros em uma página da Web</span><span class="sxs-lookup"><span data-stu-id="fbddd-171">Displaying the Error Log In a Web Page</span></span>

<span data-ttu-id="fbddd-172">Com a configuração atual do site, o sistema de monitoramento de integridade registra todas as exceções sem tratamento no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="fbddd-172">With the website's current configuration, the health monitoring system logs all unhandled exceptions to the database.</span></span> <span data-ttu-id="fbddd-173">No entanto, o monitoramento de integridade não fornece qualquer mecanismo para exibir o log de erros por meio de uma página da web.</span><span class="sxs-lookup"><span data-stu-id="fbddd-173">However, health monitoring does not provide any mechanism to view the error log through a web page.</span></span> <span data-ttu-id="fbddd-174">No entanto, você pode criar uma página ASP.NET que exibe essas informações do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="fbddd-174">However, you could build an ASP.NET page that displays this information from the database.</span></span> <span data-ttu-id="fbddd-175">(Conforme veremos momentaneamente, você pode optar por ter os detalhes do erro enviados a você em uma mensagem de email.)</span><span class="sxs-lookup"><span data-stu-id="fbddd-175">(As we'll see momentarily, you can opt to have the error details sent to you in an email message.)</span></span>

<span data-ttu-id="fbddd-176">Se você criar esse tipo de página, verifique se que você tomar medidas para permitir que somente usuários autorizados exibir os detalhes do erro.</span><span class="sxs-lookup"><span data-stu-id="fbddd-176">If you create such a page, make sure you take steps to allow only authorized users to view the error details.</span></span> <span data-ttu-id="fbddd-177">Se o seu site já empregar as contas de usuário, em seguida, você pode usar regras de autorização de URL para restringir o acesso para a página para determinados usuários ou funções.</span><span class="sxs-lookup"><span data-stu-id="fbddd-177">If your site already employs user accounts then you can use URL authorization rules to restrict access to the page to certain users or roles.</span></span> <span data-ttu-id="fbddd-178">Para obter mais informações sobre como conceder ou restringir o acesso a páginas da web com base no usuário conectado, consulte a minha [tutoriais de segurança de site](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span><span class="sxs-lookup"><span data-stu-id="fbddd-178">For more information on how to grant or restrict access to web pages based on the logged in user, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

> [!NOTE]
> <span data-ttu-id="fbddd-179">O tutorial subsequente explora um sistema de registro em log e notificação de erro alternativas chamado ELMAH.</span><span class="sxs-lookup"><span data-stu-id="fbddd-179">The subsequent tutorial explores an alternative error logging and notification system named ELMAH.</span></span> <span data-ttu-id="fbddd-180">O ELMAH inclui um mecanismo interno para exibir o log de erros de ambas as uma página da web e como um RSS feed.</span><span class="sxs-lookup"><span data-stu-id="fbddd-180">ELMAH includes a built-in mechanism to view the error log from both a web page and as an RSS feed.</span></span>


## <a name="logging-events-to-email"></a><span data-ttu-id="fbddd-181">Log de eventos ao Email</span><span class="sxs-lookup"><span data-stu-id="fbddd-181">Logging Events to Email</span></span>

<span data-ttu-id="fbddd-182">A integridade do sistema de monitoramento inclui um provedor de origem de log que "registra" um evento para uma mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="fbddd-182">The health monitoring system includes a log source provider that "logs" an event to an email message.</span></span> <span data-ttu-id="fbddd-183">A fonte de log inclui as mesmas informações que estão conectadas ao banco de dados no corpo da mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="fbddd-183">The log source includes the same information that is logged to the database in the email message body.</span></span> <span data-ttu-id="fbddd-184">Você pode usar esta fonte de log para notificar um desenvolvedor quando ocorre um determinado evento de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="fbddd-184">You can use this log source to notify a developer when a certain health monitoring event occurs.</span></span>

<span data-ttu-id="fbddd-185">Vamos atualizar a configuração do site para que podemos receber um email sempre que uma exceção ocorre de resenhas de livros.</span><span class="sxs-lookup"><span data-stu-id="fbddd-185">Let's update the Book Reviews website's configuration so that we receive an email whenever an exception occurs.</span></span> <span data-ttu-id="fbddd-186">Para fazer isso, precisamos executar três tarefas:</span><span class="sxs-lookup"><span data-stu-id="fbddd-186">To accomplish this we need to perform three tasks:</span></span>

1. <span data-ttu-id="fbddd-187">Configure o aplicativo web ASP.NET para enviar email.</span><span class="sxs-lookup"><span data-stu-id="fbddd-187">Configure the ASP.NET web application to send email.</span></span> <span data-ttu-id="fbddd-188">Isso é feito especificando como as mensagens de email são enviadas por meio de `<system.net>` elemento de configuração.</span><span class="sxs-lookup"><span data-stu-id="fbddd-188">This is accomplished by specifying how email messages are sent via the `<system.net>` configuration element.</span></span> <span data-ttu-id="fbddd-189">Para obter mais informações sobre o envio de email mensagens em um aplicativo ASP.NET consultem [envio de Email no ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) e o [perguntas frequentes sobre o mail](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="fbddd-189">For more information on sending email messages in an ASP.NET application refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>
2. <span data-ttu-id="fbddd-190">Registrar o provedor de origem do log de email no `<providers>` elemento, e</span><span class="sxs-lookup"><span data-stu-id="fbddd-190">Register the email log source provider in the `<providers>` element, and</span></span>
3. <span data-ttu-id="fbddd-191">Adicionar uma entrada para o `<rules>` elemento que mapeia o evento de "Todos os erros" para o provedor de código-fonte do log adicionado na etapa (2).</span><span class="sxs-lookup"><span data-stu-id="fbddd-191">Add an entry to the `<rules>` element that maps the "All Errors" event to the log source provider added in step (2).</span></span>

<span data-ttu-id="fbddd-192">A integridade do sistema de monitoramento inclui duas classes de provedor de email log fonte: `SimpleMailWebEventProvider` e `TemplatedMailWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="fbddd-192">The health monitoring system includes two email log source provider classes: `SimpleMailWebEventProvider` and `TemplatedMailWebEventProvider`.</span></span> <span data-ttu-id="fbddd-193">O [ `SimpleMailWebEventProvider` classe](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) envia uma mensagem de email de texto sem formatação que inclui o evento de detalhes e oferece pouco personalização do corpo do email.</span><span class="sxs-lookup"><span data-stu-id="fbddd-193">The [`SimpleMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) sends a plain-text email message that includes the event details and provides little customization of the email body.</span></span> <span data-ttu-id="fbddd-194">Com o [ `TemplatedMailWebEventProvider` classe](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) você especificar uma página ASP.NET cuja marcação renderizada é usada como o corpo da mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="fbddd-194">With the [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) you specify an ASP.NET page whose rendered markup is used as the body for the email message.</span></span> <span data-ttu-id="fbddd-195">O [ `TemplatedMailWebEventProvider` classe](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) oferece muito mais controle sobre o conteúdo e o formato da mensagem de email, mas requer um pouco mais trabalho antecipado de que você tenha que criar a página ASP.NET que gera o corpo da mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="fbddd-195">The [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) gives you much greater control over the contents and format of the email message, but requires a bit more upfront work as you have to create the ASP.NET page that generates the email message's body.</span></span> <span data-ttu-id="fbddd-196">Este tutorial se concentra no uso de `SimpleMailWebEventProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="fbddd-196">This tutorial focuses on using the `SimpleMailWebEventProvider` class.</span></span>

<span data-ttu-id="fbddd-197">Atualização do sistema de monitoramento de integridade `<providers>` elemento na `Web.config` arquivo para incluir uma fonte de log para o `SimpleMailWebEventProvider` classe:</span><span class="sxs-lookup"><span data-stu-id="fbddd-197">Update the health monitoring system's `<providers>` element in the `Web.config` file to include a log source for the `SimpleMailWebEventProvider` class:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample3.xml)]

<span data-ttu-id="fbddd-198">A marcação acima usa o `SimpleMailWebEventProvider` classe como o provedor de código-fonte do log e atribui a ele o nome amigável "EmailWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="fbddd-198">The above markup uses the `SimpleMailWebEventProvider` class as the log source provider, and assigns it the friendly name "EmailWebEventProvider".</span></span> <span data-ttu-id="fbddd-199">Além disso, o `<add>` atributo inclui opções de configuração adicionais, como o campo para e de endereços da mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="fbddd-199">Moreover, the `<add>` attribute includes additional configuration options, such as the To and From addresses of the email message.</span></span>

<span data-ttu-id="fbddd-200">Com a origem de log de email definida, tudo o que resta é instruir o sistema para usar essa fonte para "Registrar" exceções sem tratamento de monitoramento de integridade.</span><span class="sxs-lookup"><span data-stu-id="fbddd-200">With the email log source defined, all that remains is to instruct the health monitoring system to use this source to "log" unhandled exceptions.</span></span> <span data-ttu-id="fbddd-201">Isso é feito adicionando uma nova regra no `<rules>` seção:</span><span class="sxs-lookup"><span data-stu-id="fbddd-201">This is accomplished by adding a new rule in the `<rules>` section:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample4.xml)]

<span data-ttu-id="fbddd-202">O `<rules>` seção agora inclui duas regras.</span><span class="sxs-lookup"><span data-stu-id="fbddd-202">The `<rules>` section now includes two rules.</span></span> <span data-ttu-id="fbddd-203">O primeiro deles, chamado "Todos os erros para Email", envia todas as exceções sem tratamento para a origem do log "EmailWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="fbddd-203">The first one, named "All Errors To Email", sends all unhandled exceptions to the "EmailWebEventProvider" log source.</span></span> <span data-ttu-id="fbddd-204">Essa regra tem o efeito de enviar detalhes sobre erros no site especificado para o endereço.</span><span class="sxs-lookup"><span data-stu-id="fbddd-204">This rule has the effect of sending details about errors on the website to the specified To address.</span></span> <span data-ttu-id="fbddd-205">A regra de "Todos os erros ao banco de dados" registra os detalhes do erro para o banco de dados do site.</span><span class="sxs-lookup"><span data-stu-id="fbddd-205">The "All Errors To Database" rule logs the error details to the site's database.</span></span> <span data-ttu-id="fbddd-206">Consequentemente, sempre que uma exceção sem tratamento ocorre no site, seus detalhes são ambos conectadas ao banco de dados e enviadas ao endereço de email especificado.</span><span class="sxs-lookup"><span data-stu-id="fbddd-206">Consequently, whenever an unhandled exception occurs on the site its details are both logged to the database and sent to specified email address.</span></span>

<span data-ttu-id="fbddd-207">**Figura 2** mostra o email gerado pelo `SimpleMailWebEventProvider` classe quando visitar `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="fbddd-207">**Figure 2** shows the email generated by the `SimpleMailWebEventProvider` class when visiting `Genre.aspx?ID=foo`.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-vb/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-vb/_static/image4.png)

<span data-ttu-id="fbddd-208">**Figura 2**: Os detalhes do erro são enviados em uma mensagem de Email</span><span class="sxs-lookup"><span data-stu-id="fbddd-208">**Figure 2**: The Error Details are Sent in an Email Message</span></span>  
<span data-ttu-id="fbddd-209">([Clique para exibir a imagem em tamanho normal](logging-error-details-with-asp-net-health-monitoring-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="fbddd-209">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-vb/_static/image6.png))</span></span>

## <a name="summary"></a><span data-ttu-id="fbddd-210">Resumo</span><span class="sxs-lookup"><span data-stu-id="fbddd-210">Summary</span></span>

<span data-ttu-id="fbddd-211">O sistema de monitoramento de integridade do ASP.NET foi projetado para permitir aos administradores monitorar a integridade de um aplicativo web implantado.</span><span class="sxs-lookup"><span data-stu-id="fbddd-211">The ASP.NET health monitoring system is designed to allow administrators to monitor the health of a deployed web application.</span></span> <span data-ttu-id="fbddd-212">Eventos de monitoramento de integridade são acionados quando Desdobrar determinadas ações, como quando o aplicativo é interrompido, quando um usuário com êxito fizer no site, ou quando ocorre uma exceção sem tratamento.</span><span class="sxs-lookup"><span data-stu-id="fbddd-212">Health monitoring events are raised when certain actions unfold, such as when the application stops, when a user successfully logs onto the site, or when an unhandled exception occurs.</span></span> <span data-ttu-id="fbddd-213">Esses eventos podem ser registradas em log para qualquer número de fontes de log.</span><span class="sxs-lookup"><span data-stu-id="fbddd-213">These events can be logged to any number of log sources.</span></span> <span data-ttu-id="fbddd-214">Este tutorial mostrou como registrar em log os detalhes de exceções sem tratamento para um banco de dados e por meio de uma mensagem de email.</span><span class="sxs-lookup"><span data-stu-id="fbddd-214">This tutorial showed how to log the details of unhandled exceptions to a database and through an email message.</span></span>

<span data-ttu-id="fbddd-215">Este tutorial se concentra no uso para registrar exceções não manipuladas, mas lembre-se de que o monitoramento de integridade foi projetado para medir a integridade geral de um aplicativo implantado do ASP.NET e inclui uma grande quantidade de eventos de monitoramento de integridade e fontes de log não de monitoramento de integridade explorado aqui.</span><span class="sxs-lookup"><span data-stu-id="fbddd-215">This tutorial focused on using health monitoring to log unhandled exceptions, but keep in mind that health monitoring is designed to measure the overall health of a deployed ASP.NET application and includes a wealth of health monitoring events and log sources not explored here.</span></span> <span data-ttu-id="fbddd-216">O que é mais, você pode criar seu próprios eventos e fontes de log de monitoramento de integridade, caso seja necessário surgir.</span><span class="sxs-lookup"><span data-stu-id="fbddd-216">What's more, you can create your own health monitoring events and log sources, should the need arise.</span></span> <span data-ttu-id="fbddd-217">Se você estiver interessado em aprender mais sobre o monitoramento de integridade, uma boa primeira etapa é ler por meio [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)do [perguntas Frequentes de monitoramento de integridade](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span><span class="sxs-lookup"><span data-stu-id="fbddd-217">If you are interested in learning more about health monitoring, a good first step is to read through [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)'s [health monitoring FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span></span> <span data-ttu-id="fbddd-218">Depois disso, consulte [How To: Usar o monitoramento de integridade no ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span><span class="sxs-lookup"><span data-stu-id="fbddd-218">Following that, consult [How To: Use Health Monitoring in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span></span>

<span data-ttu-id="fbddd-219">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="fbddd-219">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="fbddd-220">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="fbddd-220">Further Reading</span></span>

<span data-ttu-id="fbddd-221">Para obter mais informações sobre os tópicos abordados neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="fbddd-221">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="fbddd-222">Visão geral do monitoramento de integridade do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="fbddd-222">ASP.NET Health Monitoring Overview</span></span>](https://msdn.microsoft.com/library/bb398933.aspx)
- [<span data-ttu-id="fbddd-223">Configuração e personalização do sistema do ASP.NET de monitoramento de integridade</span><span class="sxs-lookup"><span data-stu-id="fbddd-223">Configuring and Customizing the Health Monitoring System of ASP.NET</span></span>](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [<span data-ttu-id="fbddd-224">Perguntas Frequentes - monitoramento de integridade no ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="fbddd-224">FAQ - Health Monitoring in ASP.NET 2.0</span></span>](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [<span data-ttu-id="fbddd-225">Como: Enviar email para notificações de monitoramento de integridade</span><span class="sxs-lookup"><span data-stu-id="fbddd-225">How To: Send E-Mail for Health Monitoring Notifications</span></span>](https://msdn.microsoft.com/library/ms227553.aspx)
- [<span data-ttu-id="fbddd-226">Como: Use o monitoramento de integridade do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="fbddd-226">How To: Use Health Monitoring in ASP.NET</span></span>](https://msdn.microsoft.com/library/ms998306.aspx)
- [<span data-ttu-id="fbddd-227">Monitoramento de integridade no ASP.NET</span><span class="sxs-lookup"><span data-stu-id="fbddd-227">Health Monitoring in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="fbddd-228">[Anterior](processing-unhandled-exceptions-vb.md)
> [Próximo](logging-error-details-with-elmah-vb.md)</span><span class="sxs-lookup"><span data-stu-id="fbddd-228">[Previous](processing-unhandled-exceptions-vb.md)
[Next](logging-error-details-with-elmah-vb.md)</span></span>
