---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: 'Usando o Entity Framework 4.0 e o controle ObjectDataSource, parte 1: Guia de Introdução | Microsoft Docs'
author: tdykstra
description: Esta série de tutoriais se baseia no aplicativo web Contoso University que é criado pelo Getting Started with a série de tutoriais do Entity Framework. Se yo...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 2f14707eb058d438495dd2bc4c17b976c471fc97
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131334"
---
# <a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="b0ab8-104">Usando o Entity Framework 4.0 e o controle ObjectDataSource, parte 1: Guia de Introdução</span><span class="sxs-lookup"><span data-stu-id="b0ab8-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>

<span data-ttu-id="b0ab8-105">por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="b0ab8-106">Esta série de tutoriais baseia-se no aplicativo web Contoso University que é criado pela [Introdução ao Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) série de tutoriais.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="b0ab8-107">Se você não concluir os tutoriais anteriores, como um ponto de partida para este tutorial, você pode [baixar o aplicativo](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) que você teria criado.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="b0ab8-108">Você também pode [baixar o aplicativo](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) que é criado pela série de tutoriais completa.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="b0ab8-109">Aplicativo web de exemplo Contoso University demonstra como criar aplicativos Web Forms do ASP.NET usando o Entity Framework 4.0 e o Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="b0ab8-110">O aplicativo de exemplo é um site de uma Contoso University fictícia.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="b0ab8-111">Ele inclui funcionalidades como admissão de alunos, criação de cursos e atribuições de instrutor.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="b0ab8-112">O tutorial mostra exemplos em c#.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="b0ab8-113">O [amostra para download](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contém código em c# e Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="b0ab8-114">Primeiro banco de dados</span><span class="sxs-lookup"><span data-stu-id="b0ab8-114">Database First</span></span>
> 
> <span data-ttu-id="b0ab8-115">Há três maneiras de que trabalhar com dados no Entity Framework: *Database First*, *Model First*, e *Code First*.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="b0ab8-116">Este tutorial é para o banco de dados primeiro.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-116">This tutorial is for Database First.</span></span> <span data-ttu-id="b0ab8-117">Para obter informações sobre as diferenças entre esses fluxos de trabalho e diretrizes sobre como escolher o melhor para seu cenário, consulte [fluxos de trabalho de desenvolvimento do Entity Framework](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="b0ab8-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="b0ab8-118">Web Forms</span><span class="sxs-lookup"><span data-stu-id="b0ab8-118">Web Forms</span></span>
> 
> <span data-ttu-id="b0ab8-119">Como a série de Introdução, esta série de tutoriais usa o modelo de Web Forms do ASP.NET e pressupõe que você sabe como trabalhar com Web Forms do ASP.NET no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="b0ab8-120">Se você não fizer isso, consulte [Introdução ao Web Forms do ASP.NET 4.5](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b0ab8-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="b0ab8-121">Se você preferir trabalhar com o ASP.NET MVC framework, consulte [guia de Introdução com o Entity Framework usando o ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="b0ab8-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="b0ab8-122">Versões de software</span><span class="sxs-lookup"><span data-stu-id="b0ab8-122">Software versions</span></span>
> 
> | <span data-ttu-id="b0ab8-123">**Mostrado no tutorial**</span><span class="sxs-lookup"><span data-stu-id="b0ab8-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="b0ab8-124">**Também funciona com**</span><span class="sxs-lookup"><span data-stu-id="b0ab8-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="b0ab8-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="b0ab8-125">Windows 7</span></span> | <span data-ttu-id="b0ab8-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="b0ab8-126">Windows 8</span></span> |
> | <span data-ttu-id="b0ab8-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="b0ab8-127">Visual Studio 2010</span></span> | <span data-ttu-id="b0ab8-128">O Visual Studio 2010 Express para Web.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="b0ab8-129">O tutorial não foi testado com versões posteriores do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="b0ab8-130">Há muitas diferenças nas seleções de menu, caixas de diálogo e modelos.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="b0ab8-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="b0ab8-131">.NET 4</span></span> | <span data-ttu-id="b0ab8-132">.NET 4.5 é compatível com versões anteriores com o .NET 4, mas o tutorial não foi testado com o .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="b0ab8-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="b0ab8-133">Entity Framework 4</span></span> | <span data-ttu-id="b0ab8-134">O tutorial não foi testado com versões posteriores do Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="b0ab8-135">Começando com o Entity Framework 5, o EF usa por padrão o `DbContext API` que foi introduzido com o EF 4.1.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="b0ab8-136">O controle EntityDataSource foi projetado para usar o `ObjectContext` API.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="b0ab8-137">Para obter informações sobre como usar o EntityDataSource controlar com o `DbContext` API, consulte [nesta postagem de blog](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span><span class="sxs-lookup"><span data-stu-id="b0ab8-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="b0ab8-138">Perguntas</span><span class="sxs-lookup"><span data-stu-id="b0ab8-138">Questions</span></span>
> 
> <span data-ttu-id="b0ab8-139">Se você tiver perguntas que não estão diretamente relacionadas para o tutorial, você pode postá-los para o [Fórum do Entity Framework do ASP.NET](https://forums.asp.net/1227.aspx), o [Entity Framework e LINQ para o fórum de entidades](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), ou [ StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="b0ab8-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>

<span data-ttu-id="b0ab8-140">O `EntityDataSource` controle permite que você criar um aplicativo muito rapidamente, mas normalmente requer que você mantenha uma quantidade significativa de lógica de negócios e lógica de acesso a dados em seu *. aspx* páginas.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="b0ab8-141">Se você espera que seu aplicativo aumente de complexidade e requer manutenção contínua, você pode investir mais tempo de desenvolvimento com antecedência para criar uma *fileiras* ou *em camadas* estrutura de aplicativo Isso é mais sustentável.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="b0ab8-142">Para implementar essa arquitetura, você pode separar a camada de apresentação da camada de lógica de negócios (BLL) e a camada de acesso a dados (DAL).</span><span class="sxs-lookup"><span data-stu-id="b0ab8-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="b0ab8-143">Uma maneira de implementar essa estrutura é usar o `ObjectDataSource` controlar em vez do `EntityDataSource` controle.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="b0ab8-144">Quando você usa o `ObjectDataSource` controle, implementar seu próprio código de acesso a dados e, em seguida, invoque-o na *. aspx* páginas usando um controle que tem muitos dos mesmos recursos que os outros controles de fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="b0ab8-145">Isso permite que você combine as vantagens de uma abordagem de n camadas com os benefícios de usar um controle de formulários da Web para acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="b0ab8-146">O `ObjectDataSource` controle oferece mais flexibilidade de outras formas também.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="b0ab8-147">Porque você escrever seu próprio código de acesso a dados, é mais fácil mais do que apenas ler, inserir, atualizar ou excluir um tipo de entidade específica, que são as tarefas que o `EntityDataSource` controle foi projetado para executar.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="b0ab8-148">Por exemplo, você pode realizar o registro em log sempre que uma entidade é atualizada, arquivar dados sempre que uma entidade é excluída, ou automaticamente verificação e atualização de dados relacionados conforme necessário ao inserir uma linha com um valor de chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="b0ab8-149">Lógica de negócios e Classes de repositório</span><span class="sxs-lookup"><span data-stu-id="b0ab8-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="b0ab8-150">Um `ObjectDataSource` funciona com a invocação de uma classe que você cria o controle.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="b0ab8-151">A classe inclui métodos que recuperam e atualizam dados, além de fornecer os nomes desses métodos para o `ObjectDataSource` controle na marcação.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="b0ab8-152">Durante o processamento ou processamento de postagem, o `ObjectDataSource` chama os métodos que você especificou.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="b0ab8-153">Além das operações CRUD básicas, a classe que você cria para usar com o `ObjectDataSource` controle talvez seja necessário executar a lógica de negócios quando a `ObjectDataSource` lê ou atualiza dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="b0ab8-154">Por exemplo, quando você atualiza um departamento, você precisa validar que não há outros departamentos tenham o mesmo administrador porque uma pessoa não pode ser um administrador de mais de um departamento.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="b0ab8-155">Em alguns `ObjectDataSource` documentação, como o [visão geral da classe ObjectDataSource](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), o controle chama uma classe conhecida como um *objeto comercial* que inclui a lógica de negócios e lógica de acesso a dados .</span><span class="sxs-lookup"><span data-stu-id="b0ab8-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="b0ab8-156">Neste tutorial, você criará as classes separadas para lógica de negócios e lógica de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="b0ab8-157">A classe que encapsula a lógica de acesso a dados é chamada uma *repositório*.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="b0ab8-158">A classe de lógica de negócios inclui métodos de lógica de negócios e os métodos de acesso a dados, mas os métodos de acesso a dados chamam o repositório para executar tarefas de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="b0ab8-159">Você também criará uma camada de abstração entre a sua BLL e DAL que facilita a unidade automatizados Testando a BLL.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="b0ab8-160">Essa camada de abstração é implementada, criando uma interface e usando a interface ao instanciar o repositório na classe de lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="b0ab8-161">Isso torna possível para fornecer a classe de lógica de negócios com uma referência a qualquer objeto que implementa a interface do repositório.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="b0ab8-162">Para uma operação normal, você deve fornecer um objeto de repositório que funciona com o Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="b0ab8-163">Para testar, você deve fornecer um objeto de repositório que funciona com dados armazenados em uma forma que você pode manipular com facilidade, como variáveis de classe definidas como coleções.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="b0ab8-164">A ilustração a seguir mostra a diferença entre uma classe de lógica de negócios que inclui a lógica de acesso a dados sem um repositório e outro que usa um repositório.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="b0ab8-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="b0ab8-166">Você começará criando páginas da web no qual o `ObjectDataSource` controle está vinculado diretamente a um repositório porque ele só executa tarefas básicas de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="b0ab8-167">No próximo tutorial você criará uma classe de lógica de negócios com a lógica de validação e associar o `ObjectDataSource` controle para essa classe em vez de à classe repository.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="b0ab8-168">Você também criará testes de unidade para a lógica de validação.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="b0ab8-169">O terceiro tutorial desta série, você adicionará a classificação e filtragem de funcionalidade para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="b0ab8-170">As páginas que você cria neste tutorial funcionam com o `Departments` conjunto de entidades do modelo de dados que você criou na [série de tutoriais de Introdução](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="b0ab8-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="b0ab8-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="b0ab8-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="b0ab8-173">Atualizando o banco de dados e o modelo de dados</span><span class="sxs-lookup"><span data-stu-id="b0ab8-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="b0ab8-174">Você começará neste tutorial, tornando duas alterações no banco de dados, ambas exigem que as alterações correspondentes ao modelo de dados que você criou na [Introdução ao Entity Framework e Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutoriais.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="b0ab8-175">Em um desses tutoriais, você fez alterações no designer de manualmente para sincronizar o modelo de dados com o banco de dados após uma alteração de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="b0ab8-176">Neste tutorial, você usará o designer **atualização do banco de dados modelo** ferramenta para atualizar o modelo de dados automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="b0ab8-177">Adicionando uma relação para o banco de dados</span><span class="sxs-lookup"><span data-stu-id="b0ab8-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="b0ab8-178">No Visual Studio, abra o aplicativo de web Contoso University criado na [Introdução ao Entity Framework e Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) série de tutoriais e, em seguida, abra o `SchoolDiagram` diagrama de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="b0ab8-179">Se você examinar a `Department` tabela no diagrama de banco de dados, você verá que ele tem um `Administrator` coluna.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="b0ab8-180">Essa coluna é uma chave estrangeira para a `Person` tabela, mas nenhuma relação de chave estrangeira é definida no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="b0ab8-181">Você precisa criar a relação e atualize o modelo de dados, de forma que o Entity Framework pode tratar automaticamente essa relação.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="b0ab8-182">No diagrama de banco de dados, clique com botão direito do `Department` da tabela e selecione **relações**.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="b0ab8-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="b0ab8-184">No **relações de chave estrangeira** caixa de clicar **Add**, em seguida, clique no botão de reticências para **especificação de tabelas e colunas**.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="b0ab8-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="b0ab8-186">No **tabelas e colunas** diálogo caixa, defina a tabela de chave primária e um campo para `Person` e `PersonID`e definir a tabela de chave estrangeira e um campo para `Department` e `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="b0ab8-187">(Quando você fizer isso, o nome da relação será alterado de `FK_Department_Department` para `FK_Department_Person`.)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="b0ab8-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="b0ab8-189">Clique em **Okey** na **tabelas e colunas** , clique em **fechar** no **relações de chave estrangeira** caixa e salve as alterações.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="b0ab8-190">Se você for solicitado se você deseja salvar o `Person` e `Department` tabelas, clique em **Sim**.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="b0ab8-191">Se você tiver excluído `Person` linhas que correspondem aos dados que já está no `Administrator` coluna, você não poderá salvar essa alteração.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="b0ab8-192">Nesse caso, use o editor de tabela no **Gerenciador de servidores** para certificar-se de que o `Administrator` valor em cada `Department` linha contém a ID de um registro que realmente existe no `Person` tabela.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="b0ab8-193">Depois de salvar a alteração, você não poderá excluir uma linha do `Person` tabela se essa pessoa é um administrador de departamento.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="b0ab8-194">Em um aplicativo de produção, você forneceria uma mensagem de erro específica quando uma restrição de banco de dados impede a exclusão ou, você especificaria uma exclusão em cascata.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="b0ab8-195">Para obter um exemplo de como especificar uma exclusão em cascata, consulte [de Entity Framework e do ASP.NET – Introdução à parte 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span><span class="sxs-lookup"><span data-stu-id="b0ab8-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>

### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="b0ab8-196">Adicionando uma exibição no banco de dados</span><span class="sxs-lookup"><span data-stu-id="b0ab8-196">Adding a View to the Database</span></span>

<span data-ttu-id="b0ab8-197">Na nova *Departments.aspx* página que você criará, que você deseja fornecer uma lista suspensa de instrutores, com nomes no formato "Sobrenome, nome" para que os usuários podem selecionar os administradores de departamento.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="b0ab8-198">Para tornar mais fácil de fazer isso, você criará um modo de exibição no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="b0ab8-199">O modo de exibição consistirá apenas os dados necessários para a lista suspensa: o nome completo (formatado corretamente) e a chave de registro.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="b0ab8-200">Na **Gerenciador de servidores**, expanda *School.mdf*, clique com botão direito a **modos de exibição** pasta e selecione **adicionar nova exibição**.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="b0ab8-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="b0ab8-202">Clique em **feche** quando o **adicionar tabela** caixa de diálogo é exibida e cole a seguinte instrução SQL no painel SQL:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="b0ab8-203">Salvar o modo de exibição como `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="b0ab8-204">Atualizando o modelo de dados</span><span class="sxs-lookup"><span data-stu-id="b0ab8-204">Updating the Data Model</span></span>

<span data-ttu-id="b0ab8-205">No *DAL* pasta, abra o *Schoolmodel* do arquivo, clique com botão direito na superfície de design e, em seguida, selecione **modelo de atualização do banco de dados**.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="b0ab8-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="b0ab8-207">No **Choose Your Database Objects** caixa de diálogo, selecione o **Add** guia e selecione o modo de exibição que você acabou de criar.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="b0ab8-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="b0ab8-209">Clique em **Finalizar**.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-209">Click **Finish**.</span></span>

<span data-ttu-id="b0ab8-210">No designer, você verá que a ferramenta está sendo criado um `vInstructorName` entidade e uma nova associação entre o `Department` e `Person` entidades.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="b0ab8-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="b0ab8-212">No **saída** e **lista de erros** tecla do windows, você poderá ver uma mensagem de aviso informando que a ferramenta criar automaticamente um primário para o novo `vInstructorName` modo de exibição.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="b0ab8-213">Esse comportamento é esperado.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-213">This is expected behavior.</span></span>

<span data-ttu-id="b0ab8-214">Quando você se referir ao novo `vInstructorName` entidade no código, você não quiser usar a convenção de banco de dados de prefixar um "v" em letras minúsculas para ele.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="b0ab8-215">Portanto, você renomeará a entidade e a entidade definida no modelo.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="b0ab8-216">Abra o **navegador de modelos**.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-216">Open the **Model Browser**.</span></span> <span data-ttu-id="b0ab8-217">Você verá `vInstructorName` listado como um tipo de entidade e um modo de exibição.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="b0ab8-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="b0ab8-219">Sob **SchoolModel** (não **SchoolModel.Store**), clique com botão direito **vInstructorName** e selecione **propriedades**.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="b0ab8-220">No **propriedades** janela, altere o **nome** propriedade como "InstructorName" e altere a **definir nome de entidade** propriedade como "InstructorNames".</span><span class="sxs-lookup"><span data-stu-id="b0ab8-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="b0ab8-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="b0ab8-222">Salve e feche o modelo de dados e, em seguida, recompile o projeto.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="b0ab8-223">Usando uma classe de repositório e um controle ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="b0ab8-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="b0ab8-224">Criar um novo arquivo de classe na *DAL* pasta, nomeie- *SchoolRepository.cs*e substitua o código existente pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="b0ab8-225">Esse código fornece uma única `GetDepartments` método que retorna todas as entidades no `Departments` conjunto de entidades.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="b0ab8-226">Porque você sabe o que você terá acesso a `Person` propriedade de navegação para todas as linhas retornadas, você especificar o carregamento adiantada para essa propriedade usando o `Include` método.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="b0ab8-227">A classe também implementa o `IDisposable` interface para garantir que a conexão de banco de dados é liberado quando o objeto é descartado.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="b0ab8-228">Uma prática comum é criar uma classe de repositório para cada tipo de entidade.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="b0ab8-229">Neste tutorial, uma classe de repositório para vários tipos de entidade é usada.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="b0ab8-230">Para obter mais informações sobre o padrão de repositório, consulte as postagens no [blog da equipe do Entity Framework](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) e [blog de Julie](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span><span class="sxs-lookup"><span data-stu-id="b0ab8-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>

<span data-ttu-id="b0ab8-231">O `GetDepartments` método retorna um `IEnumerable` objeto em vez de um `IQueryable` objeto para garantir que a coleção retornada é utilizável até mesmo depois que o próprio objeto de repositório é descartado.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="b0ab8-232">Um `IQueryable` objeto pode fazer com que o acesso de banco de dados sempre que ele é acessado, mas o objeto de repositório pode ser descartado no momento em um controle de vinculação de dados tenta renderizar os dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="b0ab8-233">Você pode retornar outro tipo de coleção, como um `IList` do objeto, em vez de um `IEnumerable` objeto.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="b0ab8-234">No entanto, retornando um `IEnumerable` objeto garante que você pode realizar tarefas de processamento de lista típica de somente leitura, como `foreach` loops e consultas LINQ, mas você não pode adicionar a ou remover itens na coleção, que poderá indicar que essas alterações seria persistentes no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="b0ab8-235">Criar uma *Departments.aspx* página que usa o *Master* página mestra e adicione a seguinte marcação no `Content` controle chamado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="b0ab8-236">Essa marcação cria um `ObjectDataSource` controle que usa a classe de repositório que você acabou de criar, e um `GridView` controle para exibir os dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="b0ab8-237">O `GridView` controle especifica **edite** e **excluir** comandos, mas você ainda não adicionou o código para dar suporte a eles ainda.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="b0ab8-238">Usarem várias colunas `DynamicField` controles de modo que você pode tirar proveito da funcionalidade de formatação e validação de dados automática.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="b0ab8-239">Para que isso funcione, você precisa chamar o `EnableDynamicData` método no `Page_Init` manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="b0ab8-240">(`DynamicControl` controles não são usados no `Administrator` campo porque eles não funcionam com as propriedades de navegação.)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="b0ab8-241">O `Vertical-Align="Top"` atributos será importantes posteriormente quando você adiciona uma coluna que tenha um aninhada `GridView` controle à grade.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="b0ab8-242">Abra o *Departments.aspx.cs* do arquivo e adicione o seguinte `using` instrução:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="b0ab8-243">Em seguida, adicione o seguinte manipulador para a página `Init` eventos:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="b0ab8-244">No *DAL* pasta, crie um novo arquivo de classe chamado *Department.cs* e substitua o código existente pelo código a seguir:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="b0ab8-245">Esse código adiciona metadados ao modelo de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="b0ab8-246">Especifica que o `Budget` propriedade do `Department` entidade representa moeda, na verdade, embora seu tipo de dados seja `Decimal`, e especifica que o valor deve ser entre 0 e US $1,000,000.00.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="b0ab8-247">Ela também especifica que o `StartDate` propriedade deve ser formatada como uma data no formato mm/dd/aaaa.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="b0ab8-248">Execute o *Departments.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="b0ab8-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="b0ab8-250">Observe que, embora você não especificar uma cadeia de caracteres de formato na *Departments.aspx* marcação da página para o **orçamento** ou **data de início** padrão de colunas, moeda e data a formatação foi aplicada a eles pela `DynamicField` controla, usando os metadados que você forneceu na *Department.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="b0ab8-251">Adição de inserção e a funcionalidade de exclusão</span><span class="sxs-lookup"><span data-stu-id="b0ab8-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="b0ab8-252">Abra *SchoolRepository.cs*, adicione o seguinte código para criar um `Insert` método e um `Delete` método.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="b0ab8-253">O código também inclui um método chamado `GenerateDepartmentID` que calcula o próximo valor de chave do Registro disponíveis para uso pelo `Insert` método.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="b0ab8-254">Isso é necessário porque o banco de dados não está configurado para calcular isso automaticamente para o `Department` tabela.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="b0ab8-255">O método Attach</span><span class="sxs-lookup"><span data-stu-id="b0ab8-255">The Attach Method</span></span>

<span data-ttu-id="b0ab8-256">O `DeleteDepartment` chamadas de método a `Attach` método para restabelecer o link que é mantido no Gerenciador de estado do objeto do contexto de objeto entre as entidades na memória e o banco de dados de linha ele representa.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="b0ab8-257">Isso deve ocorrer antes do método chama o `SaveChanges` método.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="b0ab8-258">O termo *contexto de objeto* refere-se à classe Entity Framework que deriva de `ObjectContext` classe que você usa para acessar seus conjuntos de entidades e entidades.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="b0ab8-259">O código para este projeto, a classe é chamada `SchoolEntities`, e uma instância dele é sempre denominada `context`.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="b0ab8-260">O contexto de objeto *Gerenciador de estado do objeto* é uma classe que deriva de `ObjectStateManager` classe.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="b0ab8-261">O contato de objeto usa o Gerenciador de estado do objeto para armazenar objetos de entidade e para controlar se cada um deles está em sincronizado com a sua linha correspondente da tabela ou as linhas no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="b0ab8-262">Quando você lê uma entidade, o contexto de objeto armazena-o no Gerenciador de estado do objeto e controla se essa representação do objeto está em sincronia com o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="b0ab8-263">Por exemplo, se você alterar um valor de propriedade, um sinalizador é definido para indicar que a propriedade que você alterou não está mais em sincronia com o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="b0ab8-264">Em seguida, quando você chama o `SaveChanges` método, o contexto de objeto sabe o que fazer no banco de dados porque o Gerenciador de estado do objeto sabe exatamente qual é a diferença entre o estado atual da entidade e o estado do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="b0ab8-265">No entanto, esse processo geralmente não funciona em um aplicativo web, porque a instância do contexto de objeto que lê uma entidade, juntamente com todo o conteúdo do seu Gerenciador de estado do objeto é descartada depois que uma página é renderizada.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="b0ab8-266">A instância do contexto de objeto que deve aplicar as alterações é um novo é instanciado para processamento de postagem.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="b0ab8-267">No caso do `DeleteDepartment` método, o `ObjectDataSource` controle cria novamente a versão original da entidade para você de valores em estado de exibição, mas isso recriado `Department` entidade não existe no Gerenciador de estado do objeto.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="b0ab8-268">Se você chamou o `DeleteObject` método nessa entidade criada novamente, a chamada falhará porque o contexto de objeto não sabe se a entidade está em sincronia com o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="b0ab8-269">No entanto, chamar o `Attach` método restabelece a mesma de controle entre a entidade criada novamente e os valores no banco de dados que originalmente era feito automaticamente quando a entidade foi lido em uma instância anterior do contexto de objeto.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="b0ab8-270">Há vezes quando você não quer o contexto de objeto para acompanhar as entidades no Gerenciador de estado de objeto, e você pode definir sinalizadores para impedir a fazer isso.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="b0ab8-271">Exemplos disso são mostrados nos tutoriais mais adiante nesta série.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="b0ab8-272">O método SaveChanges</span><span class="sxs-lookup"><span data-stu-id="b0ab8-272">The SaveChanges Method</span></span>

<span data-ttu-id="b0ab8-273">Essa classe de repositório simples ilustra os princípios básicos de como realizar operações CRUD.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="b0ab8-274">Neste exemplo, o `SaveChanges` método é chamado imediatamente após cada atualização.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="b0ab8-275">Em um aplicativo de produção, você talvez queira chamar o `SaveChanges` método de um método separado para lhe dar mais controle sobre quando o banco de dados é atualizado.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="b0ab8-276">(No final do próximo tutorial você encontrará um link para um white paper que aborda o padrão de unidade de trabalho que é uma abordagem para coordenar as atualizações relacionadas.) Observe também que no exemplo, o `DeleteDepartment` método não inclui código para lidar com conflitos de simultaneidade, o código para fazer isso será adicionado em um tutorial posterior nesta série.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="b0ab8-277">Recuperando nomes de instrutor para selecionar ao inserir</span><span class="sxs-lookup"><span data-stu-id="b0ab8-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="b0ab8-278">Os usuários devem poder selecionar um administrador em uma lista de instrutores em uma lista suspensa durante a criação de novos departamentos.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="b0ab8-279">Portanto, adicione o seguinte código ao *SchoolRepository.cs* para criar um método para recuperar a lista de instrutores usando o modo de exibição que você criou anteriormente:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="b0ab8-280">Criando uma página para a inserção de departamentos</span><span class="sxs-lookup"><span data-stu-id="b0ab8-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="b0ab8-281">Criar uma *DepartmentsAdd.aspx* página que usa o *Master* da página e adicione a seguinte marcação no `Content` controle chamado `Content2`:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="b0ab8-282">Essa marcação cria dois `ObjectDataSource` controles, uma para inserir novos `Department` entidades e outra para recuperar os nomes de instrutor para o `DropDownList` controle que é usado para selecionar os administradores de departamento.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="b0ab8-283">A marcação cria um `DetailsView` para inserir novos departamentos e ele especifica um manipulador para o controle de controle `ItemInserting` evento para que você possa definir o `Administrator` valor de chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="b0ab8-284">No final é um `ValidationSummary` controle para exibir mensagens de erro.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="b0ab8-285">Abra *DepartmentsAdd.aspx.cs* e adicione o seguinte `using` instrução:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="b0ab8-286">Adicione os métodos e a variável de classe a seguir:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="b0ab8-287">O `Page_Init` método habilita a funcionalidade de dados dinâmicos.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="b0ab8-288">O manipulador para o `DropDownList` do controle `Init` evento salva uma referência para o controle e o manipulador para o `DetailsView` do controle `Inserting` evento usa essa referência para obter o `PersonID` valor da atualização e do instrutor selecionado o `Administrator` propriedade de chave estrangeira do `Department` entidade.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="b0ab8-289">Execute a página, adicione informações do departamento e, em seguida, clique no **inserir** link.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="b0ab8-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="b0ab8-291">Insira valores para outro novo departamento.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-291">Enter values for another new department.</span></span> <span data-ttu-id="b0ab8-292">Insira um número maior que 1,000,000.00 na **orçamento** campo e o guia para o próximo campo.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="b0ab8-293">Um asterisco é exibido no campo e, se você mantiver o ponteiro do mouse sobre ele, você pode ver a mensagem de erro que você inseriu nos metadados para esse campo.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="b0ab8-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="b0ab8-295">Clique em **inserir**, e você verá a mensagem de erro exibida pelo `ValidationSummary` controle na parte inferior da página.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="b0ab8-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="b0ab8-297">Em seguida, feche o navegador e abra o *Departments.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="b0ab8-298">Adicionar funcionalidade de exclusão para o *Departments.aspx* página adicionando um `DeleteMethod` de atributo para o `ObjectDataSource` controle e uma `DataKeyNames` atributo para o `GridView` controle.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="b0ab8-299">As marcas de abertura para esses controles agora serão semelhante ao exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="b0ab8-300">Execute a página.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-300">Run the page.</span></span>

<span data-ttu-id="b0ab8-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="b0ab8-302">Exclui o departamento que você adicionou quando você executou o *DepartmentsAdd.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="b0ab8-303">Adicionando funcionalidade de atualização</span><span class="sxs-lookup"><span data-stu-id="b0ab8-303">Adding Update Functionality</span></span>

<span data-ttu-id="b0ab8-304">Abra *SchoolRepository.cs* e adicione o seguinte `Update` método:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="b0ab8-305">Quando você clica em **atualização** na *Departments.aspx* página, o `ObjectDataSource` controle cria dois `Department` entidades a serem passados para o `UpdateDepartment` método.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="b0ab8-306">Uma contém os valores originais que foram armazenados no estado de exibição e o outro contém os novos valores que foram inseridos no `GridView` controle.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="b0ab8-307">O código na `UpdateDepartment` método passa a `Department` entidade que tem os valores originais para o `Attach` método para estabelecer o rastreamento entre a entidade e o que está no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="b0ab8-308">Em seguida, o código passa o `Department` entidade que tem os novos valores para o `ApplyCurrentValues` método.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="b0ab8-309">O contexto de objeto compara os valores novos e antigos.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-309">The object context compares the old and new values.</span></span> <span data-ttu-id="b0ab8-310">Se um novo valor for diferente de um valor antigo, o contexto de objeto altera o valor da propriedade.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="b0ab8-311">O `SaveChanges` método, em seguida, atualiza apenas as colunas alteradas no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="b0ab8-312">(No entanto, se a função de atualização para esta entidade foram mapeada para um procedimento armazenado, a linha inteira será atualizada, independentemente de qual colunas foram alteradas.)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="b0ab8-313">Abra o *Departments.aspx* arquivo e adicione os seguintes atributos para o `DepartmentsObjectDataSource` controle:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="b0ab8-314">Esse valores antigos faz com que sejam armazenados no estado de exibição para que eles podem ser comparados com os novos valores no `Update` método.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="b0ab8-315">Isso informa o controle que é o nome do parâmetro de valores originais `origDepartment` .</span><span class="sxs-lookup"><span data-stu-id="b0ab8-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="b0ab8-316">A marcação para a marca de abertura do `ObjectDataSource` controle agora é semelhante ao exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="b0ab8-317">Adicionar um `OnRowUpdating="DepartmentsGridView_RowUpdating"` de atributo para o `GridView` controle.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="b0ab8-318">Você usará isso para definir o `Administrator` valor da propriedade com base na linha em que o usuário seleciona em uma lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="b0ab8-319">O `GridView` marca de abertura agora se parece com o exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="b0ab8-320">Adicionar um `EditItemTemplate` de controle para o `Administrator` coluna para o `GridView` controlar, imediatamente após o `ItemTemplate` controle para essa coluna:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="b0ab8-321">Isso `EditItemTemplate` controle é semelhante de `InsertItemTemplate` no controlar a *DepartmentsAdd.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="b0ab8-322">A diferença é que o valor inicial do controle é definido usando o `SelectedValue` atributo.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="b0ab8-323">Antes do `GridView` de controle, adicione uma `ValidationSummary` controlam como você fez na *DepartmentsAdd.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="b0ab8-324">Abra *Departments.aspx.cs* e imediatamente após a declaração de classe parcial, adicione o código a seguir para criar um campo particular para fazer referência a `DropDownList` controle:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="b0ab8-325">Em seguida, adicione manipuladores para o `DropDownList` do controle `Init` evento e o `GridView` do controle `RowUpdating` eventos:</span><span class="sxs-lookup"><span data-stu-id="b0ab8-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="b0ab8-326">O manipulador para o `Init` evento salva uma referência para o `DropDownList` controle no campo de classe.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="b0ab8-327">O manipulador para o `RowUpdating` evento usa a referência para obter o valor inserido pelo usuário e aplicá-lo para o `Administrator` propriedade do `Department` entidade.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="b0ab8-328">Use o *DepartmentsAdd.aspx* página para adicionar um novo departamento, em seguida, execute o *Departments.aspx* da página e clique em **editar** na linha que você adicionou.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="b0ab8-329">Você não poderá editar as linhas que você não adicionou (ou seja, que já estavam no banco de dados), devido aos dados inválidos no banco de dados; os administradores para as linhas que foram criados com o banco de dados são os alunos.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="b0ab8-330">Se você tentar editar um deles, você obterá uma página de erro que informa um erro como `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="b0ab8-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>

<span data-ttu-id="b0ab8-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="b0ab8-332">Se você inserir um inválido **orçamento** amount e, em seguida, clique em **atualização**, você verá a mesmo asterisco e mensagem de erro que você viu no *Departments.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="b0ab8-333">Alterar um valor de campo ou selecione um administrador diferente e clique em **atualização**.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="b0ab8-334">A alteração é exibida.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-334">The change is displayed.</span></span>

<span data-ttu-id="b0ab8-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="b0ab8-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="b0ab8-336">Isso conclui a introdução ao uso o `ObjectDataSource` controle para básica CRUD (criar, ler, atualizar e excluir) operações com o Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="b0ab8-337">Você criou um aplicativo de n camadas simple, mas a camada de lógica de negócios ainda estará rigidamente acoplada à camada de acesso a dados, o que complica o teste de unidade automatizado.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="b0ab8-338">O tutorial a seguir, você verá como implementar o padrão de repositório para facilitar o teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="b0ab8-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="b0ab8-339">Avançar</span><span class="sxs-lookup"><span data-stu-id="b0ab8-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
