---
uid: web-forms/overview/older-versions-security/membership/storing-additional-user-information-cs
title: Armazenar informações adicionais do usuário (c#) | Microsoft Docs
author: rick-anderson
description: Neste tutorial será respondemos a essa pergunta, criando um aplicativo de livro de visitas muito rudimentares. Dessa forma, vamos examinar as diferentes opções para modeli...
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 1642132a-1ca5-4872-983f-ab59fc8865d3
msc.legacyurl: /web-forms/overview/older-versions-security/membership/storing-additional-user-information-cs
msc.type: authoredcontent
ms.openlocfilehash: 76e6cd1ec290cf572023aef35e349b1146b2b432
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57042683"
---
<a name="storing-additional-user-information-c"></a><span data-ttu-id="703d9-104">Armazenar informações de usuário adicionais (C#)</span><span class="sxs-lookup"><span data-stu-id="703d9-104">Storing Additional User Information (C#)</span></span>
====================
<span data-ttu-id="703d9-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="703d9-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="703d9-106">[Baixar o código](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_CS.zip) ou [baixar PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="703d9-106">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_CS.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_cs.pdf)</span></span>

> <span data-ttu-id="703d9-107">Neste tutorial será respondemos a essa pergunta, criando um aplicativo de livro de visitas muito rudimentares.</span><span class="sxs-lookup"><span data-stu-id="703d9-107">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="703d9-108">Dessa forma, podemos examinar opções diferentes para modelagem de informações do usuário em um banco de dados e, em seguida, consulte como associar esses dados com as contas de usuário criadas pela estrutura de associação.</span><span class="sxs-lookup"><span data-stu-id="703d9-108">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span>


## <a name="introduction"></a><span data-ttu-id="703d9-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="703d9-109">Introduction</span></span>

<span data-ttu-id="703d9-110">ASP. Estrutura de associação da rede oferece uma interface flexível para gerenciar usuários.</span><span class="sxs-lookup"><span data-stu-id="703d9-110">ASP.NET's Membership framework offers a flexible interface for managing users.</span></span> <span data-ttu-id="703d9-111">A API Membership inclui métodos para validar as credenciais, recuperando informações sobre o usuário conectado no momento, criando uma nova conta de usuário e a exclusão de uma conta de usuário, entre outros.</span><span class="sxs-lookup"><span data-stu-id="703d9-111">The Membership API includes methods for validating credentials, retrieving information about the currently logged on user, creating a new user account, and deleting a user account, among others.</span></span> <span data-ttu-id="703d9-112">Cada conta de usuário na estrutura associação contém apenas as propriedades necessárias para validar as credenciais e executar tarefas relacionadas a contas de usuário essencial.</span><span class="sxs-lookup"><span data-stu-id="703d9-112">Each user account in the Membership framework contains only the properties needed for validating credentials and performing essential user account-related tasks.</span></span> <span data-ttu-id="703d9-113">Isso fica evidente através de métodos e propriedades do [ `MembershipUser` classe](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), que modela uma conta de usuário na estrutura de associação.</span><span class="sxs-lookup"><span data-stu-id="703d9-113">This is evidenced by the methods and properties of the [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), which models a user account in the Membership framework.</span></span> <span data-ttu-id="703d9-114">Essa classe tem propriedades como [ `UserName` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [ `Email` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), e [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), e métodos como [ `GetPassword` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) e [ `UnlockUser` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="703d9-114">This class has properties like [`UserName`](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [`Email`](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), and [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), and methods like [`GetPassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) and [`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span>

<span data-ttu-id="703d9-115">Muitas vezes, os aplicativos precisam armazenar informações de usuário adicionais não incluídas na estrutura associação.</span><span class="sxs-lookup"><span data-stu-id="703d9-115">Oftentimes, applications need to store additional user information not included in the Membership framework.</span></span> <span data-ttu-id="703d9-116">Por exemplo, uma loja online, talvez seja necessário permitir que cada usuário armazenar seus endereços de envio e de cobrança, informações de pagamento, as preferências de entrega e entre em contato com o número de telefone.</span><span class="sxs-lookup"><span data-stu-id="703d9-116">For example, an online retailer might need to let each user store her shipping and billing addresses, payment information, delivery preferences, and contact phone number.</span></span> <span data-ttu-id="703d9-117">Além disso, cada pedido no sistema está associado uma conta de usuário específica.</span><span class="sxs-lookup"><span data-stu-id="703d9-117">Furthermore, each order in the system is associated with a particular user account.</span></span>

<span data-ttu-id="703d9-118">O `MembershipUser` classe não inclui propriedades como `PhoneNumber` ou `DeliveryPreferences` ou `PastOrders`.</span><span class="sxs-lookup"><span data-stu-id="703d9-118">The `MembershipUser` class does not include properties like `PhoneNumber` or `DeliveryPreferences` or `PastOrders`.</span></span> <span data-ttu-id="703d9-119">Então, como podemos acompanhar as informações de usuário necessitadas para o aplicativo e fazer com que ele se integram com a estrutura de associação?</span><span class="sxs-lookup"><span data-stu-id="703d9-119">So how do we track the user information needed by the application and have it integrate with the Membership framework?</span></span> <span data-ttu-id="703d9-120">Neste tutorial será respondemos a essa pergunta, criando um aplicativo de livro de visitas muito rudimentares.</span><span class="sxs-lookup"><span data-stu-id="703d9-120">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="703d9-121">Dessa forma, podemos examinar opções diferentes para modelagem de informações do usuário em um banco de dados e, em seguida, consulte como associar esses dados com as contas de usuário criadas pela estrutura de associação.</span><span class="sxs-lookup"><span data-stu-id="703d9-121">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="703d9-122">Vamos começar!</span><span class="sxs-lookup"><span data-stu-id="703d9-122">Let's get started!</span></span>

## <a name="step-1-creating-the-guestbook-applications-data-model"></a><span data-ttu-id="703d9-123">Etapa 1: Criando o modelo de dados do aplicativo de livro de visitas</span><span class="sxs-lookup"><span data-stu-id="703d9-123">Step 1: Creating the Guestbook Application's Data Model</span></span>

<span data-ttu-id="703d9-124">Há uma variedade de técnicas que podem ser empregadas para capturar informações de usuário em um banco de dados e associá-la com as contas de usuário criadas pela estrutura de associação.</span><span class="sxs-lookup"><span data-stu-id="703d9-124">There are a variety of techniques that can be employed to capture user information in a database and associate it with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="703d9-125">Para ilustrar essas técnicas, é necessário aumentar o aplicativo web do tutorial, de modo que ele captura algum tipo de dados relacionados ao usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-125">In order to illustrate these techniques, we will need to augment the tutorial web application so that it captures some sort of user-related data.</span></span> <span data-ttu-id="703d9-126">(No momento, o modelo de dados do aplicativo contém apenas o aplicativo de serviços tabelas necessárias para o `SqlMembershipProvider`.)</span><span class="sxs-lookup"><span data-stu-id="703d9-126">(Currently, the application's data model contains only the application services tables needed by the `SqlMembershipProvider`.)</span></span>

<span data-ttu-id="703d9-127">Vamos criar um aplicativo de livro de visitas muito simples em que um usuário autenticado pode deixar um comentário.</span><span class="sxs-lookup"><span data-stu-id="703d9-127">Let's create a very simple guestbook application where an authenticated user can leave a comment.</span></span> <span data-ttu-id="703d9-128">Além de armazenar comentários de livro de visitas, vamos permitir que cada usuário armazenar sua cidade, a home page e a assinatura.</span><span class="sxs-lookup"><span data-stu-id="703d9-128">In addition to storing guestbook comments, let's allow each user to store his home town, homepage, and signature.</span></span> <span data-ttu-id="703d9-129">Se fornecido, cidade do usuário, home page e a assinatura serão exibido em cada mensagem que ele saiu no livro de visitas.</span><span class="sxs-lookup"><span data-stu-id="703d9-129">If provided, the user's home town, homepage, and signature will appear on each message he has left in the guestbook.</span></span>

### <a name="adding-theguestbookcommentstable"></a><span data-ttu-id="703d9-130">Adicionando o`GuestbookComments`tabela</span><span class="sxs-lookup"><span data-stu-id="703d9-130">Adding the`GuestbookComments`Table</span></span>

<span data-ttu-id="703d9-131">Para capturar os comentários do livro de visitas, precisamos criar uma tabela de banco de dados denominada `GuestbookComments` que tem colunas como `CommentId`, `Subject`, `Body`, e `CommentDate`.</span><span class="sxs-lookup"><span data-stu-id="703d9-131">In order to capture the guestbook comments, we need to create a database table named `GuestbookComments` that has columns like `CommentId`, `Subject`, `Body`, and `CommentDate`.</span></span> <span data-ttu-id="703d9-132">Também precisamos ter cada registro no `GuestbookComments` o usuário que deixou o comentário de referência de tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-132">We also need to have each record in the `GuestbookComments` table reference the user who left the comment.</span></span>

<span data-ttu-id="703d9-133">Para adicionar essa tabela para nosso banco de dados, vá para o Gerenciador de banco de dados no Visual Studio e Detalhar o `SecurityTutorials` banco de dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-133">To add this table to our database, go to the Database Explorer in Visual Studio and drill down into the `SecurityTutorials` database.</span></span> <span data-ttu-id="703d9-134">Clique com botão direito na pasta tabelas e escolha Adicionar nova tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-134">Right-click on the Tables folder and choose Add New Table.</span></span> <span data-ttu-id="703d9-135">Isso abre uma interface que permite definir as colunas para a nova tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-135">This brings up an interface that allows us to define the columns for the new table.</span></span>


<span data-ttu-id="703d9-136">[![Adicionar uma nova tabela no banco de dados SecurityTutorials](storing-additional-user-information-cs/_static/image2.png)](storing-additional-user-information-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-136">[![Add a New Table to the SecurityTutorials Database](storing-additional-user-information-cs/_static/image2.png)](storing-additional-user-information-cs/_static/image1.png)</span></span>

<span data-ttu-id="703d9-137">**Figura 1**: Adicionar uma nova tabela para o `SecurityTutorials` banco de dados ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-137">**Figure 1**: Add a New Table to the `SecurityTutorials` Database  ([Click to view full-size image](storing-additional-user-information-cs/_static/image3.png))</span></span>


<span data-ttu-id="703d9-138">Em seguida, defina o `GuestbookComments`da colunas.</span><span class="sxs-lookup"><span data-stu-id="703d9-138">Next, define the `GuestbookComments`'s columns.</span></span> <span data-ttu-id="703d9-139">Comece adicionando uma coluna denominada `CommentId` do tipo `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="703d9-139">Start by adding a column named `CommentId` of type `uniqueidentifier`.</span></span> <span data-ttu-id="703d9-140">Esta coluna será identificam exclusivamente cada comentário no livro de visitas, portanto, não permitir `NULL` s e marcá-la como chave primária da tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-140">This column will uniquely identify each comment in the guestbook, so disallow `NULL` s and mark it as the table's primary key.</span></span> <span data-ttu-id="703d9-141">Em vez de fornecer um valor para o `CommentId` campo em cada `INSERT`, podemos pode indicar que uma nova `uniqueidentifier` valor deve ser gerado automaticamente para esse campo em `INSERT` definindo o valor padrão da coluna como `NEWID()`.</span><span class="sxs-lookup"><span data-stu-id="703d9-141">Rather than providing a value for the `CommentId` field on each `INSERT`, we can indicate that a new `uniqueidentifier` value should be automatically generated for this field on `INSERT` by setting the column's default value to `NEWID()`.</span></span> <span data-ttu-id="703d9-142">Depois de adicionar esse campo primeiro, marcando-o como a chave primária e as configurações de seu valor padrão, sua tela deve ser semelhante à mostrada na Figura 2 de captura de tela.</span><span class="sxs-lookup"><span data-stu-id="703d9-142">After adding this first field, marking it as the primary key, and settings its default value, your screen should look similar to the screen shot shown in Figure 2.</span></span>


<span data-ttu-id="703d9-143">[![Adicionar uma coluna principal chamada CommentId](storing-additional-user-information-cs/_static/image5.png)](storing-additional-user-information-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-143">[![Add a Primary Column Named CommentId](storing-additional-user-information-cs/_static/image5.png)](storing-additional-user-information-cs/_static/image4.png)</span></span>

<span data-ttu-id="703d9-144">**Figura 2**: Adicionar uma coluna denominada primário `CommentId` ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-144">**Figure 2**: Add a Primary Column Named `CommentId` ([Click to view full-size image](storing-additional-user-information-cs/_static/image6.png))</span></span>


<span data-ttu-id="703d9-145">Em seguida, adicione uma coluna denominada `Subject` do tipo `nvarchar(50)` e uma coluna denominada `Body` do tipo `nvarchar(MAX)`, desativando `NULL` s em ambas as colunas.</span><span class="sxs-lookup"><span data-stu-id="703d9-145">Next, add a column named `Subject` of type `nvarchar(50)` and a column named `Body` of type `nvarchar(MAX)`, disallowing `NULL` s in both columns.</span></span> <span data-ttu-id="703d9-146">Depois disso, adicione uma coluna denominada `CommentDate` do tipo `datetime`.</span><span class="sxs-lookup"><span data-stu-id="703d9-146">Following that, add a column named `CommentDate` of type `datetime`.</span></span> <span data-ttu-id="703d9-147">Não permitir `NULL` s e defina o `CommentDate` valor de padrão da coluna a ser `getdate()`.</span><span class="sxs-lookup"><span data-stu-id="703d9-147">Disallow `NULL` s and set the `CommentDate` column's default value to `getdate()`.</span></span>

<span data-ttu-id="703d9-148">Tudo o que resta é adicionar uma coluna que associa uma conta de usuário a cada comentário do livro de visitas.</span><span class="sxs-lookup"><span data-stu-id="703d9-148">All that remains is to add a column that associates a user account with each guestbook comment.</span></span> <span data-ttu-id="703d9-149">Uma opção seria adicionar uma coluna denominada `UserName` do tipo `nvarchar(256)`.</span><span class="sxs-lookup"><span data-stu-id="703d9-149">One option would be to add a column named `UserName` of type `nvarchar(256)`.</span></span> <span data-ttu-id="703d9-150">Isso é uma escolha adequada ao uso de um provedor de associação diferente a `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="703d9-150">This is a suitable choice when using a Membership provider other than the `SqlMembershipProvider`.</span></span> <span data-ttu-id="703d9-151">Mas ao usar o `SqlMembershipProvider`, pois estamos nessa série de tutoriais, o `UserName` coluna o `aspnet_Users` tabela não é garantida para ser exclusivo.</span><span class="sxs-lookup"><span data-stu-id="703d9-151">But when using the `SqlMembershipProvider`, as we are in this tutorial series, the `UserName` column in the `aspnet_Users` table is not guaranteed to be unique.</span></span> <span data-ttu-id="703d9-152">O `aspnet_Users` é de chave primária da tabela `UserId` e é do tipo `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="703d9-152">The `aspnet_Users` table's primary key is `UserId` and is of type `uniqueidentifier`.</span></span> <span data-ttu-id="703d9-153">Portanto, o `GuestbookComments` tabela precisa de uma coluna denominada `UserId` do tipo `uniqueidentifier` (desautorizando `NULL` valores).</span><span class="sxs-lookup"><span data-stu-id="703d9-153">Therefore, the `GuestbookComments` table needs a column named `UserId` of type `uniqueidentifier` (disallowing `NULL` values).</span></span> <span data-ttu-id="703d9-154">Vá em frente e adicione esta coluna.</span><span class="sxs-lookup"><span data-stu-id="703d9-154">Go ahead and add this column.</span></span>

> [!NOTE]
> <span data-ttu-id="703d9-155">Como discutimos na [ *criação do esquema de associação no SQL Server* ](creating-the-membership-schema-in-sql-server-cs.md) tutorial, a estrutura de associação foi projetada para permitir vários aplicativos web com contas de usuário diferentes compartilhar o mesmo repositório do usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-155">As we discussed in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) tutorial, the Membership framework is designed to enable multiple web applications with different user accounts to share the same user store.</span></span> <span data-ttu-id="703d9-156">Ele faz isso por meio do particionamento de contas de usuário em aplicativos diferentes.</span><span class="sxs-lookup"><span data-stu-id="703d9-156">It does this by partitioning user accounts into different applications.</span></span> <span data-ttu-id="703d9-157">E enquanto cada nome de usuário é garantido que seja exclusivo dentro de um aplicativo, o mesmo nome de usuário pode ser usado em aplicativos diferentes usando o mesmo repositório de usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-157">And while each username is guaranteed to be unique within an application, the same username may be used in different applications using the same user store.</span></span> <span data-ttu-id="703d9-158">Há uma composição `UNIQUE` restrição na `aspnet_Users` tabela o `UserName` e `ApplicationId` campos, mas não uma em apenas o `UserName` campo.</span><span class="sxs-lookup"><span data-stu-id="703d9-158">There is a composite `UNIQUE` constraint in the `aspnet_Users` table on the `UserName` and `ApplicationId` fields, but not one on just the `UserName` field.</span></span> <span data-ttu-id="703d9-159">Consequentemente, é possível que o aspnet\_tabela de usuários para ter dois (ou mais) registros com o mesmo `UserName` valor.</span><span class="sxs-lookup"><span data-stu-id="703d9-159">Consequently, it is possible for the aspnet\_Users table to have two (or more) records with the same `UserName` value.</span></span> <span data-ttu-id="703d9-160">No entanto, há uma `UNIQUE` restrição na `aspnet_Users` da tabela `UserId` campo (já que é a chave primária).</span><span class="sxs-lookup"><span data-stu-id="703d9-160">There is, however, a `UNIQUE` constraint on the `aspnet_Users` table's `UserId` field (since it is the primary key).</span></span> <span data-ttu-id="703d9-161">Um `UNIQUE` restrição é importante porque sem ela, não é possível estabelecer uma restrição de chave estrangeira entre as `GuestbookComments` e `aspnet_Users` tabelas.</span><span class="sxs-lookup"><span data-stu-id="703d9-161">A `UNIQUE` constraint is important because without it we cannot establish a foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables.</span></span>


<span data-ttu-id="703d9-162">Depois de adicionar o `UserId` coluna, salve a tabela clicando no ícone de salvar na barra de ferramentas.</span><span class="sxs-lookup"><span data-stu-id="703d9-162">After adding the `UserId` column, save the table by clicking on the Save icon in the Toolbar.</span></span> <span data-ttu-id="703d9-163">Nomeie a nova tabela `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="703d9-163">Name the new table `GuestbookComments`.</span></span>

<span data-ttu-id="703d9-164">Temos uma última questão participar com o `GuestbookComments` tabela: é necessário criar um [restrição de chave estrangeira](https://msdn.microsoft.com/library/ms175464.aspx) entre o `GuestbookComments.UserId` coluna e o `aspnet_Users.UserId` coluna.</span><span class="sxs-lookup"><span data-stu-id="703d9-164">We have one last issue to attend to with the `GuestbookComments` table: we need to create a [foreign key constraint](https://msdn.microsoft.com/library/ms175464.aspx) between the `GuestbookComments.UserId` column and the `aspnet_Users.UserId` column.</span></span> <span data-ttu-id="703d9-165">Para fazer isso, clique no ícone de relação na barra de ferramentas para iniciar a caixa de diálogo relações de chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="703d9-165">To achieve this, click the Relationship icon in the Toolbar to launch the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="703d9-166">(Como alternativa, você pode iniciar esta caixa de diálogo, no menu Designer de tabela e escolhendo as relações).</span><span class="sxs-lookup"><span data-stu-id="703d9-166">(Alternatively, you can launch this dialog box by going to the Table Designer menu and choosing Relationships.)</span></span>

<span data-ttu-id="703d9-167">Clique no botão Adicionar no canto inferior esquerdo da caixa de diálogo relações de chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="703d9-167">Click the Add button in the lower left corner of the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="703d9-168">Isso adicionará uma nova restrição foreign key, embora ainda assim será preciso definir as tabelas que participam na relação.</span><span class="sxs-lookup"><span data-stu-id="703d9-168">This will add a new foreign key constraint, although we still need to define the tables that participate in the relationship.</span></span>


<span data-ttu-id="703d9-169">[![Use a caixa de diálogo relações de chave estrangeira para gerenciar as restrições de chave estrangeira da tabela](storing-additional-user-information-cs/_static/image8.png)](storing-additional-user-information-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-169">[![Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints](storing-additional-user-information-cs/_static/image8.png)](storing-additional-user-information-cs/_static/image7.png)</span></span>

<span data-ttu-id="703d9-170">**Figura 3**: Use a caixa de diálogo de relações de chave estrangeira para gerenciar as restrições de chave estrangeira da tabela ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-170">**Figure 3**: Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints  ([Click to view full-size image](storing-additional-user-information-cs/_static/image9.png))</span></span>


<span data-ttu-id="703d9-171">Em seguida, clique no ícone de reticências na linha "Especificações de tabela e colunas" à direita.</span><span class="sxs-lookup"><span data-stu-id="703d9-171">Next, click the ellipses icon in the "Table and Columns Specifications" row on the right.</span></span> <span data-ttu-id="703d9-172">Isso iniciará a caixa de diálogo tabelas e colunas, dos quais podemos especificar a tabela de chave primária e a coluna e a coluna de chave estrangeira do `GuestbookComments` tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-172">This will launch the Tables and Columns dialog box, from which we can specify the primary key table and column and the foreign key column from the `GuestbookComments` table.</span></span> <span data-ttu-id="703d9-173">Em particular, selecione `aspnet_Users` e `UserId` como a tabela de chave primária e a coluna, e `UserId` da `GuestbookComments` tabela como a coluna de chave estrangeira (consulte a Figura 4).</span><span class="sxs-lookup"><span data-stu-id="703d9-173">In particular, select `aspnet_Users` and `UserId` as the primary key table and column, and `UserId` from the `GuestbookComments` table as the foreign key column (see Figure 4).</span></span> <span data-ttu-id="703d9-174">Depois de definir as colunas e tabelas de chave primárias e estrangeiras, clique em Okey para retornar à caixa de diálogo relações de chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="703d9-174">After defining the primary and foreign key tables and columns, click OK to return to the Foreign Key Relationships dialog box.</span></span>


<span data-ttu-id="703d9-175">[![Estabeleça uma Foreign Key restrição entre o aspnet_Users e GuesbookComments tabelas](storing-additional-user-information-cs/_static/image11.png)](storing-additional-user-information-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-175">[![Establish a Foreign Key Constraint Between the aspnet_Users and GuesbookComments Tables](storing-additional-user-information-cs/_static/image11.png)](storing-additional-user-information-cs/_static/image10.png)</span></span>

<span data-ttu-id="703d9-176">**Figura 4**: Estabelecer uma Foreign Key restrição entre o `aspnet_Users` e `GuesbookComments` tabelas ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-176">**Figure 4**: Establish a Foreign Key Constraint Between the `aspnet_Users` and `GuesbookComments` Tables  ([Click to view full-size image](storing-additional-user-information-cs/_static/image12.png))</span></span>


<span data-ttu-id="703d9-177">Neste momento a restrição de chave estrangeira foi estabelecida.</span><span class="sxs-lookup"><span data-stu-id="703d9-177">At this point the foreign key constraint has been established.</span></span> <span data-ttu-id="703d9-178">A presença dessa restrição garante [integridade relacional](http://en.wikipedia.org/wiki/Referential_integrity) entre as duas tabelas, garantindo que nunca haverá uma entrada de livro de visitas referindo-se a uma conta de usuário inexistente.</span><span class="sxs-lookup"><span data-stu-id="703d9-178">The presence of this constraint ensures [relational integrity](http://en.wikipedia.org/wiki/Referential_integrity) between the two tables by guaranteeing that there will never be a guestbook entry referring to a non-existent user account.</span></span> <span data-ttu-id="703d9-179">Por padrão, uma restrição foreign key não permitirá um registro pai a ser excluído se existem registros filho correspondentes.</span><span class="sxs-lookup"><span data-stu-id="703d9-179">By default, a foreign key constraint will disallow a parent record to be deleted if there are corresponding child records.</span></span> <span data-ttu-id="703d9-180">Ou seja, se um usuário faz um ou mais comentários do livro de visitas e, em seguida, podemos tentar excluir essa conta de usuário, a exclusão falhará, a menos que os comentários do livro de visitas são excluídos primeiro.</span><span class="sxs-lookup"><span data-stu-id="703d9-180">That is, if a user makes one or more guestbook comments, and then we attempt to delete that user account, the delete will fail unless his guestbook comments are deleted first.</span></span>

<span data-ttu-id="703d9-181">Restrições de chave estrangeira podem ser configuradas para excluir automaticamente os registros filho associado quando um registro pai é excluído.</span><span class="sxs-lookup"><span data-stu-id="703d9-181">Foreign key constraints can be configured to automatically delete the associated child records when a parent record is deleted.</span></span> <span data-ttu-id="703d9-182">Em outras palavras, podemos pode configurar essa restrição de chave estrangeira para que as entradas de livro de visitas do usuário são excluídas automaticamente quando sua conta de usuário é excluída.</span><span class="sxs-lookup"><span data-stu-id="703d9-182">In other words, we can setup this foreign key constraint so that a user's guestbook entries are automatically deleted when her user account is deleted.</span></span> <span data-ttu-id="703d9-183">Para fazer isso, expanda a seção "Especificação de inserção e atualização" e defina a propriedade de "Excluir a regra" em cascata.</span><span class="sxs-lookup"><span data-stu-id="703d9-183">To accomplish this, expand the "INSERT And UPDATE Specification" section and set the "Delete Rule" property to Cascade.</span></span>


<span data-ttu-id="703d9-184">[![Configurar a restrição de chave estrangeira para exclusões em cascata](storing-additional-user-information-cs/_static/image14.png)](storing-additional-user-information-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-184">[![Configure the Foreign Key Constraint to Cascade Deletes](storing-additional-user-information-cs/_static/image14.png)](storing-additional-user-information-cs/_static/image13.png)</span></span>

<span data-ttu-id="703d9-185">**Figura 5**: Configurar a restrição de chave estrangeira para exclusões em cascata ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-185">**Figure 5**: Configure the Foreign Key Constraint to Cascade Deletes  ([Click to view full-size image](storing-additional-user-information-cs/_static/image15.png))</span></span>


<span data-ttu-id="703d9-186">Para salvar a restrição de chave estrangeira, clique no botão Fechar para sair das relações de chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="703d9-186">To save the foreign key constraint, click the Close button to exit out of the Foreign Key Relationships.</span></span> <span data-ttu-id="703d9-187">Em seguida, clique no ícone Salvar na barra de ferramentas para salvar a tabela e essa relação.</span><span class="sxs-lookup"><span data-stu-id="703d9-187">Then click the Save icon in the Toolbar to save the table and the this relationship.</span></span>

### <a name="storing-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="703d9-188">Armazenar Home Town, home page e assinatura do usuário</span><span class="sxs-lookup"><span data-stu-id="703d9-188">Storing the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="703d9-189">O `GuestbookComments` tabela ilustra como armazenar informações que compartilha uma relação um-para-muitos com as contas de usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-189">The `GuestbookComments` table illustrates how to store information that shares a one-to-many relationship with user accounts.</span></span> <span data-ttu-id="703d9-190">Como cada conta de usuário pode ter um número arbitrário de comentários associados, essa relação é modelada com a criação de uma tabela para armazenar o conjunto de comentários que inclui uma coluna que vincula cada comentário de volta para um determinado usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-190">Since each user account may have an arbitrary number of associated comments, this relationship is modeled by creating a table to hold the set of comments that includes a column that links back each comment to a particular user.</span></span> <span data-ttu-id="703d9-191">Ao usar o `SqlMembershipProvider`, esse link melhor é estabelecido com a criação de uma coluna denominada `UserId` do tipo `uniqueidentifier` e uma restrição de chave estrangeira entre esta coluna e `aspnet_Users.UserId`.</span><span class="sxs-lookup"><span data-stu-id="703d9-191">When using the `SqlMembershipProvider`, this link is best established by creating a column named `UserId` of type `uniqueidentifier` and a foreign key constraint between this column and `aspnet_Users.UserId`.</span></span>

<span data-ttu-id="703d9-192">Agora, precisamos associar três colunas a cada conta de usuário para armazenar a cidade, home page e assinatura, que será exibido em seu livro de visitas comentários do usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-192">We now need to associate three columns with each user account to store the user's home town, homepage, and signature, which will appear in his guestbook comments.</span></span> <span data-ttu-id="703d9-193">Há várias maneiras diferentes para fazer isso:</span><span class="sxs-lookup"><span data-stu-id="703d9-193">There are number of different ways to accomplish this:</span></span>

- <span data-ttu-id="703d9-194"><strong>Adicionar novas colunas para o</strong><strong>`aspnet_Users`</strong><strong>ou</strong><strong>`aspnet_Membership`</strong><strong>tabelas.</strong></span><span class="sxs-lookup"><span data-stu-id="703d9-194"><strong>Add new columns to the</strong><strong>`aspnet_Users`</strong><strong>or</strong><strong>`aspnet_Membership`</strong><strong>tables.</strong></span></span> <span data-ttu-id="703d9-195">Não recomendo essa abordagem porque ele modifica o esquema usado pelo `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="703d9-195">I would not recommend this approach because it modifies the schema used by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="703d9-196">Essa decisão pode se voltar contra você ao longo do caminho.</span><span class="sxs-lookup"><span data-stu-id="703d9-196">This decision may come back to haunt you down the road.</span></span> <span data-ttu-id="703d9-197">Por exemplo, se uma versão futura do ASP.NET usa outro `SqlMembershipProvider` esquema.</span><span class="sxs-lookup"><span data-stu-id="703d9-197">For example, what if a future version of ASP.NET uses a different `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="703d9-198">A Microsoft pode incluir uma ferramenta para migrar do ASP.NET 2.0 `SqlMembershipProvider` dados para o novo esquema, mas se você tiver modificado o ASP.NET 2.0 `SqlMembershipProvider` esquema, essa conversão pode não ser possível.</span><span class="sxs-lookup"><span data-stu-id="703d9-198">Microsoft may include a tool to migrate the ASP.NET 2.0 `SqlMembershipProvider` data to the new schema, but if you have modified the ASP.NET 2.0 `SqlMembershipProvider` schema, such a conversion may not be possible.</span></span>

- <span data-ttu-id="703d9-199">**Use o ASP. Framework de perfil da rede, definindo uma propriedade de perfil para a cidade, a home page e a assinatura.**</span><span class="sxs-lookup"><span data-stu-id="703d9-199">**Use ASP.NET's Profile framework, defining a profile property for the home town, homepage, and signature.**</span></span> <span data-ttu-id="703d9-200">O ASP.NET inclui uma estrutura de perfil que foi projetada para armazenar dados específicos de usuário adicionais.</span><span class="sxs-lookup"><span data-stu-id="703d9-200">ASP.NET includes a Profile framework that is designed to store additional user-specific data.</span></span> <span data-ttu-id="703d9-201">Como a estrutura de associação, a estrutura de perfil foi criada sobre o modelo de provedor.</span><span class="sxs-lookup"><span data-stu-id="703d9-201">Like the Membership framework, the Profile framework is built atop the provider model.</span></span> <span data-ttu-id="703d9-202">O .NET Framework vem com um `SqlProfileProvider` desaparecem armazena dados de perfil em um banco de dados do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="703d9-202">The .NET Framework ships with a `SqlProfileProvider` sthat stores profile data in a SQL Server database.</span></span> <span data-ttu-id="703d9-203">Na verdade, nosso banco de dados já tem a tabela usada pelo `SqlProfileProvider` (`aspnet_Profile`), como ele foi adicionado quando adicionamos os serviços de aplicativo de volta a <a id="_msoanchor_2"> </a> [ *criar o esquema de associação no SQL Servidor* ](creating-the-membership-schema-in-sql-server-cs.md) tutorial.</span><span class="sxs-lookup"><span data-stu-id="703d9-203">In fact, our database already has the table used by the `SqlProfileProvider` (`aspnet_Profile`), as it was added when we added the application services back in the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) tutorial.</span></span>   
  <span data-ttu-id="703d9-204">O principal benefício do framework de perfil é que ela permite aos desenvolvedores definir as propriedades de perfil no `Web.config` – nenhum código precisa ser escrito para serializar os dados de perfil de e para o armazenamento de dados subjacente.</span><span class="sxs-lookup"><span data-stu-id="703d9-204">The main benefit of the Profile framework is that it allows for developers to define the profile properties in `Web.config` – no code needs to be written to serialize the profile data to and from the underlying data store.</span></span> <span data-ttu-id="703d9-205">Em resumo, é incrivelmente fácil definir um conjunto de propriedades de perfil e trabalhar com eles no código.</span><span class="sxs-lookup"><span data-stu-id="703d9-205">In short, it is incredibly easy to define a set of profile properties and to work with them in code.</span></span> <span data-ttu-id="703d9-206">No entanto, o sistema de perfil deixa muito a desejar quando se trata de controle de versão, portanto, se você tiver um aplicativo em que você espera que novas propriedades específicas do usuário a ser adicionado em um momento posterior, ou os existentes para ser removido ou modificado, em seguida, a estrutura de perfil pode não ser o  melhor opção.</span><span class="sxs-lookup"><span data-stu-id="703d9-206">However, the Profile system leaves a lot to be desired when it comes to versioning, so if you have an application where you expect new user-specific properties to be added at a later time, or existing ones to be removed or modified, then the Profile framework may not be the best option.</span></span> <span data-ttu-id="703d9-207">Além disso, o `SqlProfileProvider` armazena as propriedades de perfil de maneira altamente desnormalizada, tornando praticamente impossível executar consultas diretamente nos dados de perfil (por exemplo, quantos usuários têm uma cidade de Nova York doméstica).</span><span class="sxs-lookup"><span data-stu-id="703d9-207">Moreover, the `SqlProfileProvider` stores the profile properties in a highly denormalized fashion, making it next to impossible to run queries directly against the profile data (such as, how many users have a home town of New York).</span></span>   
  <span data-ttu-id="703d9-208">Para obter mais informações sobre a estrutura de perfil, consulte a seção de "Leituras adicionais" no final deste tutorial.</span><span class="sxs-lookup"><span data-stu-id="703d9-208">For more information on the Profile framework, consult the "Further Readings" section at the end of this tutorial.</span></span>

- <span data-ttu-id="703d9-209"><strong>Adicione essas três colunas em uma nova tabela no banco de dados e estabelecer uma relação um para um entre essa tabela e</strong><strong>`aspnet_Users`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="703d9-209"><strong>Add these three columns to a new table in the database and establish a one-to-one relationship between this table and</strong><strong>`aspnet_Users`</strong><strong>.</strong></span></span> <span data-ttu-id="703d9-210">Essa abordagem envolve um pouco mais trabalho do que com o framework de perfil, mas oferece a máxima flexibilidade em como as propriedades adicionais do usuário são modeladas no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-210">This approach involves a bit more work than with the Profile framework, but offers maximum flexibility in how the additional user properties are modeled in the database.</span></span> <span data-ttu-id="703d9-211">Essa é a opção que usaremos neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="703d9-211">This is the option we will use in this tutorial.</span></span>

<span data-ttu-id="703d9-212">Vamos criar uma nova tabela chamada `UserProfiles` para salvar a cidade, a home page e a assinatura para cada usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-212">We will create a new table called `UserProfiles` to save the home town, homepage, and signature for each user.</span></span> <span data-ttu-id="703d9-213">Clique com botão direito na pasta tabelas na janela do Gerenciador de banco de dados e optar por criar uma nova tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-213">Right-click on the Tables folder in the Database Explorer window and choose to create a new table.</span></span> <span data-ttu-id="703d9-214">Nome da coluna da primeira `UserId` e defina seu tipo como `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="703d9-214">Name the first column `UserId` and set its type to `uniqueidentifier`.</span></span> <span data-ttu-id="703d9-215">Não permitir `NULL` valores e marque a coluna como uma chave primária.</span><span class="sxs-lookup"><span data-stu-id="703d9-215">Disallow `NULL` values and mark the column as a primary key.</span></span> <span data-ttu-id="703d9-216">Em seguida, adicione colunas nomeadas: `HomeTown` do tipo `nvarchar(50)`; `HomepageUrl` do tipo `nvarchar(100)`; e a assinatura de tipo `nvarchar(500)`.</span><span class="sxs-lookup"><span data-stu-id="703d9-216">Next, add columns named: `HomeTown` of type `nvarchar(50)`; `HomepageUrl` of type `nvarchar(100)`; and Signature of type `nvarchar(500)`.</span></span> <span data-ttu-id="703d9-217">Cada uma dessas três colunas pode aceitar um `NULL` valor.</span><span class="sxs-lookup"><span data-stu-id="703d9-217">Each of these three columns can accept a `NULL` value.</span></span>


<span data-ttu-id="703d9-218">[![Criar a tabela UserProfiles](storing-additional-user-information-cs/_static/image17.png)](storing-additional-user-information-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-218">[![Create the UserProfiles Table](storing-additional-user-information-cs/_static/image17.png)](storing-additional-user-information-cs/_static/image16.png)</span></span>

<span data-ttu-id="703d9-219">**Figura 6**: Criar o `UserProfiles` tabela ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-219">**Figure 6**: Create the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image18.png))</span></span>


<span data-ttu-id="703d9-220">Salve a tabela e nomeie- `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="703d9-220">Save the table and name it `UserProfiles`.</span></span> <span data-ttu-id="703d9-221">Por fim, estabelecer uma restrição de chave estrangeira entre a `UserProfiles` da tabela `UserId` campo e o `aspnet_Users.UserId` campo.</span><span class="sxs-lookup"><span data-stu-id="703d9-221">Lastly, establish a foreign key constraint between the `UserProfiles` table's `UserId` field and the `aspnet_Users.UserId` field.</span></span> <span data-ttu-id="703d9-222">Como fizemos com a restrição de chave estrangeira entre a `GuestbookComments` e `aspnet_Users` tabelas, têm essa restrição Propagar exclusões.</span><span class="sxs-lookup"><span data-stu-id="703d9-222">As we did with the foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables, have this constraint cascade deletes.</span></span> <span data-ttu-id="703d9-223">Uma vez que o `UserId` campo `UserProfiles` é o primário chave, isso garante que haverá não mais do que um registro no `UserProfiles` tabela para cada conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-223">Since the `UserId` field in `UserProfiles` is the primary key, this ensures that there will be no more than one record in the `UserProfiles` table for each user account.</span></span> <span data-ttu-id="703d9-224">Esse tipo de relação é chamado como um para um.</span><span class="sxs-lookup"><span data-stu-id="703d9-224">This type of relationship is referred to as one-to-one.</span></span>

<span data-ttu-id="703d9-225">Agora que temos o modelo de dados criado, estamos prontos para usá-lo.</span><span class="sxs-lookup"><span data-stu-id="703d9-225">Now that we have the data model created, we are ready to use it.</span></span> <span data-ttu-id="703d9-226">Nas etapas 2 e 3 vamos examinar como o usuário conectado no momento pode exibir e editar suas informações de cidade, a home page e a assinatura principal.</span><span class="sxs-lookup"><span data-stu-id="703d9-226">In Steps 2 and 3 we will look at how the currently logged on user can view and edit their home town, homepage, and signature information.</span></span> <span data-ttu-id="703d9-227">Etapa 4, vamos criar a interface para usuários autenticados enviar novos comentários para o livro de visitas e exibir os existentes.</span><span class="sxs-lookup"><span data-stu-id="703d9-227">In Step 4 we will create the interface for authenticated users to submit new comments to the guestbook and view the existing ones.</span></span>

## <a name="step-2-displaying-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="703d9-228">Etapa 2: Exibindo a cidade inicial, home page e assinatura do usuário</span><span class="sxs-lookup"><span data-stu-id="703d9-228">Step 2: Displaying the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="703d9-229">Há várias maneiras para permitir que o usuário conectado no momento exibir e editar suas informações de cidade, a home page e a assinatura iniciais.</span><span class="sxs-lookup"><span data-stu-id="703d9-229">There are a variety of ways to allow the currently logged on user to view and edit his home town, homepage, and signature information.</span></span> <span data-ttu-id="703d9-230">Podemos pode criar manualmente a interface do usuário com a caixa de texto e controles de rótulo ou, use um dos controles da Web, como o controle DetailsView de dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-230">We could manually create the user interface with TextBox and Label controls or we could use one of the data Web controls, such as the DetailsView control.</span></span> <span data-ttu-id="703d9-231">Para executar o banco de dados `SELECT` e `UPDATE` instruções poderíamos escrever ADO.NET na classe de code-behind da nossa página de código ou, Alternativamente, empregar uma abordagem declarativa com o SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="703d9-231">To perform the database `SELECT` and `UPDATE` statements we could write ADO.NET code in our page's code-behind class or, alternatively, employ a declarative approach with the SqlDataSource.</span></span> <span data-ttu-id="703d9-232">O ideal é que o nosso aplicativo conteria uma arquitetura em camadas, o que podemos pode invocar por meio de programação de classe de code-behind da página, ou declarativamente por meio do controle ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="703d9-232">Ideally our application would contain a tiered architecture, which we could either invoke programmatically from the page's code-behind class or declaratively via the ObjectDataSource control.</span></span>

<span data-ttu-id="703d9-233">Uma vez que esta série de tutoriais se concentra em formulários de autenticação, autorização, contas de usuário e funções, não haverá uma discussão completa sobre essas opções de acesso de dados diferente ou por que uma arquitetura em camadas é preferível executar instruções SQL diretamente Na página ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="703d9-233">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, there will not be a thorough discussion of these different data access options or why a tiered architecture is preferred over executing SQL statements directly from the ASP.NET page.</span></span> <span data-ttu-id="703d9-234">Vou percorrer usando um DetailsView e SqlDataSource – a opção mais rápida e fácil – mas os conceitos discutidos certamente podem ser aplicados a alternativa lógica de acesso dados e controles da Web.</span><span class="sxs-lookup"><span data-stu-id="703d9-234">I am going to walk through using a DetailsView and SqlDataSource – the quickest and easiest option – but the concepts discussed can certainly be applied to alternative Web controls and data access logic.</span></span> <span data-ttu-id="703d9-235">Para obter mais informações sobre como trabalhar com dados no ASP.NET, consulte a minha *[trabalhando com dados no ASP.NET 2.0](../../data-access/index.md)* série de tutoriais.</span><span class="sxs-lookup"><span data-stu-id="703d9-235">For more information on working with data in ASP.NET, refer to my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="703d9-236">Abrir o `AdditionalUserInfo.aspx` página na `Membership` pasta e adicione um controle DetailsView para a página, definindo seu `ID` propriedade a ser `UserProfile` e limpeza dos seu `Width` e `Height` propriedades.</span><span class="sxs-lookup"><span data-stu-id="703d9-236">Open the `AdditionalUserInfo.aspx` page in the `Membership` folder and add a DetailsView control to the page, setting its `ID` property to `UserProfile` and clearing out its `Width` and `Height` properties.</span></span> <span data-ttu-id="703d9-237">Expanda de marca de DetailsView inteligente e escolha vinculá-la a um novo controle de fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-237">Expand the DetailsView's Smart Tag and choose to bind it to a new data source control.</span></span> <span data-ttu-id="703d9-238">Isso iniciará o Assistente de configuração de fonte de dados (veja a Figura 7).</span><span class="sxs-lookup"><span data-stu-id="703d9-238">This will launch the DataSource Configuration Wizard (see Figure 7).</span></span> <span data-ttu-id="703d9-239">A primeira etapa solicitará que você especifique o tipo de fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-239">The first step asks you to specify the data source type.</span></span> <span data-ttu-id="703d9-240">Já que vamos para se conectar diretamente para o `SecurityTutorials` banco de dados, escolha o ícone de banco de dados, especificando o `ID` como `UserProfileDataSource`.</span><span class="sxs-lookup"><span data-stu-id="703d9-240">Since we are going to connect directly to the `SecurityTutorials` database, choose the Database icon, specifying the `ID` as `UserProfileDataSource`.</span></span>


<span data-ttu-id="703d9-241">[![Adicionar um novo controle SqlDataSource chamado UserProfileDataSource](storing-additional-user-information-cs/_static/image20.png)](storing-additional-user-information-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-241">[![Add a New SqlDataSource Control Named UserProfileDataSource](storing-additional-user-information-cs/_static/image20.png)](storing-additional-user-information-cs/_static/image19.png)</span></span>

<span data-ttu-id="703d9-242">**Figura 7**: Adicionar um controle SqlDataSource novo chamado `UserProfileDataSource` ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-242">**Figure 7**: Add a New SqlDataSource Control Named `UserProfileDataSource` ([Click to view full-size image](storing-additional-user-information-cs/_static/image21.png))</span></span>


<span data-ttu-id="703d9-243">A próxima tela solicita o banco de dados usar.</span><span class="sxs-lookup"><span data-stu-id="703d9-243">The next screen prompts for the database to use.</span></span> <span data-ttu-id="703d9-244">Nós já definimos uma cadeia de caracteres de conexão no `Web.config` para o `SecurityTutorials` banco de dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-244">We have already defined a connection string in `Web.config` for the `SecurityTutorials` database.</span></span> <span data-ttu-id="703d9-245">Esse nome de cadeia de caracteres de conexão – `SecurityTutorialsConnectionString` – devem estar na lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="703d9-245">This connection string name – `SecurityTutorialsConnectionString` – should be in the drop-down list.</span></span> <span data-ttu-id="703d9-246">Selecione esta opção e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="703d9-246">Select this option and click Next.</span></span>


<span data-ttu-id="703d9-247">[![Escolha SecurityTutorialsConnectionString na lista suspensa](storing-additional-user-information-cs/_static/image23.png)](storing-additional-user-information-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-247">[![Choose SecurityTutorialsConnectionString from the Drop-Down List](storing-additional-user-information-cs/_static/image23.png)](storing-additional-user-information-cs/_static/image22.png)</span></span>

<span data-ttu-id="703d9-248">**Figura 8**: Escolher `SecurityTutorialsConnectionString` na lista suspensa ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-248">**Figure 8**: Choose `SecurityTutorialsConnectionString` from the Drop-Down List  ([Click to view full-size image](storing-additional-user-information-cs/_static/image24.png))</span></span>


<span data-ttu-id="703d9-249">A tela subsequente nos pede para especificar a tabela e colunas à consulta.</span><span class="sxs-lookup"><span data-stu-id="703d9-249">The subsequent screen asks us to specify the table and columns to query.</span></span> <span data-ttu-id="703d9-250">Escolha o `UserProfiles` de tabela na lista suspensa e verificar todas as colunas.</span><span class="sxs-lookup"><span data-stu-id="703d9-250">Choose the `UserProfiles` table from the drop-down list and check all of the columns.</span></span>


<span data-ttu-id="703d9-251">[![Trazer de volta todas as colunas da tabela UserProfiles](storing-additional-user-information-cs/_static/image26.png)](storing-additional-user-information-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-251">[![Bring Back All of the Columns from the UserProfiles Table](storing-additional-user-information-cs/_static/image26.png)](storing-additional-user-information-cs/_static/image25.png)</span></span>

<span data-ttu-id="703d9-252">**Figura 9**: Trazer de volta todas as colunas dos `UserProfiles` tabela ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-252">**Figure 9**: Bring Back All of the Columns from the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image27.png))</span></span>


<span data-ttu-id="703d9-253">A consulta atual na Figura 9 retorna *todos os* dos registros no `UserProfiles`, mas estamos interessados apenas no registro do usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="703d9-253">The current query in Figure 9 returns *all* of the records in `UserProfiles`, but we are only interested in the currently logged on user's record.</span></span> <span data-ttu-id="703d9-254">Para adicionar um `WHERE` cláusula, clique em de `WHERE` botão para abrir a adicionar `WHERE` caixa de diálogo de cláusula (veja a Figura 10).</span><span class="sxs-lookup"><span data-stu-id="703d9-254">To add a `WHERE` clause, click the `WHERE` button to bring up the Add `WHERE` Clause dialog box (see Figure 10).</span></span> <span data-ttu-id="703d9-255">Aqui você pode selecionar a coluna para filtrar, o operador e a origem do parâmetro de filtro.</span><span class="sxs-lookup"><span data-stu-id="703d9-255">Here you can select the column to filter on, the operator, and the source of the filter parameter.</span></span> <span data-ttu-id="703d9-256">Selecione `UserId` como a coluna e "=" como o operador.</span><span class="sxs-lookup"><span data-stu-id="703d9-256">Select `UserId` as the column and "=" as the Operator.</span></span>

<span data-ttu-id="703d9-257">Infelizmente não há nenhuma fonte de parâmetro interno para retornar o usuário conectado no momento `UserId` valor.</span><span class="sxs-lookup"><span data-stu-id="703d9-257">Unfortunately there is no built-in parameter source to return the currently logged on user's `UserId` value.</span></span> <span data-ttu-id="703d9-258">Precisamos pegar esse valor por meio de programação.</span><span class="sxs-lookup"><span data-stu-id="703d9-258">We will need to grab this value programmatically.</span></span> <span data-ttu-id="703d9-259">Portanto, defina a lista suspensa de origem para "None", clique em Adicionar botão para adicionar o parâmetro e, em seguida, clique em Okey.</span><span class="sxs-lookup"><span data-stu-id="703d9-259">Therefore, set the Source drop-down list to "None," click the Add button to add the parameter, and then click OK.</span></span>


<span data-ttu-id="703d9-260">[![Adicionar um parâmetro de filtro na coluna de ID de usuário](storing-additional-user-information-cs/_static/image29.png)](storing-additional-user-information-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-260">[![Add a Filter Parameter on the UserId Column](storing-additional-user-information-cs/_static/image29.png)](storing-additional-user-information-cs/_static/image28.png)</span></span>

<span data-ttu-id="703d9-261">**Figura 10**: Adicionar um parâmetro de filtro sobre o `UserId` coluna ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-261">**Figure 10**: Add a Filter Parameter on the `UserId` Column  ([Click to view full-size image](storing-additional-user-information-cs/_static/image30.png))</span></span>


<span data-ttu-id="703d9-262">Depois de clicar em Okey, você voltará para a tela mostrada na Figura 9.</span><span class="sxs-lookup"><span data-stu-id="703d9-262">After clicking OK you will be returned to the screen shown in Figure 9.</span></span> <span data-ttu-id="703d9-263">Neste momento, no entanto, a consulta SQL na parte inferior da tela deve incluir um `WHERE` cláusula.</span><span class="sxs-lookup"><span data-stu-id="703d9-263">This time, however, the SQL query at the bottom of the screen should include a `WHERE` clause.</span></span> <span data-ttu-id="703d9-264">Clique em Avançar para passar para a tela de "Consulta de teste".</span><span class="sxs-lookup"><span data-stu-id="703d9-264">Click Next to move on to the "Test Query" screen.</span></span> <span data-ttu-id="703d9-265">Aqui você pode executar a consulta e ver os resultados.</span><span class="sxs-lookup"><span data-stu-id="703d9-265">Here you can run the query and see the results.</span></span> <span data-ttu-id="703d9-266">Clique em Concluir para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="703d9-266">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="703d9-267">Após concluir o Assistente de configuração de fonte de dados, o Visual Studio cria o controle SqlDataSource com base nas configurações especificadas no assistente.</span><span class="sxs-lookup"><span data-stu-id="703d9-267">Upon completing the DataSource Configuration Wizard, Visual Studio creates the SqlDataSource control based on the settings specified in the wizard.</span></span> <span data-ttu-id="703d9-268">Além disso, ele adiciona manualmente BoundFields a DetailsView para cada coluna retornada pelo SqlDataSource `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="703d9-268">Moreover, it manually adds BoundFields to the DetailsView for each column returned by the SqlDataSource's `SelectCommand`.</span></span> <span data-ttu-id="703d9-269">Não é necessário para mostrar o `UserId` campo DetailsView, uma vez que o usuário não precisa saber esse valor.</span><span class="sxs-lookup"><span data-stu-id="703d9-269">There's no need to show the `UserId` field in the DetailsView, since the user does not need to know this value.</span></span> <span data-ttu-id="703d9-270">Você pode remover esse campo diretamente na marcação declarativa do controle DetailsView ou clicando em "Editar campos" link da sua marca inteligente.</span><span class="sxs-lookup"><span data-stu-id="703d9-270">You can remove this field directly from the DetailsView control's declarative markup or by clicking the "Edit Fields" link from its Smart Tag.</span></span>

<span data-ttu-id="703d9-271">Neste ponto marcação declarativa de sua página deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="703d9-271">At this point your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample1.aspx)]

<span data-ttu-id="703d9-272">Precisamos definir programaticamente do controle SqlDataSource `UserId` parâmetro para o usuário conectado no momento `UserId` antes que os dados são selecionados.</span><span class="sxs-lookup"><span data-stu-id="703d9-272">We need to programmatically set the SqlDataSource control's `UserId` parameter to the currently logged in user's `UserId` before the data is selected.</span></span> <span data-ttu-id="703d9-273">Isso pode ser feito criando um manipulador de eventos para o SqlDataSource `Selecting` eventos e adicionando o seguinte código lá:</span><span class="sxs-lookup"><span data-stu-id="703d9-273">This can be accomplished by creating an event handler for the SqlDataSource's `Selecting` event and adding the following code there:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample2.cs)]

<span data-ttu-id="703d9-274">O código acima começa obtendo uma referência para o usuário conectado no momento chamando o `Membership` da classe `GetUser` método.</span><span class="sxs-lookup"><span data-stu-id="703d9-274">The above code starts by obtaining a reference to the currently logged on user by calling the `Membership` class's `GetUser` method.</span></span> <span data-ttu-id="703d9-275">Isso retorna um `MembershipUser` do objeto, cuja `ProviderUserKey` propriedade contém o `UserId`.</span><span class="sxs-lookup"><span data-stu-id="703d9-275">This returns a `MembershipUser` object, whose `ProviderUserKey` property contains the `UserId`.</span></span> <span data-ttu-id="703d9-276">O `UserId` valor é então atribuído para o SqlDataSource `@UserId` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="703d9-276">The `UserId` value is then assigned to the SqlDataSource's `@UserId` parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="703d9-277">O `Membership.GetUser()` método retorna informações sobre o usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="703d9-277">The `Membership.GetUser()` method returns information about the currently logged on user.</span></span> <span data-ttu-id="703d9-278">Se um usuário anônimo está visitando a página, ela retornará um valor de `null`.</span><span class="sxs-lookup"><span data-stu-id="703d9-278">If an anonymous user is visiting the page, it will return a value of `null`.</span></span> <span data-ttu-id="703d9-279">Nesse caso, isso levará a um `NullReferenceException` na linha seguinte do código ao tentar ler o `ProviderUserKey` propriedade.</span><span class="sxs-lookup"><span data-stu-id="703d9-279">In such a case, this will lead to a `NullReferenceException` on the following line of code when attempting to read the `ProviderUserKey` property.</span></span> <span data-ttu-id="703d9-280">Claro, nós não precisa se preocupar sobre `Membership.GetUser()` retornando um `null` o valor a `AdditionalUserInfo.aspx` página como configuramos a autorização de URL em um tutorial anterior para que somente usuários autenticados poderiam acessar os recursos do ASP.NET nessa pasta.</span><span class="sxs-lookup"><span data-stu-id="703d9-280">Of course, we don't have to worry about `Membership.GetUser()` returning a `null` value in the `AdditionalUserInfo.aspx` page because we configured URL authorization in a previous tutorial so that only authenticated users could access the ASP.NET resources in this folder.</span></span> <span data-ttu-id="703d9-281">Se você precisar acessar informações sobre o usuário conectado no momento em uma página em que o acesso anônimo é permitido, certifique-se de verificar se um não -`null MembershipUser` objeto é retornado do `GetUser()` método antes de fazer referência a suas propriedades.</span><span class="sxs-lookup"><span data-stu-id="703d9-281">If you need to access information about the currently logged on user in a page where anonymous access is permitted, make sure to check that a non-`null MembershipUser` object is returned from the `GetUser()` method before referencing its properties.</span></span>


<span data-ttu-id="703d9-282">Se você visitar o `AdditionalUserInfo.aspx` página por meio de um navegador você verá uma página em branco porque ainda precisamos adicionar linhas a serem o `UserProfiles` tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-282">If you visit the `AdditionalUserInfo.aspx` page through a browser you will see a blank page because we have yet to add any rows to the `UserProfiles` table.</span></span> <span data-ttu-id="703d9-283">Na etapa 6, vamos examinar como personalizar o controle CreateUserWizard para adicionar automaticamente uma nova linha para o `UserProfiles` tabela quando uma nova conta de usuário é criada.</span><span class="sxs-lookup"><span data-stu-id="703d9-283">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span> <span data-ttu-id="703d9-284">Por enquanto, no entanto, precisamos criar manualmente um registro na tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-284">For now, however, we will need to manually create a record in the table.</span></span>

<span data-ttu-id="703d9-285">Navegue até o Gerenciador de banco de dados no Visual Studio e expanda a pasta de tabelas.</span><span class="sxs-lookup"><span data-stu-id="703d9-285">Navigate to the Database Explorer in Visual Studio and expand the Tables folder.</span></span> <span data-ttu-id="703d9-286">Clique com botão direito no `aspnet_Users` tabela e escolha "Mostrar dados da tabela" para ver os registros na tabela; para fazer a mesma coisa o `UserProfiles` tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-286">Right-click on the `aspnet_Users` table and choose "Show Table Data" to see the records in the table; do the same thing for the `UserProfiles` table.</span></span> <span data-ttu-id="703d9-287">Figura 11 mostra estes resultados quando o lado a lado verticalmente.</span><span class="sxs-lookup"><span data-stu-id="703d9-287">Figure 11 shows these results when tiled vertically.</span></span> <span data-ttu-id="703d9-288">No meu banco de dados atualmente, há `aspnet_Users` registros de Bruce, Fred e Tito, mas não há registros no `UserProfiles` tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-288">In my database there are currently `aspnet_Users` records for Bruce, Fred, and Tito, but no records in the `UserProfiles` table.</span></span>


<span data-ttu-id="703d9-289">[![O conteúdo do aspnet_Users e UserProfiles tabelas são exibidas](storing-additional-user-information-cs/_static/image32.png)](storing-additional-user-information-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-289">[![The Contents of the aspnet_Users and UserProfiles Tables are Displayed](storing-additional-user-information-cs/_static/image32.png)](storing-additional-user-information-cs/_static/image31.png)</span></span>

<span data-ttu-id="703d9-290">**Figura 11**: O conteúdo a `aspnet_Users` e `UserProfiles` tabelas são exibidas ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-290">**Figure 11**: The Contents of the `aspnet_Users` and `UserProfiles` Tables are Displayed  ([Click to view full-size image](storing-additional-user-information-cs/_static/image33.png))</span></span>


<span data-ttu-id="703d9-291">Adicione um novo registro para o `UserProfiles` tabela digitando manualmente valores para o `HomeTown`, `HomepageUrl`, e `Signature` campos.</span><span class="sxs-lookup"><span data-stu-id="703d9-291">Add a new record to the `UserProfiles` table by manually typing in values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span> <span data-ttu-id="703d9-292">A maneira mais fácil de obter válida `UserId` valor no novo `UserProfiles` registro é selecionar o `UserId` campo de uma conta de usuário específico no `aspnet_Users` de tabela e copie e cole-o na `UserId` campo `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="703d9-292">The easiest way to get a valid `UserId` value in the new `UserProfiles` record is to select the `UserId` field from a particular user account in the `aspnet_Users` table and copy and paste it into the `UserId` field in `UserProfiles`.</span></span> <span data-ttu-id="703d9-293">A Figura 12 mostra o `UserProfiles` depois que foi adicionado a um novo registro de Bruce de tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-293">Figure 12 shows the `UserProfiles` table after a new record has been added for Bruce.</span></span>


<span data-ttu-id="703d9-294">[![Um registro foi adicionado ao UserProfiles para Bruce](storing-additional-user-information-cs/_static/image35.png)](storing-additional-user-information-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-294">[![A Record was Added to UserProfiles for Bruce](storing-additional-user-information-cs/_static/image35.png)](storing-additional-user-information-cs/_static/image34.png)</span></span>

<span data-ttu-id="703d9-295">**Figura 12**: Um registro foi adicionado ao `UserProfiles` de Bruce ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-295">**Figure 12**: A Record was Added to `UserProfiles` for Bruce  ([Click to view full-size image](storing-additional-user-information-cs/_static/image36.png))</span></span>


<span data-ttu-id="703d9-296">Volte para o `AdditionalUserInfo.aspx` página, conectada como Bruce.</span><span class="sxs-lookup"><span data-stu-id="703d9-296">Return to the `AdditionalUserInfo.aspx` page, logged in as Bruce.</span></span> <span data-ttu-id="703d9-297">Como mostra a Figura 13, configurações de Bruce são exibidas.</span><span class="sxs-lookup"><span data-stu-id="703d9-297">As Figure 13 shows, Bruce's settings are displayed.</span></span>


<span data-ttu-id="703d9-298">[![O usuário no momento, visitando é mostrado His configurações](storing-additional-user-information-cs/_static/image38.png)](storing-additional-user-information-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-298">[![The Currently Visiting User is Shown His Settings](storing-additional-user-information-cs/_static/image38.png)](storing-additional-user-information-cs/_static/image37.png)</span></span>

<span data-ttu-id="703d9-299">**Figura 13**: O usuário no momento, visitando é mostrado configurações His ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-299">**Figure 13**: The Currently Visiting User is Shown His Settings  ([Click to view full-size image](storing-additional-user-information-cs/_static/image39.png))</span></span>


> [!NOTE]
> <span data-ttu-id="703d9-300">Vá em frente e manualmente adicione registros no `UserProfiles` tabela para cada usuário da associação.</span><span class="sxs-lookup"><span data-stu-id="703d9-300">Go ahead and manually add records in the `UserProfiles` table for each Membership user.</span></span> <span data-ttu-id="703d9-301">Na etapa 6, vamos examinar como personalizar o controle CreateUserWizard para adicionar automaticamente uma nova linha para o `UserProfiles` tabela quando uma nova conta de usuário é criada.</span><span class="sxs-lookup"><span data-stu-id="703d9-301">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span>


## <a name="step-3-allowing-the-user-to-edit-his-home-town-homepage-and-signature"></a><span data-ttu-id="703d9-302">Etapa 3: Permitindo que o usuário edite sua cidade inicial, a home page e a assinatura</span><span class="sxs-lookup"><span data-stu-id="703d9-302">Step 3: Allowing the User to Edit His Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="703d9-303">Neste momento o usuário conectado no momento pode exibir sua cidade, home page e configuração de assinatura, mas eles ainda não é possível modificá-los.</span><span class="sxs-lookup"><span data-stu-id="703d9-303">At this point the currently logged in user can view their home town, homepage, and signature setting, but they cannot yet modify them.</span></span> <span data-ttu-id="703d9-304">Vamos atualizar o controle DetailsView para que os dados podem ser editados.</span><span class="sxs-lookup"><span data-stu-id="703d9-304">Let's update the DetailsView control so that the data can be edited.</span></span>

<span data-ttu-id="703d9-305">A primeira coisa que precisamos fazer é adicionar um `UpdateCommand` para o SqlDataSource, especificando o `UPDATE` instrução a ser executada e seus parâmetros correspondentes.</span><span class="sxs-lookup"><span data-stu-id="703d9-305">The first thing we need to do is add an `UpdateCommand` for the SqlDataSource, specifying the `UPDATE` statement to execute and its corresponding parameters.</span></span> <span data-ttu-id="703d9-306">Selecione o SqlDataSource e, na janela Propriedades, clique na elipse ao lado da propriedade UpdateQuery para abrir a caixa de diálogo Editor de comando e parâmetro.</span><span class="sxs-lookup"><span data-stu-id="703d9-306">Select the SqlDataSource and, from the Properties window, click on the ellipses next to the UpdateQuery property to bring up the Command and Parameter Editor dialog box.</span></span> <span data-ttu-id="703d9-307">Insira o seguinte `UPDATE` instrução na caixa de texto:</span><span class="sxs-lookup"><span data-stu-id="703d9-307">Enter the following `UPDATE` statement into the textbox:</span></span>

[!code-sql[Main](storing-additional-user-information-cs/samples/sample3.sql)]

<span data-ttu-id="703d9-308">Em seguida, clique no botão "Atualizar parâmetros", que criará um parâmetro no controle do SqlDataSource `UpdateParameters` coleção para cada um dos parâmetros no `UPDATE` instrução.</span><span class="sxs-lookup"><span data-stu-id="703d9-308">Next, click the "Refresh Parameters" button, which will create a parameter in the SqlDataSource control's `UpdateParameters` collection for each of the parameters in the `UPDATE` statement.</span></span> <span data-ttu-id="703d9-309">Deixe a fonte para todos os parâmetros como None e clique no botão Okey para concluir a caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="703d9-309">Leave the source for all of the parameters set to None and click the OK button to complete the dialog box.</span></span>


<span data-ttu-id="703d9-310">[![Especifique o SqlDataSource UpdateCommand e UpdateParameters](storing-additional-user-information-cs/_static/image41.png)](storing-additional-user-information-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-310">[![Specify the SqlDataSource's UpdateCommand and UpdateParameters](storing-additional-user-information-cs/_static/image41.png)](storing-additional-user-information-cs/_static/image40.png)</span></span>

<span data-ttu-id="703d9-311">**Figura 14**: Especifique o SqlDataSource `UpdateCommand` e `UpdateParameters` ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-311">**Figure 14**: Specify the SqlDataSource's `UpdateCommand` and `UpdateParameters` ([Click to view full-size image](storing-additional-user-information-cs/_static/image42.png))</span></span>


<span data-ttu-id="703d9-312">Devido às adições que fizemos para o controle SqlDataSource, DetailsView controle pode oferecer suporte a edição.</span><span class="sxs-lookup"><span data-stu-id="703d9-312">Due to the additions we made to the SqlDataSource control, the DetailsView control can now support editing.</span></span> <span data-ttu-id="703d9-313">Na marca inteligente de DetailsView, marque a caixa de seleção "Habilitar edição".</span><span class="sxs-lookup"><span data-stu-id="703d9-313">From the DetailsView's Smart Tag, check the "Enable Editing" checkbox.</span></span> <span data-ttu-id="703d9-314">Isso adiciona um CommandField para o controle `Fields` coleção com seu `ShowEditButton` propriedade definida como True.</span><span class="sxs-lookup"><span data-stu-id="703d9-314">This adds a CommandField to the control's `Fields` collection with its `ShowEditButton` property set to True.</span></span> <span data-ttu-id="703d9-315">Isso renderiza um botão de edição quando DetailsView é exibido no modo somente leitura e atualização e botões de cancelamento quando exibido no modo de edição.</span><span class="sxs-lookup"><span data-stu-id="703d9-315">This renders an Edit button when the DetailsView is displayed in read-only mode and Update and Cancel buttons when displayed in edit mode.</span></span> <span data-ttu-id="703d9-316">Em vez de exigir que o usuário clique em Editar, no entanto, podemos ter renderização DetailsView em um estado "sempre editável", definindo o controle de DetailsView [ `DefaultMode` propriedade](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) para `Edit`.</span><span class="sxs-lookup"><span data-stu-id="703d9-316">Rather than requiring the user to click Edit, though, we can have the DetailsView render in an "always editable" state by setting the DetailsView control's [`DefaultMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) to `Edit`.</span></span>

<span data-ttu-id="703d9-317">Com essas alterações, a marcação declarativa do seu controle DetailsView deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="703d9-317">With these changes, your DetailsView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample4.aspx)]

<span data-ttu-id="703d9-318">Observe a adição do CommandField e o `DefaultMode` propriedade.</span><span class="sxs-lookup"><span data-stu-id="703d9-318">Note the addition of the CommandField and the `DefaultMode` property.</span></span>

<span data-ttu-id="703d9-319">Vá em frente e teste essa página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="703d9-319">Go ahead and test this page through a browser.</span></span> <span data-ttu-id="703d9-320">Ao visitar com um usuário que tem um registro correspondente na `UserProfiles`, as configurações do usuário são exibidas em uma interface editável.</span><span class="sxs-lookup"><span data-stu-id="703d9-320">When visiting with a user that has a corresponding record in `UserProfiles`, the user's settings are displayed in an editable interface.</span></span>


<span data-ttu-id="703d9-321">[![DetailsView renderiza uma Interface editável](storing-additional-user-information-cs/_static/image44.png)](storing-additional-user-information-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-321">[![The DetailsView Renders an Editable Interface](storing-additional-user-information-cs/_static/image44.png)](storing-additional-user-information-cs/_static/image43.png)</span></span>

<span data-ttu-id="703d9-322">**Figura 15**: DetailsView renderiza uma Interface editável ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-322">**Figure 15**: The DetailsView Renders an Editable Interface  ([Click to view full-size image](storing-additional-user-information-cs/_static/image45.png))</span></span>


<span data-ttu-id="703d9-323">Tente alterar os valores e clicando no botão de atualização.</span><span class="sxs-lookup"><span data-stu-id="703d9-323">Try changing the values and clicking the Update button.</span></span> <span data-ttu-id="703d9-324">Ele aparece como se nada acontecerá.</span><span class="sxs-lookup"><span data-stu-id="703d9-324">It appears as if nothing happens.</span></span> <span data-ttu-id="703d9-325">Há um postback e os valores são salvos no banco de dados, mas não há nenhum feedback visual que ocorreu o salvamento.</span><span class="sxs-lookup"><span data-stu-id="703d9-325">There is a postback and the values are saved to the database, but there's no visual feedback that the save occurred.</span></span>

<span data-ttu-id="703d9-326">Para corrigir isso, retorne ao Visual Studio e adicione um controle de rótulo acima DetailsView.</span><span class="sxs-lookup"><span data-stu-id="703d9-326">To remedy this, return to Visual Studio and add a Label control above the DetailsView.</span></span> <span data-ttu-id="703d9-327">Defina suas `ID` para `SettingsUpdatedMessage`, sua `Text` propriedade como "suas configurações foram atualizadas," e seu `Visible` e `EnableViewState` propriedades para `false`.</span><span class="sxs-lookup"><span data-stu-id="703d9-327">Set its `ID` to `SettingsUpdatedMessage`, its `Text` property to "Your settings have been updated," and its `Visible` and `EnableViewState` properties to `false`.</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample5.aspx)]

<span data-ttu-id="703d9-328">É necessário exibir o `SettingsUpdatedMessage` rotular sempre que DetailsView é atualizado.</span><span class="sxs-lookup"><span data-stu-id="703d9-328">We need to display the `SettingsUpdatedMessage` Label whenever the DetailsView is updated.</span></span> <span data-ttu-id="703d9-329">Para fazer isso, crie um manipulador de eventos para o DetailsView `ItemUpdated` eventos e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="703d9-329">To accomplish this, create an event handler for the DetailsView's `ItemUpdated` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample6.cs)]

<span data-ttu-id="703d9-330">Volte para o `AdditionalUserInfo.aspx` página por meio de um navegador e atualizar os dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-330">Return to the `AdditionalUserInfo.aspx` page through a browser and update the data.</span></span> <span data-ttu-id="703d9-331">Desta vez, será exibida uma mensagem de status úteis.</span><span class="sxs-lookup"><span data-stu-id="703d9-331">This time, a helpful status message is displayed.</span></span>


<span data-ttu-id="703d9-332">[![Uma mensagem curta é exibido quando as configurações são atualizadas](storing-additional-user-information-cs/_static/image47.png)](storing-additional-user-information-cs/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-332">[![A Short Message is Displayed When the Settings are Updated](storing-additional-user-information-cs/_static/image47.png)](storing-additional-user-information-cs/_static/image46.png)</span></span>

<span data-ttu-id="703d9-333">**Figura 16**: Uma mensagem curta é exibida quando as configurações são atualizadas ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-333">**Figure 16**: A Short Message is Displayed When the Settings are Updated  ([Click to view full-size image](storing-additional-user-information-cs/_static/image48.png))</span></span>


> [!NOTE]
> <span data-ttu-id="703d9-334">O controle DetailsView de edição do interface deixa muito a desejar.</span><span class="sxs-lookup"><span data-stu-id="703d9-334">The DetailsView control's editing interface leaves a lot to be desired.</span></span> <span data-ttu-id="703d9-335">Ele usa o tamanho padrão caixas de texto, mas o campo de assinatura provavelmente deve ser uma caixa de texto de várias linha.</span><span class="sxs-lookup"><span data-stu-id="703d9-335">It uses standard-sized textboxes, but the Signature field should probably be a multi-line textbox.</span></span> <span data-ttu-id="703d9-336">Um RegularExpressionValidator deve ser usado para garantir que a URL da home page, se inserido, comece com "http://" ou "https://".</span><span class="sxs-lookup"><span data-stu-id="703d9-336">A RegularExpressionValidator should be used to ensure that the homepage URL, if entered, starts with "http://" or "https://".</span></span> <span data-ttu-id="703d9-337">Além disso, desde DetailsView controle tem seu `DefaultMode` propriedade definida como `Edit`, o botão Cancelar não faz nada.</span><span class="sxs-lookup"><span data-stu-id="703d9-337">Moreover, since the DetailsView control has its `DefaultMode` property set to `Edit`, the Cancel button does not do anything.</span></span> <span data-ttu-id="703d9-338">Ele o devem ser removido ou, quando clicado, redirecione o usuário para alguma outra página (como `~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="703d9-338">It should either be removed or, when clicked, redirect the user to some other page (such as `~/Default.aspx`).</span></span> <span data-ttu-id="703d9-339">Posso deixar essas melhorias como um exercício para o leitor.</span><span class="sxs-lookup"><span data-stu-id="703d9-339">I leave these enhancements as an exercise for the reader.</span></span>


### <a name="adding-a-link-to-theadditionaluserinfoaspxpage-in-the-master-page"></a><span data-ttu-id="703d9-340">Adicionando um Link para o`AdditionalUserInfo.aspx`página na página mestra</span><span class="sxs-lookup"><span data-stu-id="703d9-340">Adding a Link to the`AdditionalUserInfo.aspx`Page in the Master Page</span></span>

<span data-ttu-id="703d9-341">Atualmente, o site não oferece quaisquer links para o `AdditionalUserInfo.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="703d9-341">Currently, the website does not provide any links to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="703d9-342">É a única maneira de acessá-lo inserir a URL da página diretamente na barra de endereços do navegador.</span><span class="sxs-lookup"><span data-stu-id="703d9-342">The only way to reach it is to enter the page's URL directly into the browser's Address bar.</span></span> <span data-ttu-id="703d9-343">Vamos adicionar um link para esta página no `Site.master` página mestra.</span><span class="sxs-lookup"><span data-stu-id="703d9-343">Let's add a link to this page in the `Site.master` master page.</span></span>

<span data-ttu-id="703d9-344">Lembre-se de que a página mestra contém um controle LoginView Web no seu `LoginContent` ContentPlaceHolder que exibe a marcação diferente para os visitantes autenticados e anônimos.</span><span class="sxs-lookup"><span data-stu-id="703d9-344">Recall that the master page contains a LoginView Web control in its `LoginContent` ContentPlaceHolder that displays different markup for authenticated and anonymous visitors.</span></span> <span data-ttu-id="703d9-345">Atualizar do controle LoginView `LoggedInTemplate` para incluir um link para o `AdditionalUserInfo.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="703d9-345">Update the LoginView control's `LoggedInTemplate` to include a link to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="703d9-346">Depois de fazer essas alterações a LoginView marcação declarativa do controle deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="703d9-346">After making these changes the LoginView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample7.aspx)]

<span data-ttu-id="703d9-347">Observe a adição do `lnkUpdateSettings` controle de hiperlink para o `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="703d9-347">Note the addition of the `lnkUpdateSettings` HyperLink control to the `LoggedInTemplate`.</span></span> <span data-ttu-id="703d9-348">Com este link em vigor, os usuários autenticados podem ir rapidamente para a página para exibir e modificar suas configurações de cidade, a home page e a assinatura iniciais.</span><span class="sxs-lookup"><span data-stu-id="703d9-348">With this link in place, authenticated users can quickly jump to the page to view and modify their home town, homepage, and signature settings.</span></span>

## <a name="step-4-adding-new-guestbook-comments"></a><span data-ttu-id="703d9-349">Etapa 4: Adicionando novos comentários de livro de visitas</span><span class="sxs-lookup"><span data-stu-id="703d9-349">Step 4: Adding New Guestbook Comments</span></span>

<span data-ttu-id="703d9-350">O `Guestbook.aspx` página é onde os usuários autenticados podem exibir o livro de visitas e deixe um comentário.</span><span class="sxs-lookup"><span data-stu-id="703d9-350">The `Guestbook.aspx` page is where authenticated users can view the guestbook and leave a comment.</span></span> <span data-ttu-id="703d9-351">Vamos começar criando a interface para adicionar novos comentários de livro de visitas.</span><span class="sxs-lookup"><span data-stu-id="703d9-351">Let's start with creating the interface to add new guestbook comments.</span></span>

<span data-ttu-id="703d9-352">Abra o `Guestbook.aspx` página no Visual Studio e construir uma interface do usuário consiste em dois controles TextBox, um para o assunto do novo comentário e outra para seu corpo.</span><span class="sxs-lookup"><span data-stu-id="703d9-352">Open the `Guestbook.aspx` page in Visual Studio and construct a user interface consisting of two TextBox controls, one for the new comment's subject and one for its body.</span></span> <span data-ttu-id="703d9-353">Defina o controle de caixa de texto primeiro `ID` propriedade para `Subject` e seu `Columns` propriedade para 40; do segundo conjunto `ID` para `Body`, sua `TextMode` para `MultiLine`e seu `Width` e `Rows` as propriedades para "95%" e 8, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="703d9-353">Set the first TextBox control's `ID` property to `Subject` and its `Columns` property to 40; set second's `ID` to `Body`, its `TextMode` to `MultiLine`, and its `Width` and `Rows` properties to "95%" and 8, respectively.</span></span> <span data-ttu-id="703d9-354">Para concluir a interface do usuário, adicione um controle da Web de botão chamado `PostCommentButton` e defina seu `Text` propriedade como "Postar seu comentário".</span><span class="sxs-lookup"><span data-stu-id="703d9-354">To complete the user interface, add a Button Web control named `PostCommentButton` and set its `Text` property to "Post Your Comment".</span></span>

<span data-ttu-id="703d9-355">Como cada comentário do livro de visitas requer um assunto e corpo, adicione um RequiredFieldValidator para cada uma das caixas de texto.</span><span class="sxs-lookup"><span data-stu-id="703d9-355">Since each guestbook comment requires a subject and body, add a RequiredFieldValidator for each of the TextBoxes.</span></span> <span data-ttu-id="703d9-356">Defina a `ValidationGroup` propriedade desses controles para "EnterComment"; da mesma forma, defina a `PostCommentButton` do controle `ValidationGroup` propriedade como "EnterComment".</span><span class="sxs-lookup"><span data-stu-id="703d9-356">Set the `ValidationGroup` property of these controls to "EnterComment"; likewise, set the `PostCommentButton` control's `ValidationGroup` property to "EnterComment".</span></span> <span data-ttu-id="703d9-357">Para obter mais informações sobre o ASP. Controles de validação da rede, check-out [validação do formulário no ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [dissecando os controles de validação no ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)e o [Tutorial de controles de servidor de validação](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) na [W3Schools](http://www.w3schools.com/).</span><span class="sxs-lookup"><span data-stu-id="703d9-357">For more information on ASP.NET's validation controls, check out [Form Validation in ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx), and the [Validation Server Controls Tutorial](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) on [W3Schools](http://www.w3schools.com/).</span></span>

<span data-ttu-id="703d9-358">Depois de elaborar a interface do usuário marcação declarativa de sua página deve ser algo semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="703d9-358">After crafting the user interface your page's declarative markup should look something like the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample8.aspx)]

<span data-ttu-id="703d9-359">Com a interface de usuário completa, nossa próxima tarefa é inserir um novo registro para o `GuestbookComments` tabela quando o `PostCommentButton` é clicado.</span><span class="sxs-lookup"><span data-stu-id="703d9-359">With the user interface complete, our next task is to insert a new record into the `GuestbookComments` table when the `PostCommentButton` is clicked.</span></span> <span data-ttu-id="703d9-360">Isso pode ser feito de várias maneiras: podemos escrever código ADO.NET no botão `Click` manipulador de eventos; podemos pode adicionar um controle SqlDataSource para a página, configurar seu `InsertCommand`e, em seguida, chame seu `Insert` método do `Click` evento manipulador; ou poderíamos criar uma camada intermediária que era responsável por inserir novos comentários de livro de visitas e invocar essa funcionalidade no `Click` manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="703d9-360">This can be accomplished in a number of ways: we can write ADO.NET code in the Button's `Click` event handler; we can add a SqlDataSource control to the page, configure its `InsertCommand`, and then call its `Insert` method from the `Click` event handler; or we could build a middle tier that was responsible for inserting new guestbook comments, and invoke this functionality from the `Click` event handler.</span></span> <span data-ttu-id="703d9-361">Uma vez que analisamos usando um SqlDataSource na etapa 3, vamos usar código ADO.NET aqui.</span><span class="sxs-lookup"><span data-stu-id="703d9-361">Since we looked at using a SqlDataSource in Step 3, let's use ADO.NET code here.</span></span>

> [!NOTE]
> <span data-ttu-id="703d9-362">As classes ADO.NET usadas para acessar programaticamente os dados de um banco de dados do Microsoft SQL Server estão localizadas no `System.Data.SqlClient` namespace.</span><span class="sxs-lookup"><span data-stu-id="703d9-362">The ADO.NET classes used to programmatically access data from a Microsoft SQL Server database are located in the `System.Data.SqlClient` namespace.</span></span> <span data-ttu-id="703d9-363">Talvez seja necessário importar esse namespace para classe de code-behind da sua página (ou seja, `using System.Data.SqlClient;`).</span><span class="sxs-lookup"><span data-stu-id="703d9-363">You may need to import this namespace into your page's code-behind class (i.e., `using System.Data.SqlClient;`).</span></span>


<span data-ttu-id="703d9-364">Crie um manipulador de eventos para o `PostCommentButton`do `Click` evento e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="703d9-364">Create an event handler for the `PostCommentButton`'s `Click` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample9.cs)]

<span data-ttu-id="703d9-365">O `Click` manipulador de eventos é iniciado, verificando se os dados fornecidos pelo usuário são válidos.</span><span class="sxs-lookup"><span data-stu-id="703d9-365">The `Click` event handler starts by checking that the user-supplied data is valid.</span></span> <span data-ttu-id="703d9-366">Se não for, o manipulador de eventos é encerrado antes de inserir um registro.</span><span class="sxs-lookup"><span data-stu-id="703d9-366">If it is not, the event handler exits before inserting a record.</span></span> <span data-ttu-id="703d9-367">Supondo que os dados fornecidos são válidos, o usuário conectado no momento `UserId` valor é recuperado e armazenado no `currentUserId` variável local.</span><span class="sxs-lookup"><span data-stu-id="703d9-367">Assuming the supplied data is valid, the currently logged on user's `UserId` value is retrieved and stored in the `currentUserId` local variable.</span></span> <span data-ttu-id="703d9-368">Esse valor é necessário porque estamos deve fornecer um `UserId` valor ao inserir um registro em `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="703d9-368">This value is needed because we must supply a `UserId` value when inserting a record into `GuestbookComments`.</span></span>

<span data-ttu-id="703d9-369">Depois disso, a conexão de cadeia de caracteres para o `SecurityTutorials` banco de dados é recuperado do `Web.config` e o `INSERT` instrução SQL é especificada.</span><span class="sxs-lookup"><span data-stu-id="703d9-369">Following that, the connection string for the `SecurityTutorials` database is retrieved from `Web.config` and the `INSERT` SQL statement is specified.</span></span> <span data-ttu-id="703d9-370">Um `SqlConnection` objeto, em seguida, é criado e aberto.</span><span class="sxs-lookup"><span data-stu-id="703d9-370">A `SqlConnection` object is then created and opened.</span></span> <span data-ttu-id="703d9-371">Em seguida, uma `SqlCommand` objeto é construído e os valores para os parâmetros usados no `INSERT` da consulta são atribuídos.</span><span class="sxs-lookup"><span data-stu-id="703d9-371">Next, a `SqlCommand` object is constructed and the values for the parameters used in the `INSERT` query are assigned.</span></span> <span data-ttu-id="703d9-372">O `INSERT` instrução será executada e a conexão é fechada.</span><span class="sxs-lookup"><span data-stu-id="703d9-372">The `INSERT` statement is then executed and the connection closed.</span></span> <span data-ttu-id="703d9-373">No final do manipulador de eventos, o `Subject` e `Body` caixas de texto `Text` propriedades são limpos para que os valores do usuário não persistem entre o postback.</span><span class="sxs-lookup"><span data-stu-id="703d9-373">At the end of the event handler, the `Subject` and `Body` TextBoxes' `Text` properties are cleared out so that the user's values are not persisted across the postback.</span></span>

<span data-ttu-id="703d9-374">Vá em frente e testar esta página em um navegador.</span><span class="sxs-lookup"><span data-stu-id="703d9-374">Go ahead and test out this page in a browser.</span></span> <span data-ttu-id="703d9-375">Uma vez que essa página está no `Membership` pasta não está acessível para visitantes anônimos.</span><span class="sxs-lookup"><span data-stu-id="703d9-375">Since this page is in the `Membership` folder it is not accessible to anonymous visitors.</span></span> <span data-ttu-id="703d9-376">Portanto, você precisará fazer logon pela primeira vez (se você ainda não tiver).</span><span class="sxs-lookup"><span data-stu-id="703d9-376">Therefore, you will need to first log on (if you have not already).</span></span> <span data-ttu-id="703d9-377">Insira um valor para o `Subject` e `Body` caixas de texto e clique no `PostCommentButton` botão.</span><span class="sxs-lookup"><span data-stu-id="703d9-377">Enter a value into the `Subject` and `Body` TextBoxes and click the `PostCommentButton` button.</span></span> <span data-ttu-id="703d9-378">Isso fará com que um novo registro a ser adicionado ao `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="703d9-378">This will cause a new record to be added to `GuestbookComments`.</span></span> <span data-ttu-id="703d9-379">No postback, o assunto e corpo fornecido por você são apagados de TextBoxes.</span><span class="sxs-lookup"><span data-stu-id="703d9-379">On postback, the subject and body you provided are wiped from the TextBoxes.</span></span>

<span data-ttu-id="703d9-380">Depois de clicar o `PostCommentButton` botão lá está sem comentários visuais que o comentário foi adicionado ao livro de visitas.</span><span class="sxs-lookup"><span data-stu-id="703d9-380">After clicking the `PostCommentButton` button there is no visual feedback that the comment was added to the guestbook.</span></span> <span data-ttu-id="703d9-381">Ainda precisamos atualizar esta página para exibir os comentários de livro de visitas existente, o que vamos fazer na etapa 5.</span><span class="sxs-lookup"><span data-stu-id="703d9-381">We still need to update this page to display the existing guestbook comments, which we will do in Step 5.</span></span> <span data-ttu-id="703d9-382">Depois que podemos fazer isso, o comentário adicionado apenas será exibida na lista de comentários, fornecer comentários visuais adequados.</span><span class="sxs-lookup"><span data-stu-id="703d9-382">Once we accomplish that, the just-added comment will appear in the list of comments, providing adequate visual feedback.</span></span> <span data-ttu-id="703d9-383">Por enquanto, confirme se o seu comentário do livro de visitas foi salvo, examinando o conteúdo do `GuestbookComments` tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-383">For now, confirm that your guestbook comment was saved by examining the contents of the `GuestbookComments` table.</span></span>

<span data-ttu-id="703d9-384">Figura 17 mostra o conteúdo do `GuestbookComments` após dois comentários foram deixados de tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-384">Figure 17 shows the contents of the `GuestbookComments` table after two comments have been left.</span></span>


<span data-ttu-id="703d9-385">[![Você pode ver os comentários do livro de visitas na tabela GuestbookComments](storing-additional-user-information-cs/_static/image50.png)](storing-additional-user-information-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-385">[![You Can See the Guestbook Comments in the GuestbookComments Table](storing-additional-user-information-cs/_static/image50.png)](storing-additional-user-information-cs/_static/image49.png)</span></span>

<span data-ttu-id="703d9-386">**Figura 17**: Você pode ver comentários no livro de visitas a `GuestbookComments` tabela ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-386">**Figure 17**: You Can See the Guestbook Comments in the `GuestbookComments` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image51.png))</span></span>


> [!NOTE]
> <span data-ttu-id="703d9-387">Se um usuário tentar inserir um comentário de livro de visitas contém potencialmente perigosa marcação – como HTML – ASP.NET irá acionar uma `HttpRequestValidationException`.</span><span class="sxs-lookup"><span data-stu-id="703d9-387">If a user attempts to insert a guestbook comment that contains potentially dangerous markup – such as HTML – ASP.NET will throw an `HttpRequestValidationException`.</span></span> <span data-ttu-id="703d9-388">Para saber mais sobre essa exceção, por que é gerada, e como permitir que os usuários enviem valores potencialmente perigosos, consulte o [white paper de validação de solicitação](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="703d9-388">To learn more about this exception, why it's thrown, and how to permit users to submit potentially dangerous values, consult the [Request Validation Whitepaper](../../../../whitepapers/request-validation.md).</span></span>


## <a name="step-5-listing-the-existing-guestbook-comments"></a><span data-ttu-id="703d9-389">Etapa 5: Listando os comentários existentes do livro de visitas</span><span class="sxs-lookup"><span data-stu-id="703d9-389">Step 5: Listing the Existing Guestbook Comments</span></span>

<span data-ttu-id="703d9-390">Além de deixar comentários, um usuário visitar o `Guestbook.aspx` página também deve ser capaz de exibir os comentários existentes do livro de visitas.</span><span class="sxs-lookup"><span data-stu-id="703d9-390">In addition to leaving comments, a user visiting the `Guestbook.aspx` page should also be able to view the guestbook's existing comments.</span></span> <span data-ttu-id="703d9-391">Para fazer isso, adicione um controle ListView chamado `CommentList` na parte inferior da página.</span><span class="sxs-lookup"><span data-stu-id="703d9-391">To accomplish this, add a ListView control named `CommentList` to the bottom of the page.</span></span>

> [!NOTE]
> <span data-ttu-id="703d9-392">O controle ListView é novo para o ASP.NET versão 3.5.</span><span class="sxs-lookup"><span data-stu-id="703d9-392">The ListView control is new to ASP.NET version 3.5.</span></span> <span data-ttu-id="703d9-393">Ele é projetado para exibir uma lista de itens em um layout bastante personalizável e flexível, e ainda oferecem ainda internos editando, inserindo, excluindo, paginação e classificação funcionalidades como GridView.</span><span class="sxs-lookup"><span data-stu-id="703d9-393">It is designed to display a list of items in a very customizable and flexible layout, yet still offer built-in editing, inserting, deleting, paging, and sorting functionality like the GridView.</span></span> <span data-ttu-id="703d9-394">Se você estiver usando o ASP.NET 2.0, você precisará usar o controle DataList ou Repeater em vez disso.</span><span class="sxs-lookup"><span data-stu-id="703d9-394">If you are using ASP.NET 2.0, you will need to use the DataList or Repeater control instead.</span></span> <span data-ttu-id="703d9-395">Para obter mais informações sobre como usar o ListView, consulte [Scott Guthrie](https://weblogs.asp.net/scottgu/)da entrada de blog [controle asp: ListView](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)e o meu artigo [exibindo dados com o controle ListView](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="703d9-395">For more information on using the ListView, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry, [The asp:ListView Control](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx), and my article, [Displaying Data with the ListView Control](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span></span>


<span data-ttu-id="703d9-396">Abrir de marca do ListView inteligente e, na lista suspensa Escolher fonte de dados, associar o controle para uma nova fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-396">Open the ListView's Smart Tag and, from the Choose Data Source drop-down list, bind the control to a new data source.</span></span> <span data-ttu-id="703d9-397">Como vimos na etapa 2, isso iniciará o Assistente de configuração de fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-397">As we saw in Step 2, this will launch the Data Source Configuration Wizard.</span></span> <span data-ttu-id="703d9-398">Selecione o ícone de banco de dados, nomeie o SqlDataSource resultante `CommentsDataSource`e clique em Okey.</span><span class="sxs-lookup"><span data-stu-id="703d9-398">Select the Database icon, name the resulting SqlDataSource `CommentsDataSource`, and click OK.</span></span> <span data-ttu-id="703d9-399">Em seguida, selecione o `SecurityTutorialsConnectionString` conexão da cadeia de caracteres da lista suspensa e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="703d9-399">Next, select the `SecurityTutorialsConnectionString` connection string from the drop-down list and click Next.</span></span>

<span data-ttu-id="703d9-400">Nesse ponto na etapa 2 especificamos os dados para consulta pela separação de `UserProfiles` de tabela na lista suspensa e selecionar as colunas para retornar (consulte novamente a Figura 9).</span><span class="sxs-lookup"><span data-stu-id="703d9-400">At this point in Step 2 we specified the data to query by picking the `UserProfiles` table from the drop-down list and selecting the columns to return (refer back to Figure 9).</span></span> <span data-ttu-id="703d9-401">Neste momento, no entanto, queremos criar uma instrução SQL que efetua pull de não apenas os registros de volta `GuestbookComments`, mas também do autor do comentário cidade, home page, assinatura e nome de usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-401">This time, however, we want to craft a SQL statement that pulls back not only the records from `GuestbookComments`, but also the commenter's home town, homepage, signature, and username.</span></span> <span data-ttu-id="703d9-402">Portanto, selecione o botão de rádio "Especificar uma instrução SQL personalizada ou procedimento armazenado" e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="703d9-402">Therefore, select the "Specify a custom SQL statement or stored procedure" radio button and click Next.</span></span>

<span data-ttu-id="703d9-403">Isso abrirá a tela de "Definir personalizado instruções ou procedimentos armazenados".</span><span class="sxs-lookup"><span data-stu-id="703d9-403">This will bring up the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="703d9-404">Clique no botão Construtor de consultas para compilar graficamente a consulta.</span><span class="sxs-lookup"><span data-stu-id="703d9-404">Click the Query Builder button to graphically build the query.</span></span> <span data-ttu-id="703d9-405">O construtor de consultas começa solicitando que você especifique as tabelas que desejamos consultar.</span><span class="sxs-lookup"><span data-stu-id="703d9-405">The Query Builder starts by prompting us to specify the tables we want to query from.</span></span> <span data-ttu-id="703d9-406">Selecione o `GuestbookComments`, `UserProfiles`, e `aspnet_Users` tabelas e clique em Okey.</span><span class="sxs-lookup"><span data-stu-id="703d9-406">Select the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables and click OK.</span></span> <span data-ttu-id="703d9-407">Isso adicionará todas as três tabelas à superfície de design.</span><span class="sxs-lookup"><span data-stu-id="703d9-407">This will add all three tables to the design surface.</span></span> <span data-ttu-id="703d9-408">Como não há restrições de chave estrangeira entre a `GuestbookComments`, `UserProfiles`, e `aspnet_Users` tabelas, o construtor de consultas automaticamente `JOIN` s essas tabelas.</span><span class="sxs-lookup"><span data-stu-id="703d9-408">Since there are foreign key constraints amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables, the Query Builder automatically `JOIN` s these tables.</span></span>

<span data-ttu-id="703d9-409">Tudo o que resta fazer é especificar as colunas para retornar.</span><span class="sxs-lookup"><span data-stu-id="703d9-409">All that remains is to specify the columns to return.</span></span> <span data-ttu-id="703d9-410">Do `GuestbookComments` select da tabela o `Subject`, `Body`, e `CommentDate` colunas; retornar o `HomeTown`, `HomepageUrl`, e `Signature` colunas da `UserProfiles` tabela; e retornar `UserName` do `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="703d9-410">From the `GuestbookComments` table select the `Subject`, `Body`, and `CommentDate` columns; return the `HomeTown`, `HomepageUrl`, and `Signature` columns from the `UserProfiles` table; and return `UserName` from `aspnet_Users`.</span></span> <span data-ttu-id="703d9-411">Além disso, adicione "`ORDER BY CommentDate DESC`" ao final do `SELECT` consulta para que as postagens mais recentes são retornadas pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="703d9-411">Also, add "`ORDER BY CommentDate DESC`" to the end of the `SELECT` query so that the most recent posts are returned first.</span></span> <span data-ttu-id="703d9-412">Depois de fazer essas seleções, sua interface do construtor de consultas deve ser semelhante para a tela na Figura 18.</span><span class="sxs-lookup"><span data-stu-id="703d9-412">After making these selections, your Query Builder interface should look similar to the screen shot in Figure 18.</span></span>


<span data-ttu-id="703d9-413">[![A consulta de Constructed une as tabelas de aspnet_Users, UserProfiles e GuestbookComments](storing-additional-user-information-cs/_static/image53.png)](storing-additional-user-information-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-413">[![The Constructed Query JOINs the GuestbookComments, UserProfiles, and aspnet_Users Tables](storing-additional-user-information-cs/_static/image53.png)](storing-additional-user-information-cs/_static/image52.png)</span></span>

<span data-ttu-id="703d9-414">**Figura 18**: A consulta construída `JOIN` s a `GuestbookComments`, `UserProfiles`, e `aspnet_Users` tabelas ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-414">**Figure 18**: The Constructed Query `JOIN` s the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` Tables  ([Click to view full-size image](storing-additional-user-information-cs/_static/image54.png))</span></span>


<span data-ttu-id="703d9-415">Clique em Okey para fechar a janela do construtor de consulta e retornar à tela "Definir personalizado instruções ou procedimentos armazenados".</span><span class="sxs-lookup"><span data-stu-id="703d9-415">Click OK to close the Query Builder window and return to the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="703d9-416">Clique em Avançar para ir à tela de "Consulta de teste", onde você pode exibir os resultados da consulta clicando no botão consulta de teste.</span><span class="sxs-lookup"><span data-stu-id="703d9-416">Click Next to advance to the "Test Query" screen, where you may view the query results by clicking the Test Query button.</span></span> <span data-ttu-id="703d9-417">Quando você estiver pronto, clique em Concluir para concluir o Assistente Configurar fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="703d9-417">When you're ready, click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="703d9-418">Quando é concluído o Assistente Configurar fonte de dados do etapa 2, o controle DetailsView associado `Fields` coleção foi atualizada para incluir um BoundField para cada coluna retornada pela `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="703d9-418">When we completed the Configure Data Source wizard in Step 2, the associated DetailsView control's `Fields` collection was updated to include a BoundField for each column returned by the `SelectCommand`.</span></span> <span data-ttu-id="703d9-419">No entanto, o ListView, permanece inalterado; ainda precisamos definir seu layout.</span><span class="sxs-lookup"><span data-stu-id="703d9-419">The ListView, however, remains unchanged; we still need to define its layout.</span></span> <span data-ttu-id="703d9-420">Layout do ListView pode ser construído manualmente por meio de sua marcação declarativa ou na opção "Configurar ListView" em sua marca inteligente.</span><span class="sxs-lookup"><span data-stu-id="703d9-420">The ListView's layout can be constructed manually through its declarative markup or from the "Configure ListView" option in its Smart Tag.</span></span> <span data-ttu-id="703d9-421">Eu geralmente prefiro definir a marcação manualmente, mas usar qualquer método que é mais natural para você.</span><span class="sxs-lookup"><span data-stu-id="703d9-421">I usually prefer defining the markup by hand, but use whatever method is most natural to you.</span></span>

<span data-ttu-id="703d9-422">Eu acabei usando o seguinte `LayoutTemplate`, `ItemTemplate`, e `ItemSeparatorTemplate` do meu controle ListView:</span><span class="sxs-lookup"><span data-stu-id="703d9-422">I ended up using the following `LayoutTemplate`, `ItemTemplate`, and `ItemSeparatorTemplate` for my ListView control:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample10.aspx)]

<span data-ttu-id="703d9-423">O `LayoutTemplate` define a marcação emitidos pelo controle, enquanto o `ItemTemplate` processa cada item retornado pela SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="703d9-423">The `LayoutTemplate` defines the markup emitted by the control, while the `ItemTemplate` renders each item returned by the SqlDataSource.</span></span> <span data-ttu-id="703d9-424">O `ItemTemplate`da marcação resultante é colocada na `LayoutTemplate`do `itemPlaceholder` controle.</span><span class="sxs-lookup"><span data-stu-id="703d9-424">The `ItemTemplate`'s resulting markup is placed in the `LayoutTemplate`'s `itemPlaceholder` control.</span></span> <span data-ttu-id="703d9-425">Além de `itemPlaceholder`, o `LayoutTemplate` inclui um controle DataPager, o que limita o ListView para mostrar apenas 10 comentários de livro de visitas por página (o padrão) e renderiza uma interface de paginação.</span><span class="sxs-lookup"><span data-stu-id="703d9-425">In addition to the `itemPlaceholder`, the `LayoutTemplate` includes a DataPager control, which limits the ListView to showing just 10 guestbook comments per page (the default) and renders a paging interface.</span></span>

<span data-ttu-id="703d9-426">Minha `ItemTemplate` exibe o assunto do livro de visitas de cada comentário em um `<h4>` elemento com o corpo situado abaixo o assunto.</span><span class="sxs-lookup"><span data-stu-id="703d9-426">My `ItemTemplate` displays each guestbook comment's subject in an `<h4>` element with the body situated below the subject.</span></span> <span data-ttu-id="703d9-427">Observe que a sintaxe usada para exibir o corpo leva os dados retornados pela `Eval("Body")` declaração de associação de dados, converte-o em uma cadeia de caracteres e quebras de linha de substitui com o `<br />` elemento.</span><span class="sxs-lookup"><span data-stu-id="703d9-427">Note that syntax used for displaying the body takes the data returned by the `Eval("Body")` databinding statement, converts it to a string, and replaces line breaks with the `<br />` element.</span></span> <span data-ttu-id="703d9-428">Essa conversão é necessária para mostrar as quebras de linha inseridas ao enviar o comentário, pois o espaço em branco é ignorado por HTML.</span><span class="sxs-lookup"><span data-stu-id="703d9-428">This conversion is needed in order to show the line breaks entered when submitting the comment since whitespace is ignored by HTML.</span></span> <span data-ttu-id="703d9-429">Assinatura do usuário é exibida abaixo do corpo em itálico, seguido cidade do usuário, um link para sua home page, a data e hora em que o comentário foi feito e o nome de usuário da pessoa que deixou o comentário.</span><span class="sxs-lookup"><span data-stu-id="703d9-429">The user's signature is displayed beneath the body in italics, followed by the user's home town, a link to his homepage, the date and time the comment was made, and the username of the person who left the comment.</span></span>

<span data-ttu-id="703d9-430">Reserve um tempo para exibir a página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="703d9-430">Take a moment to view the page through a browser.</span></span> <span data-ttu-id="703d9-431">Você deve ver os comentários que você adicionou ao livro de visitas na etapa 5 exibidas aqui.</span><span class="sxs-lookup"><span data-stu-id="703d9-431">You should see the comments that you added to the guestbook in Step 5 displayed here.</span></span>


<span data-ttu-id="703d9-432">[![GuestBook agora exibe comentários do livro de visitas](storing-additional-user-information-cs/_static/image56.png)](storing-additional-user-information-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-432">[![Guestbook.aspx Now Displays the Guestbook's Comments](storing-additional-user-information-cs/_static/image56.png)](storing-additional-user-information-cs/_static/image55.png)</span></span>

<span data-ttu-id="703d9-433">**Figura 19**: `Guestbook.aspx` Agora exibe comentários do livro de visitas ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-433">**Figure 19**: `Guestbook.aspx` Now Displays the Guestbook's Comments  ([Click to view full-size image](storing-additional-user-information-cs/_static/image57.png))</span></span>


<span data-ttu-id="703d9-434">Tente adicionar um novo comentário para o livro de visitas.</span><span class="sxs-lookup"><span data-stu-id="703d9-434">Try adding a new comment to the guestbook.</span></span> <span data-ttu-id="703d9-435">Ao clicar o `PostCommentButton` botão a página é postada e o comentário for adicionado ao banco de dados, mas o controle ListView não é atualizado para mostrar o novo comentário.</span><span class="sxs-lookup"><span data-stu-id="703d9-435">Upon clicking the `PostCommentButton` button the page posts back and the comment is added to the database, but the ListView control is not updated to show the new comment.</span></span> <span data-ttu-id="703d9-436">Isso pode ser corrigido por qualquer um:</span><span class="sxs-lookup"><span data-stu-id="703d9-436">This can be fixed by either:</span></span>

- <span data-ttu-id="703d9-437">Atualizando o `PostCommentButton` do botão `Click` manipulador de eventos para que ele invoca o controle de ListView `DataBind()` método depois de inserir o novo comentário para o banco de dados, ou</span><span class="sxs-lookup"><span data-stu-id="703d9-437">Updating the `PostCommentButton` button's `Click` event handler so that it invokes the ListView control's `DataBind()` method after inserting the new comment into the database, or</span></span>
- <span data-ttu-id="703d9-438">Configuração do controle ListView `EnableViewState` propriedade para `false`.</span><span class="sxs-lookup"><span data-stu-id="703d9-438">Setting the ListView control's `EnableViewState` property to `false`.</span></span> <span data-ttu-id="703d9-439">Essa abordagem funciona porque, ao desabilitar o estado de exibição do controle, ele deve associar novamente os dados subjacentes em cada postagem.</span><span class="sxs-lookup"><span data-stu-id="703d9-439">This approach works because by disabling the control's view state, it must rebind to the underlying data on every postback.</span></span>

<span data-ttu-id="703d9-440">O site do tutorial disponível para download deste tutorial ilustra ambas as técnicas.</span><span class="sxs-lookup"><span data-stu-id="703d9-440">The tutorial website downloadable from this tutorial illustrates both techniques.</span></span> <span data-ttu-id="703d9-441">Do controle ListView `EnableViewState` propriedade para `false` e o código necessário para reassociar programaticamente os dados para o ListView está presente no `Click` manipulador de eventos, mas é comentado.</span><span class="sxs-lookup"><span data-stu-id="703d9-441">The ListView control's `EnableViewState` property to `false` and the code needed to programmatically rebind the data to the ListView is present in the `Click` event handler, but is commented out.</span></span>

> [!NOTE]
> <span data-ttu-id="703d9-442">Atualmente, o `AdditionalUserInfo.aspx` página permite que o usuário exibir e editar suas configurações de cidade, a home page e a assinatura iniciais.</span><span class="sxs-lookup"><span data-stu-id="703d9-442">Currently the `AdditionalUserInfo.aspx` page allows the user to view and edit their home town, homepage, and signature settings.</span></span> <span data-ttu-id="703d9-443">Seria bom atualizar `AdditionalUserInfo.aspx` para exibir o log em comentários de livro de visitas do usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-443">It might be nice to update `AdditionalUserInfo.aspx` to display the logged in user's guestbook comments.</span></span> <span data-ttu-id="703d9-444">Ou seja, além de examinar e modificar suas informações, um usuário poderá visitar o `AdditionalUserInfo.aspx` página para ver quais livro de visitas comentários, ela é feita no passado.</span><span class="sxs-lookup"><span data-stu-id="703d9-444">That is, in addition to examining and modifying her information, a user can visit the `AdditionalUserInfo.aspx` page to see what guestbook comments she's made in the past.</span></span> <span data-ttu-id="703d9-445">Vou deixar isso como um exercício para os leitores interessados.</span><span class="sxs-lookup"><span data-stu-id="703d9-445">I leave this as an exercise for the interested reader.</span></span>


## <a name="step-6-customizing-the-createuserwizard-control-to-include-an-interface-for-the-home-town-homepage-and-signature"></a><span data-ttu-id="703d9-446">Etapa 6: Personalizando o controle CreateUserWizard para incluir uma Interface para a cidade inicial, home page e assinatura</span><span class="sxs-lookup"><span data-stu-id="703d9-446">Step 6: Customizing the CreateUserWizard Control to Include an Interface for the Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="703d9-447">O `SELECT` consulta usada pelo `Guestbook.aspx` página usa um `INNER JOIN` para combinar os registros relacionados entre os `GuestbookComments`, `UserProfiles`, e `aspnet_Users` tabelas.</span><span class="sxs-lookup"><span data-stu-id="703d9-447">The `SELECT` query used by the `Guestbook.aspx` page uses an `INNER JOIN` to combine the related records amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables.</span></span> <span data-ttu-id="703d9-448">Se um usuário que não tem nenhum registro na `UserProfiles` possibilita um livro de visitas de comentário, o comentário não será exibido o ListView porque o `INNER JOIN` retorna apenas `GuestbookComments` registros quando há registros correspondentes na `UserProfiles` e `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="703d9-448">If a user that has no record in `UserProfiles` makes a guestbook comment, the comment won't be displayed in the ListView because the `INNER JOIN` only returns `GuestbookComments` records when there are matching records in `UserProfiles` and `aspnet_Users`.</span></span> <span data-ttu-id="703d9-449">Conforme observamos na etapa 3, se um usuário não tem um registro em `UserProfiles` ela não é possível exibir ou editar suas configurações no `AdditionalUserInfo.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="703d9-449">And as we saw in Step 3, if a user does not have a record in `UserProfiles` she cannot view or edit her settings in the `AdditionalUserInfo.aspx` page.</span></span>

<span data-ttu-id="703d9-450">Desnecessário dizer, é importante que cada conta de usuário no sistema de associação tem uma correspondência de decisões devido ao nosso design registram no `UserProfiles` tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-450">Needless to say, due to our design decisions it is important that every user account in the Membership system have a matching record in the `UserProfiles` table.</span></span> <span data-ttu-id="703d9-451">O que queremos é um registro correspondente a ser adicionado ao `UserProfiles` sempre que uma nova conta de usuário de associação é criada por meio de CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="703d9-451">What we want is for a corresponding record to be added to `UserProfiles` whenever a new Membership user account is created through the CreateUserWizard.</span></span>

<span data-ttu-id="703d9-452">Conforme discutido na [ *criando contas de usuário* ](creating-user-accounts-cs.md) tutorial, depois que a nova conta de usuário de associação é criada o controle CreateUserWizard aciona seu [ `CreatedUser` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="703d9-452">As discussed in the [*Creating User Accounts*](creating-user-accounts-cs.md) tutorial, after the new Membership user account is created the CreateUserWizard control raises its [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span></span> <span data-ttu-id="703d9-453">Podemos criar um manipulador de eventos para esse evento, obter a ID de usuário para o usuário recém-criada e, em seguida, inserir um registro para o `UserProfiles` tabela com valores padrão para o `HomeTown`, `HomepageUrl`, e `Signature` colunas.</span><span class="sxs-lookup"><span data-stu-id="703d9-453">We can create an event handler for this event, get the UserId for the just-created user, and then insert a record into the `UserProfiles` table with default values for the `HomeTown`, `HomepageUrl`, and `Signature` columns.</span></span> <span data-ttu-id="703d9-454">Além disso, é possível solicitar ao usuário para obter esses valores, personalizando a interface do controle CreateUserWizard para incluir caixas de texto adicionais.</span><span class="sxs-lookup"><span data-stu-id="703d9-454">What's more, it is possible to prompt the user for these values by customizing the CreateUserWizard control's interface to include additional TextBoxes.</span></span>

<span data-ttu-id="703d9-455">Vamos primeiro examinar como adicionar uma nova linha para o `UserProfiles` na tabela a `CreatedUser` manipulador de eventos com valores padrão.</span><span class="sxs-lookup"><span data-stu-id="703d9-455">Let's first look at how to add a new row to the `UserProfiles` table in the `CreatedUser` event handler with default values.</span></span> <span data-ttu-id="703d9-456">Depois disso, veremos como personalizar a interface do usuário do controle CreateUserWizard para incluir campos adicionais para coletar o novo usuário cidade, home page e assinatura.</span><span class="sxs-lookup"><span data-stu-id="703d9-456">Following that, we will see how to customize the CreateUserWizard control's user interface to include additional form fields to collect the new user's home town, homepage, and signature.</span></span>

### <a name="adding-a-default-row-touserprofiles"></a><span data-ttu-id="703d9-457">Adição de uma linha padrão para`UserProfiles`</span><span class="sxs-lookup"><span data-stu-id="703d9-457">Adding a Default Row to`UserProfiles`</span></span>

<span data-ttu-id="703d9-458">No [ *criando contas de usuário* ](creating-user-accounts-cs.md) tutorial adicionamos um controle CreateUserWizard para o `CreatingUserAccounts.aspx` página o `Membership` pasta.</span><span class="sxs-lookup"><span data-stu-id="703d9-458">In the [*Creating User Accounts*](creating-user-accounts-cs.md) tutorial we added a CreateUserWizard control to the `CreatingUserAccounts.aspx` page in the `Membership` folder.</span></span> <span data-ttu-id="703d9-459">Para ter o CreateUserWizard controle Adicionar um registro a `UserProfiles` tabela no momento da criação da conta de usuário, precisamos atualizar a funcionalidade do controle CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="703d9-459">In order to have the CreateUserWizard control add a record to `UserProfiles` table upon user account creation, we need to update the CreateUserWizard control's functionality.</span></span> <span data-ttu-id="703d9-460">Em vez de fazer essas alterações para o `CreatingUserAccounts.aspx` página, em vez disso, adicionaremos um novo controle CreateUserWizard para `EnhancedCreateUserWizard.aspx` página e faça as modificações para este tutorial lá.</span><span class="sxs-lookup"><span data-stu-id="703d9-460">Rather than making these changes to the `CreatingUserAccounts.aspx` page, let's instead add a new CreateUserWizard control to `EnhancedCreateUserWizard.aspx` page and make the modifications for this tutorial there.</span></span>

<span data-ttu-id="703d9-461">Abra o `EnhancedCreateUserWizard.aspx` página no Visual Studio e arraste um controle CreateUserWizard Toolbox para a página.</span><span class="sxs-lookup"><span data-stu-id="703d9-461">Open the `EnhancedCreateUserWizard.aspx` page in Visual Studio and drag a CreateUserWizard control from the Toolbox onto the page.</span></span> <span data-ttu-id="703d9-462">Defina o controle de CreateUserWizard `ID` propriedade para `NewUserWizard`.</span><span class="sxs-lookup"><span data-stu-id="703d9-462">Set the CreateUserWizard control's `ID` property to `NewUserWizard`.</span></span> <span data-ttu-id="703d9-463">Como discutimos na <a id="_msoanchor_5"> </a> [ *criando contas de usuário* ](creating-user-accounts-cs.md) tutorial, a interface do usuário padrão do CreateUserWizard solicita que o visitante para as informações necessárias.</span><span class="sxs-lookup"><span data-stu-id="703d9-463">As we discussed in the <a id="_msoanchor_5"></a>[*Creating User Accounts*](creating-user-accounts-cs.md) tutorial, the CreateUserWizard's default user interface prompts the visitor for the necessary information.</span></span> <span data-ttu-id="703d9-464">Depois que essas informações foram fornecidas, o controle internamente cria uma nova conta de usuário na estrutura de associação, tudo isso sem nós ter que escrever uma única linha de código.</span><span class="sxs-lookup"><span data-stu-id="703d9-464">Once this information has been supplied, the control internally creates a new user account in the Membership framework, all without us having to write a single line of code.</span></span>

<span data-ttu-id="703d9-465">O controle CreateUserWizard eleva um número de eventos durante o fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="703d9-465">The CreateUserWizard control raises a number of events during its workflow.</span></span> <span data-ttu-id="703d9-466">Depois que um visitante fornece as informações de solicitação e envia o formulário, o controle CreateUserWizard inicialmente dispara seu [ `CreatingUser` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span><span class="sxs-lookup"><span data-stu-id="703d9-466">After a visitor supplies the request information and submits the form, the CreateUserWizard control initially fires its [`CreatingUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span></span> <span data-ttu-id="703d9-467">Se houver um problema durante o processo de criação, o [ `CreateUserError` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) é acionado; no entanto, se o usuário é criado com êxito, o [ `CreatedUser` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) é gerado.</span><span class="sxs-lookup"><span data-stu-id="703d9-467">If there is a problem during the create process, the [`CreateUserError` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) is fired; however, if the user is successfully created, then the [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) is raised.</span></span> <span data-ttu-id="703d9-468">No <a id="_msoanchor_6"> </a> [ *criando contas de usuário* ](creating-user-accounts-cs.md) tutorial, criamos um manipulador de eventos para o `CreatingUser` evento para garantir que o nome de usuário fornecido não contém qualquer líderes ou espaços à direita, e que o nome de usuário não foram exibidos em qualquer lugar na senha.</span><span class="sxs-lookup"><span data-stu-id="703d9-468">In the <a id="_msoanchor_6"></a>[*Creating User Accounts*](creating-user-accounts-cs.md) tutorial we created an event handler for the `CreatingUser` event to ensure that the supplied username did not contain any leading or trailing spaces, and that the username did not appear anywhere in the password.</span></span>

<span data-ttu-id="703d9-469">Para adicionar uma linha na `UserProfiles` tabela de usuário recém-criada, precisamos criar um manipulador de eventos para o `CreatedUser` eventos.</span><span class="sxs-lookup"><span data-stu-id="703d9-469">In order to add a row in the `UserProfiles` table for the just-created user, we need to create an event handler for the `CreatedUser` event.</span></span> <span data-ttu-id="703d9-470">No momento o `CreatedUser` evento foi disparado, a conta de usuário já tiver sido criada na estrutura de associação, que permite recuperar o valor de ID de usuário da conta.</span><span class="sxs-lookup"><span data-stu-id="703d9-470">By the time the `CreatedUser` event has fired, the user account has already been created in the Membership framework, enabling us to retrieve the account's UserId value.</span></span>

<span data-ttu-id="703d9-471">Crie um manipulador de eventos para o `NewUserWizard`do `CreatedUser` evento e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="703d9-471">Create an event handler for the `NewUserWizard`'s `CreatedUser` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample11.cs)]

<span data-ttu-id="703d9-472">Os seres código acima, recuperando a ID do usuário da conta de usuário just-adicionado.</span><span class="sxs-lookup"><span data-stu-id="703d9-472">The above code beings by retrieving the UserId of the just-added user account.</span></span> <span data-ttu-id="703d9-473">Isso é feito usando o `Membership.GetUser(username)` método para retornar informações sobre um usuário específico e, em seguida, usando o `ProviderUserKey` propriedade a recuperar sua ID de usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-473">This is accomplished by using the `Membership.GetUser(username)` method to return information about a particular user, and then using the `ProviderUserKey` property to retrieve their UserId.</span></span> <span data-ttu-id="703d9-474">O nome de usuário inserido pelo usuário no controle CreateUserWizard está disponível por meio de seu [ `UserName` propriedade](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span><span class="sxs-lookup"><span data-stu-id="703d9-474">The username entered by the user in the CreateUserWizard control is available via its [`UserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span></span>

<span data-ttu-id="703d9-475">Em seguida, a cadeia de caracteres de conexão é recuperada do `Web.config` e o `INSERT` instrução é especificada.</span><span class="sxs-lookup"><span data-stu-id="703d9-475">Next, the connection string is retrieved from `Web.config` and the `INSERT` statement is specified.</span></span> <span data-ttu-id="703d9-476">Os objetos necessários do ADO.NET são instanciados e o comando executado.</span><span class="sxs-lookup"><span data-stu-id="703d9-476">The necessary ADO.NET objects are instantiated and the command executed.</span></span> <span data-ttu-id="703d9-477">O código atribui uma [ `DBNull` ](https://msdn.microsoft.com/library/system.dbnull.aspx) da instância para o `@HomeTown`, `@HomepageUrl`, e `@Signature` parâmetros, que tem o efeito de inserção de banco de dados `NULL` os valores para o `HomeTown`, `HomepageUrl`, e `Signature` campos.</span><span class="sxs-lookup"><span data-stu-id="703d9-477">The code assigns a [`DBNull`](https://msdn.microsoft.com/library/system.dbnull.aspx) instance to the `@HomeTown`, `@HomepageUrl`, and `@Signature` parameters, which has the effect of inserting database `NULL` values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span>

<span data-ttu-id="703d9-478">Visite o `EnhancedCreateUserWizard.aspx` página por meio de um navegador e criar uma nova conta de usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-478">Visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account.</span></span> <span data-ttu-id="703d9-479">Depois de fazer isso, retorne ao Visual Studio e examinar o conteúdo do `aspnet_Users` e `UserProfiles` tabelas (como fizemos na Figura 12).</span><span class="sxs-lookup"><span data-stu-id="703d9-479">After doing so, return to Visual Studio and examine the contents of the `aspnet_Users` and `UserProfiles` tables (like we did back in Figure 12).</span></span> <span data-ttu-id="703d9-480">Você deve ver a nova conta de usuário na `aspnet_Users` e um correspondente `UserProfiles` linha (com `NULL` os valores para `HomeTown`, `HomepageUrl`, e `Signature`).</span><span class="sxs-lookup"><span data-stu-id="703d9-480">You should see the new user account in `aspnet_Users` and a corresponding `UserProfiles` row (with `NULL` values for `HomeTown`, `HomepageUrl`, and `Signature`).</span></span>


<span data-ttu-id="703d9-481">[![Uma nova conta de usuário e o registro UserProfiles foram adicionados](storing-additional-user-information-cs/_static/image59.png)](storing-additional-user-information-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-481">[![A New User Account and UserProfiles Record Have Been Added](storing-additional-user-information-cs/_static/image59.png)](storing-additional-user-information-cs/_static/image58.png)</span></span>

<span data-ttu-id="703d9-482">**Figura 20**: Uma nova conta de usuário e `UserProfiles` registro foram adicionados ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-482">**Figure 20**: A New User Account and `UserProfiles` Record Have Been Added  ([Click to view full-size image](storing-additional-user-information-cs/_static/image60.png))</span></span>


<span data-ttu-id="703d9-483">Depois que o visitante tenha fornecido as informações de sua nova conta e clicou no botão "Criar usuário", a conta de usuário é criada e uma linha é adicionada para o `UserProfiles` tabela.</span><span class="sxs-lookup"><span data-stu-id="703d9-483">After the visitor has supplied his new account information and clicked the "Create User" button, the user account is created and a row added to the `UserProfiles` table.</span></span> <span data-ttu-id="703d9-484">O CreateUserWizard, em seguida, exibe seu `CompleteWizardStep`, que exibe uma mensagem de êxito e um botão continuar.</span><span class="sxs-lookup"><span data-stu-id="703d9-484">The CreateUserWizard then displays its `CompleteWizardStep`, which displays a success message and a Continue button.</span></span> <span data-ttu-id="703d9-485">Clicar no botão continuar faz com que um postback, mas nenhuma ação é executada, deixando o usuário preso no `EnhancedCreateUserWizard.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="703d9-485">Clicking the Continue button causes a postback, but no action is taken, leaving the user stuck on the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="703d9-486">Podemos especificar uma URL para enviar o usuário para quando o botão continuar é clicado por meio do controle CreateUserWizard [ `ContinueDestinationPageUrl` propriedade](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span><span class="sxs-lookup"><span data-stu-id="703d9-486">We can specify a URL to send the user to when the Continue button is clicked via the CreateUserWizard control's [`ContinueDestinationPageUrl` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span></span> <span data-ttu-id="703d9-487">Defina o `ContinueDestinationPageUrl` propriedade como "~ / Membership/AdditionalUserInfo.aspx".</span><span class="sxs-lookup"><span data-stu-id="703d9-487">Set the `ContinueDestinationPageUrl` property to "~/Membership/AdditionalUserInfo.aspx".</span></span> <span data-ttu-id="703d9-488">Isso leva o novo usuário `AdditionalUserInfo.aspx`, onde eles podem exibir e atualizar suas configurações.</span><span class="sxs-lookup"><span data-stu-id="703d9-488">This takes the new user to `AdditionalUserInfo.aspx`, where they can view and update their settings.</span></span>

### <a name="customizing-the-createuserwizards-interface-to-prompt-for-the-new-users-home-town-homepage-and-signature"></a><span data-ttu-id="703d9-489">Personalizando a Interface do CreateUserWizard para solicitar o novo usuário cidade Home, home page e assinatura</span><span class="sxs-lookup"><span data-stu-id="703d9-489">Customizing the CreateUserWizard's Interface to Prompt for the New User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="703d9-490">Interface de padrão do controle CreateUserWizard é suficiente para cenários de criação de conta simples onde somente informações de conta de usuário de núcleo, como email, senha e nome de usuário precisam ser coletadas.</span><span class="sxs-lookup"><span data-stu-id="703d9-490">The CreateUserWizard control's default interface is sufficient for simple account creation scenarios where only core user account information like username, password, and email need be collected.</span></span> <span data-ttu-id="703d9-491">Mas e se quiséssemos solicitar que o visitante a inserir sua cidade, home page e assinatura durante a criação de sua conta?</span><span class="sxs-lookup"><span data-stu-id="703d9-491">But what if we wanted to prompt the visitor to enter her home town, homepage, and signature while creating her account?</span></span> <span data-ttu-id="703d9-492">É possível personalizar a interface do controle CreateUserWizard para coletar informações adicionais na inscrição, e essas informações podem ser usadas no `CreatedUser` manipulador de eventos para inserir registros adicionais no banco de dados subjacente.</span><span class="sxs-lookup"><span data-stu-id="703d9-492">It is possible to customize the CreateUserWizard control's interface to collect additional information at signup, and this information may be used in the `CreatedUser` event handler to insert additional records into the underlying database.</span></span>

<span data-ttu-id="703d9-493">O controle CreateUserWizard estende o controle Wizard do ASP.NET, que é um controle que permite que um desenvolvedor de página definir uma série de ordenada `WizardSteps`.</span><span class="sxs-lookup"><span data-stu-id="703d9-493">The CreateUserWizard control extends the ASP.NET Wizard control, which is a control that allows a page developer to define a series of ordered `WizardSteps`.</span></span> <span data-ttu-id="703d9-494">O controle de assistente renderiza a etapa ativa e fornece uma interface de navegação que permite que o visitante a percorrer essas etapas.</span><span class="sxs-lookup"><span data-stu-id="703d9-494">The Wizard control renders the active step and provides a navigation interface that allows the visitor to move through these steps.</span></span> <span data-ttu-id="703d9-495">O controle Wizard é ideal para dividir uma tarefa longa em várias etapas.</span><span class="sxs-lookup"><span data-stu-id="703d9-495">The Wizard control is ideal for breaking down a long task into several short steps.</span></span> <span data-ttu-id="703d9-496">Para obter mais informações sobre o controle Wizard, consulte [criando uma Interface do usuário passo a passo com o controle Wizard do ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="703d9-496">For more information on the Wizard control, see [Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span></span>

<span data-ttu-id="703d9-497">Marcação de padrão do controle CreateUserWizard define dois `WizardSteps`: `CreateUserWizardStep` e `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="703d9-497">The CreateUserWizard control's default markup defines two `WizardSteps`: `CreateUserWizardStep` and `CompleteWizardStep`.</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample12.aspx)]

<span data-ttu-id="703d9-498">A primeira `WizardStep`, `CreateUserWizardStep`, renderiza a interface que solicita o nome de usuário, senha, email e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="703d9-498">The first `WizardStep`, `CreateUserWizardStep`, renders the interface that prompts for the username, password, email, and so on.</span></span> <span data-ttu-id="703d9-499">Depois que o visitante fornece essas informações e clica em "Criar usuário", ela será mostrada a `CompleteWizardStep`, que mostra a mensagem de êxito e um botão continuar.</span><span class="sxs-lookup"><span data-stu-id="703d9-499">After the visitor supplies this information and clicks "Create User", she is shown the `CompleteWizardStep`, which shows the success message and a Continue button.</span></span>

<span data-ttu-id="703d9-500">Para personalizar a interface do controle CreateUserWizard para incluir campos adicionais, podemos:</span><span class="sxs-lookup"><span data-stu-id="703d9-500">To customize the CreateUserWizard control's interface to include additional form fields, we can:</span></span>

- <span data-ttu-id="703d9-501"><strong>Criar um ou mais novos</strong><strong>`WizardStep`</strong><strong>s para conter os elementos de interface de usuário adicionais</strong>.</span><span class="sxs-lookup"><span data-stu-id="703d9-501"><strong>Create one or more new</strong><strong>`WizardStep`</strong><strong>s to contain the additional user interface elements</strong>.</span></span> <span data-ttu-id="703d9-502">Para adicionar uma nova `WizardStep` para o CreateUserWizard, clique no "Adicionar/remover `WizardSteps`" link da sua marca inteligente para iniciar o `WizardStep` Editor de coleção.</span><span class="sxs-lookup"><span data-stu-id="703d9-502">To add a new `WizardStep` to the CreateUserWizard, click the "Add/Remove `WizardSteps`" link from its Smart Tag to launch the `WizardStep` Collection Editor.</span></span> <span data-ttu-id="703d9-503">A partir daí você pode adicionar, remover ou reordenar as etapas no assistente.</span><span class="sxs-lookup"><span data-stu-id="703d9-503">From there you can add, remove, or reorder the steps in the wizard.</span></span> <span data-ttu-id="703d9-504">Essa é a abordagem que usaremos para este tutorial.</span><span class="sxs-lookup"><span data-stu-id="703d9-504">This is the approach we will use for this tutorial.</span></span>

- <span data-ttu-id="703d9-505"><strong>Converter o</strong><strong>`CreateUserWizardStep`</strong><strong>em um editável</strong><strong>`WizardStep`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="703d9-505"><strong>Convert the</strong><strong>`CreateUserWizardStep`</strong><strong>into an editable</strong><strong>`WizardStep`</strong><strong>.</strong></span></span> <span data-ttu-id="703d9-506">Isso substitui o `CreateUserWizardStep` com um equivalente `WizardStep` cuja marcação define uma interface do usuário que corresponde a `CreateUserWizardStep`' s.</span><span class="sxs-lookup"><span data-stu-id="703d9-506">This replaces the `CreateUserWizardStep` with an equivalent `WizardStep` whose markup defines a user interface that matches the `CreateUserWizardStep`'s.</span></span> <span data-ttu-id="703d9-507">Convertendo o `CreateUserWizardStep` em um `WizardStep` podemos reposicionar os controles ou adicionar elementos da interface do usuário adicionais a essa etapa.</span><span class="sxs-lookup"><span data-stu-id="703d9-507">By converting the `CreateUserWizardStep` into a `WizardStep` we can reposition the controls or add additional user interface elements to this step.</span></span> <span data-ttu-id="703d9-508">Para converter o `CreateUserWizardStep` ou `CompleteWizardStep` em um editável `WizardStep`, clique no "Personalizar criar usuário Step" ou "Personalizar conclua a etapa" vincular de Smart Tag do controle.</span><span class="sxs-lookup"><span data-stu-id="703d9-508">To convert the `CreateUserWizardStep` or `CompleteWizardStep` into an editable `WizardStep`, click the "Customize Create User Step" or "Customize Complete Step" link from the control's Smart Tag.</span></span>

- <span data-ttu-id="703d9-509">**Use uma combinação das duas opções acima.**</span><span class="sxs-lookup"><span data-stu-id="703d9-509">**Use some combination of the above two options.**</span></span>

<span data-ttu-id="703d9-510">Uma coisa importante para ter em mente é que o controle CreateUserWizard executa seu processo de criação de conta de usuário, quando se clica no botão de "Criar usuário" no seu `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="703d9-510">One important thing to keep in mind is that the CreateUserWizard control executes its user account creation process when the "Create User" button is clicked from within its `CreateUserWizardStep`.</span></span> <span data-ttu-id="703d9-511">Não importa se há adicionais `WizardStep` s após o `CreateUserWizardStep` ou não.</span><span class="sxs-lookup"><span data-stu-id="703d9-511">It doesn't matter if there are additional `WizardStep` s after the `CreateUserWizardStep` or not.</span></span>

<span data-ttu-id="703d9-512">Ao adicionar um personalizado `WizardStep` para o controle CreateUserWizard para coletar entrada do usuário adicionais, personalizados `WizardStep` pode ser colocado antes ou depois do `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="703d9-512">When adding a custom `WizardStep` to the CreateUserWizard control to collect additional user input, the custom `WizardStep` can be placed before or after the `CreateUserWizardStep`.</span></span> <span data-ttu-id="703d9-513">Se ele vem antes do `CreateUserWizardStep` , em seguida, a entrada do usuário adicionais coletados personalizado `WizardStep` está disponível para o `CreatedUser` manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="703d9-513">If it comes before the `CreateUserWizardStep` then the additional user input collected from the custom `WizardStep` is available for the `CreatedUser` event handler.</span></span> <span data-ttu-id="703d9-514">No entanto, se personalizado `WizardStep` vem depois `CreateUserWizardStep` , em seguida, o tempo personalizada `WizardStep` é exibida a nova conta de usuário já tiver sido criada e o `CreatedUser` evento já foi disparado.</span><span class="sxs-lookup"><span data-stu-id="703d9-514">However, if the custom `WizardStep` comes after `CreateUserWizardStep` then by the time the custom `WizardStep` is displayed the new user account has already been created and the `CreatedUser` event has already fired.</span></span>

<span data-ttu-id="703d9-515">A Figura 21 mostra o fluxo de trabalho quando adicionado `WizardStep` precede o `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="703d9-515">Figure 21 shows the workflow when the added `WizardStep` precedes the `CreateUserWizardStep`.</span></span> <span data-ttu-id="703d9-516">Desde que as informações de usuário adicionais foram coletadas no momento a `CreatedUser` evento é acionado, só precisamos fazer é atualizar o `CreatedUser` manipulador de eventos para recuperar essas entradas e usá-las para o `INSERT` valores de parâmetro da instrução (em vez de `DBNull.Value`).</span><span class="sxs-lookup"><span data-stu-id="703d9-516">Since the additional user information has been collected by the time the `CreatedUser` event fires, all we have to do is update the `CreatedUser` event handler to retrieve these inputs and use those for the `INSERT` statement's parameter values (rather than `DBNull.Value`).</span></span>


<span data-ttu-id="703d9-517">[![O fluxo de trabalho CreateUserWizard quando um WizardStep adicional precede o CreateUserWizardStep](storing-additional-user-information-cs/_static/image62.png)](storing-additional-user-information-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-517">[![The CreateUserWizard Workflow When an Additional WizardStep Precedes the CreateUserWizardStep](storing-additional-user-information-cs/_static/image62.png)](storing-additional-user-information-cs/_static/image61.png)</span></span>

<span data-ttu-id="703d9-518">**Figura 21**: O CreateUserWizard fluxo de trabalho quando um adicional `WizardStep` Precedes as `CreateUserWizardStep` ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-518">**Figure 21**: The CreateUserWizard Workflow When an Additional `WizardStep` Precedes the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-cs/_static/image63.png))</span></span>


<span data-ttu-id="703d9-519">Se o personalizado `WizardStep` é colocado *após* o `CreateUserWizardStep`, no entanto, o processo de conta de usuário de criação ocorre antes que o usuário tenha tido a oportunidade de inserir sua cidade, a home page ou a assinatura.</span><span class="sxs-lookup"><span data-stu-id="703d9-519">If the custom `WizardStep` is placed *after* the `CreateUserWizardStep`, however, the create user account process occurs before the user has had a chance to enter her home town, homepage, or signature.</span></span> <span data-ttu-id="703d9-520">Nesse caso, essa informação adicional precisa ser inserido no banco de dados depois que a conta de usuário tiver sido criada, como mostra a Figura 22.</span><span class="sxs-lookup"><span data-stu-id="703d9-520">In such a case, this additional information needs to be inserted into the database after the user account has been created, as Figure 22 illustrates.</span></span>


<span data-ttu-id="703d9-521">[![O fluxo de trabalho CreateUserWizard quando um WizardStep adicional vem após o CreateUserWizardStep](storing-additional-user-information-cs/_static/image65.png)](storing-additional-user-information-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-521">[![The CreateUserWizard Workflow When an Additional WizardStep Comes After the CreateUserWizardStep](storing-additional-user-information-cs/_static/image65.png)](storing-additional-user-information-cs/_static/image64.png)</span></span>

<span data-ttu-id="703d9-522">**Figura 22**: O CreateUserWizard fluxo de trabalho quando um adicional `WizardStep` vem após o `CreateUserWizardStep` ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-522">**Figure 22**: The CreateUserWizard Workflow When an Additional `WizardStep` Comes After the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-cs/_static/image66.png))</span></span>


<span data-ttu-id="703d9-523">O fluxo de trabalho mostrado na Figura 22 aguarda para inserir um registro para o `UserProfiles` tabela até após a conclusão da etapa 2.</span><span class="sxs-lookup"><span data-stu-id="703d9-523">The workflow shown in Figure 22 waits to insert a record into the `UserProfiles` table until after Step 2 completes.</span></span> <span data-ttu-id="703d9-524">Se o visitante fechar seu navegador após a etapa 1, no entanto, teremos atingido um estado em que uma conta de usuário foi criada, mas nenhum registro foi adicionado à `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="703d9-524">If the visitor closes her browser after step 1, however, we will have reached a state where a user account was created, but no record was added to `UserProfiles`.</span></span> <span data-ttu-id="703d9-525">Uma solução alternativa é ter um registro com `NULL` ou padrão de valores inseridos nas `UserProfiles` no `CreatedUser` manipulador de eventos (que é acionado após a etapa 1) e atualize esse registro após a conclusão da etapa 2.</span><span class="sxs-lookup"><span data-stu-id="703d9-525">One workaround is to have a record with `NULL` or default values inserted into `UserProfiles` in the `CreatedUser` event handler (which fires after step 1), and then update this record after step 2 completes.</span></span> <span data-ttu-id="703d9-526">Isso garante que um `UserProfiles` registro será adicionado para a conta de usuário, mesmo que o usuário fecha no processo de registro meio.</span><span class="sxs-lookup"><span data-stu-id="703d9-526">This ensures that a `UserProfiles` record will be added for the user account even if the user quits the registration process midway through.</span></span>

<span data-ttu-id="703d9-527">Para este tutorial vamos criar um novo `WizardStep` que ocorre após o `CreateUserWizardStep` , mas antes de `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="703d9-527">For this tutorial let's create a new `WizardStep` that occurs after the `CreateUserWizardStep` but before the `CompleteWizardStep`.</span></span> <span data-ttu-id="703d9-528">Vamos primeiro obtenha o WizardStep em colocar e configurado e, em seguida, podemos examinar o código.</span><span class="sxs-lookup"><span data-stu-id="703d9-528">Let's first get the WizardStep in place and configured and then we'll look at the code.</span></span>

<span data-ttu-id="703d9-529">Na Smart Tag do controle CreateUserWizard, selecione o "Adicionar/remover `WizardStep` s", que abre o `WizardStep` caixa de diálogo do Editor de coleção.</span><span class="sxs-lookup"><span data-stu-id="703d9-529">From the CreateUserWizard control's Smart Tag, select the "Add/Remove `WizardStep` s", which brings up the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="703d9-530">Adicione um novo `WizardStep`, definindo seu `ID` ao `UserSettings`, sua `Title` para "Configurações de seu" e seu `StepType` para `Step`.</span><span class="sxs-lookup"><span data-stu-id="703d9-530">Add a new `WizardStep`, setting its `ID` to `UserSettings`, its `Title` to "Your Settings" and its `StepType` to `Step`.</span></span> <span data-ttu-id="703d9-531">Em seguida, posicioná-lo para que ele vem depois o `CreateUserWizardStep` ("Sign Up for Your New Account") e antes do `CompleteWizardStep` ("concluído"), conforme mostrado na Figura 23.</span><span class="sxs-lookup"><span data-stu-id="703d9-531">Then position it so that it comes after the `CreateUserWizardStep` ("Sign Up for Your New Account") and before the `CompleteWizardStep` ("Complete"), as shown in Figure 23.</span></span>


<span data-ttu-id="703d9-532">[![Adicionar um novo WizardStep para o controle CreateUserWizard](storing-additional-user-information-cs/_static/image68.png)](storing-additional-user-information-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="703d9-532">[![Add a New WizardStep to the CreateUserWizard Control](storing-additional-user-information-cs/_static/image68.png)](storing-additional-user-information-cs/_static/image67.png)</span></span>

<span data-ttu-id="703d9-533">**Figura 23**: Adicionar um novo `WizardStep` para o controle CreateUserWizard ([clique para exibir a imagem em tamanho normal](storing-additional-user-information-cs/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="703d9-533">**Figure 23**: Add a New `WizardStep` to the CreateUserWizard Control  ([Click to view full-size image](storing-additional-user-information-cs/_static/image69.png))</span></span>


<span data-ttu-id="703d9-534">Clique em Okey para fechar o `WizardStep` caixa de diálogo do Editor de coleção.</span><span class="sxs-lookup"><span data-stu-id="703d9-534">Click OK to close the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="703d9-535">O novo `WizardStep` é evidenciada pelo marcação declarativa do atualizada do controle CreateUserWizard:</span><span class="sxs-lookup"><span data-stu-id="703d9-535">The new `WizardStep` is evidenced by the CreateUserWizard control's updated declarative markup:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample13.aspx)]

<span data-ttu-id="703d9-536">Observe o novo `<asp:WizardStep>` elemento.</span><span class="sxs-lookup"><span data-stu-id="703d9-536">Note the new `<asp:WizardStep>` element.</span></span> <span data-ttu-id="703d9-537">Precisamos adicionar a interface do usuário para coletar o novo usuário cidade, home page e assinatura aqui.</span><span class="sxs-lookup"><span data-stu-id="703d9-537">We need to add the user interface to collect the new user's home town, homepage, and signature here.</span></span> <span data-ttu-id="703d9-538">Você pode inserir esse conteúdo na sintaxe declarativa ou por meio do Designer.</span><span class="sxs-lookup"><span data-stu-id="703d9-538">You can enter this content in the declarative syntax or through the Designer.</span></span> <span data-ttu-id="703d9-539">Para usar o Designer, selecione a etapa de "Configurações de seu" na lista suspensa na marca inteligente para ver a etapa no Designer.</span><span class="sxs-lookup"><span data-stu-id="703d9-539">To use the Designer, select the "Your Settings" step from the drop-down list in the Smart Tag to see the step in the Designer.</span></span>

> [!NOTE]
> <span data-ttu-id="703d9-540">Seleção de uma etapa por meio na lista suspensa da marca inteligente de atualizações do controle CreateUserWizard [ `ActiveStepIndex` propriedade](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), que especifica o índice da etapa inicial.</span><span class="sxs-lookup"><span data-stu-id="703d9-540">Selecting a step through the Smart Tag's drop-down list updates the CreateUserWizard control's [`ActiveStepIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), which specifies the index of the starting step.</span></span> <span data-ttu-id="703d9-541">Portanto, se você usar essa lista suspensa para editar a etapa de "Configurações de seu" no Designer, certifique-se para defini-lo para "Sign Up for Your New Account", para que essa etapa é exibido quando os usuários visitam primeiro o `EnhancedCreateUserWizard.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="703d9-541">Therefore, if you use this drop-down list to edit the "Your Settings" step in the Designer, be sure to set it back to "Sign Up for Your New Account" so that this step is shown when users first visit the `EnhancedCreateUserWizard.aspx` page.</span></span>


<span data-ttu-id="703d9-542">Criar uma interface do usuário dentro da etapa de "Configurações de seu" que contém três controles de caixa de texto denominados `HomeTown`, `HomepageUrl`, e `Signature`.</span><span class="sxs-lookup"><span data-stu-id="703d9-542">Create a user interface within the "Your Settings" step that contains three TextBox controls named `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="703d9-543">Depois de construir essa interface, marcação declarativa do CreateUserWizard deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="703d9-543">After constructing this interface, the CreateUserWizard's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample14.aspx)]

<span data-ttu-id="703d9-544">Vá em frente e visitar esta página por meio de um navegador e criar uma nova conta de usuário, especificando valores para a cidade, a home page e a assinatura.</span><span class="sxs-lookup"><span data-stu-id="703d9-544">Go ahead and visit this page through a browser and create a new user account, specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="703d9-545">Depois de concluir a `CreateUserWizardStep` a conta de usuário é criada na estrutura de associação e o `CreatedUser` execuções de manipulador de eventos, que adiciona uma nova linha à `UserProfiles`, mas com um banco de dados `NULL` valor para `HomeTown`, `HomepageUrl`, e `Signature`.</span><span class="sxs-lookup"><span data-stu-id="703d9-545">After completing the `CreateUserWizardStep` the user account is created in the Membership framework and the `CreatedUser` event handler runs, which adds a new row to `UserProfiles`, but with a database `NULL` value for `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="703d9-546">Os valores inseridos para a cidade, a home page e a assinatura nunca são usados.</span><span class="sxs-lookup"><span data-stu-id="703d9-546">The values entered for the home town, homepage, and signature are never used.</span></span> <span data-ttu-id="703d9-547">O resultado é uma nova conta de usuário com uma `UserProfiles` registre cuja `HomeTown`, `HomepageUrl`, e `Signature` campos ainda precisam ser especificados.</span><span class="sxs-lookup"><span data-stu-id="703d9-547">The net result is a new user account with a `UserProfiles` record whose `HomeTown`, `HomepageUrl`, and `Signature` fields have yet to be specified.</span></span>

<span data-ttu-id="703d9-548">É preciso executar código após a etapa de "Configurações de seu" que usa os valores de cidade, honepage e assinatura iniciais inseridos pelo usuário e atualiza o apropriada `UserProfiles` registro.</span><span class="sxs-lookup"><span data-stu-id="703d9-548">We need to execute code after the "Your Settings" step that takes the home town, honepage, and signature values entered by the user and updates the appropriate `UserProfiles` record.</span></span> <span data-ttu-id="703d9-549">Cada vez que o usuário move entre as etapas em um Assistente de controle, o assistente [ `ActiveStepChanged` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) é acionado.</span><span class="sxs-lookup"><span data-stu-id="703d9-549">Each time the user moves between steps in a Wizard control, the Wizard's [`ActiveStepChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) fires.</span></span> <span data-ttu-id="703d9-550">Podemos criar um manipulador de eventos para esse evento e a atualização de `UserProfiles` tabela quando a etapa de "Configurações de seu" foi concluída.</span><span class="sxs-lookup"><span data-stu-id="703d9-550">We can create an event handler for this event and update the `UserProfiles` table when the "Your Settings" step has completed.</span></span>

<span data-ttu-id="703d9-551">Adicionar um manipulador de eventos para o CreateUserWizard `ActiveStepChanged` eventos e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="703d9-551">Add an event handler for the CreateUserWizard's `ActiveStepChanged` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample15.cs)]

<span data-ttu-id="703d9-552">O código acima inicia determinando se alcançamos apenas a etapa de "Concluído".</span><span class="sxs-lookup"><span data-stu-id="703d9-552">The above code starts by determining if we have just reached the "Complete" step.</span></span> <span data-ttu-id="703d9-553">Como a etapa de "Concluído" ocorre imediatamente após a etapa de "Configurações de seu", Avançar quando atinge o visitante "Concluído" passo a passo que significa que ela acabou de concluir a etapa de "Configurações de seu".</span><span class="sxs-lookup"><span data-stu-id="703d9-553">Since the "Complete" step occurs immediately after the "Your Settings" step, then when the visitor reaches "Complete" step that means she just finished the "Your Settings" step.</span></span>

<span data-ttu-id="703d9-554">Nesse caso, precisamos referenciar programaticamente os controles de caixa de texto dentro de `UserSettings WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="703d9-554">In such a case, we need to programmatically reference the TextBox controls within the `UserSettings WizardStep`.</span></span> <span data-ttu-id="703d9-555">Isso é feito primeiro usando o `FindControl` método para referenciar programaticamente o `UserSettings WizardStep`e, em seguida, novamente para fazer referência a caixas de texto de dentro a `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="703d9-555">This is accomplished by first using the `FindControl` method to programmatically referencing the `UserSettings WizardStep`, and then again to reference the TextBoxes from within the `WizardStep`.</span></span> <span data-ttu-id="703d9-556">Depois que as caixas de texto foram mencionadas, estamos prontos para executar o `UPDATE` instrução.</span><span class="sxs-lookup"><span data-stu-id="703d9-556">Once the TextBoxes have been referenced, we're ready to execute the `UPDATE` statement.</span></span> <span data-ttu-id="703d9-557">O `UPDATE` instrução tem o mesmo número de parâmetros como o `INSERT` instrução no `CreatedUser` manipulador de eventos, mas aqui, usamos os valores de cidade, a home page e a assinatura iniciais fornecidos pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-557">The `UPDATE` statement has the same number of parameters as the `INSERT` statement in the `CreatedUser` event handler, but here we use the home town, homepage, and signature values supplied by the user.</span></span>

<span data-ttu-id="703d9-558">Com este manipulador de eventos em vigor, visite o `EnhancedCreateUserWizard.aspx` página por meio de um navegador e criar uma nova conta de usuário, especificando valores para a cidade, a home page e a assinatura.</span><span class="sxs-lookup"><span data-stu-id="703d9-558">With this event handler in place, visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="703d9-559">Depois de criar a nova conta, você deverá ser redirecionado para o `AdditionalUserInfo.aspx` página, onde as informações de cidade, a home page e a assinatura iniciais just-inserido são exibidas.</span><span class="sxs-lookup"><span data-stu-id="703d9-559">After creating the new account you should be redirected to the `AdditionalUserInfo.aspx` page, where the just-entered home town, homepage, and signature information is displayed.</span></span>

> [!NOTE]
> <span data-ttu-id="703d9-560">Nosso site atualmente tem duas páginas do qual um visitante pode criar uma nova conta: `CreatingUserAccounts.aspx` e `EnhancedCreateUserWizard.aspx`.</span><span class="sxs-lookup"><span data-stu-id="703d9-560">Our website currently has two pages from which a visitor can create a new account: `CreatingUserAccounts.aspx` and `EnhancedCreateUserWizard.aspx`.</span></span> <span data-ttu-id="703d9-561">Mapa do site do site e a página de logon apontam para o `CreatingUserAccounts.aspx` página, mas o `CreatingUserAccounts.aspx` página não solicitar ao usuário para suas informações de cidade, a home page e a assinatura iniciais e não adicionará uma linha correspondente à `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="703d9-561">The website's sitemap and login page point to the `CreatingUserAccounts.aspx` page, but the `CreatingUserAccounts.aspx` page does not prompt the user for their home town, homepage, and signature information and does not add a corresponding row to `UserProfiles`.</span></span> <span data-ttu-id="703d9-562">Portanto, atualizar o `CreatingUserAccounts.aspx` página para que ele oferece essa funcionalidade ou atualizar a página de logon e o mapa do site para fazer referência a `EnhancedCreateUserWizard.aspx` em vez de `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="703d9-562">Therefore, either update the `CreatingUserAccounts.aspx` page so that it offers this functionality or update the sitemap and login page to reference `EnhancedCreateUserWizard.aspx` instead of `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="703d9-563">Se você escolher a última opção, certifique-se de atualizar o `Membership` da pasta `Web.config` arquivo de modo a permitir que usuários anônimos acessem o `EnhancedCreateUserWizard.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="703d9-563">If you choose the latter option, be sure to update the `Membership` folder's `Web.config` file so as to allow anonymous users access to the `EnhancedCreateUserWizard.aspx` page.</span></span>


## <a name="summary"></a><span data-ttu-id="703d9-564">Resumo</span><span class="sxs-lookup"><span data-stu-id="703d9-564">Summary</span></span>

<span data-ttu-id="703d9-565">Neste tutorial vimos técnicas para modelar dados relacionados a contas de usuário dentro da estrutura de associação.</span><span class="sxs-lookup"><span data-stu-id="703d9-565">In this tutorial we looked at techniques for modeling data that is related to user accounts within the Membership framework.</span></span> <span data-ttu-id="703d9-566">Em particular, analisamos a modelagem de entidades que compartilham uma relação um-para-muitos com as contas de usuário, bem como os dados que compartilha uma relação um para um.</span><span class="sxs-lookup"><span data-stu-id="703d9-566">In particular, we looked at modeling entities that share a one-to-many relationship with user accounts as well as data that shares a one-to-one relationship.</span></span> <span data-ttu-id="703d9-567">Além disso, vimos como isso relacionados informações poderiam ser exibidas, inseridas e atualizadas, com alguns exemplos usando o controle SqlDataSource e outros usando o código do ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="703d9-567">Furthermore, we saw how this related information could be displayed, inserted, and updated, with some examples using the SqlDataSource control and others using ADO.NET code.</span></span>

<span data-ttu-id="703d9-568">Esse tutorial conclui nossa aparência em contas de usuário.</span><span class="sxs-lookup"><span data-stu-id="703d9-568">This tutorial completes our look at user accounts.</span></span> <span data-ttu-id="703d9-569">Começando com o próximo tutorial será transformamos nossas atenções para funções.</span><span class="sxs-lookup"><span data-stu-id="703d9-569">Starting with the next tutorial we will turn our attention to roles.</span></span> <span data-ttu-id="703d9-570">Nos próximos vários tutoriais, vamos examinar a estrutura de funções, consulte como criar novas funções, como atribuir funções aos usuários, como determinar as funções que um usuário pertence e para aplicar a autorização baseada em função.</span><span class="sxs-lookup"><span data-stu-id="703d9-570">Over the next several tutorials we will look at the Roles framework, see how to create new roles, how to assign roles to users, how to determine what roles a user belongs to, and how to apply role-based authorization.</span></span>

<span data-ttu-id="703d9-571">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="703d9-571">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="703d9-572">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="703d9-572">Further Reading</span></span>

<span data-ttu-id="703d9-573">Para obter mais informações sobre os tópicos abordados neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="703d9-573">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="703d9-574">Acessar e atualizar dados no ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="703d9-574">Accessing and Updating Data in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="703d9-575">Controle Wizard 2.0 do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="703d9-575">ASP.NET 2.0 Wizard Control</span></span>](https://weblogs.asp.net/scottgu/archive/2006/02/21/438732.aspx)
- [<span data-ttu-id="703d9-576">Criando uma Interface do usuário passo a passo com o controle do ASP.NET 2.0 Assistente</span><span class="sxs-lookup"><span data-stu-id="703d9-576">Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [<span data-ttu-id="703d9-577">Criando parâmetros de controle de fonte de dados personalizado</span><span class="sxs-lookup"><span data-stu-id="703d9-577">Creating Custom DataSource Control Parameters</span></span>](http://aspnet.4guysfromrolla.com/articles/110106-1.aspx)
- [<span data-ttu-id="703d9-578">Personalizando o controle CreateUserWizard</span><span class="sxs-lookup"><span data-stu-id="703d9-578">Customizing the CreateUserWizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)
- [<span data-ttu-id="703d9-579">Guias de início rápido controle DetailsView</span><span class="sxs-lookup"><span data-stu-id="703d9-579">DetailsView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/detailsview.aspx)
- [<span data-ttu-id="703d9-580">Exibindo dados com o controle ListView</span><span class="sxs-lookup"><span data-stu-id="703d9-580">Displaying Data with the ListView Control</span></span>](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)
- [<span data-ttu-id="703d9-581">Dissecando os controles de validação no ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="703d9-581">Dissecting the Validation Controls in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)
- [<span data-ttu-id="703d9-582">Edição de inserção e exclusão de dados</span><span class="sxs-lookup"><span data-stu-id="703d9-582">Editing Insert and Deleting Data</span></span>](../../data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)
- [<span data-ttu-id="703d9-583">Validação do formulário no ASP.NET</span><span class="sxs-lookup"><span data-stu-id="703d9-583">Form Validation in ASP.NET</span></span>](http://www.4guysfromrolla.com/webtech/090200-1.shtml)
- [<span data-ttu-id="703d9-584">Coletando informações de registro de usuário personalizada</span><span class="sxs-lookup"><span data-stu-id="703d9-584">Gathering Custom User Registration Information</span></span>](https://weblogs.asp.net/scottgu/archive/2006/07/05/Tip_2F00_Trick_3A00_-Gathering-Custom-User-Registration-Information.aspx)
- [<span data-ttu-id="703d9-585">Perfis no ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="703d9-585">Profiles in ASP.NET 2.0</span></span>](http://www.odetocode.com/Articles/440.aspx)
- [<span data-ttu-id="703d9-586">O controle asp: ListView</span><span class="sxs-lookup"><span data-stu-id="703d9-586">The asp:ListView Control</span></span>](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)
- [<span data-ttu-id="703d9-587">Início rápido de perfis de usuário</span><span class="sxs-lookup"><span data-stu-id="703d9-587">User Profiles QuickStart</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/profile/default.aspx)

### <a name="about-the-author"></a><span data-ttu-id="703d9-588">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="703d9-588">About the Author</span></span>

<span data-ttu-id="703d9-589">Scott Mitchell, autor de vários livros sobre ASP/ASP.NET e fundador da 4GuysFromRolla.com, trabalha com tecnologias Web Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="703d9-589">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="703d9-590">Scott funciona como um consultor independente, instrutor e escritor.</span><span class="sxs-lookup"><span data-stu-id="703d9-590">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="703d9-591">Seu livro mais recente é  *[Sams Teach por conta própria ASP.NET 2.0 em 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="703d9-591">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="703d9-592">Scott pode ser contatado pelo [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) ou por meio de seu blog em [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="703d9-592">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="703d9-593">Agradecimentos especiais a...</span><span class="sxs-lookup"><span data-stu-id="703d9-593">Special Thanks To…</span></span>

<span data-ttu-id="703d9-594">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="703d9-594">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="703d9-595">Você está interessado na revisão Meus próximos artigos do MSDN?</span><span class="sxs-lookup"><span data-stu-id="703d9-595">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="703d9-596">Nesse caso, me descartar uma linha na [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="703d9-596">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="703d9-597">[Anterior](user-based-authorization-cs.md)
> [Próximo](creating-the-membership-schema-in-sql-server-vb.md)</span><span class="sxs-lookup"><span data-stu-id="703d9-597">[Previous](user-based-authorization-cs.md)
[Next](creating-the-membership-schema-in-sql-server-vb.md)</span></span>
