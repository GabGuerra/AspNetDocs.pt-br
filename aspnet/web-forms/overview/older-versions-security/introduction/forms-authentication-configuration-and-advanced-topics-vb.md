---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
title: Configuração de autenticação formulários e tópicos avançados (VB) | Microsoft Docs
author: rick-anderson
description: Neste tutorial examinaremos as várias configurações de autenticação de formulários e veja como modificá-los por meio do elemento de formulários. Isso envolvem uma detalhada...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: 829d2f56-5c48-445b-b826-3418a450c788
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
msc.type: authoredcontent
ms.openlocfilehash: eb533cf763c2f3132ea0a5420b4d4cbea16c61cd
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57061423"
---
<a name="forms-authentication-configuration-and-advanced-topics-vb"></a><span data-ttu-id="76bf3-104">Configuração de autenticação de formulários e tópicos avançados (VB)</span><span class="sxs-lookup"><span data-stu-id="76bf3-104">Forms Authentication Configuration and Advanced Topics (VB)</span></span>
====================
<span data-ttu-id="76bf3-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="76bf3-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="76bf3-106">[Baixar o código](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) ou [baixar PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="76bf3-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span></span>

> <span data-ttu-id="76bf3-107">Neste tutorial examinaremos as várias configurações de autenticação de formulários e veja como modificá-los por meio do elemento de formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="76bf3-108">Isso envolvem uma visão detalhada de como personalizar o valor de tempo limite do tíquete de autenticação de formulários, usando uma página de logon com uma URL personalizada (como SignIn.aspx em vez de login. aspx) e tíquetes de autenticação de formulários sem cookies.</span><span class="sxs-lookup"><span data-stu-id="76bf3-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>


## <a name="introduction"></a><span data-ttu-id="76bf3-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="76bf3-109">Introduction</span></span>

<span data-ttu-id="76bf3-110">No [tutorial anterior](an-overview-of-forms-authentication-vb.md) analisamos as etapas necessárias para implementar a autenticação de formulários em um aplicativo ASP.NET, da especificação de definições de configuração no Web. config para a criação de um log na página para exibir diferentes conteúdo para usuários anônimos e autenticados.</span><span class="sxs-lookup"><span data-stu-id="76bf3-110">In the [previous tutorial](an-overview-of-forms-authentication-vb.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="76bf3-111">Lembre-se de que podemos configurar o site para usar autenticação de formulários, definindo o atributo do modo dos &lt;autenticação&gt; elemento aos formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="76bf3-112">O &lt;autenticação&gt; elemento pode incluir opcionalmente um &lt;formulários&gt; elemento filho, por meio do qual uma variedade de configurações de autenticação de formulários pode ser especificada.</span><span class="sxs-lookup"><span data-stu-id="76bf3-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="76bf3-113">Neste tutorial examinaremos as várias configurações de autenticação de formulários e veja como modificá-los por meio de &lt;formulários&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="76bf3-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="76bf3-114">Isso envolvem uma visão detalhada de como personalizar o valor de tempo limite do tíquete de autenticação de formulários, usando uma página de logon com uma URL personalizada (como SignIn.aspx em vez de login. aspx) e tíquetes de autenticação de formulários sem cookies.</span><span class="sxs-lookup"><span data-stu-id="76bf3-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="76bf3-115">Também examinaremos a composição de tíquete de autenticação de formulários mais de perto e ver as precauções que ASP.NET usa para garantir que os dados de tíquete sejam protegidos contra inspeção e violação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="76bf3-116">Por fim, vamos examinar como modelar esses dados por meio de um objeto de entidade personalizado e de como armazenar dados de usuário adicionais no tíquete de autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="76bf3-117">Etapa 1: Examinando os &lt;formulários&gt; definições de configuração</span><span class="sxs-lookup"><span data-stu-id="76bf3-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="76bf3-118">O sistema de autenticação de formulários no ASP.NET oferece uma série de definições de configuração que podem ser personalizados em uma base por aplicativo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="76bf3-119">Isso inclui configurações como: o tempo de vida de autenticação de formulários do tíquete; que tipo de proteção é aplicado ao tíquete; em qual autenticação sem cookies de condições, as permissões são usadas; o caminho para a página de logon. e outras informações.</span><span class="sxs-lookup"><span data-stu-id="76bf3-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="76bf3-120">Para modificar os valores padrão, adicione uma [ &lt;formulários&gt; elemento](https://msdn.microsoft.com/library/1d3t3c61.aspx) como um filho a [ &lt;autenticação&gt; elemento](https://msdn.microsoft.com/library/532aee0e.aspx), especificando essas propriedade valores que você deseja personalizar como atributos XML desta forma:</span><span class="sxs-lookup"><span data-stu-id="76bf3-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample1.xml)]

<span data-ttu-id="76bf3-121">A tabela 1 resume as propriedades que podem ser personalizadas por meio de &lt;formulários&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="76bf3-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="76bf3-122">Como o Web. config é um arquivo XML, os nomes de atributo na coluna esquerda diferenciam maiusculas de minúsculas.</span><span class="sxs-lookup"><span data-stu-id="76bf3-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>


| <span data-ttu-id="76bf3-123"><strong>Atributo</strong></span><span class="sxs-lookup"><span data-stu-id="76bf3-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="76bf3-124"><strong>Descrição</strong></span><span class="sxs-lookup"><span data-stu-id="76bf3-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="76bf3-125">sem cookies</span><span class="sxs-lookup"><span data-stu-id="76bf3-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="76bf3-126">Esse atributo especifica em quais condições o tíquete de autenticação é armazenado em um cookie versus sendo inserida na URL.</span><span class="sxs-lookup"><span data-stu-id="76bf3-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="76bf3-127">Valores permitidos são: UseCookies; UseUri; Detecção automática; e UseDeviceProfile (o padrão).</span><span class="sxs-lookup"><span data-stu-id="76bf3-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="76bf3-128">Etapa 2 examina essa configuração em mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="76bf3-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="76bf3-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="76bf3-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="76bf3-130">Indica a URL que os usuários são redirecionados para depois de entrar na página de logon, se não houver nenhum valor de URL de redirecionamento especificado na cadeia de consulta.</span><span class="sxs-lookup"><span data-stu-id="76bf3-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="76bf3-131">O valor padrão é default. aspx.</span><span class="sxs-lookup"><span data-stu-id="76bf3-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="76bf3-132">domínio</span><span class="sxs-lookup"><span data-stu-id="76bf3-132">domain</span></span>           | <span data-ttu-id="76bf3-133">Ao usar os tíquetes de autenticação baseada em cookies, essa configuração especifica o valor de domínio do cookie s.</span><span class="sxs-lookup"><span data-stu-id="76bf3-133">When using cookie-based authentication tickets, this setting specifies the cookie s domain value.</span></span> <span data-ttu-id="76bf3-134">O valor padrão é uma cadeia de caracteres vazia, o que faz com que o navegador para usar o domínio do qual ele foi emitido (como www.yourdomain.com).</span><span class="sxs-lookup"><span data-stu-id="76bf3-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="76bf3-135">Nesse caso, o cookie será <strong>não</strong> ser enviada quando a tomada de solicitações para subdomínios, como admin.yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="76bf3-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="76bf3-136">Se você quiser que o cookie a ser passado para todos os subdomínios, você precisará personalizar o atributo de domínio, configurando-a como seudomínio.com.</span><span class="sxs-lookup"><span data-stu-id="76bf3-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="76bf3-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="76bf3-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="76bf3-138">Um valor booliano que indica se os usuários autenticados devem ser lembrados quando redirecionados para URLs em outros aplicativos da web no mesmo servidor.</span><span class="sxs-lookup"><span data-stu-id="76bf3-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="76bf3-139">O padrão é falso.</span><span class="sxs-lookup"><span data-stu-id="76bf3-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="76bf3-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="76bf3-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="76bf3-141">A URL da página de logon.</span><span class="sxs-lookup"><span data-stu-id="76bf3-141">The URL of the login page.</span></span> <span data-ttu-id="76bf3-142">O valor padrão é login.aspx.</span><span class="sxs-lookup"><span data-stu-id="76bf3-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="76bf3-143">name</span><span class="sxs-lookup"><span data-stu-id="76bf3-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="76bf3-144">Ao usar os tíquetes de autenticação baseada em cookies, o nome do cookie.</span><span class="sxs-lookup"><span data-stu-id="76bf3-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="76bf3-145">O padrão é. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="76bf3-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="76bf3-146">path</span><span class="sxs-lookup"><span data-stu-id="76bf3-146">path</span></span>            |                                                                             <span data-ttu-id="76bf3-147">Ao usar os tíquetes de autenticação baseada em cookies, essa configuração especifica o atributo de caminho do cookie s.</span><span class="sxs-lookup"><span data-stu-id="76bf3-147">When using cookie-based authentication tickets, this setting specifies the cookie s path attribute.</span></span> <span data-ttu-id="76bf3-148">O atributo de caminho permite que um desenvolvedor limitar o escopo de um cookie para uma hierarquia de diretório específico.</span><span class="sxs-lookup"><span data-stu-id="76bf3-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="76bf3-149">O valor padrão é /, que informa ao navegador para enviar o cookie do tíquete de autenticação para qualquer solicitação feita ao domínio.</span><span class="sxs-lookup"><span data-stu-id="76bf3-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="76bf3-150">proteção</span><span class="sxs-lookup"><span data-stu-id="76bf3-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="76bf3-151">Indica quais técnicas são usadas para proteger o tíquete de autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="76bf3-152">Os valores permitidos são: Todos os (o padrão); Criptografia; Nenhum; e a validação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="76bf3-153">Essas configurações são discutidas em detalhes na etapa 3.</span><span class="sxs-lookup"><span data-stu-id="76bf3-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="76bf3-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="76bf3-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="76bf3-155">Um valor booliano que indica se uma conexão SSL é necessária para transmitir o cookie de autenticação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="76bf3-156">O valor padrão é false.</span><span class="sxs-lookup"><span data-stu-id="76bf3-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="76bf3-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="76bf3-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="76bf3-158">Um valor booliano que indica que se o tempo limite s do cookie de autenticação é redefinido cada vez que o usuário visita o site durante uma única sessão.</span><span class="sxs-lookup"><span data-stu-id="76bf3-158">A Boolean value that indicates whether the authentication cookie s timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="76bf3-159">O valor padrão é true.</span><span class="sxs-lookup"><span data-stu-id="76bf3-159">The default value is true.</span></span> <span data-ttu-id="76bf3-160">A política de tempo limite do tíquete de autenticação é discutida mais detalhadamente o especificando o tíquete de seção do valor de tempo limite de s.</span><span class="sxs-lookup"><span data-stu-id="76bf3-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="76bf3-161">tempo limite</span><span class="sxs-lookup"><span data-stu-id="76bf3-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="76bf3-162">Especifica o tempo, em minutos, após o qual o cookie do tíquete de autenticação expira.</span><span class="sxs-lookup"><span data-stu-id="76bf3-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="76bf3-163">O valor padrão é 30.</span><span class="sxs-lookup"><span data-stu-id="76bf3-163">The default value is 30.</span></span> <span data-ttu-id="76bf3-164">A política de tempo limite do tíquete de autenticação é discutida mais detalhadamente o especificando o tíquete de seção do valor de tempo limite de s.</span><span class="sxs-lookup"><span data-stu-id="76bf3-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="76bf3-165">**Tabela 1**: Um resumo do &lt;formulários&gt; atributos do elemento</span><span class="sxs-lookup"><span data-stu-id="76bf3-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="76bf3-166">No ASP.NET 2.0 e posteriores, o padrão a valores de autenticação de formulários são embutidos em código na classe FormsAuthenticationConfiguration no .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="76bf3-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="76bf3-167">Devem ser aplicadas a todas as modificações em uma base por aplicativo no arquivo Web. config.</span><span class="sxs-lookup"><span data-stu-id="76bf3-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="76bf3-168">Isso é diferente do ASP.NET 1. x, onde os valores de autenticação de formulários padrão foram armazenados no arquivo Machine. config (e, portanto, pode ser modificados por meio da edição Machine. config).</span><span class="sxs-lookup"><span data-stu-id="76bf3-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="76bf3-169">Enquanto o tópico do ASP.NET 1.x, vale a pena mencionar que um número das configurações de sistema de autenticação de formulários têm valores padrão diferentes no ASP.NET 2.0 e além dele, que no ASP.NET 1. x.</span><span class="sxs-lookup"><span data-stu-id="76bf3-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="76bf3-170">Se você estiver migrando seu aplicativo em um ambiente do ASP.NET 1. x, é importante estar ciente dessas diferenças.</span><span class="sxs-lookup"><span data-stu-id="76bf3-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="76bf3-171">Consultar [as &lt;formulários&gt; documentação técnica do elemento](https://msdn.microsoft.com/library/1d3t3c61.aspx) para obter uma lista das diferenças.</span><span class="sxs-lookup"><span data-stu-id="76bf3-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-172">Várias configurações de autenticação de formulários, como o tempo limite, o domínio e o caminho, especificam os detalhes para o cookie de tíquete de autenticação de formulários resultante.</span><span class="sxs-lookup"><span data-stu-id="76bf3-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="76bf3-173">Para obter mais informações sobre cookies, como elas funcionam e suas várias propriedades, leia [este tutorial de Cookies](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="76bf3-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>


### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="76bf3-174">Especificando o valor de tempo limite do tíquete</span><span class="sxs-lookup"><span data-stu-id="76bf3-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="76bf3-175">O tíquete de autenticação de formulários é um token que representa uma identidade.</span><span class="sxs-lookup"><span data-stu-id="76bf3-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="76bf3-176">Com permissões de autenticação baseada em cookies, esse token é mantido na forma de um cookie e enviado para o servidor web em cada solicitação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="76bf3-177">A posse do token, em essência, declara, eu sou *nome de usuário*, eu já fez logon e é usado para que a identidade do usuário pode ser lembrada em visitas à página.</span><span class="sxs-lookup"><span data-stu-id="76bf3-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="76bf3-178">O tíquete de autenticação de formulários não apenas inclui a identidade do usuário, mas também contém informações para ajudar a garantir a integridade e a segurança do token.</span><span class="sxs-lookup"><span data-stu-id="76bf3-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="76bf3-179">Afinal, não queremos que um usuário perigoso para poder criar um token falsificado ou modificar um token legítimas de alguma forma underhanded.</span><span class="sxs-lookup"><span data-stu-id="76bf3-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="76bf3-180">Um tal bit de informações incluídas no tíquete é um *expiração*, que é a data e hora que o tíquete não é mais válido.</span><span class="sxs-lookup"><span data-stu-id="76bf3-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="76bf3-181">Cada vez que o FormsAuthenticationModule inspeciona um tíquete de autenticação, ele garante a expiração do tíquete ainda não tiver passado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="76bf3-182">Em caso positivo, ele desconsidera o tíquete e identifica o usuário como sendo anônimo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="76bf3-183">Essa proteção ajuda a proteger contra ataques de repetição.</span><span class="sxs-lookup"><span data-stu-id="76bf3-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="76bf3-184">Sem uma expiração, se um hacker conseguiu obter suas mãos no tíquete de autenticação válido de um usuário - talvez obtendo acesso físico ao seu computador e torcendo por meio de seus cookies, eles poderiam enviar uma solicitação para o servidor com esse tíquete de autenticação roubados e obter a entrada.</span><span class="sxs-lookup"><span data-stu-id="76bf3-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="76bf3-185">Embora a expiração não impede que esse cenário, isso limita a janela durante o qual um ataque desse tipo pode ser bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="76bf3-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-186">Etapa 3 técnicas adicionais de detalhes usadas pelo sistema de autenticação de formulários para proteger o tíquete de autenticação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>


<span data-ttu-id="76bf3-187">Ao criar o tíquete de autenticação, o sistema de autenticação de formulários determina sua expiração consultando a configuração de tempo limite.</span><span class="sxs-lookup"><span data-stu-id="76bf3-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="76bf3-188">Conforme observado na tabela 1, o tempo limite configurando padrões para 30 minutos, o que significa que, quando o tíquete de autenticação de formulários é criado sua expiração é definida como uma data e hora, 30 minutos no futuro.</span><span class="sxs-lookup"><span data-stu-id="76bf3-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="76bf3-189">A expiração define um tempo absoluto no futuro em que o tíquete de autenticação de formulários expira.</span><span class="sxs-lookup"><span data-stu-id="76bf3-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="76bf3-190">Mas, normalmente, os desenvolvedores querem implementar uma expiração deslizante, que é redefinida toda vez que o usuário revisitar o site.</span><span class="sxs-lookup"><span data-stu-id="76bf3-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="76bf3-191">Esse comportamento é determinado pelas configurações slidingExpiration.</span><span class="sxs-lookup"><span data-stu-id="76bf3-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="76bf3-192">Se definido como true (padrão), cada vez que o FormsAuthenticationModule autentica um usuário, ele de atualizações de expiração do tíquete.</span><span class="sxs-lookup"><span data-stu-id="76bf3-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="76bf3-193">Se definido como false, a expiração não é atualizado em cada solicitação, causando assim o tíquete expirar exatamente tempo limite número de minutos passados quando o tíquete foi inicialmente criado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-194">A expiração armazenada no tíquete de autenticação é uma data absoluta e o valor de tempo, como em 2 de agosto de 2008 11:34 AM.</span><span class="sxs-lookup"><span data-stu-id="76bf3-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="76bf3-195">Além disso, a data e hora são em relação à hora do local do servidor web.</span><span class="sxs-lookup"><span data-stu-id="76bf3-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="76bf3-196">Essa decisão de design pode ter alguns efeitos colaterais de interessantes em torno do horário de verão (DST), que é quando os relógios dos Estados Unidos são movidos com antecedência (supondo que o servidor web está hospedado em uma localidade em que o horário de verão é observada) de uma hora.</span><span class="sxs-lookup"><span data-stu-id="76bf3-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="76bf3-197">Considere o que aconteceria para um site ASP.NET com uma expiração de 30 minutos próximos ao horário em que horário de verão começa (que é às 2 horas).</span><span class="sxs-lookup"><span data-stu-id="76bf3-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="76bf3-198">Imagine que um visitante se inscreve para o site em 11 de março de 2008 à 1h: 55.</span><span class="sxs-lookup"><span data-stu-id="76bf3-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="76bf3-199">Isso geraria um tíquete de autenticação de formulários expira no dia 11 de março de 2008 às: 25 2H (30 minutos no futuro).</span><span class="sxs-lookup"><span data-stu-id="76bf3-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="76bf3-200">No entanto, depois de chegar às 2H, o relógio salta para 3:00 AM devido ao horário de verão.</span><span class="sxs-lookup"><span data-stu-id="76bf3-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="76bf3-201">Quando o usuário carregar uma nova página de seis minutos depois de entrar (em 3:01 AM), o FormsAuthenticationModule observa que o tíquete expirou e redireciona o usuário para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="76bf3-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="76bf3-202">Para obter uma discussão mais completa sobre esse e outros Singularidades do tempo limite de tíquete de autenticação, bem como soluções alternativas, escolher um exemplar de Stefan Schackow *Professional ASP.NET 2.0 segurança, associação e gerenciamento de função* (ISBN: 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="76bf3-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>


<span data-ttu-id="76bf3-203">Figura 1 ilustra o fluxo de trabalho quando slidingExpiration é definido como false e o tempo limite é definido como 30.</span><span class="sxs-lookup"><span data-stu-id="76bf3-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="76bf3-204">Observe que o tíquete de autenticação gerado no logon contém a data de validade, e esse valor não é atualizado em solicitações subsequentes.</span><span class="sxs-lookup"><span data-stu-id="76bf3-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="76bf3-205">Se o FormsAuthenticationModule localiza o tíquete expirou, ele descarta e trata a solicitação como anônimo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>


<span data-ttu-id="76bf3-206">[![Uma representação gráfica dos slidingExpiration do tíquete de autenticação de formulários de expiração quando for false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="76bf3-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span></span>

<span data-ttu-id="76bf3-207">**Figura 01**: Uma representação gráfica dos slidingExpiration do tíquete de autenticação de formulários de expiração quando for false ([clique para exibir a imagem em tamanho normal](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="76bf3-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span></span>


<span data-ttu-id="76bf3-208">A Figura 2 mostra o fluxo de trabalho quando slidingExpiration é definido como true e o tempo limite é definido como 30.</span><span class="sxs-lookup"><span data-stu-id="76bf3-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="76bf3-209">Quando uma solicitação autenticada é recebida (com um tíquete não expirados) sua expiração é atualizada para o tempo limite número de minutos no futuro.</span><span class="sxs-lookup"><span data-stu-id="76bf3-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>


<span data-ttu-id="76bf3-210">[![Uma representação gráfica do tíquete de autenticação de formulários quando slidingExpiration é true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="76bf3-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span></span>

<span data-ttu-id="76bf3-211">**Figura 02**: Uma representação gráfica do tíquete de autenticação de formulários quando slidingExpiration é true ([clique para exibir a imagem em tamanho normal](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="76bf3-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span></span>


<span data-ttu-id="76bf3-212">Ao usar os tíquetes de autenticação baseada em cookie (o padrão), esta discussão se torna um pouco mais confusa porque cookies também podem ter seus próprios expirações especificadas.</span><span class="sxs-lookup"><span data-stu-id="76bf3-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="76bf3-213">Expiração de um cookie (ou falta de preparação) instrui o navegador quando o cookie deve ser destruído.</span><span class="sxs-lookup"><span data-stu-id="76bf3-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="76bf3-214">Se o cookie não tiver uma expiração, ele é destruído quando o navegador é fechado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="76bf3-215">Se houver uma expiração, no entanto, o cookie permanecerá armazenado no computador do usuário até a data e especificado na expiração do tempo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="76bf3-216">Quando um cookie for destruído pelo navegador, ele não é enviado ao servidor web.</span><span class="sxs-lookup"><span data-stu-id="76bf3-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="76bf3-217">Portanto, a destruição de um cookie é análoga ao usuário fazer logoff do site.</span><span class="sxs-lookup"><span data-stu-id="76bf3-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-218">É claro, é possível que um usuário proativamente remover quaisquer cookies armazenados em seu computador.</span><span class="sxs-lookup"><span data-stu-id="76bf3-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="76bf3-219">No Internet Explorer 7, você teria vá para ferramentas, opções e clique no botão Excluir na seção de histórico de navegação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="76bf3-220">A partir daí, clique no botão Excluir cookies.</span><span class="sxs-lookup"><span data-stu-id="76bf3-220">From there, click the Delete cookies button.</span></span>


<span data-ttu-id="76bf3-221">O sistema de autenticação de formulários cria cookies com base em sessão ou com base em expiração, dependendo do valor passado para o *persistCookie* parâmetro.</span><span class="sxs-lookup"><span data-stu-id="76bf3-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="76bf3-222">Lembre-se que os métodos da classe FormsAuthentication de GetAuthCookie, SetAuthCookie e RedirectFromLoginPage levar dois parâmetros de entrada: *nome de usuário* e *persistCookie*.</span><span class="sxs-lookup"><span data-stu-id="76bf3-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="76bf3-223">A página de logon que criamos no tutorial anterior incluído um CheckBox lembrar-me, que determinado se um cookie persistente foi criado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="76bf3-224">Cookies persistentes são baseados em expiração; cookies não persistentes são baseadas em sessão.</span><span class="sxs-lookup"><span data-stu-id="76bf3-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="76bf3-225">Os tempo limite e slidingExpiration conceitos já discutidos aplicam o mesmo para ambos os cookies com base em sessão e expiração.</span><span class="sxs-lookup"><span data-stu-id="76bf3-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="76bf3-226">Há apenas uma diferença mínima em execução: ao usar cookies com base em expiração com slidingTimeout definido como true, expiração do cookie só é atualizada quando mais de metade do tempo especificado tiver decorrido.</span><span class="sxs-lookup"><span data-stu-id="76bf3-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="76bf3-227">Vamos atualizar as políticas de tempo limite de tíquete de autenticação do nosso site para que tíquetes do tempo limite após uma hora (60 minutos), usando uma expiração deslizante.</span><span class="sxs-lookup"><span data-stu-id="76bf3-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="76bf3-228">Para efetuar essa alteração, atualize o arquivo Web. config, adicionando um &lt;formulários&gt; elemento para o &lt;autenticação&gt; elemento com a seguinte marcação:</span><span class="sxs-lookup"><span data-stu-id="76bf3-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="76bf3-229">Usando uma URL da página de logon diferente de login. aspx</span><span class="sxs-lookup"><span data-stu-id="76bf3-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="76bf3-230">Uma vez que o FormsAuthenticationModule redireciona automaticamente os usuários não autorizados para a página de logon, ele precisa saber a URL da página de logon.</span><span class="sxs-lookup"><span data-stu-id="76bf3-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="76bf3-231">Essa URL é especificada pelo atributo loginUrl na &lt;formulários&gt; elemento e o padrão é login. aspx.</span><span class="sxs-lookup"><span data-stu-id="76bf3-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="76bf3-232">Se você estiver portando ao longo de um site existente, você talvez já tenha uma página de logon com uma URL diferente, um que já foi marcada e indexada por mecanismos de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="76bf3-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="76bf3-233">Em vez de renomear sua página de logon existentes para login. aspx e quebrar links e marcadores de usuários, você pode modificar em vez disso, o atributo loginUrl para apontar para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="76bf3-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="76bf3-234">Por exemplo, se sua página de logon foi nomeada SignIn.aspx e foi localizada no diretório de usuários, você pode apontar a definição de configuração loginUrl para ~/Users/SignIn.aspx da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="76bf3-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample3.xml)]

<span data-ttu-id="76bf3-235">Como nosso aplicativo atual já tem uma página de logon chamada Login. aspx, não é necessário especificar um valor personalizado na &lt;formulários&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="76bf3-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="76bf3-236">Etapa 2: Usando sem cookies tíquetes de autenticação de formulários</span><span class="sxs-lookup"><span data-stu-id="76bf3-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="76bf3-237">Por padrão, o sistema de autenticação de formulários determina se deseja armazenar seus tíquetes de autenticação na coleção de cookies ou inseri-las na URL com base no agente do usuário visitar o site.</span><span class="sxs-lookup"><span data-stu-id="76bf3-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="76bf3-238">Todos os navegadores da área de trabalho como cookies de suporte do Internet Explorer, Firefox, Opera e Safari, mas não todos os dispositivos móveis.</span><span class="sxs-lookup"><span data-stu-id="76bf3-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="76bf3-239">A política de cookie usada pelo sistema de autenticação de formulários depende da configuração sem cookies na &lt;formulários&gt; elemento, que pode ser atribuído um dos quatro valores:</span><span class="sxs-lookup"><span data-stu-id="76bf3-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="76bf3-240">UseCookies - Especifica que os tíquetes de autenticação baseada em cookie sempre serão usados.</span><span class="sxs-lookup"><span data-stu-id="76bf3-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="76bf3-241">UseUri - indica que os tíquetes de autenticação baseada em cookie nunca serão usados.</span><span class="sxs-lookup"><span data-stu-id="76bf3-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="76bf3-242">Detecção automática - se o perfil de dispositivo não dá suporte a cookies, tíquetes de autenticação baseada em cookies não são usados; Se o perfil de dispositivo dá suporte a cookies, um mecanismo de investigação é usado para determinar se os cookies estão habilitados.</span><span class="sxs-lookup"><span data-stu-id="76bf3-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="76bf3-243">UseDeviceProfile - padrão. usa os tíquetes de autenticação baseada em cookie somente se o perfil de dispositivo dá suporte a cookies.</span><span class="sxs-lookup"><span data-stu-id="76bf3-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="76bf3-244">Nenhum mecanismo de investigação é usado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-244">No probing mechanism is used.</span></span>

<span data-ttu-id="76bf3-245">As configurações de detecção automática e UseDeviceProfile dependem de um *perfil de dispositivo* no atestar se é necessário usar tíquetes de autenticação sem cookies ou baseada em cookie.</span><span class="sxs-lookup"><span data-stu-id="76bf3-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="76bf3-246">O ASP.NET mantém um banco de dados de vários dispositivos e seus recursos, como se eles dão suporte a cookies, qual versão do JavaScript dar suporte a eles e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="76bf3-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="76bf3-247">Cada vez que um dispositivo solicita uma página da web de um servidor web que ele envia ao longo de um *agente do usuário* cabeçalho HTTP que identifica o tipo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="76bf3-248">ASP.NET corresponde automaticamente a cadeia de caracteres de agente do usuário fornecido com o perfil correspondente especificado no seu banco de dados.</span><span class="sxs-lookup"><span data-stu-id="76bf3-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-249">Este banco de dados de recursos do dispositivo é armazenado em um número de arquivos XML que seguem a [esquema de arquivo de definição do navegador](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="76bf3-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="76bf3-250">Os arquivos de perfil de dispositivo padrão estão localizados em % WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="76bf3-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="76bf3-251">Você também pode adicionar arquivos personalizados ao aplicativo do seu aplicativo\_pasta navegadores.</span><span class="sxs-lookup"><span data-stu-id="76bf3-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="76bf3-252">Para obter mais informações, consulte [How To: Detectar tipos de navegador em páginas da Web ASP.NET](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="76bf3-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>


<span data-ttu-id="76bf3-253">Como a configuração padrão é UseDeviceProfile, tíquetes de autenticação de formulários sem cookies serão usadas quando o site é visitado por um dispositivo cujo perfil informa que ele não dá suporte a cookies.</span><span class="sxs-lookup"><span data-stu-id="76bf3-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="76bf3-254">O tíquete de autenticação na URL de codificação</span><span class="sxs-lookup"><span data-stu-id="76bf3-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="76bf3-255">Os cookies são uma mídia natural para incluir informações do navegador em cada solicitação para um site específico, por isso, as configurações de autenticação de formulários padrão usam cookies se o dispositivo visitando ofereça suporte a eles.</span><span class="sxs-lookup"><span data-stu-id="76bf3-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="76bf3-256">Se os cookies não são suportados, deve-se empregar um meio alternativo para transmitir o tíquete de autenticação do cliente ao servidor.</span><span class="sxs-lookup"><span data-stu-id="76bf3-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="76bf3-257">É uma solução comum usada em ambientes sem cookies codificar os dados do cookie na URL.</span><span class="sxs-lookup"><span data-stu-id="76bf3-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="76bf3-258">A melhor maneira de ver como essas informações podem estar incorporadas a URL é forçar o site para usar os tíquetes de autenticação sem cookies.</span><span class="sxs-lookup"><span data-stu-id="76bf3-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="76bf3-259">Isso pode ser feito definindo o parâmetro de configuração sem cookies para UseUri:</span><span class="sxs-lookup"><span data-stu-id="76bf3-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample4.xml)]

<span data-ttu-id="76bf3-260">Depois de fazer essa alteração, visite o site por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="76bf3-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="76bf3-261">Ao visitar como um usuário anônimo, as URLs serão semelhantes, exatamente como antes.</span><span class="sxs-lookup"><span data-stu-id="76bf3-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="76bf3-262">Por exemplo, ao visitar a página Default. aspx barra de endereços do meu navegador mostra a seguinte URL:</span><span class="sxs-lookup"><span data-stu-id="76bf3-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="76bf3-263">No entanto, após fazer logon, o tíquete de autenticação de formulários é incorporado na URL.</span><span class="sxs-lookup"><span data-stu-id="76bf3-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="76bf3-264">Por exemplo, depois de visitar a página de logon e registro em log como Sam, eu estou retornado para a página Default. aspx, mas a URL neste momento é:</span><span class="sxs-lookup"><span data-stu-id="76bf3-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="76bf3-265">O tíquete de autenticação de formulários foi incorporado na URL.</span><span class="sxs-lookup"><span data-stu-id="76bf3-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="76bf3-266">A cadeia de caracteres (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv rfezq0gKadKX0YPZCkA2) representa as informações de tíquete de autenticação codificada em hexadecimal e são os mesmos dados que normalmente são armazenados em um cookie.</span><span class="sxs-lookup"><span data-stu-id="76bf3-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="76bf3-267">Em ordem para tíquetes de autenticação sem cookies funcione, o sistema deverá codificar todas as URLs na página para incluir os dados de tíquete de autenticação, caso contrário, o tíquete de autenticação serão perdido quando o usuário clica em um link.</span><span class="sxs-lookup"><span data-stu-id="76bf3-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="76bf3-268">Felizmente, essa lógica de inserção é executada automaticamente.</span><span class="sxs-lookup"><span data-stu-id="76bf3-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="76bf3-269">Para demonstrar essa funcionalidade, abra a página Default. aspx e adicione um controle de hiperlink, definindo suas propriedades de texto e NavigateUrl para testar Link e SomePage.aspx, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="76bf3-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="76bf3-270">Não importa que existe realmente não uma página em nosso projeto chamado SomePage.aspx.</span><span class="sxs-lookup"><span data-stu-id="76bf3-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="76bf3-271">Salvar as alterações em Default. aspx e, em seguida, visite-o por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="76bf3-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="76bf3-272">Faça logon no site para que o tíquete de autenticação de formulários é inserido na URL.</span><span class="sxs-lookup"><span data-stu-id="76bf3-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="76bf3-273">Em seguida, de Default. aspx, clique no link de link "teste".</span><span class="sxs-lookup"><span data-stu-id="76bf3-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="76bf3-274">O que aconteceu?</span><span class="sxs-lookup"><span data-stu-id="76bf3-274">What happened?</span></span> <span data-ttu-id="76bf3-275">Se nenhuma página denominada SomePage.aspx existir, em seguida, um erro 404 ocorreu, mas que não é o que é importante aqui.</span><span class="sxs-lookup"><span data-stu-id="76bf3-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="76bf3-276">Em vez disso, concentre-se na barra de endereços do seu navegador.</span><span class="sxs-lookup"><span data-stu-id="76bf3-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="76bf3-277">Observe que ele inclui o tíquete de autenticação de formulários na URL!</span><span class="sxs-lookup"><span data-stu-id="76bf3-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="76bf3-278">O SomePage.aspx de URL no link foi convertida automaticamente em uma URL que incluído o tíquete de autenticação - não temos de escrever uma linha de código!</span><span class="sxs-lookup"><span data-stu-id="76bf3-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="76bf3-279">O tíquete de autenticação de formulário será inserido automaticamente na URL para todos os hiperlinks não começar com http:// ou /.</span><span class="sxs-lookup"><span data-stu-id="76bf3-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with http:// or /.</span></span> <span data-ttu-id="76bf3-280">Não importa se o hiperlink é exibido em uma chamada de Response. Redirect, em um controle de hiperlink ou em um elemento âncora HTML (ou seja, &lt;href = "..."&gt;... &lt;/a&gt;).</span><span class="sxs-lookup"><span data-stu-id="76bf3-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., &lt;a href="..."&gt;...&lt;/a&gt;).</span></span> <span data-ttu-id="76bf3-281">Desde que a URL não é algo como http://www.someserver.com/SomePage.aspx ou /SomePage.aspx, formulários de tíquete de autenticação será inserido para nós.</span><span class="sxs-lookup"><span data-stu-id="76bf3-281">As long as the URL isn't something like http://www.someserver.com/SomePage.aspx or /SomePage.aspx, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-282">Tíquetes de autenticação de formulários sem cookies seguem as mesmas políticas de tempo limite como tíquetes de autenticação baseada em cookie.</span><span class="sxs-lookup"><span data-stu-id="76bf3-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="76bf3-283">No entanto, os tíquetes de autenticação sem cookies são mais propensos a ataques de repetição, pois o tíquete de autenticação é inserido diretamente na URL.</span><span class="sxs-lookup"><span data-stu-id="76bf3-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="76bf3-284">Imagine que um usuário que visita um site, faz logon no e, em seguida, cola a URL em um email a um colega.</span><span class="sxs-lookup"><span data-stu-id="76bf3-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="76bf3-285">Se o colega clicar nesse link antes que a expiração é atingida, eles serão estar conectados como o usuário que enviou o email!</span><span class="sxs-lookup"><span data-stu-id="76bf3-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>


## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="76bf3-286">Etapa 3: Protegendo o tíquete de autenticação</span><span class="sxs-lookup"><span data-stu-id="76bf3-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="76bf3-287">O tíquete de autenticação de formulários é transmitido durante a transmissão em um cookie ou inserido diretamente na URL.</span><span class="sxs-lookup"><span data-stu-id="76bf3-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="76bf3-288">Além das informações de identidade, o tíquete de autenticação também pode incluir dados de usuário (conforme veremos na etapa 4).</span><span class="sxs-lookup"><span data-stu-id="76bf3-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="76bf3-289">Consequentemente, é importante que os dados do tíquete são criptografados das pessoas curiosas e (ainda mais importante) que o sistema de autenticação de formulários pode garantir que o tíquete não foi violado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="76bf3-290">Para garantir a privacidade dos dados de tíquete, o sistema de autenticação de formulários pode criptografar os dados de tíquete.</span><span class="sxs-lookup"><span data-stu-id="76bf3-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="76bf3-291">Falha ao criptografar os dados de tíquete envia informações potencialmente confidenciais durante a transmissão em texto sem formatação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="76bf3-292">Para garantir a autenticidade de um tíquete, o sistema de autenticação de formulários deve *validar* o tíquete.</span><span class="sxs-lookup"><span data-stu-id="76bf3-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="76bf3-293">A validação é o ato de garantir que um determinado tipo de dados não tiver sido modificado e é feito por meio de um  *[(MAC) de código de autenticação de mensagem](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span><span class="sxs-lookup"><span data-stu-id="76bf3-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="76bf3-294">Em resumo, o MAC é uma pequena parte de informações que identificam os dados que precisa ser validada (nesse caso, o tíquete).</span><span class="sxs-lookup"><span data-stu-id="76bf3-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="76bf3-295">Se os dados representados pelo MAC for modificados, em seguida, o MAC e os dados não serão correspondentes para cima.</span><span class="sxs-lookup"><span data-stu-id="76bf3-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="76bf3-296">Além disso, é computacionalmente difícil um hacker tanto modificar os dados e gerar seu próprio MAC para corresponder com os dados modificados.</span><span class="sxs-lookup"><span data-stu-id="76bf3-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="76bf3-297">Ao criar (ou modificação) um tíquete, o sistema de autenticação de formulários cria um MAC e o anexa aos dados do tíquete.</span><span class="sxs-lookup"><span data-stu-id="76bf3-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="76bf3-298">Quando chega uma solicitação subsequente, o sistema de autenticação de formulários compara os dados de MAC e tíquete para validar a autenticidade dos dados de tíquete.</span><span class="sxs-lookup"><span data-stu-id="76bf3-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="76bf3-299">Figura 3 ilustra esse fluxo de trabalho graficamente.</span><span class="sxs-lookup"><span data-stu-id="76bf3-299">Figure 3 illustrates this workflow graphically.</span></span>


<span data-ttu-id="76bf3-300">[![Autenticidade do tíquete é garantida por meio de um MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="76bf3-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span></span>

<span data-ttu-id="76bf3-301">**Figura 03**: Autenticidade do tíquete é garantida por meio de um MAC ([clique para exibir a imagem em tamanho normal](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="76bf3-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span></span>


<span data-ttu-id="76bf3-302">Quais medidas de segurança são aplicadas para o tíquete de autenticação depende da configuração de proteção na &lt;formulários&gt; elemento.</span><span class="sxs-lookup"><span data-stu-id="76bf3-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="76bf3-303">A configuração de proteção pode ser atribuída a um dos seguintes três valores:</span><span class="sxs-lookup"><span data-stu-id="76bf3-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="76bf3-304">All - o tíquete é criptografado e assinada digitalmente (o padrão).</span><span class="sxs-lookup"><span data-stu-id="76bf3-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="76bf3-305">Criptografia – criptografia só é aplicada – nenhum MAC é gerado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="76bf3-306">Nenhum - o tíquete não é criptografado, nem assinado digitalmente.</span><span class="sxs-lookup"><span data-stu-id="76bf3-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="76bf3-307">Validação - um MAC é gerada, mas os dados de tíquete são enviados eletronicamente em texto sem formatação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="76bf3-308">Microsoft recomenda o uso de todas as configurações.</span><span class="sxs-lookup"><span data-stu-id="76bf3-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="76bf3-309">Definindo as chaves de descriptografia e validação</span><span class="sxs-lookup"><span data-stu-id="76bf3-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="76bf3-310">A criptografia e algoritmos usados pelo sistema de autenticação de formulários para criptografar e validar o tíquete de autenticação de hash são personalizáveis por meio de [ &lt;machineKey&gt; elemento](https://msdn.microsoft.com/library/w8h3skw9.aspx) no Web. config. A tabela 2 descreve o &lt;machineKey&gt; atributos do elemento e seus valores possíveis.</span><span class="sxs-lookup"><span data-stu-id="76bf3-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="76bf3-311">**Atributo**</span><span class="sxs-lookup"><span data-stu-id="76bf3-311">**Attribute**</span></span> | <span data-ttu-id="76bf3-312">**Descrição**</span><span class="sxs-lookup"><span data-stu-id="76bf3-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="76bf3-313">descriptografia</span><span class="sxs-lookup"><span data-stu-id="76bf3-313">decryption</span></span> | <span data-ttu-id="76bf3-314">Indica o algoritmo usado para criptografia.</span><span class="sxs-lookup"><span data-stu-id="76bf3-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="76bf3-315">Esse atributo pode ter um dos quatro valores a seguir: - Auto - o padrão; Determina o algoritmo com base no comprimento do atributo decryptionKey.</span><span class="sxs-lookup"><span data-stu-id="76bf3-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="76bf3-316">-AES - usa a [criptografia AES (padrão avançado)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algoritmo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="76bf3-317">-DES - usa a [padrão de criptografia de dados (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) esse algoritmo é considerado computacionalmente fraco e não deve ser usado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="76bf3-318">-3DES - usa a [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algoritmo, que funciona aplicando o algoritmo DES triplo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="76bf3-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="76bf3-319">decryptionKey</span></span> | <span data-ttu-id="76bf3-320">A chave secreta usada pelo algoritmo de criptografia.</span><span class="sxs-lookup"><span data-stu-id="76bf3-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="76bf3-321">Esse valor deve ser uma cadeia de caracteres hexadecimal do tamanho apropriado (com base no valor na descriptografia), gerar automaticamente ou qualquer valor concatenado com, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="76bf3-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="76bf3-322">Adicionar IsolateApps instrui o ASP.NET para usar um valor exclusivo para cada aplicativo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="76bf3-323">O padrão é AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="76bf3-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="76bf3-324">validação</span><span class="sxs-lookup"><span data-stu-id="76bf3-324">validation</span></span> | <span data-ttu-id="76bf3-325">Indica o algoritmo usado para validação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="76bf3-326">Esse atributo pode ter um dos quatro valores a seguir: - AES - usa o algoritmo de criptografia AES (padrão avançado).</span><span class="sxs-lookup"><span data-stu-id="76bf3-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="76bf3-327">-MD5 - usa a [Message Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algoritmo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="76bf3-328">-SHA1 - usa a [SHA1](http://en.wikipedia.org/wiki/Sha1) algoritmo (o padrão).</span><span class="sxs-lookup"><span data-stu-id="76bf3-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="76bf3-329">-3DES - usa o algoritmo DES triplo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="76bf3-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="76bf3-330">validationKey</span></span> | <span data-ttu-id="76bf3-331">A chave secreta usada pelo algoritmo de validação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="76bf3-332">Esse valor deve ser uma cadeia de caracteres hexadecimal do tamanho apropriado (com base no valor de validação), gerar automaticamente ou qualquer valor concatenado com, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="76bf3-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="76bf3-333">Adicionar IsolateApps instrui o ASP.NET para usar um valor exclusivo para cada aplicativo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="76bf3-334">O padrão é AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="76bf3-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="76bf3-335">**Tabela 2**: O &lt;machineKey&gt; atributos do elemento</span><span class="sxs-lookup"><span data-stu-id="76bf3-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="76bf3-336">Uma discussão completa sobre essas opções de criptografia e validação e os prós e contras de vários algoritmos, estão além do escopo deste tutorial.</span><span class="sxs-lookup"><span data-stu-id="76bf3-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="76bf3-337">Para um profundo examinar esses problemas, incluindo diretrizes sobre quais algoritmos de criptografia e validação de usar, quais comprimentos de chave a ser usado e a melhor maneira de gerar essas chaves, consulte *Professional ASP.NET 2.0 segurança, associação e gerenciamento de função* .</span><span class="sxs-lookup"><span data-stu-id="76bf3-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="76bf3-338">Por padrão, as chaves usadas para criptografia e validação são geradas automaticamente para cada aplicativo, e essas chaves são armazenadas na autoridade de segurança Local (LSA).</span><span class="sxs-lookup"><span data-stu-id="76bf3-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="76bf3-339">Em resumo, as configurações padrão garantem que as chaves exclusivas em um servidor da web pelo servidor web e aplicativo por aplicativo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="76bf3-340">Consequentemente, esse comportamento padrão não funcionará para os dois seguintes cenários:</span><span class="sxs-lookup"><span data-stu-id="76bf3-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="76bf3-341">**Web Farms** - em uma [farm da web](http://en.wikipedia.org/wiki/Web_farm) cenário, um único aplicativo web está hospedado em vários servidores web para fins de redundância e escalabilidade.</span><span class="sxs-lookup"><span data-stu-id="76bf3-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="76bf3-342">Cada solicitação de entrada é enviada a um servidor no farm, que significa que ao longo do tempo de vida de uma sessão do usuário, servidores diferentes podem ser usadas para lidar com suas várias solicitações.</span><span class="sxs-lookup"><span data-stu-id="76bf3-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="76bf3-343">Consequentemente, cada servidor deve usar as mesmas chaves de criptografia e validação para que o tíquete de autenticação de formulários criados, criptografado e validado em um servidor pode ser descriptografado e validado em outro servidor no farm.</span><span class="sxs-lookup"><span data-stu-id="76bf3-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="76bf3-344">**Entre o aplicativo de compartilhamento de tíquete** -um único servidor web pode hospedar vários aplicativos ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="76bf3-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="76bf3-345">Se você precisar para esses aplicativos diferentes compartilhar um tíquete de autenticação de formulários único, é imperativo que suas chaves de criptografia e validação de correspondam.</span><span class="sxs-lookup"><span data-stu-id="76bf3-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="76bf3-346">Ao trabalhar em um farm da web definindo ou compartilhamento de tíquetes de autenticação entre aplicativos no mesmo servidor, você precisará configurar o &lt;machineKey&gt; elemento em aplicativos afetados para que seus decryptionKey e valores de validationKey correspondem.</span><span class="sxs-lookup"><span data-stu-id="76bf3-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="76bf3-347">Embora nenhum dos cenários acima aplica-se ao nosso aplicativo de exemplo, podemos ainda especificar valores de validationKey e decryptionKey explícita e defina os algoritmos a ser usado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="76bf3-348">Adicionar um &lt;machineKey&gt; configuração ao arquivo Web. config:</span><span class="sxs-lookup"><span data-stu-id="76bf3-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample5.xml)]

<span data-ttu-id="76bf3-349">Para obter mais informações Confira [How To: Configurar MachineKey no ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="76bf3-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-350">Os valores de validationKey decryptionKey foram tirados [Steve Gibson](http://www.grc.com/stevegibson.htm)do [página de web de senhas perfeito](https://www.grc.com/passwords.htm), que gera a 64 caracteres hexadecimais aleatórios em cada visita de página.</span><span class="sxs-lookup"><span data-stu-id="76bf3-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="76bf3-351">Para reduzir a probabilidade de que essas chaves até seus aplicativos de produção, você é incentivado a substituir as chaves acima por aqueles gerados aleatoriamente da página de senhas perfeito.</span><span class="sxs-lookup"><span data-stu-id="76bf3-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>


## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="76bf3-352">Etapa 4: Armazenar dados de usuário adicionais no tíquete</span><span class="sxs-lookup"><span data-stu-id="76bf3-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="76bf3-353">Muitos aplicativos da web exibem informações sobre ou exibição da página de base no usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="76bf3-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="76bf3-354">Por exemplo, uma página da web pode mostrar o nome do usuário e a data em que ela último logon na parte superior de cada página.</span><span class="sxs-lookup"><span data-stu-id="76bf3-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="76bf3-355">O tíquete de autenticação de formulários armazena o nome de usuário do usuário conectado no momento, mas quando qualquer outra informação é necessária, a página deve ir para o repositório do usuário - normalmente um banco de dados - para pesquisar as informações não armazenadas em do tíquete de autenticação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="76bf3-356">Com um pouco de código podemos pode armazenar informações adicionais do usuário em que o tíquete de autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="76bf3-357">Esses dados podem ser expressos por meio de [classe FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)do [UserData propriedade](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span><span class="sxs-lookup"><span data-stu-id="76bf3-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="76bf3-358">Isso é um local útil para colocar pequenas quantidades de informações sobre o usuário que normalmente é necessária.</span><span class="sxs-lookup"><span data-stu-id="76bf3-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="76bf3-359">O valor especificado em UserData propriedade é incluído como parte do cookie do tíquete de autenticação e, como os outros campos de tíquete é criptografada e validada com base na configuração do sistema de autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="76bf3-360">Por padrão, os dados do usuário é uma cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="76bf3-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="76bf3-361">Para armazenar dados de usuário em que o tíquete de autenticação, precisamos escrever um pouco de código na página de logon que captura as informações específicas do usuário e o armazena no tíquete.</span><span class="sxs-lookup"><span data-stu-id="76bf3-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="76bf3-362">Como dados do usuário é uma propriedade do tipo cadeia de caracteres, os dados armazenados nele devem ser serializados corretamente como uma cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="76bf3-362">Since UserData is a property of type String, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="76bf3-363">Por exemplo, imagine que nosso repositório do usuário incluído data de cada usuário de nascimento e o nome do seu empregador, e queremos armazenar esses valores de dois propriedade no tíquete de autenticação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="76bf3-364">Podemos pode serializar esses valores em uma cadeia de caracteres concatenando a data do usuário da cadeia de caracteres do nascimento com uma barra vertical (|), seguido pelo nome do empregador.</span><span class="sxs-lookup"><span data-stu-id="76bf3-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="76bf3-365">Para um usuário nascido em 15 de agosto de 1974 que funciona para a Northwind Traders, atribuiríamos a propriedade UserData a cadeia de caracteres: 1974-08-15 | A Northwind Traders.</span><span class="sxs-lookup"><span data-stu-id="76bf3-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="76bf3-366">Sempre que é necessário acessar os dados armazenados no tíquete, podemos fazer isso captando FormsAuthenticationTicket da solicitação atual e desserializar a propriedade de dados do usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="76bf3-367">No caso a data de nascimento e empregador exemplo de nome, podemos seria dividir a cadeia de caracteres de dados do usuário em duas subcadeias de caracteres com base no delimitador (|).</span><span class="sxs-lookup"><span data-stu-id="76bf3-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>


<span data-ttu-id="76bf3-368">[![Informações adicionais do usuário podem ser armazenadas no tíquete de autenticação](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="76bf3-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span></span>

<span data-ttu-id="76bf3-369">**Figura 04**: Adicionais usuário informações podem ser armazenados no tíquete de autenticação ([clique para exibir a imagem em tamanho normal](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="76bf3-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span></span>


### <a name="writing-information-to-userdata"></a><span data-ttu-id="76bf3-370">Gravando informações UserData</span><span class="sxs-lookup"><span data-stu-id="76bf3-370">Writing Information to UserData</span></span>

<span data-ttu-id="76bf3-371">Infelizmente, não é tão simples como se pode esperar a adição de informações específicas do usuário para um tíquete de autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="76bf3-372">A propriedade de dados do usuário da classe FormsAuthenticationTicket é somente leitura e só pode ser especificada por meio do construtor de classe FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="76bf3-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="76bf3-373">Ao especificar a propriedade de dados do usuário no construtor, também precisamos fornecer o tíquete de outros valores: o nome de usuário, a data de emissão, a expiração e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="76bf3-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="76bf3-374">Quando criamos a página de logon no tutorial anterior, isso foi tudo tratado para que possamos pela classe FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="76bf3-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="76bf3-375">Ao adicionar UserData a FormsAuthenticationTicket, precisamos escrever código para replicar grande parte da funcionalidade já fornecida pela classe FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="76bf3-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="76bf3-376">Vamos explorar o código necessário para trabalhar com dados do usuário atualizando a página de login. aspx para registrar informações adicionais sobre o usuário para o tíquete de autenticação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="76bf3-377">Suponhamos que o nosso repositório do usuário contém informações sobre o usuário trabalha para a empresa e seu título e que queremos capturar essas informações no tíquete de autenticação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="76bf3-378">Atualize o manipulador de eventos de clique LoginButton da página de login. aspx para que o código é semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="76bf3-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample6.vb)]

<span data-ttu-id="76bf3-379">Vamos percorrer esse código uma linha por vez.</span><span class="sxs-lookup"><span data-stu-id="76bf3-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="76bf3-380">O método começa definindo quatro matrizes de cadeia de caracteres: os usuários, senhas, companyName e titleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="76bf3-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="76bf3-381">Essas matrizes contêm os nomes de usuário, senhas, nomes de empresa e títulos para as contas de usuário no sistema, de que há três: Scott, Jisun e Sam.</span><span class="sxs-lookup"><span data-stu-id="76bf3-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="76bf3-382">Em um aplicativo real, esses valores seriam consultados de repositório do usuário, não embutido no código-fonte da página.</span><span class="sxs-lookup"><span data-stu-id="76bf3-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="76bf3-383">No tutorial anterior, se as credenciais fornecidas eram válidas, simplesmente chamamos FormsAuthentication. RedirectFromLoginPage (UserName.Text, RememberMe.Checked), que executou as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="76bf3-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="76bf3-384">Criado o tíquete de autenticação de formulários</span><span class="sxs-lookup"><span data-stu-id="76bf3-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="76bf3-385">Gravou o tíquete de armazenamento apropriado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="76bf3-386">Para tíquetes de autenticação baseada em cookies, a coleção de cookies do navegador é usada; para tíquetes de autenticação sem cookies, os dados de tíquete são serializados em URL</span><span class="sxs-lookup"><span data-stu-id="76bf3-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="76bf3-387">Redirecionado ao usuário para a página apropriada</span><span class="sxs-lookup"><span data-stu-id="76bf3-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="76bf3-388">Essas etapas são replicadas no código acima.</span><span class="sxs-lookup"><span data-stu-id="76bf3-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="76bf3-389">Em primeiro lugar, a cadeia de caracteres, eventualmente, armazenaremos na propriedade UserData é formada pela combinação do nome da empresa e o título, que delimita os dois valores com um caractere de pipe (|).</span><span class="sxs-lookup"><span data-stu-id="76bf3-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="76bf3-390">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span><span class="sxs-lookup"><span data-stu-id="76bf3-390">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span></span>

<span data-ttu-id="76bf3-391">Em seguida, FormsAuthentication.GetAuthCookie o método é invocado, que cria o tíquete de autenticação, criptografa e valida-lo de acordo com as definições de configuração e coloca-o em um objeto HttpCookie.</span><span class="sxs-lookup"><span data-stu-id="76bf3-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="76bf3-392">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span><span class="sxs-lookup"><span data-stu-id="76bf3-392">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span></span>

<span data-ttu-id="76bf3-393">Para trabalhar com o FormAuthenticationTicket incorporada o cookie, precisamos chamar a classe de FormAuthentication [descriptografar método](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passando o valor do cookie.</span><span class="sxs-lookup"><span data-stu-id="76bf3-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="76bf3-394">Dim ticket As FormsAuthenticationTicket = FormsAuthentication.Decrypt(authCookie.Value)</span><span class="sxs-lookup"><span data-stu-id="76bf3-394">Dim ticket As FormsAuthenticationTicket = FormsAuthentication.Decrypt(authCookie.Value)</span></span>

<span data-ttu-id="76bf3-395">Em seguida, criamos uma *novo* FormsAuthenticationTicket instância com base nos valores do FormsAuthenticationTicket existente.</span><span class="sxs-lookup"><span data-stu-id="76bf3-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="76bf3-396">No entanto, esse novo tíquete inclui informações específicas do usuário (userDataString).</span><span class="sxs-lookup"><span data-stu-id="76bf3-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="76bf3-397">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString)</span><span class="sxs-lookup"><span data-stu-id="76bf3-397">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString)</span></span>

<span data-ttu-id="76bf3-398">Nós, em seguida, criptografar (e validar) a nova instância de FormsAuthenticationTicket chamando o [método de criptografia](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)e colocar esses dados criptografados (e validados) de volta no authCookie.</span><span class="sxs-lookup"><span data-stu-id="76bf3-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="76bf3-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span><span class="sxs-lookup"><span data-stu-id="76bf3-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span></span>

<span data-ttu-id="76bf3-400">Por fim, authCookie é adicionado à coleção Response.Cookies e o método GetRedirectUrl é chamado para determinar a página apropriada para enviar ao usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample7.vb)]

<span data-ttu-id="76bf3-401">Todo esse código é necessária porque a propriedade de dados do usuário é somente leitura e a classe FormsAuthentication não fornece nenhum método para especificar informações de dados do usuário em seus métodos GetAuthCookie, SetAuthCookie ou RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="76bf3-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-402">O código que acabamos de examinar armazena informações específicas do usuário em um tíquete de autenticação baseada em cookies.</span><span class="sxs-lookup"><span data-stu-id="76bf3-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="76bf3-403">As classes responsáveis pela serialização o tíquete de autenticação de formulários para a URL são internas ao .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="76bf3-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="76bf3-404">Encurtar a história, é possível armazenar dados de usuário em um tíquete de autenticação de formulários sem cookies.</span><span class="sxs-lookup"><span data-stu-id="76bf3-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>


### <a name="accessing-the-userdata-information"></a><span data-ttu-id="76bf3-405">Acessar as informações de dados do usuário</span><span class="sxs-lookup"><span data-stu-id="76bf3-405">Accessing the UserData Information</span></span>

<span data-ttu-id="76bf3-406">Neste ponto nome da empresa e o título de cada usuário é armazenada na propriedade de dados do usuário do tíquete de autenticação de formulários quando ele fizer logon.</span><span class="sxs-lookup"><span data-stu-id="76bf3-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="76bf3-407">Essas informações podem ser acessadas no tíquete de autenticação em qualquer página sem a necessidade de uma viagem para o repositório do usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="76bf3-408">Para ilustrar como essas informações podem ser recuperadas da propriedade UserData, vamos atualizar default. aspx para que sua mensagem de boas-vinda inclui não apenas o nome do usuário, mas também a empresa trabalham e seu título.</span><span class="sxs-lookup"><span data-stu-id="76bf3-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="76bf3-409">Atualmente, default. aspx contém um painel AuthenticatedMessagePanel com um controle de rótulo denominado WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="76bf3-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="76bf3-410">Este painel é exibido somente para usuários autenticados.</span><span class="sxs-lookup"><span data-stu-id="76bf3-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="76bf3-411">Atualizar o código em página da default. aspx\_carregar o manipulador de eventos para que ele é semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="76bf3-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample8.vb)]

<span data-ttu-id="76bf3-412">Se Request.IsAuthenticated for True, então a propriedade de texto do WelcomeBackMessage é definida primeiro para bem-vindo, *nome de usuário*.</span><span class="sxs-lookup"><span data-stu-id="76bf3-412">If Request.IsAuthenticated is True, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="76bf3-413">Em seguida, a propriedade Identity é convertida para um objeto FormsIdentity, de modo que podemos acessar o FormsAuthenticationTicket subjacente.</span><span class="sxs-lookup"><span data-stu-id="76bf3-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="76bf3-414">Assim que tivermos o FormsAuthenticationTicket, podemos Desserialize a propriedade de dados do usuário para o nome da empresa e o título.</span><span class="sxs-lookup"><span data-stu-id="76bf3-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="76bf3-415">Isso é feito ao dividir a cadeia de caracteres de caractere de barra vertical.</span><span class="sxs-lookup"><span data-stu-id="76bf3-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="76bf3-416">O nome da empresa e o título são exibidos no rótulo WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="76bf3-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="76bf3-417">Figura 5 mostra uma captura de tela nessa exibição em ação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="76bf3-418">Fazer logon como Scott exibe uma mensagem de back-boas-vinda que inclui a empresa e o título de Scott.</span><span class="sxs-lookup"><span data-stu-id="76bf3-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>


<span data-ttu-id="76bf3-419">[![Título e empresa atualmente registradas do usuário são exibidos](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="76bf3-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span></span>

<span data-ttu-id="76bf3-420">**Figura 05**: Título e empresa atualmente registradas do usuário são exibidas ([clique para exibir a imagem em tamanho normal](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="76bf3-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="76bf3-421">Propriedade de dados do usuário do tíquete de autenticação serve como um cache para o repositório do usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="76bf3-422">Como qualquer cache, ele precisa ser atualizada quando os dados subjacentes são modificados.</span><span class="sxs-lookup"><span data-stu-id="76bf3-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="76bf3-423">Por exemplo, se houver uma página da web do qual os usuários podem atualizar seu perfil, os campos armazenados em cache na propriedade UserData devem atualizados para refletir as alterações feitas pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>


## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="76bf3-424">Etapa 5: Usando uma entidade de segurança personalizada</span><span class="sxs-lookup"><span data-stu-id="76bf3-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="76bf3-425">Em cada solicitação de entrada FormsAuthenticationModule tenta autenticar o usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="76bf3-426">Se houver um tíquete de autenticação não expiradas, o FormsAuthenticationModule atribui a propriedade HttpContext para um novo objeto GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="76bf3-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="76bf3-427">Esse objeto GenericPrincipal tem uma identidade de tipo FormsIdentity, que inclui uma referência para o tíquete de autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="76bf3-428">A classe GenericPrincipal contém bare funcionalidade mínima necessária para uma classe que implementa IPrincipal - tem apenas uma propriedade de identidade e um método IsInRole.</span><span class="sxs-lookup"><span data-stu-id="76bf3-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="76bf3-429">O objeto de entidade tem duas responsabilidades: para indicar as funções que o usuário pertence e para fornecer informações de identidade.</span><span class="sxs-lookup"><span data-stu-id="76bf3-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="76bf3-430">Isso é feito por meio IsInRole da interface IPrincipal (*roleName*) método e propriedade de identidade, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="76bf3-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="76bf3-431">A classe GenericPrincipal permite uma matriz de cadeia de caracteres de nomes de função para ser especificados através de seu construtor; seu IsInRole (*roleName*) método simplesmente verifica para ver se passado na *roleName* existe dentro da matriz de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="76bf3-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="76bf3-432">Quando o FormsAuthenticationModule cria o GenericPrincipal, ele passa em uma matriz de cadeia de caracteres vazia para o construtor do GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="76bf3-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="76bf3-433">Consequentemente, todas as chamadas de IsInRole sempre retornará False.</span><span class="sxs-lookup"><span data-stu-id="76bf3-433">Consequently, any call to IsInRole will always return False.</span></span>

<span data-ttu-id="76bf3-434">A classe GenericPrincipal atende às necessidades para a maioria dos cenários de autenticação baseada em formulários em que as funções não são usadas.</span><span class="sxs-lookup"><span data-stu-id="76bf3-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="76bf3-435">Nas situações em que o tratamento de função padrão é insuficiente ou quando você precisa associar um objeto de IIdentity personalizado com o usuário, você pode criar um objeto IPrincipal personalizado durante o fluxo de trabalho de autenticação e atribuí-lo para a propriedade HttpContext.</span><span class="sxs-lookup"><span data-stu-id="76bf3-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-436">Como veremos no futuro tutoriais, ao ASP. Framework de funções do .NET está habilitado ele cria um objeto de entidade personalizado do tipo [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) e substitui o objeto de GenericPrincipal formulários criados para autenticação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="76bf3-437">Ela faz isso para personalizar o IsInRole método principal para interagir com a API da estrutura de funções.</span><span class="sxs-lookup"><span data-stu-id="76bf3-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>


<span data-ttu-id="76bf3-438">Uma vez que podemos ter não entende sozinhos com funções ainda, o único motivo pelo qual que temos para criar uma entidade personalizada nesse momento seria associar um objeto de IIdentity personalizado para a entidade de segurança.</span><span class="sxs-lookup"><span data-stu-id="76bf3-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="76bf3-439">Na etapa 4, examinamos armazenar informações adicionais do usuário na propriedade de dados do usuário do tíquete de autenticação, em particular, o nome do usuário da empresa e seu título.</span><span class="sxs-lookup"><span data-stu-id="76bf3-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="76bf3-440">No entanto, as informações de dados do usuário só estão acessível por meio do tíquete de autenticação e, em seguida, apenas como uma cadeia de caracteres serializada, que significa que sempre que desejamos exibir as informações de usuário armazenadas no tíquete, precisamos analisar a propriedade de dados do usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="76bf3-441">Podemos melhorar a experiência do desenvolvedor, criando uma classe que implementa IIdentity e inclui propriedades CompanyName e título.</span><span class="sxs-lookup"><span data-stu-id="76bf3-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="76bf3-442">Dessa forma, um desenvolvedor pode acessar o nome da empresa do usuário conectado no momento e título diretamente por meio das propriedades de título e o CompanyName sem precisava saber como analisar a propriedade de dados do usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="76bf3-443">Criando a identidade personalizada e Classes de entidade de segurança</span><span class="sxs-lookup"><span data-stu-id="76bf3-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="76bf3-444">Para este tutorial, vamos criar os objetos personalizados de entidade de segurança e identidade no aplicativo\_pasta de código.</span><span class="sxs-lookup"><span data-stu-id="76bf3-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="76bf3-445">Comece adicionando um aplicativo\_pasta ao seu projeto de código – clique com botão direito no nome do projeto no Gerenciador de soluções, selecione a opção de adicionar pasta ASP.NET e escolha aplicativo\_código.</span><span class="sxs-lookup"><span data-stu-id="76bf3-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="76bf3-446">O aplicativo\_pasta de código é uma pasta especial do ASP.NET que contém arquivos de classe específico para o site.</span><span class="sxs-lookup"><span data-stu-id="76bf3-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="76bf3-447">O aplicativo\_pasta de código deve ser usada somente durante o gerenciamento de seu projeto por meio do modelo de projeto de site.</span><span class="sxs-lookup"><span data-stu-id="76bf3-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="76bf3-448">Se você estiver usando o [modelo de projeto de aplicativo Web](https://msdn.microsoft.com/asp.net/Aa336618.aspx), criar uma pasta padrão e adicionar as classes a ele.</span><span class="sxs-lookup"><span data-stu-id="76bf3-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="76bf3-449">Por exemplo, você poderia adicionar uma nova pasta chamada Classes e colocar seu código lá.</span><span class="sxs-lookup"><span data-stu-id="76bf3-449">For example, you could add a new folder named Classes, and place your code there.</span></span>


<span data-ttu-id="76bf3-450">Em seguida, adicione dois novos arquivos de classe para o aplicativo\_pasta de código, um CustomIdentity.vb nomeado e outro chamado CustomPrincipal.vb.</span><span class="sxs-lookup"><span data-stu-id="76bf3-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.vb and one named CustomPrincipal.vb.</span></span>


<span data-ttu-id="76bf3-451">[![Adicione as Classes de CustomPrincipal e CustomIdentity ao seu projeto](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="76bf3-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span></span>

<span data-ttu-id="76bf3-452">**Figura 06**: Adicione as Classes de CustomPrincipal e CustomIdentity ao seu projeto ([clique para exibir a imagem em tamanho normal](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="76bf3-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span></span>


<span data-ttu-id="76bf3-453">A classe CustomIdentity é responsável por implementar a interface IIdentity, que define as propriedades AuthenticationType, IsAuthenticated e nome.</span><span class="sxs-lookup"><span data-stu-id="76bf3-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="76bf3-454">Além dessas propriedades necessárias, estamos interessados em expor o subjacente tíquete de autenticação de formulários, bem como as propriedades para o nome da empresa e o título do usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="76bf3-455">Insira o código a seguir para a classe CustomIdentity.</span><span class="sxs-lookup"><span data-stu-id="76bf3-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample9.vb)]

<span data-ttu-id="76bf3-456">Observe que a classe inclui uma variável de membro FormsAuthenticationTicket (\_tíquete) e que essas informações de permissão devem ser fornecidas por meio do construtor.</span><span class="sxs-lookup"><span data-stu-id="76bf3-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="76bf3-457">Esses dados de tíquete são usados para retornar o nome da identidade; sua propriedade UserData é analisada para retornar os valores para as propriedades CompanyName e título.</span><span class="sxs-lookup"><span data-stu-id="76bf3-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="76bf3-458">Em seguida, crie a classe CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="76bf3-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="76bf3-459">Como não estamos preocupados com as funções nesse momento, o construtor da classe CustomPrincipal aceita apenas um objeto de CustomIdentity; o método IsInRole sempre retorna False.</span><span class="sxs-lookup"><span data-stu-id="76bf3-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns False.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample10.vb)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="76bf3-460">A atribuição de um objeto CustomPrincipal ao contexto de segurança de solicitação de entrada</span><span class="sxs-lookup"><span data-stu-id="76bf3-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="76bf3-461">Agora temos uma classe que estende a especificação de IIdentity padrão para incluir propriedades CompanyName e título, bem como uma classe de entidade personalizada que usa a identidade personalizada.</span><span class="sxs-lookup"><span data-stu-id="76bf3-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="76bf3-462">Estamos prontos para a etapa no pipeline do ASP.NET e atribuir nosso objeto de entidade personalizado para o contexto de segurança de solicitação de entrada.</span><span class="sxs-lookup"><span data-stu-id="76bf3-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="76bf3-463">O pipeline do ASP.NET leva uma solicitação de entrada e processa-o por meio de uma série de etapas.</span><span class="sxs-lookup"><span data-stu-id="76bf3-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="76bf3-464">Em cada etapa, um determinado evento é gerado, o que possibilita aos desenvolvedores aproveitar o pipeline do ASP.NET e modificar a solicitação em determinados pontos do ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="76bf3-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="76bf3-465">O FormsAuthenticationModule, por exemplo, espera por ASP.NET gerar a [evento AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), no ponto em que ele inspeciona a solicitação de entrada para um tíquete de autenticação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="76bf3-466">Se for encontrado um tíquete de autenticação, um objeto GenericPrincipal é criado e atribuído à propriedade HttpContext.</span><span class="sxs-lookup"><span data-stu-id="76bf3-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="76bf3-467">Após o evento AuthenticateRequest, o pipeline do ASP.NET gera o [PostAuthenticateRequest evento](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), que é onde podemos pode substituir o objeto GenericPrincipal criado pelo FormsAuthenticationModule com uma instância do nosso Objeto CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="76bf3-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="76bf3-468">Figura 7 ilustra esse fluxo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="76bf3-468">Figure 7 depicts this workflow.</span></span>


<span data-ttu-id="76bf3-469">[![O GenericPrincipal é substituído por um CustomPrincipal no evento PostAuthenticationRequest](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="76bf3-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span></span>

<span data-ttu-id="76bf3-470">**Figura 07**: O GenericPrincipal é substituído por um CustomPrincipal no evento PostAuthenticationRequest ([clique para exibir a imagem em tamanho normal](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="76bf3-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span></span>


<span data-ttu-id="76bf3-471">Para executar código em resposta a um evento de pipeline do ASP.NET, podemos pode criar o manipulador de eventos apropriado no global. asax ou criar nosso próprio módulo de HTTP.</span><span class="sxs-lookup"><span data-stu-id="76bf3-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="76bf3-472">Para este tutorial vamos criar o manipulador de eventos no global. asax.</span><span class="sxs-lookup"><span data-stu-id="76bf3-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="76bf3-473">Comece adicionando global. asax ao seu site.</span><span class="sxs-lookup"><span data-stu-id="76bf3-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="76bf3-474">Clique com botão direito no nome do projeto no Gerenciador de soluções e adicione um item de tipo de classe de aplicativo Global chamado global. asax.</span><span class="sxs-lookup"><span data-stu-id="76bf3-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>


<span data-ttu-id="76bf3-475">[![Adicionar um arquivo global asax ao seu site](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="76bf3-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span></span>

<span data-ttu-id="76bf3-476">**Figura 08**: Adicionar um arquivo global asax ao seu site ([clique para exibir a imagem em tamanho normal](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="76bf3-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span></span>


<span data-ttu-id="76bf3-477">O modelo padrão do global. asax inclui manipuladores de eventos para um número de eventos do pipeline ASP.NET, incluindo o início, fim e [evento de erro](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), entre outros.</span><span class="sxs-lookup"><span data-stu-id="76bf3-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="76bf3-478">Fique à vontade remover esses manipuladores de eventos, como não precisamos delas para este aplicativo.</span><span class="sxs-lookup"><span data-stu-id="76bf3-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="76bf3-479">O evento que estamos interessados em é PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="76bf3-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="76bf3-480">Atualize o arquivo global. asax para que sua marcação fique semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="76bf3-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample11.aspx)]

<span data-ttu-id="76bf3-481">O aplicativo\_OnPostAuthenticateRequest método executado cada vez que o tempo de execução do ASP.NET gera o evento de PostAuthenticateRequest, que ocorre uma vez em cada solicitação de página de entrada.</span><span class="sxs-lookup"><span data-stu-id="76bf3-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="76bf3-482">Inicia o manipulador de eventos para verificar se o usuário é autenticado e foi autenticado por meio da autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="76bf3-483">Nesse caso, um novo objeto CustomIdentity é criado e passado o tíquete de autenticação da solicitação atual em seu construtor.</span><span class="sxs-lookup"><span data-stu-id="76bf3-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="76bf3-484">Depois disso, um objeto CustomPrincipal é criado e recebe o objeto de CustomIdentity recém-criada em seu construtor.</span><span class="sxs-lookup"><span data-stu-id="76bf3-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="76bf3-485">Por fim, o contexto de segurança da solicitação atual é atribuído ao objeto CustomPrincipal recém-criado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="76bf3-486">Observe que a última etapa – associando o objeto CustomPrincipal o contexto de segurança da solicitação - atribui a entidade de segurança a duas propriedades: HttpContext e thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="76bf3-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="76bf3-487">Essas duas atribuições são necessárias devido à maneira contextos de segurança são tratados no ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="76bf3-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="76bf3-488">O .NET Framework associa um contexto de segurança a cada thread em execução; Essas informações estão disponíveis como um objeto IPrincipal por meio de [objeto de Thread](https://msdn.microsoft.com/library/system.threading.thread.aspx)do [propriedade CurrentPrincipal](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span><span class="sxs-lookup"><span data-stu-id="76bf3-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="76bf3-489">O que é uma confusão é que o ASP.NET tem suas próprias informações de contexto de segurança (HttpContext).</span><span class="sxs-lookup"><span data-stu-id="76bf3-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="76bf3-490">Em determinados cenários, a propriedade de thread. CurrentPrincipal é examinada para determinar o contexto de segurança; em outros cenários, HttpContext é usado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="76bf3-491">Por exemplo, há recursos de segurança do .NET que permitem aos desenvolvedores declarativamente de estado que os usuários ou funções podem instanciar uma classe ou invocar métodos específicos (consulte [adicionando regras de autorização para os negócios e camadas de dados usando PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="76bf3-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="76bf3-492">Nos bastidores, essas técnicas declarativas determinam o contexto de segurança por meio da propriedade de thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="76bf3-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="76bf3-493">Em outros cenários, a propriedade HttpContext é usada.</span><span class="sxs-lookup"><span data-stu-id="76bf3-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="76bf3-494">Por exemplo, no tutorial anterior, nós usamos essa propriedade para exibir o nome de usuário do usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="76bf3-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="76bf3-495">Claramente, em seguida, é imperativo que as informações de contexto de segurança nas propriedades do thread. CurrentPrincipal e HttpContext correspondem.</span><span class="sxs-lookup"><span data-stu-id="76bf3-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="76bf3-496">O tempo de execução do ASP.NET sincroniza automaticamente esses valores de propriedade para nós.</span><span class="sxs-lookup"><span data-stu-id="76bf3-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="76bf3-497">No entanto, esta sincronização ocorre após o evento AuthenticateRequest, mas *antes de* o evento PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="76bf3-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="76bf3-498">Consequentemente, ao adicionar uma entidade personalizada no evento PostAuthenticateRequest precisamos ter certeza de atribuir manualmente o thread. CurrentPrincipal ou então um thread. CurrentPrincipal e HttpContext estará fora de sincronia. Consulte [Context.User vs. Thread. CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) para uma discussão mais detalhada sobre esse problema.</span><span class="sxs-lookup"><span data-stu-id="76bf3-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="76bf3-499">Acessando o CompanyName e propriedades do título</span><span class="sxs-lookup"><span data-stu-id="76bf3-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="76bf3-500">Sempre que uma solicitação chega e é expedida para o mecanismo do ASP.NET, o aplicativo\_OnPostAuthenticateRequest o manipulador de eventos no global. asax será acionado.</span><span class="sxs-lookup"><span data-stu-id="76bf3-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="76bf3-501">Se a solicitação foi autenticada com êxito pelo FormsAuthenticationModule, o manipulador de eventos criará um novo objeto CustomPrincipal com um objeto CustomIdentity com base no tíquete de autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="76bf3-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="76bf3-502">Com essa lógica em vigor, o acesso a informações sobre o nome da empresa e o título do usuário conectado no momento é incrivelmente simples.</span><span class="sxs-lookup"><span data-stu-id="76bf3-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="76bf3-503">Retornar à página\_manipulador de eventos de carga em Default. aspx, onde na etapa 4, escrevemos código para recuperar o tíquete de autenticação de formulário e analisar a propriedade de dados do usuário para exibir o nome da empresa e o título do usuário.</span><span class="sxs-lookup"><span data-stu-id="76bf3-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="76bf3-504">Com os objetos CustomPrincipal e CustomIdentity em uso agora, não é necessário para analisar os valores de propriedade de dados do usuário do tíquete.</span><span class="sxs-lookup"><span data-stu-id="76bf3-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="76bf3-505">Em vez disso, basta obter uma referência ao objeto CustomIdentity e usar suas propriedades CompanyName e título:</span><span class="sxs-lookup"><span data-stu-id="76bf3-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample12.vb)]

## <a name="summary"></a><span data-ttu-id="76bf3-506">Resumo</span><span class="sxs-lookup"><span data-stu-id="76bf3-506">Summary</span></span>

<span data-ttu-id="76bf3-507">Neste tutorial, examinamos como personalizar configurações do sistema de autenticação de formulários por meio do Web. config. Analisamos como a expiração do tíquete de autenticação é tratada e como as garantias de criptografia e validação são usadas para proteger o tíquete de inspeção e a modificação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="76bf3-508">Por fim, discutimos usando a propriedade de dados do usuário do tíquete de autenticação para armazenar informações de usuário adicionais na permissão em si e como usar objetos personalizados de entidade de segurança e identidade para expor essas informações de maneira mais amigável para desenvolvedores.</span><span class="sxs-lookup"><span data-stu-id="76bf3-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="76bf3-509">Esse tutorial conclui nossa análise de autenticação de formulários no ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="76bf3-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="76bf3-510">O próximo tutorial inicia nossa jornada para a estrutura de associação.</span><span class="sxs-lookup"><span data-stu-id="76bf3-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="76bf3-511">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="76bf3-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="76bf3-512">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="76bf3-512">Further Reading</span></span>

<span data-ttu-id="76bf3-513">Para obter mais informações sobre os tópicos abordados neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="76bf3-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="76bf3-514">Dissecando autenticação de formulários</span><span class="sxs-lookup"><span data-stu-id="76bf3-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="76bf3-515">Explicado: Autenticação de formulários no ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="76bf3-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="76bf3-516">Como: Proteger a autenticação de formulários no ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="76bf3-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="76bf3-517">[Professional ASP.NET 2.0 segurança, associação e gerenciamento de função](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="76bf3-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="76bf3-518">Protegendo os controles de logon</span><span class="sxs-lookup"><span data-stu-id="76bf3-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="76bf3-519">O &lt;autenticação&gt; elemento</span><span class="sxs-lookup"><span data-stu-id="76bf3-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="76bf3-520">O &lt;formulários&gt; elemento para &lt;autenticação&gt;</span><span class="sxs-lookup"><span data-stu-id="76bf3-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="76bf3-521">O &lt;machineKey&gt; elemento</span><span class="sxs-lookup"><span data-stu-id="76bf3-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="76bf3-522">Noções básicas sobre o tíquete de autenticação de formulários e o Cookie</span><span class="sxs-lookup"><span data-stu-id="76bf3-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="76bf3-523">Treinamento em vídeo sobre os tópicos contidos neste tutorial</span><span class="sxs-lookup"><span data-stu-id="76bf3-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="76bf3-524">Como alterar as propriedades de autenticação de formulários</span><span class="sxs-lookup"><span data-stu-id="76bf3-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="76bf3-525">Como configurar e usar autenticação sem cookies em um aplicativo ASP.NET</span><span class="sxs-lookup"><span data-stu-id="76bf3-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="76bf3-526">Realocação de logon de formulários do ASP</span><span class="sxs-lookup"><span data-stu-id="76bf3-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="76bf3-527">Configuração de chave personalizada de logon de formulários</span><span class="sxs-lookup"><span data-stu-id="76bf3-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="76bf3-528">Adicionar dados personalizados ao método de autenticação</span><span class="sxs-lookup"><span data-stu-id="76bf3-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="76bf3-529">Usar objetos de entidade de segurança personalizada</span><span class="sxs-lookup"><span data-stu-id="76bf3-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="76bf3-530">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="76bf3-530">About the Author</span></span>

<span data-ttu-id="76bf3-531">Scott Mitchell, autor de vários livros sobre ASP/ASP.NET e fundador da 4GuysFromRolla.com, trabalha com tecnologias Web Microsoft desde 1998.</span><span class="sxs-lookup"><span data-stu-id="76bf3-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="76bf3-532">Scott funciona como um consultor independente, instrutor e escritor.</span><span class="sxs-lookup"><span data-stu-id="76bf3-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="76bf3-533">Seu livro mais recente é  *[Sams Teach por conta própria ASP.NET 2.0 em 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="76bf3-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="76bf3-534">Scott pode ser contatado pelo [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) ou por meio de seu blog em [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="76bf3-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="76bf3-535">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="76bf3-535">Special Thanks To</span></span>

<span data-ttu-id="76bf3-536">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="76bf3-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="76bf3-537">Revisor de avanço para este tutorial foi Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="76bf3-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="76bf3-538">Você está interessado na revisão Meus próximos artigos do MSDN?</span><span class="sxs-lookup"><span data-stu-id="76bf3-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="76bf3-539">Nesse caso, me descartar uma linha na [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="76bf3-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="76bf3-540">Anterior</span><span class="sxs-lookup"><span data-stu-id="76bf3-540">Previous</span></span>](an-overview-of-forms-authentication-vb.md)
