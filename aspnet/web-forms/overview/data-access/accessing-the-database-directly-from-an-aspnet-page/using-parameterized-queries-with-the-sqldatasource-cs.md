---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-cs
title: Usando consultas parametrizadas com o SqlDataSource (c#) | Microsoft Docs
author: rick-anderson
description: Neste tutorial, podemos continuar a nossa aparência para o controle SqlDataSource e saiba como definir consultas parametrizadas. Os parâmetros podem ser especificados ambos os i...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: 9128aaac-afe2-449f-84b2-bb1d035083c4
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-cs
msc.type: authoredcontent
ms.openlocfilehash: 654c0ce5520a206e5e8e2fd20bed92ac1075bfe9
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57035893"
---
<a name="using-parameterized-queries-with-the-sqldatasource-c"></a><span data-ttu-id="a88c6-104">Uso de consultas parametrizadas com o SqlDataSource (C#)</span><span class="sxs-lookup"><span data-stu-id="a88c6-104">Using Parameterized Queries with the SqlDataSource (C#)</span></span>
====================
<span data-ttu-id="a88c6-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a88c6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a88c6-106">[Baixe o aplicativo de exemplo](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_CS.exe) ou [baixar PDF](using-parameterized-queries-with-the-sqldatasource-cs/_static/datatutorial48cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a88c6-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_CS.exe) or [Download PDF](using-parameterized-queries-with-the-sqldatasource-cs/_static/datatutorial48cs1.pdf)</span></span>

> <span data-ttu-id="a88c6-107">Neste tutorial, podemos continuar a nossa aparência para o controle SqlDataSource e saiba como definir consultas parametrizadas.</span><span class="sxs-lookup"><span data-stu-id="a88c6-107">In this tutorial, we continue our look at the SqlDataSource control and learn how to define parameterized queries.</span></span> <span data-ttu-id="a88c6-108">Os parâmetros podem ser especificados de forma declarativa e por meio de programação e podem ser extraídos de um número de locais como querystring, estado sessão, outros controles e muito mais.</span><span class="sxs-lookup"><span data-stu-id="a88c6-108">The parameters can be specified both declaratively and programmatically, and can be pulled from a number of locations such as the querystring, Session state, other controls, and more.</span></span>


## <a name="introduction"></a><span data-ttu-id="a88c6-109">Introdução</span><span class="sxs-lookup"><span data-stu-id="a88c6-109">Introduction</span></span>

<span data-ttu-id="a88c6-110">No tutorial anterior, vimos como usar o controle SqlDataSource para recuperar dados diretamente de um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-110">In the previous tutorial we saw how to use the SqlDataSource control to retrieve data directly from a database.</span></span> <span data-ttu-id="a88c6-111">Usando o Assistente Configurar fonte de dados, poderíamos escolher o banco de dados e, em seguida,: selecione as colunas para retornar de uma tabela ou exibição; Insira uma instrução SQL personalizada; ou use um procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-111">Using the Configure Data Source wizard, we could choose the database and then either: pick the columns to return from a table or view; enter a custom SQL statement; or use a stored procedure.</span></span> <span data-ttu-id="a88c6-112">Se selecionar colunas de uma tabela ou exibição ou a inserção de uma instrução SQL personalizada, o SqlDataSource controle s `SelectCommand` o SQL ad hoc resultante é atribuído a propriedade `SELECT` instrução e é isso `SELECT` instrução é executada quando o S SqlDataSource `Select()` método é invocado (programaticamente ou automaticamente de um controle da Web de dados).</span><span class="sxs-lookup"><span data-stu-id="a88c6-112">Whether selecting columns from a table or view or entering a custom SQL statement, the SqlDataSource control s `SelectCommand` property is assigned the resulting ad-hoc SQL `SELECT` statement and it is this `SELECT` statement that is executed when the SqlDataSource s `Select()` method is invoked (either programmatically or automatically from a data Web control).</span></span>

<span data-ttu-id="a88c6-113">O SQL `SELECT` instruções usadas no tutorial s demonstrações anteriores não tinha `WHERE` cláusulas.</span><span class="sxs-lookup"><span data-stu-id="a88c6-113">The SQL `SELECT` statements used in the previous tutorial s demos lacked `WHERE` clauses.</span></span> <span data-ttu-id="a88c6-114">Em um `SELECT` instrução, o `WHERE` cláusula pode ser usada para limitar os resultados retornados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-114">In a `SELECT` statement, the `WHERE` clause can be used to limit the results returned.</span></span> <span data-ttu-id="a88c6-115">Por exemplo, para exibir os nomes dos produtos que custam mais de US $50,00, podemos pode usar a consulta a seguir:</span><span class="sxs-lookup"><span data-stu-id="a88c6-115">For example, to display the names of products costing more than $50.00, we could use the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample1.sql)]

<span data-ttu-id="a88c6-116">Normalmente, os valores usados em um `WHERE` cláusula são determinar por meio de alguma fonte externa, como um valor de cadeia de consulta, uma variável de sessão ou a entrada do usuário de um controle da Web na página.</span><span class="sxs-lookup"><span data-stu-id="a88c6-116">Typically, the values used in a `WHERE` clause are determine by some external source, such as a querystring value, a session variable, or user input from a Web control on the page.</span></span> <span data-ttu-id="a88c6-117">O ideal é que essas entradas são especificadas por meio do uso do *parâmetros*.</span><span class="sxs-lookup"><span data-stu-id="a88c6-117">Ideally, such inputs are specified through the use of *parameters*.</span></span> <span data-ttu-id="a88c6-118">Com o Microsoft SQL Server, os parâmetros são indicados usando `@parameterName`, como em:</span><span class="sxs-lookup"><span data-stu-id="a88c6-118">With Microsoft SQL Server, parameters are denoted using `@parameterName`, as in:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample2.sql)]

<span data-ttu-id="a88c6-119">O SqlDataSource dá suporte a consultas parametrizadas, ambas para `SELECT` instruções e `INSERT`, `UPDATE`, e `DELETE` instruções.</span><span class="sxs-lookup"><span data-stu-id="a88c6-119">The SqlDataSource supports parameterized queries, both for `SELECT` statements and `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="a88c6-120">Além disso, os valores de parâmetro podem ser automaticamente extraídos de uma variedade de fontes de querystring, estado de sessão, os controles na página e assim por diante ou podem ser atribuídos programaticamente.</span><span class="sxs-lookup"><span data-stu-id="a88c6-120">Moreover, the parameter values can be automatically pulled from a variety of sources the querystring, session state, controls on the page, and so on or can be assigned programmatically.</span></span> <span data-ttu-id="a88c6-121">Neste tutorial, veremos como definir consultas parametrizadas, bem como para especificar o parâmetro valores declarativamente e programaticamente.</span><span class="sxs-lookup"><span data-stu-id="a88c6-121">In this tutorial, we'll see how to define parameterized queries as well as how to specify the parameter values both declaratively and programmatically.</span></span>

> [!NOTE]
> <span data-ttu-id="a88c6-122">No tutorial anterior, em comparação com o ObjectDataSource que já foi nossa ferramenta de escolha sobre os 46 primeiro tutoriais com o SqlDataSource, observando as semelhanças conceituais.</span><span class="sxs-lookup"><span data-stu-id="a88c6-122">In the previous tutorial we compared the ObjectDataSource which has been our tool of choice over the first 46 tutorials with the SqlDataSource, noting their conceptual similarities.</span></span> <span data-ttu-id="a88c6-123">Essas semelhanças também se estendem aos parâmetros.</span><span class="sxs-lookup"><span data-stu-id="a88c6-123">These similarities also extend to parameters.</span></span> <span data-ttu-id="a88c6-124">Os parâmetros do ObjectDataSource s mapeados para os parâmetros de entrada para os métodos na camada de lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="a88c6-124">The ObjectDataSource s parameters mapped to the input parameters for the methods in the Business Logic Layer.</span></span> <span data-ttu-id="a88c6-125">Com o SqlDataSource, os parâmetros são definidos diretamente na consulta SQL.</span><span class="sxs-lookup"><span data-stu-id="a88c6-125">With the SqlDataSource, the parameters are defined directly within the SQL query.</span></span> <span data-ttu-id="a88c6-126">Ambos os controles têm coleções de parâmetros para seus `Select()`, `Insert()`, `Update()`, e `Delete()` métodos e ambos podem ter esses valores de parâmetros preenchidos a partir de fontes previamente definidos (valores de cadeia de consulta, as variáveis de sessão e assim por diante ) ou atribuídos de forma programática.</span><span class="sxs-lookup"><span data-stu-id="a88c6-126">Both controls have collections of parameters for their `Select()`, `Insert()`, `Update()`, and `Delete()` methods, and both can have these parameter values populated from pre-defined sources (querystring values, session variables, and so on) or assigned programmatically.</span></span>


## <a name="creating-a-parameterized-query"></a><span data-ttu-id="a88c6-127">Criando uma consulta parametrizada</span><span class="sxs-lookup"><span data-stu-id="a88c6-127">Creating a Parameterized Query</span></span>

<span data-ttu-id="a88c6-128">O Assistente para configurar a fonte de dados do SqlDataSource controle s oferece três vias para definir o comando a ser executada para recuperar os registros de banco de dados:</span><span class="sxs-lookup"><span data-stu-id="a88c6-128">The SqlDataSource control s Configure Data Source wizard offers three avenues for defining the command to execute to retrieve database records:</span></span>

- <span data-ttu-id="a88c6-129">Selecionando colunas de uma tabela ou exibição existente,</span><span class="sxs-lookup"><span data-stu-id="a88c6-129">By picking the columns from an existing table or view,</span></span>
- <span data-ttu-id="a88c6-130">Digitando uma instrução SQL personalizada, ou</span><span class="sxs-lookup"><span data-stu-id="a88c6-130">By entering a custom SQL statement, or</span></span>
- <span data-ttu-id="a88c6-131">Escolhendo um procedimento armazenado</span><span class="sxs-lookup"><span data-stu-id="a88c6-131">By choosing a stored procedure</span></span>

<span data-ttu-id="a88c6-132">Ao escolher colunas de uma tabela existente ou exibição, os parâmetros para o `WHERE` cláusula deve ser especificada por meio de adicionar `WHERE` caixa de diálogo cláusula.</span><span class="sxs-lookup"><span data-stu-id="a88c6-132">When picking columns from an existing table or view, the parameters for the `WHERE` clause must be specified through the Add `WHERE` Clause dialog box.</span></span> <span data-ttu-id="a88c6-133">Ao criar uma instrução SQL personalizada, no entanto, você pode inserir os parâmetros diretamente para o `WHERE` cláusula (usando `@parameterName` para indicar cada parâmetro).</span><span class="sxs-lookup"><span data-stu-id="a88c6-133">When creating a custom SQL statement, however, you can enter the parameters directly into the `WHERE` clause (using `@parameterName` to denote each parameter).</span></span> <span data-ttu-id="a88c6-134">Um [procedimento armazenado](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consiste em uma ou mais instruções SQL, e essas instruções podem ser parametrizadas.</span><span class="sxs-lookup"><span data-stu-id="a88c6-134">A [stored procedure](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consists of one or more SQL statements, and these statements can be parameterized.</span></span> <span data-ttu-id="a88c6-135">Os parâmetros usados em instruções SQL, no entanto, devem ser passados em como parâmetros de entrada para o procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-135">The parameters used in the SQL statements, however, must be passed in as input parameters to the stored procedure.</span></span>

<span data-ttu-id="a88c6-136">Como criar uma consulta parametrizada depende de como o s SqlDataSource `SelectCommand` é s especificado, vamos dar uma olhada em todas as três abordagens.</span><span class="sxs-lookup"><span data-stu-id="a88c6-136">Since creating a parameterized query depends on how the SqlDataSource s `SelectCommand` is specified, let s take a look at all three approaches.</span></span> <span data-ttu-id="a88c6-137">Para começar, abra o `ParameterizedQueries.aspx` página o `SqlDataSource` pasta, arraste um controle SqlDataSource da caixa de ferramentas para o Designer e defina seu `ID` para `Products25BucksAndUnderDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-137">To get started, open the `ParameterizedQueries.aspx` page in the `SqlDataSource` folder, drag a SqlDataSource control from the Toolbox onto the Designer, and set its `ID` to `Products25BucksAndUnderDataSource`.</span></span> <span data-ttu-id="a88c6-138">Em seguida, clique no link de configurar fonte de dados a partir da marca inteligente do controle s.</span><span class="sxs-lookup"><span data-stu-id="a88c6-138">Next, click the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="a88c6-139">Selecione o banco de dados para usar (`NORTHWINDConnectionString`) e clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="a88c6-139">Select the database to use (`NORTHWINDConnectionString`) and click Next.</span></span>

## <a name="step-1-adding-awhereclause-when-picking-the-columns-from-a-table-or-view"></a><span data-ttu-id="a88c6-140">Etapa 1: Adicionando um`WHERE`cláusula ao separar as colunas de uma tabela ou exibição</span><span class="sxs-lookup"><span data-stu-id="a88c6-140">Step 1: Adding a`WHERE`Clause When Picking the Columns from a Table or View</span></span>

<span data-ttu-id="a88c6-141">Ao selecionar os dados a serem retornados do banco de dados com o controle SqlDataSource, o Assistente Configurar fonte de dados nos permite simplesmente escolhe as colunas para retornar de uma tabela existente ou exibir (veja a Figura 1).</span><span class="sxs-lookup"><span data-stu-id="a88c6-141">When selecting the data to return from the database with the SqlDataSource control, the Configure Data Source wizard allows us to simply pick the columns to return from an existing table or view (see Figure 1).</span></span> <span data-ttu-id="a88c6-142">Fazendo isso automaticamente cria um SQL `SELECT` instrução, que é o que é enviado ao banco de dados quando o s SqlDataSource `Select()` método é invocado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-142">Doing so automatically builds up a SQL `SELECT` statement, which is what is sent to the database when the SqlDataSource s `Select()` method is invoked.</span></span> <span data-ttu-id="a88c6-143">Como fizemos no tutorial anterior, selecione a tabela de produtos na lista suspensa e verificar a `ProductID`, `ProductName`, e `UnitPrice` colunas.</span><span class="sxs-lookup"><span data-stu-id="a88c6-143">As we did in the previous tutorial, select the Products table from the drop-down list and check the `ProductID`, `ProductName`, and `UnitPrice` columns.</span></span>


<span data-ttu-id="a88c6-144">[![Selecione as colunas para retornar de uma tabela ou exibição](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-144">[![Pick the Columns to Return from a Table or View](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image1.png)</span></span>

<span data-ttu-id="a88c6-145">**Figura 1**: Selecione as colunas para o retorno de uma tabela ou exibição ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-145">**Figure 1**: Pick the Columns to Return from a Table or View ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.png))</span></span>


<span data-ttu-id="a88c6-146">Para incluir um `WHERE` cláusula em de `SELECT` instrução, clique no `WHERE` botão, o que abrirá a adicionar `WHERE` caixa de diálogo de cláusula (veja a Figura 2).</span><span class="sxs-lookup"><span data-stu-id="a88c6-146">To include a `WHERE` clause in the `SELECT` statement, click the `WHERE` button, which brings up the Add `WHERE` Clause dialog box (see Figure 2).</span></span> <span data-ttu-id="a88c6-147">Para adicionar um parâmetro para limitar os resultados retornados pelo `SELECT` da consulta, primeiro escolha a coluna para filtrar os dados por.</span><span class="sxs-lookup"><span data-stu-id="a88c6-147">To add a parameter to limit the results returned by the `SELECT` query, first choose the column to filter the data by.</span></span> <span data-ttu-id="a88c6-148">Em seguida, escolha o operador a ser usado para filtragem (=, &lt;, &lt;=, &gt;e assim por diante).</span><span class="sxs-lookup"><span data-stu-id="a88c6-148">Next, choose the operator to use for filtering (=, &lt;, &lt;=, &gt;, and so on).</span></span> <span data-ttu-id="a88c6-149">Por fim, escolha a origem do valor do parâmetro de s, como do estado de sessão ou de cadeia de consulta.</span><span class="sxs-lookup"><span data-stu-id="a88c6-149">Finally, choose the source of the parameter s value, such as from the querystring or session state.</span></span> <span data-ttu-id="a88c6-150">Depois de configurar o parâmetro, clique no botão Adicionar para incluí-lo no `SELECT` consulta.</span><span class="sxs-lookup"><span data-stu-id="a88c6-150">After configuring the parameter, click the Add button to include it in the `SELECT` query.</span></span>

<span data-ttu-id="a88c6-151">Neste exemplo, let s retornar apenas os resultados onde o `UnitPrice` valor é menor ou igual a $25,00.</span><span class="sxs-lookup"><span data-stu-id="a88c6-151">For this example, let s only return those results where the `UnitPrice` value is less than or equal to $25.00.</span></span> <span data-ttu-id="a88c6-152">Portanto, escolha `UnitPrice` na lista suspensa coluna e &lt;= da lista suspensa do operador.</span><span class="sxs-lookup"><span data-stu-id="a88c6-152">Therefore, pick `UnitPrice` from the Column drop-down list and &lt;= from the Operator drop-down list.</span></span> <span data-ttu-id="a88c6-153">Ao usar um valor de parâmetro embutido em código (por exemplo, $25,00) ou se o valor do parâmetro deve ser especificada programaticamente, selecione nenhum na lista suspensa origem.</span><span class="sxs-lookup"><span data-stu-id="a88c6-153">When using a hard-coded parameter value (such as $25.00) or if the parameter value is to be specified programmatically, select None from the Source drop-down list.</span></span> <span data-ttu-id="a88c6-154">Em seguida, insira o valor do parâmetro embutido em código na caixa de texto valor 25,00 e concluir o processo clicando no botão Adicionar.</span><span class="sxs-lookup"><span data-stu-id="a88c6-154">Next, enter the hard-coded parameter value in the Value textbox 25.00 and complete the process by clicking the Add button.</span></span>


<span data-ttu-id="a88c6-155">[![Limitar os resultados retornados do Adicione WHERE caixa de diálogo cláusula](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-155">[![Limit the Results Returned from the Add WHERE Clause Dialog Box](using-parameterized-queries-with-the-sqldatasource-cs/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.png)</span></span>

<span data-ttu-id="a88c6-156">**Figura 2**: Limitar os resultados retornados de adicionar `WHERE` caixa de diálogo cláusula ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-156">**Figure 2**: Limit the Results Returned from the Add `WHERE` Clause Dialog Box ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.png))</span></span>


<span data-ttu-id="a88c6-157">Depois de adicionar o parâmetro, clique em Okey para retornar para o Assistente Configurar fonte de dados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-157">After adding the parameter, click OK to return to the Configure Data Source wizard.</span></span> <span data-ttu-id="a88c6-158">O `SELECT` instrução na parte inferior do assistente agora deve incluir uma `WHERE` cláusula com um parâmetro chamado `@UnitPrice`:</span><span class="sxs-lookup"><span data-stu-id="a88c6-158">The `SELECT` statement at the bottom of the wizard should now include a `WHERE` clause with a parameter named `@UnitPrice`:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample3.sql)]

> [!NOTE]
> <span data-ttu-id="a88c6-159">Se você especificar várias condições na `WHERE` cláusula de adicionar `WHERE` caixa de diálogo cláusula, o assistente une-as com o `AND` operador.</span><span class="sxs-lookup"><span data-stu-id="a88c6-159">If you specify multiple conditions in the `WHERE` clause from the Add `WHERE` Clause dialog box, the wizard joins them with the `AND` operator.</span></span> <span data-ttu-id="a88c6-160">Se você precisa incluir um `OR` no `WHERE` cláusula (como `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) e em seguida, você precisa criar o `SELECT` instrução por meio da tela de instrução SQL personalizada.</span><span class="sxs-lookup"><span data-stu-id="a88c6-160">If you need to include an `OR` in the `WHERE` clause (such as `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) then you have to build the `SELECT` statement through the custom SQL statement screen.</span></span>


<span data-ttu-id="a88c6-161">Concluir a configuração o SqlDataSource (clique em seguida, em seguida, concluir) e, em seguida, inspecione a marcação declarativa de s SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a88c6-161">Complete configuring the SqlDataSource (click Next, then Finish) and then inspect the SqlDataSource s declarative markup.</span></span> <span data-ttu-id="a88c6-162">A marcação agora inclui um `<SelectParameters>` coleta, que esclarece as fontes para os parâmetros no `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-162">The markup now includes a `<SelectParameters>` collection, which spells out the sources for the parameters in the `SelectCommand`.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample4.aspx)]

<span data-ttu-id="a88c6-163">Quando o s SqlDataSource `Select()` método é invocado, o `UnitPrice` o valor do parâmetro (25,00) é aplicado ao `@UnitPrice` parâmetro no `SelectCommand` antes de serem enviados ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-163">When the SqlDataSource s `Select()` method is invoked, the `UnitPrice` parameter value (25.00) is applied to the `@UnitPrice` parameter in the `SelectCommand` before being sent to the database.</span></span> <span data-ttu-id="a88c6-164">O resultado líquido é que somente esses produtos retornados de menor ou igual a $25,00 o `Products` tabela.</span><span class="sxs-lookup"><span data-stu-id="a88c6-164">The net result is that only those products less than or equal to $25.00 are returned from the `Products` table.</span></span> <span data-ttu-id="a88c6-165">Para confirmar isso, adicione um controle GridView à página, associá-lo a essa fonte de dados e, em seguida, exiba a página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="a88c6-165">To confirm this, add a GridView to the page, bind it to this data source, and then view the page through a browser.</span></span> <span data-ttu-id="a88c6-166">Você deve ver apenas os produtos listados menor ou igual a $25,00, enquanto confirma a Figura 3.</span><span class="sxs-lookup"><span data-stu-id="a88c6-166">You should only see those products listed that are less than or equal to $25.00, as Figure 3 confirms.</span></span>


<span data-ttu-id="a88c6-167">[![São exibidas apenas aqueles produtos menor que ou igual a $25,00](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-167">[![Only Those Products Less Than or Equal to $25.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.png)</span></span>

<span data-ttu-id="a88c6-168">**Figura 3**: São exibidas apenas aqueles produtos menor que ou igual a $25,00 ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-168">**Figure 3**: Only Those Products Less Than or Equal to $25.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.png))</span></span>


## <a name="step-2-adding-parameters-to-a-custom-sql-statement"></a><span data-ttu-id="a88c6-169">Etapa 2: Adicionando parâmetros para uma instrução SQL personalizada</span><span class="sxs-lookup"><span data-stu-id="a88c6-169">Step 2: Adding Parameters to a Custom SQL Statement</span></span>

<span data-ttu-id="a88c6-170">Ao adicionar uma instrução SQL personalizada que você pode inserir o `WHERE` cláusula explicitamente ou especifique um valor na célula do construtor de consulta de filtro.</span><span class="sxs-lookup"><span data-stu-id="a88c6-170">When adding a custom SQL statement you can enter the `WHERE` clause explicitly or specify a value in the Filter cell of the Query Builder.</span></span> <span data-ttu-id="a88c6-171">Para demonstrar isso, deixe s exibir apenas esses produtos em um GridView cujos preços são menores que um determinado limite.</span><span class="sxs-lookup"><span data-stu-id="a88c6-171">To demonstrate this, let s display just those products in a GridView whose prices are less than a certain threshold.</span></span> <span data-ttu-id="a88c6-172">Comece adicionando uma caixa de texto o `ParameterizedQueries.aspx` página para obter esse valor de limite do usuário.</span><span class="sxs-lookup"><span data-stu-id="a88c6-172">Start by adding a TextBox to the `ParameterizedQueries.aspx` page to collect this threshold value from the user.</span></span> <span data-ttu-id="a88c6-173">Definir o s TextBox `ID` propriedade para `MaxPrice`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-173">Set the TextBox s `ID` property to `MaxPrice`.</span></span> <span data-ttu-id="a88c6-174">Adicione um controle da Web de botão e defina seu `Text` propriedade aos produtos de correspondência de exibição.</span><span class="sxs-lookup"><span data-stu-id="a88c6-174">Add a Button Web control and set its `Text` property to Display Matching Products .</span></span>

<span data-ttu-id="a88c6-175">Em seguida, arraste um controle GridView à página e na marca inteligente de optar por criar um novo SqlDataSource chamado `ProductsFilteredByPriceDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-175">Next, drag a GridView onto the page and from its smart tag choose to create a new SqlDataSource named `ProductsFilteredByPriceDataSource`.</span></span> <span data-ttu-id="a88c6-176">No Assistente Configurar fonte de dados, continue para especificar uma instrução SQL personalizada ou tela de procedimento armazenado (veja a Figura 4) e digite a seguinte consulta:</span><span class="sxs-lookup"><span data-stu-id="a88c6-176">From the Configure Data Source wizard, proceed to the Specify a custom SQL statement or stored procedure screen (see Figure 4) and enter the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample5.sql)]

<span data-ttu-id="a88c6-177">Depois de inserir a consulta (manualmente ou por meio do construtor de consultas), clique em Avançar.</span><span class="sxs-lookup"><span data-stu-id="a88c6-177">After entering the query (either manually or through the Query Builder), click Next.</span></span>


<span data-ttu-id="a88c6-178">[![Retornar apenas os produtos menor ou igual a um valor de parâmetro](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-178">[![Return Only Those Products Less Than or Equal to a Parameter Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.png)</span></span>

<span data-ttu-id="a88c6-179">**Figura 4**: Retorno apenas aqueles produtos menor que ou igual a um valor de parâmetro ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-179">**Figure 4**: Return Only Those Products Less Than or Equal to a Parameter Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.png))</span></span>


<span data-ttu-id="a88c6-180">Uma vez que a consulta inclui parâmetros, a próxima tela do assistente nos solicita a origem dos valores de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="a88c6-180">Since the query includes parameters, the next screen in the wizard prompts us for the source of the parameters values.</span></span> <span data-ttu-id="a88c6-181">Escolha o controle da lista de lista suspensa de fonte de parâmetro e `MaxPrice` (o controle de caixa de texto s `ID` valor) na lista suspensa ControlID.</span><span class="sxs-lookup"><span data-stu-id="a88c6-181">Choose Control from the Parameter source drop-down list and `MaxPrice` (the TextBox control s `ID` value) from the ControlID drop-down list.</span></span> <span data-ttu-id="a88c6-182">Você também pode inserir um valor padrão opcional para usar no caso em que o usuário não tiver inserido qualquer texto no `MaxPrice` caixa de texto.</span><span class="sxs-lookup"><span data-stu-id="a88c6-182">You can also enter an optional default value to use in the case where the user has not entered any text into the `MaxPrice` TextBox.</span></span> <span data-ttu-id="a88c6-183">Por enquanto, não insira um valor padrão.</span><span class="sxs-lookup"><span data-stu-id="a88c6-183">For the time being, do not enter a default value.</span></span>


<span data-ttu-id="a88c6-184">[![O propriedade Text do s MaxPrice TextBox é usado como a origem do parâmetro](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-184">[![The MaxPrice TextBox s Text Property is Used as the Parameter Source](using-parameterized-queries-with-the-sqldatasource-cs/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.png)</span></span>

<span data-ttu-id="a88c6-185">**Figura 5**: O `MaxPrice` s de caixa de texto `Text` propriedade é usada como a origem do parâmetro ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-185">**Figure 5**: The `MaxPrice` TextBox s `Text` Property is Used as the Parameter Source ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.png))</span></span>


<span data-ttu-id="a88c6-186">Conclua o Assistente Configurar fonte de dados clicando em Avançar e em seguida concluir.</span><span class="sxs-lookup"><span data-stu-id="a88c6-186">Complete the Configure Data Source wizard by clicking Next, then Finish.</span></span> <span data-ttu-id="a88c6-187">A marcação declarativa para o GridView, TextBox, Button e SqlDataSource da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="a88c6-187">The declarative markup for the GridView, TextBox, Button, and SqlDataSource follows:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample6.aspx)]

<span data-ttu-id="a88c6-188">Observe que o parâmetro dentro da s SqlDataSource `<SelectParameters>` seção é uma `ControlParameter`, que inclui as propriedades adicionais, como `ControlID` e `PropertyName`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-188">Note that the parameter within the SqlDataSource s `<SelectParameters>` section is a `ControlParameter`, which includes additional properties like `ControlID` and `PropertyName`.</span></span> <span data-ttu-id="a88c6-189">Quando o s SqlDataSource `Select()` método é invocado, o `ControlParameter` captura o valor da propriedade especificada do controle de Web e o atribui ao parâmetro correspondente no `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-189">When the SqlDataSource s `Select()` method is invoked, the `ControlParameter` grabs the value from the specified Web control property and assigns it to the corresponding parameter in the `SelectCommand`.</span></span> <span data-ttu-id="a88c6-190">Neste exemplo, o `MaxPrice` s propriedade Text é usado como o `@MaxPrice` valor do parâmetro.</span><span class="sxs-lookup"><span data-stu-id="a88c6-190">In this example, the `MaxPrice` s Text property is used as the `@MaxPrice` parameter value.</span></span>

<span data-ttu-id="a88c6-191">Reserve um minuto para exibir esta página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="a88c6-191">Take a minute to view this page through a browser.</span></span> <span data-ttu-id="a88c6-192">Quando o primeiro visitando a página ou sempre que o `MaxPrice` caixa de texto não tiver um valor que não há registros são exibidos em um GridView.</span><span class="sxs-lookup"><span data-stu-id="a88c6-192">When first visiting the page or whenever the `MaxPrice` TextBox lacks a value no records are displayed in the GridView.</span></span>


<span data-ttu-id="a88c6-193">[![Registros não são que exibidos quando o MaxPrice caixa de texto está vazio](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-193">[![No Records are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-cs/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.png)</span></span>

<span data-ttu-id="a88c6-194">**Figura 6**: Não há registros são exibidos quando o `MaxPrice` caixa de texto está vazia ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-194">**Figure 6**: No Records are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.png))</span></span>


<span data-ttu-id="a88c6-195">O motivo pelo qual não há produtos são mostrados ocorre porque, por padrão, uma cadeia de caracteres vazia para um valor de parâmetro é convertida em um banco de dados `NULL` valor.</span><span class="sxs-lookup"><span data-stu-id="a88c6-195">The reason no products are shown is because, by default, an empty string for a parameter value is converted into a database `NULL` value.</span></span> <span data-ttu-id="a88c6-196">Desde a comparação de `[UnitPrice] <= NULL` sempre é avaliada como False, nenhum resultado será retornado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-196">Since the comparison of `[UnitPrice] <= NULL` always evaluates as False, no results are returned.</span></span>

<span data-ttu-id="a88c6-197">Insira um valor na caixa de texto, como 5.00 e clique no botão de produtos de correspondência de exibição.</span><span class="sxs-lookup"><span data-stu-id="a88c6-197">Enter a value into the textbox, like 5.00, and click the Display Matching Products button.</span></span> <span data-ttu-id="a88c6-198">No postback, SqlDataSource informa que o GridView que uma das suas fontes de parâmetro foi alterado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-198">On postback, the SqlDataSource informs the GridView that one of its parameter sources has changed.</span></span> <span data-ttu-id="a88c6-199">Consequentemente, o GridView associa novamente para o SqlDataSource, exibindo os produtos menor ou igual a US $5,00.</span><span class="sxs-lookup"><span data-stu-id="a88c6-199">Consequently, the GridView rebinds to the SqlDataSource, displaying those products less than or equal to $5.00.</span></span>


<span data-ttu-id="a88c6-200">[![Produtos de menor que ou igual a US $5,00 são exibidos](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-200">[![Products Less Than or Equal to $5.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.png)</span></span>

<span data-ttu-id="a88c6-201">**Figura 7**: Produtos de menor que ou igual a US $5,00 são exibidas ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-201">**Figure 7**: Products Less Than or Equal to $5.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.png))</span></span>


## <a name="initially-displaying-all-products"></a><span data-ttu-id="a88c6-202">Inicialmente, exibindo todos os produtos</span><span class="sxs-lookup"><span data-stu-id="a88c6-202">Initially Displaying All Products</span></span>

<span data-ttu-id="a88c6-203">Em vez de não exibir nenhum produto quando a página é carregada pela primeira vez, podemos querer exibir *todos os* produtos.</span><span class="sxs-lookup"><span data-stu-id="a88c6-203">Rather than displaying no products when the page is first loaded, we may want to display *all* products.</span></span> <span data-ttu-id="a88c6-204">Uma maneira de listar todos os produtos sempre que o `MaxPrice` caixa de texto está vazia é definir o valor padrão do parâmetro s como algum valor incrivelmente alta, como 1000000, desde que ele s improvável que a Northwind Traders fará nunca ter um inventário cujo preço unitário excede US $1.000.000.</span><span class="sxs-lookup"><span data-stu-id="a88c6-204">One way to list all products whenever the `MaxPrice` TextBox is empty is to set the parameter s default value to some insanely high value, like 1000000, since it s unlikely that Northwind Traders will ever have inventory whose unit price exceeds $1,000,000.</span></span> <span data-ttu-id="a88c6-205">No entanto, essa abordagem é falta e pode não funcionar em outras situações.</span><span class="sxs-lookup"><span data-stu-id="a88c6-205">However, this approach is shortsighted and might not work in other situations.</span></span>

<span data-ttu-id="a88c6-206">Nos tutoriais anteriores - [parâmetros declarativos](../basic-reporting/declarative-parameters-cs.md) e [filtragem de mestre/detalhes com uma DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) nós foram nos deparamos com um problema semelhante.</span><span class="sxs-lookup"><span data-stu-id="a88c6-206">In previous tutorials - [Declarative Parameters](../basic-reporting/declarative-parameters-cs.md) and [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) we were faced with a similar problem.</span></span> <span data-ttu-id="a88c6-207">Lá, nossa solução foi colocar essa lógica na camada de lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="a88c6-207">Our solution there was to put this logic in the Business Logic Layer.</span></span> <span data-ttu-id="a88c6-208">Especificamente, a BLL examinado o valor de entrada e, se ele tiver sido `NULL` ou alguns reservados de valor, a chamada foi roteada para o método DAL que todos os registros retornados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-208">Specifically, the BLL examined the incoming value and, if it was `NULL` or some reserved value, the call was routed to the DAL method that returned all records.</span></span> <span data-ttu-id="a88c6-209">Se o valor de entrada for um valor de filtragem normal, foi feita uma chamada ao método DAL que executou uma instrução SQL que usado com um parâmetros `WHERE` cláusula com o valor fornecido.</span><span class="sxs-lookup"><span data-stu-id="a88c6-209">If the incoming value was a normal filtering value, a call was made to the DAL method that executed a SQL statement that used a parameterized `WHERE` clause with the supplied value.</span></span>

<span data-ttu-id="a88c6-210">Infelizmente, podemos ignorar a arquitetura, ao usar o SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a88c6-210">Unfortunately, we bypass the architecture when using the SqlDataSource.</span></span> <span data-ttu-id="a88c6-211">Em vez disso, é preciso personalizar a instrução SQL para inteligentemente pegar todos os registros, se o `@MaximumPrice` parâmetro é `NULL` ou algum valor reservado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-211">Instead, we need to customize the SQL statement to intelligently grab all records if the `@MaximumPrice` parameter is `NULL` or some reserved value.</span></span> <span data-ttu-id="a88c6-212">Para este exercício, let s tem ele então que, se o `@MaximumPrice` parâmetro for igual ao `-1.0`, em seguida, *todos os* os registros serão retornados (`-1.0` funciona como um valor reservado como nenhum produto pode ter um negativo `UnitPrice`valor).</span><span class="sxs-lookup"><span data-stu-id="a88c6-212">For this exercise, let s have it so that if the `@MaximumPrice` parameter is equal to `-1.0`, then *all* of the records are to be returned (`-1.0` works as a reserved value since no product can have a negative `UnitPrice` value).</span></span> <span data-ttu-id="a88c6-213">Para fazer isso, podemos usar a seguinte instrução SQL:</span><span class="sxs-lookup"><span data-stu-id="a88c6-213">To accomplish this we can use the following SQL statement:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample7.sql)]

<span data-ttu-id="a88c6-214">Isso `WHERE` cláusula retorna *todas as* registra se o `@MaximumPrice` é igual ao parâmetro `-1.0`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-214">This `WHERE` clause returns *all* records if the `@MaximumPrice` parameter equals `-1.0`.</span></span> <span data-ttu-id="a88c6-215">Se o valor do parâmetro não for `-1.0`, apenas aqueles produtos cujo `UnitPrice` é menor que ou igual ao `@MaximumPrice` valor de parâmetro são retornados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-215">If the parameter value is not `-1.0`, only those products whose `UnitPrice` is less than or equal to the `@MaximumPrice` parameter value are returned.</span></span> <span data-ttu-id="a88c6-216">Definindo o valor padrão a `@MaximumPrice` parâmetro para `-1.0`, o primeiro carregamento de página (ou sempre que o `MaxPrice` caixa de texto está vazia), `@MaximumPrice` terá um valor de `-1.0` e todos os produtos serão exibidos.</span><span class="sxs-lookup"><span data-stu-id="a88c6-216">By setting the default value of the `@MaximumPrice` parameter to `-1.0`, on the first page load (or whenever the `MaxPrice` TextBox is empty), `@MaximumPrice` will have a value of `-1.0` and all products will be displayed.</span></span>


<span data-ttu-id="a88c6-217">[![Agora, todos os produtos são exibidos quando o MaxPrice caixa de texto está vazio](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-217">[![Now All Products are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-cs/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.png)</span></span>

<span data-ttu-id="a88c6-218">**Figura 8**: Agora, todos os produtos são exibidos quando o `MaxPrice` caixa de texto está vazia ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-218">**Figure 8**: Now All Products are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image16.png))</span></span>


<span data-ttu-id="a88c6-219">Há algumas limitações a serem observados com essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="a88c6-219">There are a couple of caveats to note with this approach.</span></span> <span data-ttu-id="a88c6-220">Primeiro, saiba que o tipo de dados do parâmetro s é inferido por ele uso na consulta SQL.</span><span class="sxs-lookup"><span data-stu-id="a88c6-220">First, realize that the parameter s data type is inferred by it s usage in the SQL query.</span></span> <span data-ttu-id="a88c6-221">Se você alterar o `WHERE` cláusula de `@MaximumPrice = -1.0` para `@MaximumPrice = -1`, o tempo de execução trata o parâmetro como um inteiro.</span><span class="sxs-lookup"><span data-stu-id="a88c6-221">If you change the `WHERE` clause from `@MaximumPrice = -1.0` to `@MaximumPrice = -1`, the runtime treats the parameter as an integer.</span></span> <span data-ttu-id="a88c6-222">Se você tentar atribuir o `MaxPrice` caixa de texto para um valor decimal (como 5,00), ocorrerá um erro porque ele não é possível converter 5,00 em um inteiro.</span><span class="sxs-lookup"><span data-stu-id="a88c6-222">If you then attempt to assign the `MaxPrice` TextBox to a decimal value (like 5.00 ), an error will occur because it cannot convert 5.00 to an integer.</span></span> <span data-ttu-id="a88c6-223">Para corrigir isso, torne-se de que você use `@MaximumPrice = -1.0` no `WHERE` cláusula ou, melhor ainda, defina as `ControlParameter` objeto s `Type` propriedade em Decimal.</span><span class="sxs-lookup"><span data-stu-id="a88c6-223">To remedy this, either make sure that you use `@MaximumPrice = -1.0` in the `WHERE` clause or, better yet, set the `ControlParameter` object s `Type` property to Decimal .</span></span>

<span data-ttu-id="a88c6-224">Em segundo lugar, adicionando a `OR @MaximumPrice = -1.0` para o `WHERE` cláusula, o mecanismo de consulta não é possível usar um índice em `UnitPrice` (supondo que exista uma), resultando em uma verificação de tabela.</span><span class="sxs-lookup"><span data-stu-id="a88c6-224">Secondly, by adding the `OR @MaximumPrice = -1.0` to the `WHERE` clause, the query engine cannot use an index on `UnitPrice` (assuming one exists), thereby resulting in a table scan.</span></span> <span data-ttu-id="a88c6-225">Isso pode afetar o desempenho se houver um número suficientemente grande de registros no `Products` tabela.</span><span class="sxs-lookup"><span data-stu-id="a88c6-225">This can impact performance if there are a sufficiently large number of records in the `Products` table.</span></span> <span data-ttu-id="a88c6-226">Uma abordagem melhor seria mover essa lógica para um procedimento armazenado em que um `IF` instrução executaria uma `SELECT` de consulta do `Products` de tabela sem um `WHERE` cláusula quando precisam de todos os registros a serem retornados ou uma cujo `WHERE` cláusula contém apenas o `UnitPrice` critérios, para que um índice pode ser usado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-226">A better approach would be to move this logic to a stored procedure where an `IF` statement would either perform a `SELECT` query from the `Products` table without a `WHERE` clause when all records need to be returned or one whose `WHERE` clause contains just the `UnitPrice` criteria, so that an index can be used.</span></span>

## <a name="step-3-creating-and-using-parameterized-stored-procedures"></a><span data-ttu-id="a88c6-227">Etapa 3: Criar e usar procedimentos armazenados com parâmetros</span><span class="sxs-lookup"><span data-stu-id="a88c6-227">Step 3: Creating and Using Parameterized Stored Procedures</span></span>

<span data-ttu-id="a88c6-228">Procedimentos armazenados podem incluir um conjunto de parâmetros de entrada que podem ser usados nas instruções SQL definidas dentro do procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-228">Stored procedures can include a set of input parameters that can then be used in the SQL statement(s) defined within the stored procedure.</span></span> <span data-ttu-id="a88c6-229">Ao configurar o SqlDataSource para usar um procedimento armazenado que aceita parâmetros de entrada, esses valores de parâmetro podem ser especificados usando as mesmas técnicas assim como acontece com instruções SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="a88c6-229">When configuring the SqlDataSource to use a stored procedure that accepts input parameters, these parameter values can be specified using the same techniques as with ad-hoc SQL statements.</span></span>

<span data-ttu-id="a88c6-230">Para ilustrar o uso de procedimentos armazenados em SqlDataSource, let s criar um novo procedimento armazenado no banco de dados Northwind denominado `GetProductsByCategory`, que aceita um parâmetro denominado `@CategoryID` e retorna todas as colunas dos produtos cuja `CategoryID` corresponde à coluna `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-230">To illustrate using stored procedures in the SqlDataSource, let s create a new stored procedure in the Northwind database named `GetProductsByCategory`, which accepts a parameter named `@CategoryID` and returns all of the columns of the products whose `CategoryID` column matches `@CategoryID`.</span></span> <span data-ttu-id="a88c6-231">Para criar um procedimento armazenado, vá para o Gerenciador de servidores e Detalhar o `NORTHWND.MDF` banco de dados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-231">To create a stored procedure, go to the Server Explorer and drill down into the `NORTHWND.MDF` database.</span></span> <span data-ttu-id="a88c6-232">(Se você don t ver o Gerenciador de servidores, ativá-la indo até o menu Exibir e selecionar a opção de Gerenciador de servidores.)</span><span class="sxs-lookup"><span data-stu-id="a88c6-232">(If you don t see the Server Explorer, bring it up by going to the View menu and selecting the Server Explorer option.)</span></span>

<span data-ttu-id="a88c6-233">Do `NORTHWND.MDF` de banco de dados, clique com botão direito na pasta Stored Procedures, escolha Adicionar novo procedimento armazenado e digite a seguinte sintaxe:</span><span class="sxs-lookup"><span data-stu-id="a88c6-233">From the `NORTHWND.MDF` database, right-click on the Stored Procedures folder, choose Add New Stored Procedure, and enter the following syntax:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample8.sql)]

<span data-ttu-id="a88c6-234">Clique no ícone Salvar (ou Ctrl + S) para salvar o procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-234">Click the Save icon (or Ctrl+S) to save the stored procedure.</span></span> <span data-ttu-id="a88c6-235">Você pode testar o procedimento armazenado, clicando duas vezes na pasta de procedimentos armazenados e escolha Executar.</span><span class="sxs-lookup"><span data-stu-id="a88c6-235">You can test the stored procedure by right-clicking it from the Stored Procedures folder and choosing Execute.</span></span> <span data-ttu-id="a88c6-236">Isso lhe solicitará parâmetros de procedimento armazenado s (`@CategoryID`, nesta instância), depois que os resultados serão exibidos na janela de saída.</span><span class="sxs-lookup"><span data-stu-id="a88c6-236">This will prompt you for the stored procedure s parameters (`@CategoryID`, in this instance), after which the results will be displayed in the Output window.</span></span>


<span data-ttu-id="a88c6-237">[![O GetProductsByCategory armazenados procedimento quando executada com um @CategoryID 1](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-237">[![The GetProductsByCategory Stored Procedure when Executed with a @CategoryID of 1](using-parameterized-queries-with-the-sqldatasource-cs/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image17.png)</span></span>

<span data-ttu-id="a88c6-238">**Figura 9**: O `GetProductsByCategory` procedimento armazenado quando executada com um `@CategoryID` de 1 ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-238">**Figure 9**: The `GetProductsByCategory` Stored Procedure when Executed with a `@CategoryID` of 1 ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image18.png))</span></span>


<span data-ttu-id="a88c6-239">Deixe o s usar esse procedimento armazenado para exibir todos os produtos na categoria Bebidas em um GridView.</span><span class="sxs-lookup"><span data-stu-id="a88c6-239">Let s use this stored procedure to display all products in the Beverages category in a GridView.</span></span> <span data-ttu-id="a88c6-240">Adicione um novo GridView à página e associá-lo para um novo SqlDataSource chamado `BeverageProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-240">Add a new GridView to the page and bind it to a new SqlDataSource named `BeverageProductsDataSource`.</span></span> <span data-ttu-id="a88c6-241">Continue para especificar uma instrução SQL personalizada ou tela de procedimento armazenado, selecione o botão de opção de procedimento armazenado e escolher o `GetProductsByCategory` procedimento armazenado a partir da lista suspensa.</span><span class="sxs-lookup"><span data-stu-id="a88c6-241">Continue to the Specify a custom SQL statement or stored procedure screen, select the Stored procedure radio button, and pick the `GetProductsByCategory` stored procedure from the drop-down list.</span></span>


<span data-ttu-id="a88c6-242">[![Selecione o GetProductsByCategory procedimento armazenado a partir da lista suspensa](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-242">[![Select the GetProductsByCategory Stored Procedure from the Drop-Down List](using-parameterized-queries-with-the-sqldatasource-cs/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image19.png)</span></span>

<span data-ttu-id="a88c6-243">**Figura 10**: Selecione o `GetProductsByCategory` procedimento armazenado na lista suspensa ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-243">**Figure 10**: Select the `GetProductsByCategory` Stored Procedure from the Drop-Down List ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image20.png))</span></span>


<span data-ttu-id="a88c6-244">Uma vez que o procedimento armazenado aceita um parâmetro de entrada (`@CategoryID`), clique em Avançar solicita a especificar a origem para esse valor de parâmetro s.</span><span class="sxs-lookup"><span data-stu-id="a88c6-244">Since the stored procedure accepts an input parameter (`@CategoryID`), clicking Next prompts us to specify the source for this parameter s value.</span></span> <span data-ttu-id="a88c6-245">As bebidas `CategoryID` é 1, portanto, deixe a lista de lista suspensa de origem do parâmetro com nenhum e digite 1 na caixa de texto DefaultValue.</span><span class="sxs-lookup"><span data-stu-id="a88c6-245">The Beverages `CategoryID` is 1, so leave the Parameter source drop-down list at None and enter 1 into the DefaultValue textbox.</span></span>


<span data-ttu-id="a88c6-246">[![Use um valor embutido em código de 1 para retornar os produtos na categoria Bebidas](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-246">[![Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category](using-parameterized-queries-with-the-sqldatasource-cs/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image21.png)</span></span>

<span data-ttu-id="a88c6-247">**Figura 11**: Use um valor de Hard-Coded de 1 para retornar os produtos na categoria Bebidas ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-247">**Figure 11**: Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image22.png))</span></span>


<span data-ttu-id="a88c6-248">Como mostra a marcação declarativa seguir, ao usar um procedimento armazenado, o s SqlDataSource `SelectCommand` estiver definida como o nome do procedimento armazenado e o [ `SelectCommandType` propriedade](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) está definido como `StoredProcedure`, indicando que que o `SelectCommand` é o nome de um procedimento armazenado em vez de uma instrução de SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="a88c6-248">As the following declarative markup shows, when using a stored procedure, the SqlDataSource s `SelectCommand` property is set to the name of the stored procedure and the [`SelectCommandType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) is set to `StoredProcedure`, indicating that the `SelectCommand` is the name of a stored procedure rather than an ad-hoc SQL statement.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample9.aspx)]

<span data-ttu-id="a88c6-249">Testar a página em um navegador.</span><span class="sxs-lookup"><span data-stu-id="a88c6-249">Test out the page in a browser.</span></span> <span data-ttu-id="a88c6-250">Somente os produtos que pertencem à categoria de bebidas são exibidos, embora *todos os* do produto campos são exibidos desde o `GetProductsByCategory` procedimento armazenado retorna todas as colunas da `Products` tabela.</span><span class="sxs-lookup"><span data-stu-id="a88c6-250">Only those products that belong to the Beverages category are displayed, although *all* of the product fields are displayed since the `GetProductsByCategory` stored procedure returns all of the columns from the `Products` table.</span></span> <span data-ttu-id="a88c6-251">É claro, estamos poderia limitar ou personalizar os campos de GridView da caixa de diálogo Editar colunas GridView s.</span><span class="sxs-lookup"><span data-stu-id="a88c6-251">We could, of course, limit or customize the fields displayed in the GridView from the GridView s Edit Columns dialog box.</span></span>


<span data-ttu-id="a88c6-252">[![Todos as bebidas sejam exibidos](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-252">[![All of the Beverages are Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image23.png)</span></span>

<span data-ttu-id="a88c6-253">**Figura 12**: Todos as bebidas sejam exibidos ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-253">**Figure 12**: All of the Beverages are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image24.png))</span></span>


## <a name="step-4-programmatically-invoking-a-sqldatasource-sselectstatement"></a><span data-ttu-id="a88c6-254">Etapa 4: Invocar programaticamente um s SqlDataSource`Select()`instrução</span><span class="sxs-lookup"><span data-stu-id="a88c6-254">Step 4: Programmatically Invoking a SqlDataSource s`Select()`Statement</span></span>

<span data-ttu-id="a88c6-255">Os exemplos podemos ve viu até agora no tutorial anterior e este tutorial tenha associado controles SqlDataSource diretamente a um GridView.</span><span class="sxs-lookup"><span data-stu-id="a88c6-255">The examples we ve seen in the previous tutorial and this tutorial so far have bound SqlDataSource controls directly to a GridView.</span></span> <span data-ttu-id="a88c6-256">Os dados de controle s SqlDataSource, no entanto, podem ser programaticamente acessados e enumerados no código.</span><span class="sxs-lookup"><span data-stu-id="a88c6-256">The SqlDataSource control s data, however, can be programmatically accessed and enumerated in code.</span></span> <span data-ttu-id="a88c6-257">Isso pode ser particularmente útil quando você precisa para consultar dados inspecioná-lo, mas don t preciso exibi-la.</span><span class="sxs-lookup"><span data-stu-id="a88c6-257">This can be particularly useful when you need to query data to inspect it, but don t need to display it.</span></span> <span data-ttu-id="a88c6-258">Em vez de precisar escrever todo o código do ADO.NET para se conectar ao banco de dados, especifique o comando e recuperar os resultados de texto clichê, você pode deixar o SqlDataSource lidar com esse código monótono.</span><span class="sxs-lookup"><span data-stu-id="a88c6-258">Rather than having to write all of the boilerplate ADO.NET code to connect to the database, specify the command, and retrieve the results, you can let the SqlDataSource handle this monotonous code.</span></span>

<span data-ttu-id="a88c6-259">Para ilustrar a trabalhar com o SqlDataSource s dados programaticamente, imagine que seu chefe abordou a você com uma solicitação para criar uma página da web que exibe o nome de uma categoria selecionada aleatoriamente e seus produtos associados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-259">To illustrate working with the SqlDataSource s data programmatically, imagine that your boss has approached you with a request to create a web page that displays the name of a randomly selected category and its associated products.</span></span> <span data-ttu-id="a88c6-260">Ou seja, quando um usuário visita esta página, queremos aleatoriamente, escolha uma categoria do `Categories` de tabela, exiba o nome da categoria e, em seguida, lista os produtos que pertencem a essa categoria.</span><span class="sxs-lookup"><span data-stu-id="a88c6-260">That is, when a user visits this page, we want to randomly choose a category from the `Categories` table, display the category name, and then list the products belonging to that category.</span></span>

<span data-ttu-id="a88c6-261">Para fazer isso, precisamos dois controles SqlDataSource aquele para captar uma categoria aleatória do `Categories` e outra tabela para obter a categoria de produtos.</span><span class="sxs-lookup"><span data-stu-id="a88c6-261">To accomplish this we need two SqlDataSource controls one to grab a random category from the `Categories` table and another to get the category s products.</span></span> <span data-ttu-id="a88c6-262">Vamos criar o SqlDataSource que recupera um registro de categoria aleatória nesta etapa; Etapa 5 examina elaborando o SqlDataSource que recupera os produtos a categoria.</span><span class="sxs-lookup"><span data-stu-id="a88c6-262">We'll build the SqlDataSource that retrieves a random category record in this step; Step 5 looks at crafting the SqlDataSource that retrieves the category s products.</span></span>

<span data-ttu-id="a88c6-263">Comece adicionando um SqlDataSource para `ParameterizedQueries.aspx` e defina sua `ID` para `RandomCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-263">Start by adding a SqlDataSource to `ParameterizedQueries.aspx` and set its `ID` to `RandomCategoryDataSource`.</span></span> <span data-ttu-id="a88c6-264">Configurá-lo para que ele use a seguinte consulta SQL:</span><span class="sxs-lookup"><span data-stu-id="a88c6-264">Configure it so that it uses the following SQL query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample10.sql)]

<span data-ttu-id="a88c6-265">`ORDER BY NEWID()` Retorna os registros classificados em ordem aleatória (consulte [Using `NEWID()` aleatoriamente os registros de classificação](http://www.sqlteam.com/item.asp?ItemID=8747)).</span><span class="sxs-lookup"><span data-stu-id="a88c6-265">`ORDER BY NEWID()` returns the records sorted in random order (see [Using `NEWID()` to Randomly Sort Records](http://www.sqlteam.com/item.asp?ItemID=8747)).</span></span> <span data-ttu-id="a88c6-266">`SELECT TOP 1` Retorna o primeiro registro do conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-266">`SELECT TOP 1` returns the first record from the result set.</span></span> <span data-ttu-id="a88c6-267">Juntar, esta consulta retorna os `CategoryID` e `CategoryName` valores da coluna de uma categoria de única, selecionada aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="a88c6-267">Put together, this query returns the `CategoryID` and `CategoryName` column values from a single, randomly selected category.</span></span>

<span data-ttu-id="a88c6-268">Para exibir a categoria s `CategoryName` de valor, adicione um controle de Web de rótulo para a página, defina sua `ID` propriedade `CategoryNameLabel`e limpe seu `Text` propriedade.</span><span class="sxs-lookup"><span data-stu-id="a88c6-268">To display the category s `CategoryName` value, add a Label Web control to the page, set its `ID` property to `CategoryNameLabel`, and clear out its `Text` property.</span></span> <span data-ttu-id="a88c6-269">Para recuperar programaticamente os dados de um controle SqlDataSource, precisamos chamar seu `Select()` método.</span><span class="sxs-lookup"><span data-stu-id="a88c6-269">To programmatically retrieve the data from a SqlDataSource control, we need to invoke its `Select()` method.</span></span> <span data-ttu-id="a88c6-270">O [ `Select()` método](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) espera um único parâmetro de entrada do tipo [ `DataSourceSelectArguments` ](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), que especifica como os dados devem ser da mensagem antes de serem retornados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-270">The [`Select()` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) expects a single input parameter of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), which specifies how the data should be messaged before being returned.</span></span> <span data-ttu-id="a88c6-271">Isso pode incluir instruções sobre como classificar e filtrar os dados e é usado pelos dados de que controles da Web durante a classificação ou a paginação dos dados de um controle SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a88c6-271">This can include instructions on sorting and filtering the data, and is used by the data Web controls when sorting or paging through the data from a SqlDataSource control.</span></span> <span data-ttu-id="a88c6-272">Para nosso exemplo, no entanto, podemos don precisa os dados a ser modificado antes de serem retornados e, portanto, passará o `DataSourceSelectArguments.Empty` objeto.</span><span class="sxs-lookup"><span data-stu-id="a88c6-272">For our example, though, we don t need the data to be modified before being returned, and therefore will pass in the `DataSourceSelectArguments.Empty` object.</span></span>

<span data-ttu-id="a88c6-273">O `Select()` método retorna um objeto que implementa `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-273">The `Select()` method returns an object that implements `IEnumerable`.</span></span> <span data-ttu-id="a88c6-274">O tipo exato retornado depende do valor do controle SqlDataSource s [ `DataSourceMode` propriedade](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span><span class="sxs-lookup"><span data-stu-id="a88c6-274">The precise type returned depends on the value of the SqlDataSource control s [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span></span> <span data-ttu-id="a88c6-275">Conforme discutido no tutorial anterior, essa propriedade pode ser definida como um valor de `DataSet` ou `DataReader`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-275">As discussed in the previous tutorial, this property can be set to a value of either `DataSet` or `DataReader`.</span></span> <span data-ttu-id="a88c6-276">Se definido como `DataSet`, o `Select()` método retorna um [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) objeto; se definido como `DataReader`, ele retorna um objeto que implementa [ `IDataReader` ](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span><span class="sxs-lookup"><span data-stu-id="a88c6-276">If set to `DataSet`, the `Select()` method returns a [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) object; if set to `DataReader`, it returns an object that implements [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span></span> <span data-ttu-id="a88c6-277">Uma vez que o `RandomCategoryDataSource` SqlDataSource tem seu `DataSourceMode` propriedade definida como `DataSet` (o padrão), trabalharemos com um objeto de DataView.</span><span class="sxs-lookup"><span data-stu-id="a88c6-277">Since the `RandomCategoryDataSource` SqlDataSource has its `DataSourceMode` property set to `DataSet` (the default), we will be working with a DataView object.</span></span>

<span data-ttu-id="a88c6-278">O código a seguir ilustra como recuperar os registros da `RandomCategoryDataSource` SqlDataSource como uma DataView, bem como como ler o `CategoryName` valor da coluna da primeira linha da exibição de dados:</span><span class="sxs-lookup"><span data-stu-id="a88c6-278">The following code illustrates how to retrieve the records from the `RandomCategoryDataSource` SqlDataSource as a DataView as well as how to read the `CategoryName` column value from the first DataView row:</span></span>


[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample11.cs)]

<span data-ttu-id="a88c6-279">`randomCategoryView[0]` Retorna o primeiro `DataRowView` no DataView.</span><span class="sxs-lookup"><span data-stu-id="a88c6-279">`randomCategoryView[0]` returns the first `DataRowView` in the DataView.</span></span> <span data-ttu-id="a88c6-280">`randomCategoryView[0]["CategoryName"]` Retorna o valor da `CategoryName` coluna nesta primeira linha.</span><span class="sxs-lookup"><span data-stu-id="a88c6-280">`randomCategoryView[0]["CategoryName"]` returns the value of the `CategoryName` column in this first row.</span></span> <span data-ttu-id="a88c6-281">Observe que o DataView é fracamente tipado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-281">Note that the DataView is loosely-typed.</span></span> <span data-ttu-id="a88c6-282">Para fazer referência a um valor de coluna específico, precisamos passar no nome da coluna como uma cadeia de caracteres (CategoryName, neste caso).</span><span class="sxs-lookup"><span data-stu-id="a88c6-282">To reference a particular column value we need to pass in the name of the column as a string ( CategoryName, in this case).</span></span> <span data-ttu-id="a88c6-283">A Figura 13 mostra a mensagem exibida no `CategoryNameLabel` ao exibir a página.</span><span class="sxs-lookup"><span data-stu-id="a88c6-283">Figure 13 shows the message displayed in the `CategoryNameLabel` when viewing the page.</span></span> <span data-ttu-id="a88c6-284">É claro, o nome da categoria reais exibido é selecionado aleatoriamente pelo `RandomCategoryDataSource` SqlDataSource sobre cada visita à página (incluindo postbacks).</span><span class="sxs-lookup"><span data-stu-id="a88c6-284">Of course, the actual category name displayed is randomly selected by the `RandomCategoryDataSource` SqlDataSource on each visit to the page (including postbacks).</span></span>


<span data-ttu-id="a88c6-285">[![O s da categoria selecionada aleatoriamente que nome é exibido](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-285">[![The Randomly Selected Category s Name is Displayed](using-parameterized-queries-with-the-sqldatasource-cs/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image25.png)</span></span>

<span data-ttu-id="a88c6-286">**Figura 13**: O s da categoria selecionada aleatoriamente nome é exibido ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-286">**Figure 13**: The Randomly Selected Category s Name is Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image26.png))</span></span>


> [!NOTE]
> <span data-ttu-id="a88c6-287">Se o SqlDataSource controlar s `DataSourceMode` propriedade tivesse sido definida como `DataReader`, o valor de retorno a `Select()` método precisaria ser convertido em `IDataReader`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-287">If the SqlDataSource control s `DataSourceMode` property had been set to `DataReader`, the return value from the `Select()` method would have needed to be cast to `IDataReader`.</span></span> <span data-ttu-id="a88c6-288">Para ler o `CategoryName` valor da coluna da primeira linha, podemos d usar um código como:</span><span class="sxs-lookup"><span data-stu-id="a88c6-288">To read the `CategoryName` column value from the first row, we d use code like:</span></span>


[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample12.cs)]

<span data-ttu-id="a88c6-289">Com o SqlDataSource selecionando aleatoriamente uma categoria, podemos está pronto para adicionar o GridView que lista os produtos de categoria s.</span><span class="sxs-lookup"><span data-stu-id="a88c6-289">With the SqlDataSource randomly selecting a category, we re ready to add the GridView that lists the category s products.</span></span>

> [!NOTE]
> <span data-ttu-id="a88c6-290">Em vez de usar um controle da Web do rótulo para exibir o nome da categoria s, podemos poderia ter adicionado um FormView ou DetailsView para a página, associá-lo ao SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a88c6-290">Rather than using a Label Web control to display the category s name, we could have added a FormView or DetailsView to the page, binding it to the SqlDataSource.</span></span> <span data-ttu-id="a88c6-291">Usando o rótulo, no entanto, nos permitiu explorar como chamar programaticamente o s SqlDataSource `Select()` instrução e trabalhar com seus dados resultantes no código.</span><span class="sxs-lookup"><span data-stu-id="a88c6-291">Using the Label, however, allowed us to explore how to programmatically invoke the SqlDataSource s `Select()` statement and work with its resulting data in code.</span></span>


## <a name="step-5-assigning-parameter-values-programmatically"></a><span data-ttu-id="a88c6-292">Etapa 5: Atribuindo valores de parâmetro de forma programática</span><span class="sxs-lookup"><span data-stu-id="a88c6-292">Step 5: Assigning Parameter Values Programmatically</span></span>

<span data-ttu-id="a88c6-293">Todos os exemplos podemos ve viu até agora neste tutorial ter usado um valor de parâmetro embutido em código ou um obtido em uma das fontes de parâmetro predefinidos (um valor de cadeia de consulta, um controle da Web na página e assim por diante).</span><span class="sxs-lookup"><span data-stu-id="a88c6-293">All of the examples we ve seen so far in this tutorial have used either a hard-coded parameter value or one taken from one of the pre-defined parameter sources (a querystring value, a Web control on the page, and so on).</span></span> <span data-ttu-id="a88c6-294">No entanto, os parâmetros de s controle SqlDataSource podem também ser definidos programaticamente.</span><span class="sxs-lookup"><span data-stu-id="a88c6-294">However, the SqlDataSource control s parameters can also be set programmatically.</span></span> <span data-ttu-id="a88c6-295">Para concluir o nosso exemplo atual, é necessário um SqlDataSource que retorna todos os produtos que pertencem a uma categoria especificada.</span><span class="sxs-lookup"><span data-stu-id="a88c6-295">To complete our current example, we need a SqlDataSource that returns all of the products belonging to a specified category.</span></span> <span data-ttu-id="a88c6-296">Este SqlDataSource terá um `CategoryID` parâmetro cujo valor precisa ser definido com base no `CategoryID` retornado pelo valor da coluna a `RandomCategoryDataSource` SqlDataSource no `Page_Load` manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="a88c6-296">This SqlDataSource will have a `CategoryID` parameter whose value needs to be set based on the `CategoryID` column value returned by the `RandomCategoryDataSource` SqlDataSource in the `Page_Load` event handler.</span></span>

<span data-ttu-id="a88c6-297">Comece adicionando um GridView à página e associá-lo para um novo SqlDataSource chamado `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a88c6-297">Start by adding a GridView to the page and bind it to a new SqlDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="a88c6-298">Muito como fizemos na etapa 3, configure o SqlDataSource, de modo que ele invoca o `GetProductsByCategory` procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="a88c6-298">Much like we did in Step 3, configure the SqlDataSource so that it invokes the `GetProductsByCategory` stored procedure.</span></span> <span data-ttu-id="a88c6-299">Deixe o conjunto de lista suspensa de origem do parâmetro como None, mas não insira um valor padrão, como podemos definirá esse valor padrão por meio de programação.</span><span class="sxs-lookup"><span data-stu-id="a88c6-299">Leave the Parameter source drop-down list set to None, but do not enter a default value, as we will set this default value programmatically.</span></span>


<span data-ttu-id="a88c6-300">[![Não especificar um parâmetro de origem ou o valor padrão](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-300">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image27.png)</span></span>

<span data-ttu-id="a88c6-301">**Figura 14**: Fazer não especificar uma fonte de parâmetro ou o valor padrão ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-301">**Figure 14**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image28.png))</span></span>


<span data-ttu-id="a88c6-302">Depois de concluir o assistente SqlDataSource, a marcação declarativa resultante deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="a88c6-302">After completing the SqlDataSource wizard, the resulting declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample13.aspx)]

<span data-ttu-id="a88c6-303">Podemos atribuir a `DefaultValue` do `CategoryID` parâmetro programaticamente o `Page_Load` manipulador de eventos:</span><span class="sxs-lookup"><span data-stu-id="a88c6-303">We can assign the `DefaultValue` of the `CategoryID` parameter programmatically in the `Page_Load` event handler:</span></span>


[!code-csharp[Main](using-parameterized-queries-with-the-sqldatasource-cs/samples/sample14.cs)]

<span data-ttu-id="a88c6-304">Com esse acréscimo, a página inclui um GridView que mostra os produtos associados a categoria selecionada aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="a88c6-304">With this addition, the page includes a GridView that shows the products associated with the randomly selected category.</span></span>


<span data-ttu-id="a88c6-305">[![Não especificar um parâmetro de origem ou o valor padrão](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="a88c6-305">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-cs/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-cs/_static/image29.png)</span></span>

<span data-ttu-id="a88c6-306">**Figura 15**: Fazer não especificar uma fonte de parâmetro ou o valor padrão ([clique para exibir a imagem em tamanho normal](using-parameterized-queries-with-the-sqldatasource-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="a88c6-306">**Figure 15**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-cs/_static/image30.png))</span></span>


## <a name="summary"></a><span data-ttu-id="a88c6-307">Resumo</span><span class="sxs-lookup"><span data-stu-id="a88c6-307">Summary</span></span>

<span data-ttu-id="a88c6-308">O SqlDataSource permite que os desenvolvedores de páginas definir consultas com parâmetros cujos valores de parâmetro podem ser embutido em código, extraídos de fontes de parâmetro predefinidos ou atribuídos por meio de programação.</span><span class="sxs-lookup"><span data-stu-id="a88c6-308">The SqlDataSource enables page developers to define parameterized queries whose parameter values can be hard-coded, pulled from pre-defined parameter sources, or assigned programmatically.</span></span> <span data-ttu-id="a88c6-309">Neste tutorial vimos como criar uma consulta parametrizada no Assistente para configurar a fonte de dados para consultas SQL ad hoc e procedimentos armazenados.</span><span class="sxs-lookup"><span data-stu-id="a88c6-309">In this tutorial we saw how to craft a parameterized query from the Configure Data Source wizard for both ad-hoc SQL queries and stored procedures.</span></span> <span data-ttu-id="a88c6-310">Também examinamos usando fontes de parâmetro embutido em código, um controle da Web como uma fonte de parâmetro e por meio de programação especificando o valor do parâmetro.</span><span class="sxs-lookup"><span data-stu-id="a88c6-310">We also looked at using hard-coded parameter sources, a Web control as a parameter source, and programmatically specifying the parameter value.</span></span>

<span data-ttu-id="a88c6-311">Como com o ObjectDataSource, SqlDataSource também fornece recursos para modificar seus dados subjacentes.</span><span class="sxs-lookup"><span data-stu-id="a88c6-311">Like with the ObjectDataSource, the SqlDataSource also provides capabilities to modify its underlying data.</span></span> <span data-ttu-id="a88c6-312">No próximo tutorial, examinaremos como definir `INSERT`, `UPDATE`, e `DELETE` instruções com o SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a88c6-312">In the next tutorial we'll look at how to define `INSERT`, `UPDATE`, and `DELETE` statements with the SqlDataSource.</span></span> <span data-ttu-id="a88c6-313">Quando essas instruções foram adicionadas, podemos pode utilizar interna inserir, editar e excluir recursos inerentes aos controles GridView, DetailsView e FormView.</span><span class="sxs-lookup"><span data-stu-id="a88c6-313">Once these statements have been added, we can utilize the built-in inserting, editing, and deleting features inherent to the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="a88c6-314">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="a88c6-314">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a88c6-315">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="a88c6-315">About the Author</span></span>

<span data-ttu-id="a88c6-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP.NET e fundador da [4GuysFromRolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="a88c6-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a88c6-317">Scott funciona como um consultor independente, instrutor e escritor.</span><span class="sxs-lookup"><span data-stu-id="a88c6-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a88c6-318">Seu livro mais recente é [ *Sams Teach por conta própria ASP.NET 2.0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a88c6-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a88c6-319">Ele pode ser contatado pelo [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a88c6-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a88c6-320">ou por meio de seu blog, que pode ser encontrado em [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a88c6-320">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a88c6-321">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="a88c6-321">Special Thanks To</span></span>

<span data-ttu-id="a88c6-322">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="a88c6-322">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a88c6-323">Revisores líder para este tutorial foram Scott Clyde, Randell Schmidt e Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="a88c6-323">Lead reviewers for this tutorial were Scott Clyde, Randell Schmidt, and Ken Pespisa.</span></span> <span data-ttu-id="a88c6-324">Você está interessado na revisão Meus próximos artigos do MSDN?</span><span class="sxs-lookup"><span data-stu-id="a88c6-324">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a88c6-325">Nesse caso, me descartar uma linha na [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a88c6-325">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a88c6-326">[Anterior](querying-data-with-the-sqldatasource-control-cs.md)
> [Próximo](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)</span><span class="sxs-lookup"><span data-stu-id="a88c6-326">[Previous](querying-data-with-the-sqldatasource-control-cs.md)
[Next](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)</span></span>
