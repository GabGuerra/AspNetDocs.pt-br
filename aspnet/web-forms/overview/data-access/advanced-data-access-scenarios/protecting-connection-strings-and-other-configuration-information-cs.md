---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
title: Protegendo cadeias de caracteres de Conexão e outras informações de configuração (c#) | Microsoft Docs
author: rick-anderson
description: Normalmente, um aplicativo ASP.NET armazena informações de configuração em um arquivo Web. config. Algumas dessas informações são confidenciais e garante a proteção. Por def....
ms.author: riande
ms.date: 08/03/2007
ms.assetid: ad8dd396-30f7-4abe-ac02-a0b84422e5be
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
msc.type: authoredcontent
ms.openlocfilehash: eab1ad6cd4636ab3d35988ec8dc762c8a8f51ef4
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59421128"
---
# <a name="protecting-connection-strings-and-other-configuration-information-c"></a><span data-ttu-id="5a0c2-105">Proteger cadeias de conexão e outras informações de configuração (C#)</span><span class="sxs-lookup"><span data-stu-id="5a0c2-105">Protecting Connection Strings and Other Configuration Information (C#)</span></span>

<span data-ttu-id="5a0c2-106">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5a0c2-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5a0c2-107">[Baixar o código](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) ou [baixar PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5a0c2-107">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) or [Download PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span></span>

> <span data-ttu-id="5a0c2-108">Normalmente, um aplicativo ASP.NET armazena informações de configuração em um arquivo Web. config.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-108">An ASP.NET application typically stores configuration information in a Web.config file.</span></span> <span data-ttu-id="5a0c2-109">Algumas dessas informações são confidenciais e garante a proteção.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-109">Some of this information is sensitive and warrants protection.</span></span> <span data-ttu-id="5a0c2-110">Por padrão esse arquivo não será servido para um visitante de site da Web, mas um administrador ou um hacker pode obter acesso ao sistema de arquivos do servidor Web e exibir o conteúdo do arquivo.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-110">By default this file will not be served to a Web site visitor, but an administrator or a hacker may gain access to the Web server's file system and view the contents of the file.</span></span> <span data-ttu-id="5a0c2-111">Neste tutorial, saiba que o ASP.NET 2.0 permite-na proteger informações confidenciais, criptografando seções do arquivo Web. config.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-111">In this tutorial we learn that ASP.NET 2.0 allows us to protect sensitive information by encrypting sections of the Web.config file.</span></span>


## <a name="introduction"></a><span data-ttu-id="5a0c2-112">Introdução</span><span class="sxs-lookup"><span data-stu-id="5a0c2-112">Introduction</span></span>

<span data-ttu-id="5a0c2-113">Informações de configuração para aplicativos ASP.NET é geralmente são armazenadas em um arquivo XML denominado `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-113">Configuration information for ASP.NET applications is commonly stored in an XML file named `Web.config`.</span></span> <span data-ttu-id="5a0c2-114">Ao longo destes tutoriais, nós atualizamos o `Web.config` inúmeras vezes.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-114">Over the course of these tutorials we have updated the `Web.config` a handful of times.</span></span> <span data-ttu-id="5a0c2-115">Ao criar o `Northwind` digitado o conjunto de dados na [primeiro tutorial](../introduction/creating-a-data-access-layer-cs.md), por exemplo, informações de cadeia de caracteres de conexão foi adicionadas automaticamente ao `Web.config` no `<connectionStrings>` seção.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-115">When creating the `Northwind` Typed DataSet in the [first tutorial](../introduction/creating-a-data-access-layer-cs.md), for example, connection string information was automatically added to `Web.config` in the `<connectionStrings>` section.</span></span> <span data-ttu-id="5a0c2-116">Posteriormente, o [páginas mestras e navegação no Site](../introduction/master-pages-and-site-navigation-cs.md) tutorial, estamos atualizado manualmente `Web.config`, adicionar um `<pages>` elemento que indica que todas as páginas do ASP.NET em nosso projeto devem usar o `DataWebControls` tema.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-116">Later, in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, we manually updated `Web.config`, adding a `<pages>` element indicating that all of the ASP.NET pages in our project should use the `DataWebControls` Theme.</span></span>

<span data-ttu-id="5a0c2-117">Uma vez que `Web.config` pode conter dados confidenciais, como cadeias de caracteres de conexão, é importante que o conteúdo de `Web.config` sejam mantidos seguros e ocultos dos visualizadores não autorizados.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-117">Since `Web.config` may contain sensitive data such as connection strings, it is important that the contents of `Web.config` be kept safe and hidden from unauthorized viewers.</span></span> <span data-ttu-id="5a0c2-118">Por padrão, qualquer HTTP de solicitação para um arquivo com o `.config` extensão é tratada pelo mecanismo ASP.NET, que retorna o *esse tipo de página não é atendido* mensagem mostrada na Figura 1.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-118">By default, any HTTP request to a file with the `.config` extension is handled by the ASP.NET engine, which returns the *This type of page is not served* message shown in Figure 1.</span></span> <span data-ttu-id="5a0c2-119">Isso significa que os visitantes não poderá ver sua `Web.config` s o conteúdo do arquivo, basta inserir http://www.YourServer.com/Web.config na sua barra de endereços do navegador s.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-119">This means that visitors cannot view your `Web.config` file s contents by simply entering http://www.YourServer.com/Web.config into their browser s Address bar.</span></span>


[![V<span data-ttu-id="5a0c2-120">isiting Web. config por meio de um navegador retorna esse tipo de página não é atendido mensagem]</span><span class="sxs-lookup"><span data-stu-id="5a0c2-120">isiting Web.config Through a Browser Returns a This type of page is not served Message]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)

<span data-ttu-id="5a0c2-121">**Figura 1**: Visitar `Web.config` por meio de um navegador retorna esse tipo de página não é atendida mensagem ([clique para exibir a imagem em tamanho normal](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="5a0c2-121">**Figure 1**: Visiting `Web.config` Through a Browser Returns a This type of page is not served Message ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span></span>


<span data-ttu-id="5a0c2-122">Mas e se um invasor é capaz de encontrar alguns outra exploração que permite a ela exibir seu `Web.config` s conteúdo do arquivo?</span><span class="sxs-lookup"><span data-stu-id="5a0c2-122">But what if an attacker is able to find some other exploit that allows her to view your `Web.config` file s contents?</span></span> <span data-ttu-id="5a0c2-123">O que um invasor pode fazer com essas informações e quais etapas podem ser tomadas para proteger ainda mais as informações confidenciais dentro `Web.config`?</span><span class="sxs-lookup"><span data-stu-id="5a0c2-123">What could an attacker do with this information, and what steps can be taken to further protect the sensitive information within `Web.config`?</span></span> <span data-ttu-id="5a0c2-124">Felizmente, a maioria das seções no `Web.config` não contêm informações confidenciais.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-124">Fortunately, most sections in `Web.config` do not contain sensitive information.</span></span> <span data-ttu-id="5a0c2-125">Que mal um invasor pode cometem se souberem o nome do tema usado por suas páginas ASP.NET padrão?</span><span class="sxs-lookup"><span data-stu-id="5a0c2-125">What harm can an attacker perpetrate if they know the name of the default Theme used by your ASP.NET pages?</span></span>

<span data-ttu-id="5a0c2-126">Determinados `Web.config` seções, no entanto, contêm informações confidenciais que podem incluir cadeias de caracteres de conexão, nomes de usuário, senhas, nomes de servidor, chaves de criptografia e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-126">Certain `Web.config` sections, however, contain sensitive information that may include connection strings, user names, passwords, server names, encryption keys, and so forth.</span></span> <span data-ttu-id="5a0c2-127">Essas informações geralmente são encontradas no seguinte `Web.config` seções:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-127">This information is typically found in the following `Web.config` sections:</span></span>

- `<appSettings>`
- `<connectionStrings>`
- `<identity>`
- `<sessionState>`

<span data-ttu-id="5a0c2-128">Neste tutorial vamos examinar técnicas para proteger essas informações de configuração confidenciais.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-128">In this tutorial we will look at techniques for protecting such sensitive configuration information.</span></span> <span data-ttu-id="5a0c2-129">Como veremos, o .NET Framework versão 2.0 inclui um sistema de configurações protegidas que torna muito simples de seções de configuração selecionada de forma programática com criptografia e descriptografia.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-129">As we will see, the .NET Framework version 2.0 includes a protected configurations system that makes programmatically encrypting and decrypting selected configuration sections a breeze.</span></span>

> [!NOTE]
> <span data-ttu-id="5a0c2-130">Esse tutorial conclui com uma olhada em recomendações s da Microsoft para se conectar a um banco de dados de um aplicativo ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-130">This tutorial concludes with a look at Microsoft s recommendations for connecting to a database from an ASP.NET application.</span></span> <span data-ttu-id="5a0c2-131">Além de criptografar suas cadeias de caracteres de conexão, você pode ajudar a proteger seu sistema, garantindo que você está se conectando ao banco de dados de forma segura.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-131">In addition to encrypting your connection strings, you can help harden your system by ensuring that you are connecting to the database in a secure fashion.</span></span>


## <a name="step-1-exploring-aspnet-20-s-protected-configuration-options"></a><span data-ttu-id="5a0c2-132">Etapa 1: Explorando o ASP.NET 2.0 s protegidas as opções de configuração</span><span class="sxs-lookup"><span data-stu-id="5a0c2-132">Step 1: Exploring ASP.NET 2.0 s Protected Configuration Options</span></span>

<span data-ttu-id="5a0c2-133">O ASP.NET 2.0 inclui um sistema de configuração protegida para criptografar e descriptografar as informações de configuração.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-133">ASP.NET 2.0 includes a protected configuration system for encrypting and decrypting configuration information.</span></span> <span data-ttu-id="5a0c2-134">Isso inclui métodos no .NET Framework que pode ser usado para criptografar ou descriptografar informações de configuração de forma programática.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-134">This includes methods in the .NET Framework that can be used to programmatically encrypt or decrypt configuration information.</span></span> <span data-ttu-id="5a0c2-135">O sistema de configuração protegida usa o [modelo de provedor](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), que permite aos desenvolvedores escolher qual implementação de criptografia é usada.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-135">The protected configuration system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), which allows developers to choose what cryptographic implementation is used.</span></span>

<span data-ttu-id="5a0c2-136">O .NET Framework vem com dois provedores de configuração protegida:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-136">The .NET Framework ships with two protected configuration providers:</span></span>

- <span data-ttu-id="5a0c2-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) -usa assimétrica [algoritmo RSA](http://en.wikipedia.org/wiki/Rsa) para criptografia e descriptografia.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) - uses the asymmetric [RSA algorithm](http://en.wikipedia.org/wiki/Rsa) for encryption and decryption.</span></span>
- <span data-ttu-id="5a0c2-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) -usa o Windows [API de proteção de dados (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) para criptografia e descriptografia.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) - uses the Windows [Data Protection API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) for encryption and decryption.</span></span>

<span data-ttu-id="5a0c2-139">Uma vez que o sistema de configuração protegida implementa o padrão de design de provedor, é possível criar seu próprio provedor de configuração protegida e conectá-lo ao seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-139">Since the protected configuration system implements the provider design pattern, it is possible to create your own protected configuration provider and plug it into your application.</span></span> <span data-ttu-id="5a0c2-140">Ver [implementando um provedor de configuração protegida](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) para obter mais informações sobre esse processo.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-140">See [Implementing a Protected Configuration Provider](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) for more information on this process.</span></span>

<span data-ttu-id="5a0c2-141">Os provedores de RSA e DPAPI usam chaves para suas rotinas de criptografia e descriptografia, e essas chaves podem ser armazenadas no nível da máquina ou usuário.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-141">The RSA and DPAPI providers use keys for their encryption and decryption routines, and these keys can be stored at the machine- or user-level.</span></span> <span data-ttu-id="5a0c2-142">Informações criptografadas de chaves de nível de máquina são ideais para cenários em que o aplicativo web é executado em seu próprio servidor dedicado ou se houver vários aplicativos em um servidor que precisam compartilhar.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-142">Machine-level keys are ideal for scenarios where the web application runs on its own dedicated server or if there are multiple applications on a server that need to share encrypted information.</span></span> <span data-ttu-id="5a0c2-143">As chaves de nível de usuário são uma opção mais segura em ambientes de hospedagem compartilhadas, onde outros aplicativos no mesmo servidor não devem ser capazes de descriptografar suas seções de configuração do aplicativo s protegidos.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-143">User-level keys are a more secure option in shared hosting environments where other applications on the same server should not be able to decrypt your application s protected configuration sections.</span></span>

<span data-ttu-id="5a0c2-144">Neste tutorial nossos exemplos usará o provedor DPAPI e chaves de nível de máquina.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-144">In this tutorial our examples will use the DPAPI provider and machine-level keys.</span></span> <span data-ttu-id="5a0c2-145">Especificamente, examinaremos criptografando as `<connectionStrings>` seção `Web.config`, embora o sistema de configuração protegida pode ser usado para criptografar a maioria dos qualquer `Web.config` seção.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-145">Specifically, we will look at encrypting the `<connectionStrings>` section in `Web.config`, although the protected configuration system can be used to encrypt most any `Web.config` section.</span></span> <span data-ttu-id="5a0c2-146">Para obter informações sobre o uso de chaves de nível de usuário ou usando o provedor RSA, consulte os recursos na seção Leituras adicionais no final deste tutorial.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-146">For information on using user-level keys or using the RSA provider, consult the resources in the Further Readings section at the end of this tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="5a0c2-147">O `RSAProtectedConfigurationProvider` e `DPAPIProtectedConfigurationProvider` provedores são registrados na `machine.config` arquivo com os nomes de provedor `RsaProtectedConfigurationProvider` e `DataProtectionConfigurationProvider`, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-147">The `RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider` providers are registered in the `machine.config` file with the provider names `RsaProtectedConfigurationProvider` and `DataProtectionConfigurationProvider`, respectively.</span></span> <span data-ttu-id="5a0c2-148">Ao criptografar ou descriptografar informações de configuração, precisamos fornecer o nome de provedor apropriado (`RsaProtectedConfigurationProvider` ou `DataProtectionConfigurationProvider`) em vez do nome do tipo real (`RSAProtectedConfigurationProvider` e `DPAPIProtectedConfigurationProvider`).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-148">When encrypting or decrypting configuration information we will need to supply the appropriate provider name (`RsaProtectedConfigurationProvider` or `DataProtectionConfigurationProvider`) rather than the actual type name (`RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider`).</span></span> <span data-ttu-id="5a0c2-149">Você pode encontrar o `machine.config` arquivo o `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG` pasta.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-149">You can find the `machine.config` file in the `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG` folder.</span></span>


## <a name="step-2-programmatically-encrypting-and-decrypting-configuration-sections"></a><span data-ttu-id="5a0c2-150">Etapa 2: Por meio de programação criptografar e descriptografar as seções de configuração</span><span class="sxs-lookup"><span data-stu-id="5a0c2-150">Step 2: Programmatically Encrypting and Decrypting Configuration Sections</span></span>

<span data-ttu-id="5a0c2-151">Com algumas linhas de código podemos criptografar ou descriptografar uma seção de configuração específico usando um provedor especificado.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-151">With a few lines of code we can encrypt or decrypt a particular configuration section using a specified provider.</span></span> <span data-ttu-id="5a0c2-152">O código, como veremos daqui a pouco, simplesmente precisa referenciar programaticamente a seção de configuração apropriado, chame seu `ProtectSection` ou `UnprotectSection` método e, em seguida, chame o `Save` método para manter as alterações.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-152">The code, as we will see shortly, simply needs to programmatically reference the appropriate configuration section, call its `ProtectSection` or `UnprotectSection` method, and then call the `Save` method to persist the changes.</span></span> <span data-ttu-id="5a0c2-153">Além disso, o .NET Framework inclui um utilitário de linha de comando útil que pode criptografar e descriptografar as informações de configuração.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-153">Moreover, the .NET Framework includes a helpful command line utility that can encrypt and decrypt configuration information.</span></span> <span data-ttu-id="5a0c2-154">Vamos explorar esse utilitário de linha de comando na etapa 3.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-154">We will explore this command line utility in Step 3.</span></span>

<span data-ttu-id="5a0c2-155">Para ilustrar por meio de programação de proteção de informações de configuração, let s criar uma página ASP.NET que inclui botões para criptografar e descriptografar o `<connectionStrings>` seção `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-155">To illustrate programmatically protecting configuration information, let s create an ASP.NET page that includes buttons for encrypting and decrypting the `<connectionStrings>` section in `Web.config`.</span></span>

<span data-ttu-id="5a0c2-156">Comece abrindo o `EncryptingConfigSections.aspx` página o `AdvancedDAL` pasta.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-156">Start by opening the `EncryptingConfigSections.aspx` page in the `AdvancedDAL` folder.</span></span> <span data-ttu-id="5a0c2-157">Arraste um controle de caixa de texto da caixa de ferramentas para o Designer, definindo sua `ID` propriedade para `WebConfigContents`, sua `TextMode` propriedade a ser `MultiLine`e sua `Width` e `Rows` propriedades a 95% e 15, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-157">Drag a TextBox control from the Toolbox onto the Designer, setting its `ID` property to `WebConfigContents`, its `TextMode` property to `MultiLine`, and its `Width` and `Rows` properties to 95% and 15, respectively.</span></span> <span data-ttu-id="5a0c2-158">Esse controle de caixa de texto exibirá o conteúdo de `Web.config` que nos permite ver rapidamente se o conteúdo é criptografado ou não.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-158">This TextBox control will display the contents of `Web.config` allowing us to quickly see if the contents are encrypted or not.</span></span> <span data-ttu-id="5a0c2-159">É claro que, em um aplicativo real seriam nunca deseja exibir o conteúdo de `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-159">Of course, in a real application you would never want to display the contents of `Web.config`.</span></span>

<span data-ttu-id="5a0c2-160">Sob a caixa de texto, adicione dois controles de botão chamados `EncryptConnStrings` e `DecryptConnStrings`.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-160">Beneath the TextBox, add two Button controls named `EncryptConnStrings` and `DecryptConnStrings`.</span></span> <span data-ttu-id="5a0c2-161">Defina suas propriedades de texto como cadeias de caracteres de Conexão criptografar e descriptografar cadeias de caracteres de Conexão.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-161">Set their Text properties to Encrypt Connection Strings and Decrypt Connection Strings .</span></span>

<span data-ttu-id="5a0c2-162">Neste ponto, sua tela deve ser semelhante da Figura 2.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-162">At this point your screen should look similar to Figure 2.</span></span>


[![A<span data-ttu-id="5a0c2-163">dd uma caixa de texto e dois controles de Web de botão para a página]</span><span class="sxs-lookup"><span data-stu-id="5a0c2-163">dd a TextBox and Two Button Web Controls to the Page]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)

<span data-ttu-id="5a0c2-164">**Figura 2**: Adicione uma caixa de texto e dois controles de Web de botão à página ([clique para exibir a imagem em tamanho normal](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5a0c2-164">**Figure 2**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span></span>


<span data-ttu-id="5a0c2-165">Em seguida, precisamos escrever um código que carrega e exibe o conteúdo da `Web.config` no `WebConfigContents` carregado da caixa de texto quando a página é o primeira.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-165">Next, we need to write code that loads and displays the contents of `Web.config` in the `WebConfigContents` TextBox when the page is first loaded.</span></span> <span data-ttu-id="5a0c2-166">Adicione o seguinte código para a classe de code-behind de s de página.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-166">Add the following code to the page s code-behind class.</span></span> <span data-ttu-id="5a0c2-167">Este código adiciona um método chamado `DisplayWebConfig` e chama-o do `Page_Load` manipulador de eventos quando `Page.IsPostBack` é `false`:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-167">This code adds a method named `DisplayWebConfig` and calls it from the `Page_Load` event handler when `Page.IsPostBack` is `false`:</span></span>


[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample1.cs)]

<span data-ttu-id="5a0c2-168">O `DisplayWebConfig` usa o [ `File` classe](https://msdn.microsoft.com/library/system.io.file.aspx) para abrir o aplicativo s `Web.config` arquivo, o [ `StreamReader` classe](https://msdn.microsoft.com/library/system.io.streamreader.aspx) para ler seu conteúdo em uma cadeia de caracteres e o [ `Path` classe](https://msdn.microsoft.com/library/system.io.path.aspx) para gerar o caminho físico para o `Web.config` arquivo.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-168">The `DisplayWebConfig` method uses the [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) to open the application s `Web.config` file, the [`StreamReader` class](https://msdn.microsoft.com/library/system.io.streamreader.aspx) to read its contents into a string, and the [`Path` class](https://msdn.microsoft.com/library/system.io.path.aspx) to generate the physical path to the `Web.config` file.</span></span> <span data-ttu-id="5a0c2-169">Essas três classes são todos encontrados na [ `System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-169">These three classes are all found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="5a0c2-170">Consequentemente, você precisará adicionar um `using` `System.IO` instrução na parte superior da classe code-behind ou, Alternativamente, prefixo de nomes com essas classes `System.IO.` .</span><span class="sxs-lookup"><span data-stu-id="5a0c2-170">Consequently, you will need to add a `using` `System.IO` statement to the top of the code-behind class or, alternatively, prefix these class names with `System.IO.` .</span></span>

<span data-ttu-id="5a0c2-171">Em seguida, precisamos adicionar manipuladores de eventos para os dois controles de botão `Click` eventos e adicione o código necessário para criptografar e descriptografar o `<connectionStrings>` seção usando uma chave de nível de máquina com o provedor DPAPI.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-171">Next, we need to add event handlers for the two Button controls `Click` events and add the necessary code to encrypt and decrypt the `<connectionStrings>` section using a machine-level key with the DPAPI provider.</span></span> <span data-ttu-id="5a0c2-172">No Designer, clique duas vezes em cada um dos botões para adicionar um `Click` manipulador de eventos no code-behind de classe e, em seguida, adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-172">From the Designer, double-click each of the Buttons to add a `Click` event handler in the code-behind class and then add the following code:</span></span>


[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample2.cs)]

<span data-ttu-id="5a0c2-173">O código usado nos manipuladores de eventos de dois é praticamente idêntico.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-173">The code used in the two event handlers is nearly identical.</span></span> <span data-ttu-id="5a0c2-174">Ambos comecem Obtendo informações sobre o aplicativo atual `Web.config` de arquivos por meio de [ `WebConfigurationManager` classe](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) s [ `OpenWebConfiguration` método](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-174">They both start by getting information about the current application s `Web.config` file via the [`WebConfigurationManager` class](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) s [`OpenWebConfiguration` method](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx).</span></span> <span data-ttu-id="5a0c2-175">Esse método retorna o arquivo de configuração da web para o caminho virtual especificado.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-175">This method returns the web configuration file for the specified virtual path.</span></span> <span data-ttu-id="5a0c2-176">Em seguida, o `Web.config` s de arquivo `<connectionStrings>` seção é acessada por meio de [ `Configuration` classe](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) s [ `GetSection(sectionName)` método](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx), que retorna um [ `ConfigurationSection` ](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) objeto.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-176">Next, the `Web.config` file s `<connectionStrings>` section is accessed via the [`Configuration` class](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) s [`GetSection(sectionName)` method](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx), which returns a [`ConfigurationSection`](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) object.</span></span>

<span data-ttu-id="5a0c2-177">O `ConfigurationSection` objeto inclui um [ `SectionInformation` propriedade](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) que fornece informações adicionais e funcionalidades em relação à seção de configuração.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-177">The `ConfigurationSection` object includes a [`SectionInformation` property](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) that provides additional information and functionality regarding the configuration section.</span></span> <span data-ttu-id="5a0c2-178">Como o código acima mostra, podemos determinar se a seção de configuração é criptografada, verificando o `SectionInformation` propriedade s `IsProtected` propriedade.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-178">As the code above shows, we can determine whether the configuration section is encrypted by checking the `SectionInformation` property s `IsProtected` property.</span></span> <span data-ttu-id="5a0c2-179">Além disso, a seção pode ser criptografada ou descriptografada por meio de `SectionInformation` propriedade s `ProtectSection(provider)` e `UnprotectSection` métodos.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-179">Moreover, the section can be encrypted or decrypted via the `SectionInformation` property s `ProtectSection(provider)` and `UnprotectSection` methods.</span></span>

<span data-ttu-id="5a0c2-180">O `ProtectSection(provider)` método aceita como entrada uma cadeia de caracteres especificando o nome do provedor de configuração protegida para usar ao criptografar.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-180">The `ProtectSection(provider)` method accepts as input a string specifying the name of the protected configuration provider to use when encrypting.</span></span> <span data-ttu-id="5a0c2-181">No `EncryptConnString` manipulador de eventos do botão s passamos DataProtectionConfigurationProvider no `ProtectSection(provider)` método para que o provedor do DPAPI é usado.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-181">In the `EncryptConnString` Button s event handler we pass DataProtectionConfigurationProvider into the `ProtectSection(provider)` method so that the DPAPI provider is used.</span></span> <span data-ttu-id="5a0c2-182">O `UnprotectSection` método pode determinar o provedor que foi usado para criptografar a seção de configuração e, portanto, não requer parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-182">The `UnprotectSection` method can determine the provider that was used to encrypt the configuration section and therefore does not require any input parameters.</span></span>

<span data-ttu-id="5a0c2-183">Depois de chamar o `ProtectSection(provider)` ou `UnprotectSection` método, você deve chamar o `Configuration` objeto s [ `Save` método](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) para manter as alterações.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-183">After calling the `ProtectSection(provider)` or `UnprotectSection` method, you must call the `Configuration` object s [`Save` method](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) to persist the changes.</span></span> <span data-ttu-id="5a0c2-184">Depois que as informações de configuração foram criptografadas ou descriptografadas e as alterações salvadas, chamamos `DisplayWebConfig` para carregar o atualizado `Web.config` conteúdo no controle de caixa de texto.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-184">Once the configuration information has been encrypted or decrypted and the changes saved, we call `DisplayWebConfig` to load the updated `Web.config` contents into the TextBox control.</span></span>

<span data-ttu-id="5a0c2-185">Depois que você inseriu o código acima, testá-lo visitando o `EncryptingConfigSections.aspx` página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-185">Once you have entered the above code, test it by visiting the `EncryptingConfigSections.aspx` page through a browser.</span></span> <span data-ttu-id="5a0c2-186">Inicialmente, você verá uma página que lista o conteúdo do `Web.config` com o `<connectionStrings>` seção exibida em texto sem formatação (veja a Figura 3).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-186">You should initially see a page that lists the contents of `Web.config` with the `<connectionStrings>` section displayed in plain-text (see Figure 3).</span></span>


[![A<span data-ttu-id="5a0c2-187">dd uma caixa de texto e dois controles de Web de botão para a página]</span><span class="sxs-lookup"><span data-stu-id="5a0c2-187">dd a TextBox and Two Button Web Controls to the Page]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)

<span data-ttu-id="5a0c2-188">**Figura 3**: Adicione uma caixa de texto e dois controles de Web de botão à página ([clique para exibir a imagem em tamanho normal](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="5a0c2-188">**Figure 3**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span></span>


<span data-ttu-id="5a0c2-189">Agora, clique no botão criptografar cadeias de caracteres de Conexão.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-189">Now click the Encrypt Connection Strings button.</span></span> <span data-ttu-id="5a0c2-190">Se a validação de solicitação estiver habilitada, a marcação postada a partir de `WebConfigContents` TextBox produzirá uma `HttpRequestValidationException`, que exibe a mensagem, potencialmente perigosa `Request.Form` valor foi detectado no cliente.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-190">If request validation is enabled, the markup posted back from the `WebConfigContents` TextBox will produce an `HttpRequestValidationException`, which displays the message, A potentially dangerous `Request.Form` value was detected from the client.</span></span> <span data-ttu-id="5a0c2-191">Validação de solicitação, que é habilitada por padrão no ASP.NET 2.0, proíbe postbacks que incluem sem HTML codificado e foi projetada para ajudar a evitar ataques de injeção de script.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-191">Request validation, which is enabled by default in ASP.NET 2.0, prohibits postbacks that include un-encoded HTML and is designed to help prevent script-injection attacks.</span></span> <span data-ttu-id="5a0c2-192">Essa verificação pode ser desabilitada na página - ou nível do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-192">This check can be disabled at the page- or application-level.</span></span> <span data-ttu-id="5a0c2-193">Para desativá-lo para essa página, defina as `ValidateRequest` definir como `false` no `@Page` diretiva.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-193">To turn it off for this page, set the `ValidateRequest` setting to `false` in the `@Page` directive.</span></span> <span data-ttu-id="5a0c2-194">O `@Page` diretiva for encontrada na parte superior da marcação declarativa de s de página.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-194">The `@Page` directive is found at the top of the page s declarative markup.</span></span>


[!code-aspx[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample3.aspx)]

<span data-ttu-id="5a0c2-195">Para obter mais informações sobre a validação de solicitação, sua finalidade, como desabilitá-lo na página – e nível do aplicativo, como bem como para o HTML codificar marcação, consulte [solicitação de validação – impedindo ataques de Script](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-195">For more information on request validation, its purpose, how to disable it at the page- and application-level, as well as how to HTML encode markup, see [Request Validation - Preventing Script Attacks](../../../../whitepapers/request-validation.md).</span></span>

<span data-ttu-id="5a0c2-196">Depois de desabilitar a validação de solicitação para a página, tente clicar no botão criptografar cadeias de caracteres de Conexão novamente.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-196">After disabling request validation for the page, try clicking the Encrypt Connection Strings button again.</span></span> <span data-ttu-id="5a0c2-197">No postback, o arquivo de configuração será acessado e sua `<connectionStrings>` seção criptografada usando o provedor DPAPI.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-197">On postback, the configuration file will be accessed and its `<connectionStrings>` section encrypted using the DPAPI provider.</span></span> <span data-ttu-id="5a0c2-198">A caixa de texto, em seguida, é atualizada para exibir o novo `Web.config` conteúdo.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-198">The TextBox is then updated to display the new `Web.config` content.</span></span> <span data-ttu-id="5a0c2-199">Como mostra a Figura 4, o `<connectionStrings>` informações agora são criptografadas.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-199">As Figure 4 shows, the `<connectionStrings>` information is now encrypted.</span></span>


[![C<span data-ttu-id="5a0c2-200">licking a criptografar Conexão cadeias de caracteres de botão criptografa o &lt;connectionString&gt; seção]</span><span class="sxs-lookup"><span data-stu-id="5a0c2-200">licking the Encrypt Connection Strings Button Encrypts the &lt;connectionString&gt; Section]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)

<span data-ttu-id="5a0c2-201">**Figura 4**: Clicar a criptografar Conexão cadeias de caracteres de botão criptografa o `<connectionString>` seção ([clique para exibir a imagem em tamanho normal](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="5a0c2-201">**Figure 4**: Clicking the Encrypt Connection Strings Button Encrypts the `<connectionString>` Section ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span></span>


<span data-ttu-id="5a0c2-202">O criptografado `<connectionStrings>` seção gerada no meu computador segue, embora o conteúdo a `<CipherData>` elemento tiver sido removido para fins de brevidade:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-202">The encrypted `<connectionStrings>` section generated on my computer follows, although some of the content in the `<CipherData>` element has been removed for brevity:</span></span>


[!code-xml[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample4.xml)]

> [!NOTE]
> <span data-ttu-id="5a0c2-203">O `<connectionStrings>` elemento Especifica o provedor usado para executar a criptografia (`DataProtectionConfigurationProvider`).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-203">The `<connectionStrings>` element specifies the provider used to perform the encryption (`DataProtectionConfigurationProvider`).</span></span> <span data-ttu-id="5a0c2-204">Essas informações são usadas pelo `UnprotectSection` método quando se clica no botão de descriptografar cadeias de caracteres de Conexão.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-204">This information is used by the `UnprotectSection` method when the Decrypt Connection Strings button is clicked.</span></span>


<span data-ttu-id="5a0c2-205">Quando as informações de cadeia de caracteres de conexão são acessadas de `Web.config` - o código que escrevemos, de um controle SqlDataSource, ou o código gerado automaticamente da TableAdapters em nossos conjuntos de dados tipados - é automaticamente descriptografada.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-205">When the connection string information is accessed from `Web.config` - either by code we write, from a SqlDataSource control, or the auto-generated code from the TableAdapters in our Typed DataSets - it is automatically decrypted.</span></span> <span data-ttu-id="5a0c2-206">Em resumo, não precisamos adicionar qualquer código extra ou lógica para descriptografar o criptografado `<connectionString>` seção.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-206">In short, we do not need to add any extra code or logic to decrypt the encrypted `<connectionString>` section.</span></span> <span data-ttu-id="5a0c2-207">Para demonstrar isso, visite um dos tutoriais anteriores neste momento, como o tutorial simples para exibição da seção de relatórios básicos (`~/BasicReporting/SimpleDisplay.aspx`).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-207">To demonstrate this, visit one of the earlier tutorials at this time, such as the Simple Display tutorial from the Basic Reporting section (`~/BasicReporting/SimpleDisplay.aspx`).</span></span> <span data-ttu-id="5a0c2-208">Como mostra a Figura 5, o tutorial funciona exatamente como o que desejávamos, indicando que as informações de cadeia de caracteres de conexão criptografada está sendo descriptografadas automaticamente pela página ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-208">As Figure 5 shows, the tutorial works exactly as we would expect it, indicating that the encrypted connection string information is being automatically decrypted by the ASP.NET page.</span></span>


[![T<span data-ttu-id="5a0c2-209">ele camada de acesso a dados descriptografa automaticamente as informações de cadeia de caracteres de Conexão]</span><span class="sxs-lookup"><span data-stu-id="5a0c2-209">he Data Access Layer Automatically Decrypts the Connection String Information]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)

<span data-ttu-id="5a0c2-210">**Figura 5**: A camada de acesso a dados descriptografa automaticamente as informações de cadeia de caracteres de Conexão ([clique para exibir a imagem em tamanho normal](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="5a0c2-210">**Figure 5**: The Data Access Layer Automatically Decrypts the Connection String Information ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span></span>


<span data-ttu-id="5a0c2-211">Para reverter o `<connectionStrings>` seção novamente em sua representação de texto sem formatação, clique no botão de descriptografar cadeias de caracteres de Conexão.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-211">To revert the `<connectionStrings>` section back to its plain-text representation, click the Decrypt Connection Strings button.</span></span> <span data-ttu-id="5a0c2-212">Em um postback, você deverá ver as cadeias de caracteres de conexão no `Web.config` em texto sem formatação.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-212">On postback you should see the connection strings in `Web.config` in plain-text.</span></span> <span data-ttu-id="5a0c2-213">Neste ponto, sua tela deve ser como ele fez ao primeiro ao visitar essa página (consulte Figura 3).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-213">At this point your screen should look like it did when first visiting this page (see in Figure 3).</span></span>

## <a name="step-3-encrypting-configuration-sections-usingaspnetregiisexe"></a><span data-ttu-id="5a0c2-214">Etapa 3: Criptografar seções de configuração usando o`aspnet_regiis.exe`</span><span class="sxs-lookup"><span data-stu-id="5a0c2-214">Step 3: Encrypting Configuration Sections Using`aspnet_regiis.exe`</span></span>

<span data-ttu-id="5a0c2-215">O .NET Framework inclui uma variedade de ferramentas de linha de comando no `$WINDOWS$\Microsoft.NET\Framework\version\` pasta.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-215">The .NET Framework includes a variety of command line tools in the `$WINDOWS$\Microsoft.NET\Framework\version\` folder.</span></span> <span data-ttu-id="5a0c2-216">No [dependências de Cache de SQL usando](../caching-data/using-sql-cache-dependencies-cs.md) tutorial, por exemplo, analisamos usando o `aspnet_regsql.exe` ferramenta de linha de comando para adicionar a infraestrutura necessária para as dependências de cache SQL.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-216">In the [Using SQL Cache Dependencies](../caching-data/using-sql-cache-dependencies-cs.md) tutorial, for instance, we looked at using the `aspnet_regsql.exe` command line tool to add the infrastructure necessary for SQL cache dependencies.</span></span> <span data-ttu-id="5a0c2-217">Outra ferramenta de linha de comando útil nessa pasta é a [ferramenta de registro do ASP.NET IIS (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-217">Another useful command line tool in this folder is the [ASP.NET IIS Registration tool (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span></span> <span data-ttu-id="5a0c2-218">Como o nome sugere, a ferramenta de registro de IIS do ASP.NET é principalmente usada para registrar um aplicativo ASP.NET 2.0 com o servidor de Web de nível profissional do Microsoft s, o IIS.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-218">As its name implies, the ASP.NET IIS Registration tool is primarily used to register an ASP.NET 2.0 application with Microsoft s professional-grade Web server, IIS.</span></span> <span data-ttu-id="5a0c2-219">Além de seus recursos relacionados ao IIS, a ferramenta de registro do ASP.NET IIS pode ser usada para criptografar ou descriptografar as seções de configuração especificado no `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-219">In addition to its IIS-related features, the ASP.NET IIS Registration tool can also be used to encrypt or decrypt specified configuration sections in `Web.config`.</span></span>

<span data-ttu-id="5a0c2-220">A instrução a seguir mostra a sintaxe geral usada para criptografar uma seção de configuração com o `aspnet_regiis.exe` ferramenta de linha de comando:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-220">The following statement shows the general syntax used to encrypt a configuration section with the `aspnet_regiis.exe` command line tool:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample5.cmd)]

<span data-ttu-id="5a0c2-221">*seção* é a seção de configuração para criptografar (como connectionStrings), o *físico\_diretório* é o caminho físico completo para o diretório de raiz do aplicativo s da web, e *provedor*  é o nome do provedor de configuração protegida para usar (como DataProtectionConfigurationProvider).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-221">*section* is the configuration section to encrypt (like connectionStrings ), the *physical\_directory* is the full, physical path to the web application s root directory, and *provider* is the name of the protected configuration provider to use (such as DataProtectionConfigurationProvider ).</span></span> <span data-ttu-id="5a0c2-222">Como alternativa, se o aplicativo web está registrado no IIS, você pode inserir o caminho virtual em vez do caminho físico usando a seguinte sintaxe:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-222">Alternatively, if the web application is registered in IIS you can enter the virtual path instead of the physical path using the following syntax:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample6.cmd)]

<span data-ttu-id="5a0c2-223">O seguinte `aspnet_regiis.exe` exemplo criptografa o `<connectionStrings>` seção usando o provedor com a DPAPI com uma chave de nível de máquina:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-223">The following `aspnet_regiis.exe` example encrypts the `<connectionStrings>` section using the DPAPI provider with a machine-level key:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample7.cmd)]

<span data-ttu-id="5a0c2-224">Da mesma forma, o `aspnet_regiis.exe` ferramenta de linha de comando pode ser usada para descriptografar as seções de configuração.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-224">Similarly, the `aspnet_regiis.exe` command line tool can be used to decrypt configuration sections.</span></span> <span data-ttu-id="5a0c2-225">Em vez de usar o `-pef` alternar, use `-pdf` (ou instead of `-pe`, use `-pd`).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-225">Instead of using the `-pef` switch, use `-pdf` (or instead of `-pe`, use `-pd`).</span></span> <span data-ttu-id="5a0c2-226">Além disso, observe que o nome do provedor não é necessário ao descriptografar.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-226">Also, note that the provider name is not necessary when decrypting.</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample8.cmd)]

> [!NOTE]
> <span data-ttu-id="5a0c2-227">Como estamos usando o provedor DPAPI, que usa chaves específicas do computador, você deve executar `aspnet_regiis.exe` no mesmo computador do qual as páginas da web estão sendo atendidas.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-227">Since we are using the DPAPI provider, which uses keys specific to the computer, you must run `aspnet_regiis.exe` from the same machine from which the web pages are being served.</span></span> <span data-ttu-id="5a0c2-228">Por exemplo, se você executar este programa de linha de comando do seu computador de desenvolvimento local e, em seguida, carregar o arquivo Web. config criptografado para o servidor de produção, o servidor de produção não será capaz de descriptografar as informações de cadeia de caracteres de conexão desde que foi criptografado usando chaves específicas para sua máquina de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-228">For example, if you run this command line program from your local development machine and then upload the encrypted Web.config file to the production server, the production server will not be able to decrypt the connection string information since it was encrypted using keys specific to your development machine.</span></span> <span data-ttu-id="5a0c2-229">O provedor RSA não tem essa limitação como é possível exportar as chaves RSA para outro computador.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-229">The RSA provider does not have this limitation as it is possible to export the RSA keys to another machine.</span></span>


## <a name="understanding-database-authentication-options"></a><span data-ttu-id="5a0c2-230">Noções básicas sobre opções de autenticação de banco de dados</span><span class="sxs-lookup"><span data-stu-id="5a0c2-230">Understanding Database Authentication Options</span></span>

<span data-ttu-id="5a0c2-231">Antes de qualquer aplicativo pode emitir `SELECT`, `INSERT`, `UPDATE`, ou `DELETE` consultas para um banco de dados do Microsoft SQL Server, o banco de dados primeiro devem identificar o solicitante.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-231">Before any application can issue `SELECT`, `INSERT`, `UPDATE`, or `DELETE` queries to a Microsoft SQL Server database, the database first must identify the requestor.</span></span> <span data-ttu-id="5a0c2-232">Esse processo é conhecido como *autenticação* e do SQL Server fornece dois métodos de autenticação:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-232">This process is known as *authentication* and SQL Server provides two methods of authentication:</span></span>

- <span data-ttu-id="5a0c2-233">**Autenticação do Windows** -o processo sob a qual o aplicativo está em execução é usado para se comunicar com o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-233">**Windows Authentication** - the process under which the application is running is used to communicate with the database.</span></span> <span data-ttu-id="5a0c2-234">Ao executar um aplicativo ASP.NET por meio do Visual Studio 2005 s ASP.NET Development Server, o aplicativo ASP.NET assume a identidade do usuário conectado no momento.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-234">When running an ASP.NET application through Visual Studio 2005 s ASP.NET Development Server, the ASP.NET application assumes the identity of the currently logged on user.</span></span> <span data-ttu-id="5a0c2-235">Para aplicativos do ASP.NET no Microsoft Internet Information Server (IIS), aplicativos ASP.NET normalmente assumir a identidade do `domainName``\MachineName` ou `domainName``\NETWORK SERVICE`, embora isso pode ser personalizado.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-235">For ASP.NET applications on Microsoft Internet Information Server (IIS), ASP.NET applications usually assume the identity of `domainName``\MachineName` or `domainName``\NETWORK SERVICE`, although this can be customized.</span></span>
- <span data-ttu-id="5a0c2-236">**Autenticação do SQL** -um valores de ID e a senha do usuário são fornecidos como credenciais para autenticação.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-236">**SQL Authentication** - a user ID and password values are supplied as credentials for authentication.</span></span> <span data-ttu-id="5a0c2-237">Com a autenticação do SQL, a ID de usuário e senha são fornecidos na cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-237">With SQL authentication, the user ID and password are provided in the connection string.</span></span>

<span data-ttu-id="5a0c2-238">Autenticação do Windows é preferencial em relação à autenticação do SQL porque é mais seguro.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-238">Windows authentication is preferred over SQL authentication because it is more secure.</span></span> <span data-ttu-id="5a0c2-239">Com a autenticação do Windows a cadeia de caracteres de conexão está livre de um nome de usuário e uma senha e se o servidor web e o servidor de banco de dados residirem em dois computadores diferentes, as credenciais não são enviadas pela rede em texto sem formatação.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-239">With Windows authentication the connection string is free from a username and password and if the web server and database server reside on two different machines, the credentials are not sent over the network in plain-text.</span></span> <span data-ttu-id="5a0c2-240">Com a autenticação do SQL, no entanto, as credenciais de autenticação são embutidos na cadeia de conexão e são transmitidas do servidor web para o servidor de banco de dados em texto sem formatação.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-240">With SQL authentication, however, the authentication credentials are hard-coded in the connection string and are transmitted from the web server to the database server in plain-text.</span></span>

<span data-ttu-id="5a0c2-241">Esses tutoriais usou a autenticação do Windows.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-241">These tutorials have used Windows authentication.</span></span> <span data-ttu-id="5a0c2-242">Você pode dizer qual modo de autenticação está sendo usado inspecionando a cadeia de caracteres de conexão.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-242">You can tell what authentication mode is being used by inspecting the connection string.</span></span> <span data-ttu-id="5a0c2-243">A cadeia de conexão no `Web.config` para nossos tutoriais foi:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-243">The connection string in `Web.config` for our tutorials has been:</span></span>

`Data Source=.\SQLEXPRESS; AttachDbFilename=|DataDirectory|\NORTHWND.MDF; Integrated Security=True; User Instance=True`

<span data-ttu-id="5a0c2-244">A segurança integrada = True e a falta de um nome de usuário e senha indicam que a autenticação do Windows está sendo usada.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-244">The Integrated Security=True and lack of a username and password indicate that Windows authentication is being used.</span></span> <span data-ttu-id="5a0c2-245">Em alguma conexão cadeias de caracteres de Conexão confiável termo = Yes ou a segurança integrada = SSPI é usado em vez da segurança integrada = True, mas todos os três indicam o uso da autenticação do Windows.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-245">In some connection strings the term Trusted Connection=Yes or Integrated Security=SSPI is used instead of Integrated Security=True, but all three indicate the use of Windows authentication.</span></span>

<span data-ttu-id="5a0c2-246">O exemplo a seguir mostra uma cadeia de caracteres de conexão que usa a autenticação do SQL.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-246">The following example shows a connection string that uses SQL authentication.</span></span> <span data-ttu-id="5a0c2-247">Observe que as credenciais inseridas na cadeia de conexão:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-247">Note the credentials embedded within the connection string:</span></span>

`Server=serverName; Database=Northwind; uid=userID; pwd=password`

<span data-ttu-id="5a0c2-248">Imagine que um invasor é capaz de exibir o aplicativo s `Web.config` arquivo.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-248">Imagine that an attacker is able to view your application s `Web.config` file.</span></span> <span data-ttu-id="5a0c2-249">Se você usar autenticação do SQL para se conectar a um banco de dados que seja acessível pela Internet, o invasor pode usar essa cadeia de caracteres de conexão para se conectar ao seu banco de dados SQL Management Studio ou de páginas do ASP.NET no seu próprio site.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-249">If you use SQL authentication to connect to a database that is accessible over the Internet, the attacker can use this connection string to connect to your database through SQL Management Studio or from ASP.NET pages on their own website.</span></span> <span data-ttu-id="5a0c2-250">Para ajudar a reduzir essa ameaça, criptografa as informações de cadeia de caracteres de conexão do `Web.config` usando o sistema de configuração protegida.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-250">To help mitigate this threat, encrypt the connection string information in `Web.config` using the protected configuration system.</span></span>

> [!NOTE]
> <span data-ttu-id="5a0c2-251">Para obter mais informações sobre os diferentes tipos de autenticação disponíveis no SQL Server, consulte [Building Secure ASP.NET Applications: Autenticação, autorização e comunicação segura](https://msdn.microsoft.com/library/aa302392.aspx).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-251">For more information on the different types of authentication available in SQL Server, see [Building Secure ASP.NET Applications: Authentication, Authorization, and Secure Communication](https://msdn.microsoft.com/library/aa302392.aspx).</span></span> <span data-ttu-id="5a0c2-252">Para obter ainda mais conexão cadeia de caracteres exemplos que ilustram as diferenças entre a sintaxe de autenticação do Windows e SQL, consulte [ConnectionStrings.com](http://www.connectionstrings.com/).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-252">For further connection string examples illustrating the differences between Windows and SQL authentication syntax, refer to [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>


## <a name="summary"></a><span data-ttu-id="5a0c2-253">Resumo</span><span class="sxs-lookup"><span data-stu-id="5a0c2-253">Summary</span></span>

<span data-ttu-id="5a0c2-254">Por padrão, os arquivos com um `.config` extensão em um aplicativo ASP.NET não pode ser acessado por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-254">By default, files with a `.config` extension in an ASP.NET application cannot be accessed through a browser.</span></span> <span data-ttu-id="5a0c2-255">Esses tipos de arquivos não são retornados porque eles podem conter informações confidenciais, como cadeias de conexão de banco de dados, os nomes de usuário e senhas e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-255">These types of files are not returned because they may contain sensitive information, such as database connection strings, usernames and passwords, and so on.</span></span> <span data-ttu-id="5a0c2-256">O sistema de configuração protegida no .NET 2.0 ajuda a proteger ainda mais as informações confidenciais, permitindo que as seções de configuração especificado a ser criptografado.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-256">The protected configuration system in .NET 2.0 helps further protect sensitive information by allowing specified configuration sections to be encrypted.</span></span> <span data-ttu-id="5a0c2-257">Há dois provedores de configuração protegida internos: um que usa o algoritmo RSA e outro que usa o Windows Data Protection DPAPI (API).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-257">There are two built-in protected configuration providers: one that uses the RSA algorithm and one that uses the Windows Data Protection API (DPAPI).</span></span>

<span data-ttu-id="5a0c2-258">Neste tutorial vimos como criptografar e descriptografar as definições de configuração usando o provedor DPAPI.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-258">In this tutorial we looked at how to encrypt and decrypt configuration settings using the DPAPI provider.</span></span> <span data-ttu-id="5a0c2-259">Isso pode ser feito por meio de programação, como vimos na etapa 2, bem como por meio de `aspnet_regiis.exe` ferramenta de linha de comando, que foi abordada na etapa 3.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-259">This can be accomplished both programmatically, as we saw in Step 2, as well as through the `aspnet_regiis.exe` command line tool, which was covered in Step 3.</span></span> <span data-ttu-id="5a0c2-260">Para obter mais informações sobre o uso de chaves de nível de usuário ou usando o provedor RSA em vez disso, consulte os recursos na seção leitura adicional.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-260">For more information on using user-level keys or using the RSA provider instead, see the resources in the Further Reading section.</span></span>

<span data-ttu-id="5a0c2-261">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="5a0c2-261">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="5a0c2-262">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="5a0c2-262">Further Reading</span></span>

<span data-ttu-id="5a0c2-263">Para obter mais informações sobre os tópicos abordados neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="5a0c2-263">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="5a0c2-264">Aplicativos ASP.NET seguros de construção: Autenticação, autorização e comunicação segura</span><span class="sxs-lookup"><span data-stu-id="5a0c2-264">Building Secure ASP.NET Application: Authentication, Authorization, and Secure Communication</span></span>](https://msdn.microsoft.com/library/aa302392.aspx)
- [<span data-ttu-id="5a0c2-265">Criptografando informações de configuração no ASP.NET 2.0 Applications</span><span class="sxs-lookup"><span data-stu-id="5a0c2-265">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="5a0c2-266">Criptografando `Web.config` valores no ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="5a0c2-266">Encrypting `Web.config` Values in ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/archive/2006/01/09/434893.aspx)
- [<span data-ttu-id="5a0c2-267">Como: Criptografar seções de configuração no ASP.NET 2.0 usando DPAPI</span><span class="sxs-lookup"><span data-stu-id="5a0c2-267">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using DPAPI</span></span>](https://msdn.microsoft.com/library/ms998280.aspx)
- [<span data-ttu-id="5a0c2-268">Como: Criptografar seções de configuração no ASP.NET 2.0 usando o RSA</span><span class="sxs-lookup"><span data-stu-id="5a0c2-268">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using RSA</span></span>](https://msdn.microsoft.com/library/ms998283.aspx)
- [<span data-ttu-id="5a0c2-269">A API de configuração no .NET 2.0</span><span class="sxs-lookup"><span data-stu-id="5a0c2-269">The Configuration API in .NET 2.0</span></span>](http://www.odetocode.com/Articles/418.aspx)
- [<span data-ttu-id="5a0c2-270">Proteção de dados do Windows</span><span class="sxs-lookup"><span data-stu-id="5a0c2-270">Windows Data Protection</span></span>](https://msdn.microsoft.com/library/ms995355.aspx)

## <a name="about-the-author"></a><span data-ttu-id="5a0c2-271">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="5a0c2-271">About the Author</span></span>

<span data-ttu-id="5a0c2-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP.NET e fundador da [4GuysFromRolla.com](http://www.4guysfromrolla.com), tem trabalhado com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5a0c2-273">Scott funciona como um consultor independente, instrutor e escritor.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-273">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5a0c2-274">Seu livro mais recente é [ *Sams Teach por conta própria ASP.NET 2.0 em 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-274">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5a0c2-275">Ele pode ser contatado pelo [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5a0c2-275">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5a0c2-276">ou por meio de seu blog, que pode ser encontrado em [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="5a0c2-276">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="5a0c2-277">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="5a0c2-277">Special Thanks To</span></span>

<span data-ttu-id="5a0c2-278">Esta série de tutoriais foi revisada por muitos revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-278">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5a0c2-279">Os revisores de avanço para este tutorial foram Teresa Murphy e Randy Schmidt.</span><span class="sxs-lookup"><span data-stu-id="5a0c2-279">Lead reviewers for this tutorial were Teresa Murphy and Randy Schmidt.</span></span> <span data-ttu-id="5a0c2-280">Você está interessado na revisão Meus próximos artigos do MSDN?</span><span class="sxs-lookup"><span data-stu-id="5a0c2-280">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5a0c2-281">Nesse caso, me descartar uma linha na [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5a0c2-281">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5a0c2-282">[Anterior](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
> [Próximo](debugging-stored-procedures-cs.md)</span><span class="sxs-lookup"><span data-stu-id="5a0c2-282">[Previous](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
[Next](debugging-stored-procedures-cs.md)</span></span>
