---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
title: Associação e administração | Microsoft Docs
author: Erikre
description: Esta série de tutoriais ensinará os conceitos básicos da criação de um aplicativo de Web Forms do ASP.NET usando o ASP.NET 4.5 e do Microsoft Visual Studio Express 2013 para nós...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 732a2316-e49f-4f72-becd-0cd72f14457e
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
msc.type: authoredcontent
ms.openlocfilehash: 59f859ea30572fbe66184f29555ac2c5c2f22f82
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65132136"
---
# <a name="membership-and-administration"></a><span data-ttu-id="1b6af-103">Associação e administração</span><span class="sxs-lookup"><span data-stu-id="1b6af-103">Membership and Administration</span></span>

<span data-ttu-id="1b6af-104">by [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="1b6af-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="1b6af-105">[Baixe o projeto de exemplo do Wingtip Toys (c#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) ou [Baixe o livro eletrônico (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="1b6af-105">[Download Wingtip Toys Sample Project (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="1b6af-106">Esta série de tutoriais ensinará os conceitos básicos da criação de um aplicativo de Web Forms do ASP.NET usando o ASP.NET 4.5 e do Microsoft Visual Studio Express 2013 para Web.</span><span class="sxs-lookup"><span data-stu-id="1b6af-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="1b6af-107">Um Visual Studio 2013 [projeto com código-fonte c#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) está disponível para acompanhar esta série de tutoriais.</span><span class="sxs-lookup"><span data-stu-id="1b6af-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>

<span data-ttu-id="1b6af-108">Este tutorial mostra como atualizar o aplicativo de exemplo Wingtip Toys para adicionar uma função personalizada e usar a identidade do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1b6af-108">This tutorial shows you how to update the Wingtip Toys sample application to add a custom role and use ASP.NET Identity.</span></span> <span data-ttu-id="1b6af-109">Ele também mostra como implementar uma página de administração do qual o usuário com uma função personalizada pode adicionar e remover produtos no site.</span><span class="sxs-lookup"><span data-stu-id="1b6af-109">It also shows you how to implement an administration page from which the user with a custom role can add and remove products from the website.</span></span>

<span data-ttu-id="1b6af-110">[O ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) é o sistema de associação usado para criar um aplicativo da web ASP.NET e está disponível no ASP.NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="1b6af-110">[ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) is the membership system used to build ASP.NET web application and is available in ASP.NET 4.5.</span></span> <span data-ttu-id="1b6af-111">O ASP.NET Identity é usado no modelo de projeto do Web Forms do Visual Studio 2013, bem como os modelos para [ASP.NET MVC](../../../../mvc/index.md), [API Web ASP.NET](../../../../web-api/index.md), e [o aplicativo de página única ASP.NET](../../../../single-page-application/index.md).</span><span class="sxs-lookup"><span data-stu-id="1b6af-111">ASP.NET Identity is used in the Visual Studio 2013 Web Forms project template, as well as the templates for [ASP.NET MVC](../../../../mvc/index.md), [ASP.NET Web API](../../../../web-api/index.md), and [ASP.NET Single Page Application](../../../../single-page-application/index.md).</span></span> <span data-ttu-id="1b6af-112">Também, especificamente, você pode instalar o sistema de identidade do ASP.NET usando o NuGet quando você começa com um aplicativo Web vazio.</span><span class="sxs-lookup"><span data-stu-id="1b6af-112">You can also specifically install the ASP.NET Identity system using NuGet when you start with an empty Web application.</span></span> <span data-ttu-id="1b6af-113">No entanto, nessa série de tutoriais que você usa o **Web Forms**projecttemplate, que inclui o sistema de identidade do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1b6af-113">However, in this tutorial series you use the **Web Forms**projecttemplate, which includes the ASP.NET Identity system.</span></span> <span data-ttu-id="1b6af-114">O ASP.NET Identity torna mais fácil integrar dados de perfil de usuário específico com os dados de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-114">ASP.NET Identity makes it easy to integrate user-specific profile data with application data.</span></span> <span data-ttu-id="1b6af-115">Além disso, o ASP.NET Identity permite que você escolha o modelo de persistência para perfis de usuário em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-115">Also, ASP.NET Identity allows you to choose the persistence model for user profiles in your application.</span></span> <span data-ttu-id="1b6af-116">Você pode armazenar os dados em um banco de dados do SQL Server ou outro armazenamento de dados, incluindo *NoSQL* armazenamentos de dados, como tabelas de armazenamento do Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="1b6af-116">You can store the data in a SQL Server database or another data store, including *NoSQL* data stores such as Windows Azure Storage Tables.</span></span>

<span data-ttu-id="1b6af-117">Este tutorial se baseia no tutorial anterior intitulado "Check-out e pagamento com o PayPal" a série de tutoriais de Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="1b6af-117">This tutorial builds on the previous tutorial titled "Checkout and Payment with PayPal" in the Wingtip Toys tutorial series.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="1b6af-118">O que você aprenderá:</span><span class="sxs-lookup"><span data-stu-id="1b6af-118">What you'll learn:</span></span>

- <span data-ttu-id="1b6af-119">Como usar o código para adicionar uma função personalizada e um usuário para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-119">How to use code to add a custom role and a user to the application.</span></span>
- <span data-ttu-id="1b6af-120">Como restringir o acesso para a pasta de administração e a página.</span><span class="sxs-lookup"><span data-stu-id="1b6af-120">How to restrict access to the administration folder and page.</span></span>
- <span data-ttu-id="1b6af-121">Como fornecer uma navegação para o usuário que pertence à função personalizada.</span><span class="sxs-lookup"><span data-stu-id="1b6af-121">How to provide navigation for the user that belongs to the custom role.</span></span>
- <span data-ttu-id="1b6af-122">Como usar a associação de modelo para preencher uma [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) controle com categorias de produtos.</span><span class="sxs-lookup"><span data-stu-id="1b6af-122">How to use model binding to populate a [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) control with product categories.</span></span>
- <span data-ttu-id="1b6af-123">Como carregar um arquivo para o aplicativo web usando o [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) controle.</span><span class="sxs-lookup"><span data-stu-id="1b6af-123">How to upload a file to the web application using the [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) control.</span></span>
- <span data-ttu-id="1b6af-124">Como usar controles de validação para implementar a validação de entrada.</span><span class="sxs-lookup"><span data-stu-id="1b6af-124">How to use validation controls to implement input validation.</span></span>
- <span data-ttu-id="1b6af-125">Como adicionar e remover os produtos do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-125">How to add and remove products from the application.</span></span>

## <a name="these-features-are-included-in-the-tutorial"></a><span data-ttu-id="1b6af-126">Esses recursos estão incluídos no tutorial:</span><span class="sxs-lookup"><span data-stu-id="1b6af-126">These features are included in the tutorial:</span></span>

- <span data-ttu-id="1b6af-127">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="1b6af-127">ASP.NET Identity</span></span>
- <span data-ttu-id="1b6af-128">Configuração e autorização</span><span class="sxs-lookup"><span data-stu-id="1b6af-128">Configuration and Authorization</span></span>
- <span data-ttu-id="1b6af-129">Model binding</span><span class="sxs-lookup"><span data-stu-id="1b6af-129">Model Binding</span></span>
- <span data-ttu-id="1b6af-130">Validação não invasiva</span><span class="sxs-lookup"><span data-stu-id="1b6af-130">Unobtrusive Validation</span></span>

<span data-ttu-id="1b6af-131">Web Forms do ASP.NET fornece recursos de associação.</span><span class="sxs-lookup"><span data-stu-id="1b6af-131">ASP.NET Web Forms provides membership capabilities.</span></span> <span data-ttu-id="1b6af-132">Usando o modelo padrão, você tem funcionalidade integrada de associação que você pode usar imediatamente quando o aplicativo é executado.</span><span class="sxs-lookup"><span data-stu-id="1b6af-132">By using the default template, you have built-in membership functionality that you can immediately use when the application runs.</span></span> <span data-ttu-id="1b6af-133">Este tutorial mostra como usar o ASP.NET Identity para adicionar uma função personalizada e atribuir um usuário a essa função.</span><span class="sxs-lookup"><span data-stu-id="1b6af-133">This tutorial shows you how to use ASP.NET Identity to add a custom role and assign a user to that role.</span></span> <span data-ttu-id="1b6af-134">Você aprenderá a restringir o acesso à pasta de administração.</span><span class="sxs-lookup"><span data-stu-id="1b6af-134">You will learn how to restrict access to the administration folder.</span></span> <span data-ttu-id="1b6af-135">Você adicionará uma página para a pasta de administração que permite que um usuário com uma função personalizada para adicionar e remover os produtos e visualizar um produto após ele ter sido adicionado.</span><span class="sxs-lookup"><span data-stu-id="1b6af-135">You'll add a page to the administration folder that allows a user with a custom role to add and remove products, and to preview a product after it has been added.</span></span>

## <a name="adding-a-custom-role"></a><span data-ttu-id="1b6af-136">Adicionando uma função personalizada</span><span class="sxs-lookup"><span data-stu-id="1b6af-136">Adding a Custom Role</span></span>

<span data-ttu-id="1b6af-137">Usando a identidade do ASP.NET, você pode adicionar uma função personalizada e atribuir um usuário a essa função usando o código.</span><span class="sxs-lookup"><span data-stu-id="1b6af-137">Using ASP.NET Identity, you can add a custom role and assign a user to that role using code.</span></span>

1. <span data-ttu-id="1b6af-138">Na **Gerenciador de soluções**, clique com botão direito no *lógica* pasta e crie uma nova classe.</span><span class="sxs-lookup"><span data-stu-id="1b6af-138">In **Solution Explorer**, right-click on the *Logic* folder and create a new class.</span></span>
2. <span data-ttu-id="1b6af-139">Nomeie a nova classe *RoleActions.cs*.</span><span class="sxs-lookup"><span data-stu-id="1b6af-139">Name the new class *RoleActions.cs*.</span></span>
3. <span data-ttu-id="1b6af-140">Modificar o código para que ele apareça da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="1b6af-140">Modify the code so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample1.cs?highlight=8)]
4. <span data-ttu-id="1b6af-141">Na **Gerenciador de soluções**, abra o *Global.asax.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-141">In **Solution Explorer**, open the *Global.asax.cs* file.</span></span>
5. <span data-ttu-id="1b6af-142">Modificar a *Global.asax.cs* arquivo adicionando o código realçado em amarelo para que ele apareça da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="1b6af-142">Modify the *Global.asax.cs* file by adding the code highlighted in yellow so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample2.cs?highlight=11,26-28)]
6. <span data-ttu-id="1b6af-143">Observe que `AddUserAndRole` está sublinhado em vermelho.</span><span class="sxs-lookup"><span data-stu-id="1b6af-143">Notice that `AddUserAndRole` is underlined in red.</span></span> <span data-ttu-id="1b6af-144">Clique duas vezes o código AddUserAndRole.</span><span class="sxs-lookup"><span data-stu-id="1b6af-144">Double-click the AddUserAndRole code.</span></span>  
   <span data-ttu-id="1b6af-145">A letra "A" no início do método realçado será sublinhada.</span><span class="sxs-lookup"><span data-stu-id="1b6af-145">The letter "A" at the beginning of the highlighted method will be underlined.</span></span>
7. <span data-ttu-id="1b6af-146">Passe o mouse sobre a letra "A" e clique em interface do usuário que permite que você gerar um stub de método para o `AddUserAndRole` método.</span><span class="sxs-lookup"><span data-stu-id="1b6af-146">Hover over the letter "A" and click the UI that allows you to generate a method stub for the `AddUserAndRole` method.</span></span> 

    ![Associação e administração - Gerar Stub do método](membership-and-administration/_static/image1.png)
8. <span data-ttu-id="1b6af-148">Clique na opção:</span><span class="sxs-lookup"><span data-stu-id="1b6af-148">Click the option titled:</span></span>  
    `Generate method stub for "AddUserAndRole" in "WingtipToys.Logic.RoleActions"`
9. <span data-ttu-id="1b6af-149">Abra o *RoleActions.cs* do arquivo da *lógica* pasta.</span><span class="sxs-lookup"><span data-stu-id="1b6af-149">Open the *RoleActions.cs* file from the *Logic* folder.</span></span>  
   <span data-ttu-id="1b6af-150">O `AddUserAndRole` método foi adicionado ao arquivo de classe.</span><span class="sxs-lookup"><span data-stu-id="1b6af-150">The `AddUserAndRole` method has been added to the class file.</span></span>
10. <span data-ttu-id="1b6af-151">Modificar a *RoleActions.cs* arquivo removendo o `NotImplementedException` e adicionando o código realçado em amarelo, para que ele apareça da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="1b6af-151">Modify the *RoleActions.cs* file by removing the `NotImplementedException` and adding the code highlighted in yellow, so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample3.cs?highlight=5-7,15-51)]

<span data-ttu-id="1b6af-152">Primeiro, o código acima estabelece um contexto de banco de dados para o banco de dados de associação.</span><span class="sxs-lookup"><span data-stu-id="1b6af-152">The above code first establishes a database context for the membership database.</span></span> <span data-ttu-id="1b6af-153">O banco de dados de associação também é armazenado como um *. mdf* arquivo na *App\_dados* pasta.</span><span class="sxs-lookup"><span data-stu-id="1b6af-153">The membership database is also stored as an *.mdf* file in the *App\_Data* folder.</span></span> <span data-ttu-id="1b6af-154">Você poderá exibir esse banco de dados depois que o primeiro usuário entrou nesse aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="1b6af-154">You will be able to view this database once the first user has signed in to this web application.</span></span> 

> [!NOTE] 
> 
> <span data-ttu-id="1b6af-155">Se você deseja armazenar os dados de associação, juntamente com os dados do produto, você pode considerar usar o mesmo **DbContext** que você usou para armazenar os dados de produto no código acima.</span><span class="sxs-lookup"><span data-stu-id="1b6af-155">If you wish to store the membership data along with the product data, you can consider using the same **DbContext** that you used to store the product data in the above code.</span></span>

 <span data-ttu-id="1b6af-156">O *interno* palavra-chave é um modificador de acesso para membros de tipo (como métodos ou propriedades) e tipos (como classes).</span><span class="sxs-lookup"><span data-stu-id="1b6af-156">The *internal* keyword is an access modifier for types (such as classes) and type members (such as methods or properties).</span></span> <span data-ttu-id="1b6af-157">Tipos ou membros internos são acessíveis somente em arquivos contidos no mesmo assembly *(. dll* arquivo).</span><span class="sxs-lookup"><span data-stu-id="1b6af-157">Internal types or members are accessible only within files contained in the same assembly *(.dll* file).</span></span> <span data-ttu-id="1b6af-158">Quando você compila seu aplicativo, um arquivo de assembly *(. dll*) é criado que contém o código que é executado quando você executar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-158">When you build your application, an assembly file *(.dll*) is created that contains the code that is executed when you run your application.</span></span> 

<span data-ttu-id="1b6af-159">Um `RoleStore` objeto, que fornece gerenciamento de função, é criado com base no contexto do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1b6af-159">A `RoleStore` object, which provides role management, is created based on the database context.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1b6af-160">Observe que, quando o `RoleStore` objeto é criado ele usa um genérico `IdentityRole` tipo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-160">Notice that when the `RoleStore` object is created it uses a Generic `IdentityRole` type.</span></span> <span data-ttu-id="1b6af-161">Isso significa que o `RoleStore` só pode conter `IdentityRole` objetos.</span><span class="sxs-lookup"><span data-stu-id="1b6af-161">This means that the `RoleStore` is only allowed to contain `IdentityRole` objects.</span></span> <span data-ttu-id="1b6af-162">Também, usando os genéricos, recursos na memória são tratados melhor.</span><span class="sxs-lookup"><span data-stu-id="1b6af-162">Also by using Generics, resources in memory are handled better.</span></span>

<span data-ttu-id="1b6af-163">Em seguida, o `RoleManager` de objeto, é criado com base no `RoleStore` objeto que você acabou de criar.</span><span class="sxs-lookup"><span data-stu-id="1b6af-163">Next, the `RoleManager` object, is created based on the `RoleStore` object that you just created.</span></span> <span data-ttu-id="1b6af-164">o `RoleManager` objeto expõe relacionada à função API que pode ser usado para salvar automaticamente as alterações para o `RoleStore`.</span><span class="sxs-lookup"><span data-stu-id="1b6af-164">the `RoleManager` object exposes role related API which can be used to automatically save changes to the `RoleStore`.</span></span> <span data-ttu-id="1b6af-165">O `RoleManager` só pode conter `IdentityRole` objetos porque o código usa o `<IdentityRole>` tipo genérico.</span><span class="sxs-lookup"><span data-stu-id="1b6af-165">The `RoleManager` is only allowed to contain `IdentityRole` objects because the code uses the `<IdentityRole>` Generic type.</span></span>

<span data-ttu-id="1b6af-166">Você chama o `RoleExists` método para determinar se a função "CanEdit" está presente no banco de dados de associação.</span><span class="sxs-lookup"><span data-stu-id="1b6af-166">You call the `RoleExists` method to determine if the "canEdit" role is present in the membership database.</span></span> <span data-ttu-id="1b6af-167">Se não for, você pode criar a função.</span><span class="sxs-lookup"><span data-stu-id="1b6af-167">If it is not, you create the role.</span></span>

<span data-ttu-id="1b6af-168">Criando o `UserManager` objeto parece ser mais complicado do que o `RoleManager` controlar, no entanto é quase o mesmo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-168">Creating the `UserManager` object appears to be more complicated than the `RoleManager` control, however it is nearly the same.</span></span> <span data-ttu-id="1b6af-169">Ele apenas é codificado em uma linha em vez de várias.</span><span class="sxs-lookup"><span data-stu-id="1b6af-169">It is just coded on one line rather than several.</span></span> <span data-ttu-id="1b6af-170">Aqui, o parâmetro que você está passando é criar uma instância como um novo objeto contido entre parênteses.</span><span class="sxs-lookup"><span data-stu-id="1b6af-170">Here, the parameter that you are passing is instantiating as a new object contained in the parenthesis.</span></span>

<span data-ttu-id="1b6af-171">Em seguida crie o usuário "canEditUser", criando um novo `ApplicationUser` objeto.</span><span class="sxs-lookup"><span data-stu-id="1b6af-171">Next you create the "canEditUser" user by creating a new `ApplicationUser` object.</span></span> <span data-ttu-id="1b6af-172">Em seguida, se você criar com êxito o usuário, adicione o usuário para a nova função.</span><span class="sxs-lookup"><span data-stu-id="1b6af-172">Then, if you successfully create the user, you add the user to the new role.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="1b6af-173">O tratamento de erros será atualizado durante o tutorial "Tratamento de erros do ASP.NET" mais adiante nesta série de tutoriais.</span><span class="sxs-lookup"><span data-stu-id="1b6af-173">The error handling will be updated during the "ASP.NET Error Handling" tutorial later in this tutorial series.</span></span>

<span data-ttu-id="1b6af-174">Na próxima vez que o aplicativo é iniciado, o usuário chamado "canEditUser" será adicionado como a função "canEdit" do aplicativo de chamada.</span><span class="sxs-lookup"><span data-stu-id="1b6af-174">The next time the application starts, the user named "canEditUser" will be added as the role named "canEdit" of the application.</span></span> <span data-ttu-id="1b6af-175">Posteriormente no tutorial, você fará logon como o usuário "canEditUser" para exibir os recursos adicionais que você será adicionado durante este tutorial.</span><span class="sxs-lookup"><span data-stu-id="1b6af-175">Later in this tutorial, you will login as the "canEditUser" user to display additional capabilities that you will added during this tutorial.</span></span> <span data-ttu-id="1b6af-176">Para obter detalhes de API sobre a identidade do ASP.NET, consulte o [ASPNET Namespace](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="1b6af-176">For API details about ASP.NET Identity, see the [Microsoft.AspNet.Identity Namespace](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span></span> <span data-ttu-id="1b6af-177">Para obter mais detalhes sobre como inicializar o sistema de identidade do ASP.NET, consulte o [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span><span class="sxs-lookup"><span data-stu-id="1b6af-177">For additional details about initializing the ASP.NET Identity system, see the [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span></span>

### <a name="restricting-access-to-the-administration-page"></a><span data-ttu-id="1b6af-178">Restringindo o acesso para a página de administração</span><span class="sxs-lookup"><span data-stu-id="1b6af-178">Restricting Access to the Administration Page</span></span>

<span data-ttu-id="1b6af-179">O aplicativo de exemplo Wingtip Toys permite que usuários anônimos e os usuários autorizados a exibir e comprar produtos.</span><span class="sxs-lookup"><span data-stu-id="1b6af-179">The Wingtip Toys sample application allows both anonymous users and logged-in users to view and purchase products.</span></span> <span data-ttu-id="1b6af-180">No entanto, o usuário conectado que tenha a função "canEdit" personalizada pode acessar uma página restrita para adicionar e remover produtos.</span><span class="sxs-lookup"><span data-stu-id="1b6af-180">However, the logged-in user that has the custom "canEdit" role can access a restricted page in order to add and remove products.</span></span>

#### <a name="add-an-administration-folder-and-page"></a><span data-ttu-id="1b6af-181">Adicionar uma pasta de administração e a página</span><span class="sxs-lookup"><span data-stu-id="1b6af-181">Add an Administration Folder and Page</span></span>

<span data-ttu-id="1b6af-182">Em seguida, você criará uma pasta chamada *Admin* aplicativo de exemplo para o usuário "canEditUser" que pertence à função personalizada da Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="1b6af-182">Next, you will create a folder named *Admin* for the "canEditUser" user belonging to the custom role of the Wingtip Toys sample application.</span></span>

1. <span data-ttu-id="1b6af-183">Clique com botão direito no nome do projeto (**Wingtip Toys**) em **Gerenciador de soluções** e selecione **Add**  - &gt; **nova pasta**.</span><span class="sxs-lookup"><span data-stu-id="1b6af-183">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add** -&gt; **New Folder**.</span></span>
2. <span data-ttu-id="1b6af-184">Nomeie a nova pasta *Admin*.</span><span class="sxs-lookup"><span data-stu-id="1b6af-184">Name the new folder *Admin*.</span></span>
3. <span data-ttu-id="1b6af-185">Clique com botão direito do *Admin* pasta e, em seguida, selecione **Add**  - &gt; **Novo Item**.</span><span class="sxs-lookup"><span data-stu-id="1b6af-185">Right-click the *Admin* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="1b6af-186">A caixa de diálogo **Adicionar Novo Item** é exibida.</span><span class="sxs-lookup"><span data-stu-id="1b6af-186">The **Add New Item** dialog box is displayed.</span></span>
4. <span data-ttu-id="1b6af-187">Selecione o <strong>Visual c#</strong> - &gt; <strong>Web</strong> grupo de modelos à esquerda.</span><span class="sxs-lookup"><span data-stu-id="1b6af-187">Select the <strong>Visual C#</strong>-&gt; <strong>Web</strong> templates group on the left.</span></span> <span data-ttu-id="1b6af-188">Na lista do meio, selecione <strong>Web Form com página mestra</strong>, nomeie- <em>AdminPage.aspx</em><strong>,</strong> e, em seguida, selecione <strong>adicionar</strong>.</span><span class="sxs-lookup"><span data-stu-id="1b6af-188">From the middle list, select <strong>Web Form with Master Page</strong>,name it <em>AdminPage.aspx</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
5. <span data-ttu-id="1b6af-189">Selecione o *Master* file como a página mestra e, em seguida, escolha **Okey**.</span><span class="sxs-lookup"><span data-stu-id="1b6af-189">Select the *Site.Master* file as the master page, and then choose **OK**.</span></span>

#### <a name="add-a-webconfig-file"></a><span data-ttu-id="1b6af-190">Adicionar um arquivo Web. config</span><span class="sxs-lookup"><span data-stu-id="1b6af-190">Add a Web.config File</span></span>

<span data-ttu-id="1b6af-191">Adicionando um *Web. config* do arquivo para o *Admin* pasta, você pode restringir o acesso à página contida na pasta.</span><span class="sxs-lookup"><span data-stu-id="1b6af-191">By adding a *Web.config* file to the *Admin* folder, you can restrict access to the page contained in the folder.</span></span>

1. <span data-ttu-id="1b6af-192">Clique com botão direito do *Admin* pasta e selecione **Add**  - &gt; **Novo Item**.</span><span class="sxs-lookup"><span data-stu-id="1b6af-192">Right-click the *Admin* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="1b6af-193">A caixa de diálogo **Adicionar Novo Item** é exibida.</span><span class="sxs-lookup"><span data-stu-id="1b6af-193">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="1b6af-194">Na lista de modelos de web do Visual c#, selecione <strong>arquivo de configuração Web</strong>na lista intermediária, aceite o nome padrão de <em>Web. config</em><strong>,</strong> e, em seguida, selecione <strong>Adicionar</strong>.</span><span class="sxs-lookup"><span data-stu-id="1b6af-194">From the list of Visual C# web templates, select <strong>Web Configuration File</strong>from the middle list, accept the default name of <em>Web.config</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
3. <span data-ttu-id="1b6af-195">Substitua o conteúdo em XML existente a *Web. config* arquivo com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="1b6af-195">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](membership-and-administration/samples/sample4.xml)]

<span data-ttu-id="1b6af-196">Salvar a *Web. config* arquivo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-196">Save the *Web.config* file.</span></span> <span data-ttu-id="1b6af-197">O *Web. config* arquivo Especifica que apenas o usuário que pertencem à função "canEdit" do aplicativo pode acessar a página contida na *Admin* pasta.</span><span class="sxs-lookup"><span data-stu-id="1b6af-197">The *Web.config* file specifies that only user belonging to the "canEdit" role of the application can access the page contained in the *Admin* folder.</span></span>

### <a name="including-custom-role-navigation"></a><span data-ttu-id="1b6af-198">Incluindo a navegação de função personalizada</span><span class="sxs-lookup"><span data-stu-id="1b6af-198">Including Custom Role Navigation</span></span>

<span data-ttu-id="1b6af-199">Para habilitar o usuário da função "canEdit" personalizadas navegar até a seção de administração do aplicativo, você deve adicionar um link para o *Master* página.</span><span class="sxs-lookup"><span data-stu-id="1b6af-199">To enable the user of the custom "canEdit" role to navigate to the administration section of the application, you must add a link to the *Site.Master* page.</span></span> <span data-ttu-id="1b6af-200">Somente os usuários que pertencem à função "canEdit" poderão ver os **Admin** vincular e acessar a seção de administração.</span><span class="sxs-lookup"><span data-stu-id="1b6af-200">Only users that belong to the "canEdit" role will be able to see the **Admin** link and access the administration section.</span></span>

1. <span data-ttu-id="1b6af-201">No Solution Explorer, localize e abra a *Master* página.</span><span class="sxs-lookup"><span data-stu-id="1b6af-201">In Solution Explorer, find and open the *Site.Master* page.</span></span>
2. <span data-ttu-id="1b6af-202">Para criar um link para o usuário da função "canEdit", adicione a marcação realçada em amarelo para a seguinte lista não ordenada `<ul>` elemento para que a lista é exibida como segue:</span><span class="sxs-lookup"><span data-stu-id="1b6af-202">To create a link for the user of the "canEdit" role, add the markup highlighted in yellow to the following unordered list `<ul>` element so that the list appears as follows:</span></span>  

    [!code-html[Main](membership-and-administration/samples/sample5.html?highlight=2-3)]
3. <span data-ttu-id="1b6af-203">Abra o *Site.Master.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-203">Open the *Site.Master.cs* file.</span></span> <span data-ttu-id="1b6af-204">Verifique as **Admin** link visível somente para o usuário "canEditUser" Adicionando o código realçado em amarelo para o `Page_Load` manipulador.</span><span class="sxs-lookup"><span data-stu-id="1b6af-204">Make the **Admin** link visible only to the "canEditUser" user by adding the code highlighted in yellow to the `Page_Load` handler.</span></span> <span data-ttu-id="1b6af-205">O `Page_Load` manipulador será exibida da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="1b6af-205">The `Page_Load` handler will appear as follows:</span></span>   

    [!code-csharp[Main](membership-and-administration/samples/sample6.cs?highlight=3-6)]

<span data-ttu-id="1b6af-206">Quando a página for carregada, o código verifica se o usuário conectado tem a função de "canEdit".</span><span class="sxs-lookup"><span data-stu-id="1b6af-206">When the page loads, the code checks whether the logged-in user has the role of "canEdit".</span></span> <span data-ttu-id="1b6af-207">Se o usuário pertence à função "canEdit", o elemento de intervalo que contém o link para o *AdminPage.aspx* página (e, consequentemente, o link de dentro da extensão) ficam visíveis.</span><span class="sxs-lookup"><span data-stu-id="1b6af-207">If the user belongs to the "canEdit" role, the span element containing the link to the *AdminPage.aspx* page (and consequently the link inside the span) is made visible.</span></span>

### <a name="enabling-product-administration"></a><span data-ttu-id="1b6af-208">Habilitar administração de produto</span><span class="sxs-lookup"><span data-stu-id="1b6af-208">Enabling Product Administration</span></span>

<span data-ttu-id="1b6af-209">Até agora, você criou a função "CanEdit" e adicionou um usuário de "canEditUser", uma pasta de administração e uma página de administração.</span><span class="sxs-lookup"><span data-stu-id="1b6af-209">So far, you have created the "canEdit" role and added an "canEditUser" user, an administration folder, and an administration page.</span></span> <span data-ttu-id="1b6af-210">Você definiu os direitos de acesso para a pasta de administração e a página e adicionou um link de navegação para o usuário da função "canEdit" para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-210">You have set access rights for the administration folder and page, and have added a navigation link for the user of the "canEdit" role to the application.</span></span> <span data-ttu-id="1b6af-211">Em seguida, você adicionará a marcação para o *AdminPage.aspx* página e de código para o *AdminPage.aspx.cs* arquivo code-behind que permitirá que o usuário com a função "CanEdit" adicionar e remover os produtos.</span><span class="sxs-lookup"><span data-stu-id="1b6af-211">Next, you will add markup to the *AdminPage.aspx* page and code to the *AdminPage.aspx.cs* code-behind file that will enable the user with the "canEdit" role to add and remove products.</span></span>

1. <span data-ttu-id="1b6af-212">No **Gerenciador de soluções**, abra o *AdminPage.aspx* arquivo o *Admin* pasta.</span><span class="sxs-lookup"><span data-stu-id="1b6af-212">In **Solution Explorer**, open the *AdminPage.aspx* file from the *Admin* folder.</span></span>
2. <span data-ttu-id="1b6af-213">Substitua a marcação existente pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="1b6af-213">Replace the existing markup with the following:</span></span>  

    [!code-aspx[Main](membership-and-administration/samples/sample7.aspx)]
3. <span data-ttu-id="1b6af-214">Em seguida, abra o *AdminPage.aspx.cs* arquivo de code-behind clicando com o *AdminPage.aspx* e clicando em **Exibir código**.</span><span class="sxs-lookup"><span data-stu-id="1b6af-214">Next, open the *AdminPage.aspx.cs* code-behind file by right-clicking the *AdminPage.aspx* and clicking **View Code**.</span></span>
4. <span data-ttu-id="1b6af-215">Substitua o código existente na *AdminPage.aspx.cs* arquivo code-behind com o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="1b6af-215">Replace the existing code in the *AdminPage.aspx.cs* code-behind file with the following code:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample8.cs)]

<span data-ttu-id="1b6af-216">No código que você inseriu para o *AdminPage.aspx.cs* arquivo de code-behind, uma classe chamada `AddProducts` faz o trabalho real de adição de produtos no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1b6af-216">In the code that you entered for the *AdminPage.aspx.cs* code-behind file, a class called `AddProducts` does the actual work of adding products to the database.</span></span> <span data-ttu-id="1b6af-217">Essa classe ainda não existe, portanto, você irá criá-lo agora.</span><span class="sxs-lookup"><span data-stu-id="1b6af-217">This class doesn't exist yet, so you will create it now.</span></span>

1. <span data-ttu-id="1b6af-218">No **Gerenciador de soluções**, com o botão direito do *lógica* pasta e, em seguida, selecione **Add**  - &gt; **Novo Item**.</span><span class="sxs-lookup"><span data-stu-id="1b6af-218">In **Solution Explorer**, right-click the *Logic* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="1b6af-219">A caixa de diálogo **Adicionar Novo Item** é exibida.</span><span class="sxs-lookup"><span data-stu-id="1b6af-219">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="1b6af-220">Selecione o **Visual c#**  - &gt; **código** grupo de modelos à esquerda.</span><span class="sxs-lookup"><span data-stu-id="1b6af-220">Select the **Visual C#** -&gt; **Code** templates group on the left.</span></span> <span data-ttu-id="1b6af-221">Em seguida, selecione **classe**do meio lista e nomeie-o *AddProducts.cs*.</span><span class="sxs-lookup"><span data-stu-id="1b6af-221">Then, select **Class**from the middle list and name it *AddProducts.cs*.</span></span>   
   <span data-ttu-id="1b6af-222">O novo arquivo de classe é exibido.</span><span class="sxs-lookup"><span data-stu-id="1b6af-222">The new class file is displayed.</span></span>
3. <span data-ttu-id="1b6af-223">Substitua o código existente pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="1b6af-223">Replace the existing code with the following:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample9.cs)]

<span data-ttu-id="1b6af-224">O *AdminPage.aspx* página permite que o usuário que pertencem à função "canEdit" adicionar e remover os produtos.</span><span class="sxs-lookup"><span data-stu-id="1b6af-224">The *AdminPage.aspx* page allows the user belonging to the "canEdit" role to add and remove products.</span></span> <span data-ttu-id="1b6af-225">Quando um novo produto é adicionado, os detalhes sobre o produto são validados e, em seguida, inseridos no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1b6af-225">When a new product is added, the details about the product are validated and then entered into the database.</span></span> <span data-ttu-id="1b6af-226">O novo produto é imediatamente disponibilizado para todos os usuários do aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="1b6af-226">The new product is immediately available to all users of the web application.</span></span>

#### <a name="unobtrusive-validation"></a><span data-ttu-id="1b6af-227">Validação não invasiva</span><span class="sxs-lookup"><span data-stu-id="1b6af-227">Unobtrusive Validation</span></span>

<span data-ttu-id="1b6af-228">Os detalhes do produto que o usuário fornece sobre o *AdminPage.aspx* página são validados usando controles de validação (`RequiredFieldValidator` e `RegularExpressionValidator`).</span><span class="sxs-lookup"><span data-stu-id="1b6af-228">The product details that the user provides on the *AdminPage.aspx* page are validated using validation controls (`RequiredFieldValidator` and `RegularExpressionValidator`).</span></span> <span data-ttu-id="1b6af-229">Esses controles usam automaticamente a validação não invasiva.</span><span class="sxs-lookup"><span data-stu-id="1b6af-229">These controls automatically use unobtrusive validation.</span></span> <span data-ttu-id="1b6af-230">Validação não invasiva permite que os controles de validação usar JavaScript para a lógica de validação do lado do cliente, o que significa que a página não requer uma viagem para o servidor a ser validado.</span><span class="sxs-lookup"><span data-stu-id="1b6af-230">Unobtrusive validation allows the validation controls to use JavaScript for client-side validation logic, which means the page does not require a trip to the server to be validated.</span></span> <span data-ttu-id="1b6af-231">Por padrão, a validação não invasiva está incluída na *Web. config* arquivo baseia-se a seguinte configuração:</span><span class="sxs-lookup"><span data-stu-id="1b6af-231">By default, unobtrusive validation is included in the *Web.config* file based on the following configuration setting:</span></span>

[!code-xml[Main](membership-and-administration/samples/sample10.xml)]

#### <a name="regular-expressions"></a><span data-ttu-id="1b6af-232">Expressões regulares</span><span class="sxs-lookup"><span data-stu-id="1b6af-232">Regular Expressions</span></span>

<span data-ttu-id="1b6af-233">O preço do produto sobre o *AdminPage.aspx* página é validada usando uma **RegularExpressionValidator** controle.</span><span class="sxs-lookup"><span data-stu-id="1b6af-233">The product price on the *AdminPage.aspx* page is validated using a **RegularExpressionValidator** control.</span></span> <span data-ttu-id="1b6af-234">Esse controle valida se o valor do controle de entrada associado (a caixa de texto "AddProductPrice") corresponde ao padrão especificado pela expressão regular.</span><span class="sxs-lookup"><span data-stu-id="1b6af-234">This control validates whether the value of the associated input control (the "AddProductPrice" TextBox) matches the pattern specified by the regular expression.</span></span> <span data-ttu-id="1b6af-235">Uma expressão regular é uma notação de correspondência de padrões que permite que você rapidamente Localize e correspondência de padrões de caracteres específica.</span><span class="sxs-lookup"><span data-stu-id="1b6af-235">A regular expression is a pattern-matching notation that enables you to quickly find and match specific character patterns.</span></span> <span data-ttu-id="1b6af-236">O **RegularExpressionValidator** controle inclui uma propriedade chamada `ValidationExpression` que contém a expressão regular usada para validar a entrada de preço, conforme mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="1b6af-236">The **RegularExpressionValidator** control includes a property named `ValidationExpression` that contains the regular expression used to validate price input, as shown below:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample11.aspx)]

#### <a name="fileupload-control"></a><span data-ttu-id="1b6af-237">Controle fileUpload</span><span class="sxs-lookup"><span data-stu-id="1b6af-237">FileUpload Control</span></span>

<span data-ttu-id="1b6af-238">Além dos controles de entrada e validação, você adicionou o **FileUpload** o controle para o *AdminPage.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="1b6af-238">In addition to the input and validation controls, you added the **FileUpload** control to the *AdminPage.aspx* page.</span></span> <span data-ttu-id="1b6af-239">Esse controle fornece a capacidade de carregar arquivos.</span><span class="sxs-lookup"><span data-stu-id="1b6af-239">This control provides the capability to upload files.</span></span> <span data-ttu-id="1b6af-240">Nesse caso, você está permitindo somente arquivos de imagem a ser carregado.</span><span class="sxs-lookup"><span data-stu-id="1b6af-240">In this case, you are only allowing image files to be uploaded.</span></span> <span data-ttu-id="1b6af-241">No arquivo code-behind (*AdminPage.aspx.cs*), quando o `AddProductButton` é clicado, o código verifica a `HasFile` propriedade do **FileUpload** controle.</span><span class="sxs-lookup"><span data-stu-id="1b6af-241">In the code-behind file (*AdminPage.aspx.cs*), when the `AddProductButton` is clicked, the code checks the `HasFile` property of the **FileUpload** control.</span></span> <span data-ttu-id="1b6af-242">Se o controle tem um arquivo e se o tipo de arquivo (com base na extensão de arquivo) é permitido, a imagem é salva para o *imagens* pasta e o *imagens/polegares* pasta do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-242">If the control has a file and if the file type (based on file extension) is allowed, the image is saved to the *Images* folder and the *Images/Thumbs* folder of the application.</span></span>

#### <a name="model-binding"></a><span data-ttu-id="1b6af-243">Model binding</span><span class="sxs-lookup"><span data-stu-id="1b6af-243">Model Binding</span></span>

<span data-ttu-id="1b6af-244">Anteriormente nessa série de tutoriais, você usou a associação de modelo para preencher uma **ListView** controle, um **FormsView** controle, um **GridView** controle e um  **DetailView** controle.</span><span class="sxs-lookup"><span data-stu-id="1b6af-244">Earlier in this tutorial series you used model binding to populate a **ListView** control, a **FormsView** control, a **GridView** control, and a **DetailView** control.</span></span> <span data-ttu-id="1b6af-245">Neste tutorial, você deve usar a associação de modelo para preencher uma **DropDownList** controle com uma lista de categorias de produto.</span><span class="sxs-lookup"><span data-stu-id="1b6af-245">In this tutorial, you use model binding to populate a **DropDownList** control with a list of product categories.</span></span>

<span data-ttu-id="1b6af-246">A marcação que você adicionou para a *AdminPage.aspx* arquivo contém uma **DropDownList** controle chamado `DropDownAddCategory`:</span><span class="sxs-lookup"><span data-stu-id="1b6af-246">The markup that you added to the *AdminPage.aspx* file contains a **DropDownList** control called `DropDownAddCategory`:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample12.aspx)]

<span data-ttu-id="1b6af-247">Você usa a associação de modelo para preencher isso **DropDownList** definindo o `ItemType` atributo e o `SelectMethod` atributo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-247">You use model binding to populate this **DropDownList** by setting the `ItemType` attribute and the `SelectMethod` attribute.</span></span> <span data-ttu-id="1b6af-248">O `ItemType` atributo especifica que você usa o `WingtipToys.Models.Category` de tipo quando o preenchimento do controle.</span><span class="sxs-lookup"><span data-stu-id="1b6af-248">The `ItemType` attribute specifies that you use the `WingtipToys.Models.Category` type when populating the control.</span></span> <span data-ttu-id="1b6af-249">Você definiu esse tipo no início desta série de tutoriais, criando o `Category` classe (mostrado abaixo).</span><span class="sxs-lookup"><span data-stu-id="1b6af-249">You defined this type at the beginning of this tutorial series by creating the `Category` class (shown below).</span></span> <span data-ttu-id="1b6af-250">O `Category` classe está no *modelos* pasta dentro de *Category.cs* arquivo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-250">The `Category` class is in the *Models* folder inside the *Category.cs* file.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample13.cs)]

<span data-ttu-id="1b6af-251">O `SelectMethod` atributo do **DropDownList** controle especifica que você usa o `GetCategories` método (mostrado abaixo) que é incluído no arquivo code-behind (*AdminPage.aspx.cs*).</span><span class="sxs-lookup"><span data-stu-id="1b6af-251">The `SelectMethod` attribute of the **DropDownList** control specifies that you use the `GetCategories` method (shown below) that is included in the code-behind file (*AdminPage.aspx.cs*).</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample14.cs)]

<span data-ttu-id="1b6af-252">Esse método Especifica que um `IQueryable` interface é usada para avaliar uma consulta em relação a um `Category` tipo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-252">This method specifies that an `IQueryable` interface is used to evaluate a query against a `Category` type.</span></span> <span data-ttu-id="1b6af-253">O valor retornado é usado para preencher a **DropDownList** na marcação da página (*AdminPage.aspx*).</span><span class="sxs-lookup"><span data-stu-id="1b6af-253">The returned value is used to populate the **DropDownList** in the markup of the page (*AdminPage.aspx*).</span></span>

<span data-ttu-id="1b6af-254">O texto exibido para cada item na lista é especificado, definindo o `DataTextField` atributo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-254">The text displayed for each item in the list is specified by setting the `DataTextField` attribute.</span></span> <span data-ttu-id="1b6af-255">O `DataTextField` atributo usa o `CategoryName` da `Category` classe (mostrado acima) para exibir cada categoria no **DropDownList** controle.</span><span class="sxs-lookup"><span data-stu-id="1b6af-255">The `DataTextField` attribute uses the `CategoryName` of the `Category` class (shown above) to display each category in the **DropDownList** control.</span></span> <span data-ttu-id="1b6af-256">O valor real que é passado quando um item é selecionado na **DropDownList** controle se baseia o `DataValueField` atributo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-256">The actual value that is passed when an item is selected in the **DropDownList** control is based on the `DataValueField` attribute.</span></span> <span data-ttu-id="1b6af-257">O `DataValueField` atributo é definido como o `CategoryID` à medida que define no `Category` classe (mostrado acima).</span><span class="sxs-lookup"><span data-stu-id="1b6af-257">The `DataValueField` attribute is set to the `CategoryID` as define in the `Category` class (shown above).</span></span>

### <a name="how-the-application-will-work"></a><span data-ttu-id="1b6af-258">Como o aplicativo funcionará</span><span class="sxs-lookup"><span data-stu-id="1b6af-258">How the Application Will Work</span></span>

<span data-ttu-id="1b6af-259">Quando o usuário que pertencem à função "canEdit" navega para a página pela primeira vez, o `DropDownAddCategory` **DropDownList** controle é preenchido conforme descrito acima.</span><span class="sxs-lookup"><span data-stu-id="1b6af-259">When the user belonging to the "canEdit" role navigates to the page for the first time, the `DropDownAddCategory`**DropDownList** control is populated as described above.</span></span> <span data-ttu-id="1b6af-260">O `DropDownRemoveProduct` **DropDownList** controle também é preenchido com os produtos usando a mesma abordagem.</span><span class="sxs-lookup"><span data-stu-id="1b6af-260">The `DropDownRemoveProduct`**DropDownList** control is also populated with products using the same approach.</span></span> <span data-ttu-id="1b6af-261">O usuário que pertencem à função "canEdit" seleciona o tipo de categoria e adiciona detalhes do produto (**nome**, **descrição**, **preço**, e **doarquivodeimagem**).</span><span class="sxs-lookup"><span data-stu-id="1b6af-261">The user belonging to the "canEdit" role selects the category type and adds product details (**Name**, **Description**, **Price**, and **Image File**).</span></span> <span data-ttu-id="1b6af-262">Quando o usuário que pertencem à função "canEdit" clica o **adicionar produto** botão, o `AddProductButton_Click` manipulador de eventos é disparado.</span><span class="sxs-lookup"><span data-stu-id="1b6af-262">When the user belonging to the "canEdit" role clicks the **Add Product** button, the `AddProductButton_Click` event handler is triggered.</span></span> <span data-ttu-id="1b6af-263">O `AddProductButton_Click` manipulador de eventos localizado no arquivo code-behind (*AdminPage.aspx.cs*) verifica o arquivo de imagem para verificar se ele corresponde os tipos de arquivos permitidos *(. gif*, *. PNG*, *JPEG*, ou *. jpg*).</span><span class="sxs-lookup"><span data-stu-id="1b6af-263">The `AddProductButton_Click` event handler located in the code-behind file (*AdminPage.aspx.cs*) checks the image file to make sure it matches the allowed file types *(.gif*, *.png*, *.jpeg*, or *.jpg*).</span></span> <span data-ttu-id="1b6af-264">Em seguida, o arquivo de imagem é salvo em uma pasta do aplicativo de exemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="1b6af-264">Then, the image file is saved into a folder of the Wingtip Toys sample application.</span></span> <span data-ttu-id="1b6af-265">Em seguida, o novo produto é adicionado ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1b6af-265">Next, the new product is added to the database.</span></span> <span data-ttu-id="1b6af-266">Para realizar a adição de um novo produto, uma nova instância do `AddProducts` classe é criada e nomeada products.</span><span class="sxs-lookup"><span data-stu-id="1b6af-266">To accomplish adding a new product, a new instance of the `AddProducts` class is created and named products.</span></span> <span data-ttu-id="1b6af-267">O `AddProducts` classe tem um método chamado `AddProduct`, e o objeto de produtos chama esse método para adicionar produtos ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1b6af-267">The `AddProducts` class has a method named `AddProduct`, and the products object calls this method to add products to the database.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample15.cs)]

<span data-ttu-id="1b6af-268">Se o código adiciona com êxito o novo produto no banco de dados, a página for recarregada com o valor de cadeia de caracteres de consulta `ProductAction=add`.</span><span class="sxs-lookup"><span data-stu-id="1b6af-268">If the code successfully adds the new product to the database, the page is reloaded with the query string value `ProductAction=add`.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample16.cs)]

<span data-ttu-id="1b6af-269">Quando a página é recarregado, a cadeia de caracteres de consulta está incluída na URL.</span><span class="sxs-lookup"><span data-stu-id="1b6af-269">When the page reloads, the query string is included in the URL.</span></span> <span data-ttu-id="1b6af-270">Por recarregar a página, o usuário que pertencem à função "canEdit" pode ver imediatamente as atualizações na **DropDownList** controles na *AdminPage.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="1b6af-270">By reloading the page, the user belonging to the "canEdit" role can immediately see the updates in the **DropDownList** controls on the *AdminPage.aspx* page.</span></span> <span data-ttu-id="1b6af-271">Além disso, ao incluir a cadeia de caracteres de consulta com a URL, a página pode exibir uma mensagem de êxito para o usuário que pertence à função "canEdit".</span><span class="sxs-lookup"><span data-stu-id="1b6af-271">Also, by including the query string with the URL, the page can display a success message to the user belonging to the "canEdit" role.</span></span>

<span data-ttu-id="1b6af-272">Quando o *AdminPage.aspx* página recargas, o `Page_Load` evento é chamado.</span><span class="sxs-lookup"><span data-stu-id="1b6af-272">When the *AdminPage.aspx* page reloads, the `Page_Load` event is called.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample17.cs)]

<span data-ttu-id="1b6af-273">O `Page_Load` manipulador de eventos verifica o valor de cadeia de caracteres de consulta e determina se é necessário mostrar uma mensagem de êxito.</span><span class="sxs-lookup"><span data-stu-id="1b6af-273">The `Page_Load` event handler checks the query string value and determines whether to show a success message.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="1b6af-274">Executando o aplicativo</span><span class="sxs-lookup"><span data-stu-id="1b6af-274">Running the Application</span></span>

<span data-ttu-id="1b6af-275">Você pode executar o aplicativo agora para ver como você pode adicionar, exclusão e atualização de itens no carrinho de compras.</span><span class="sxs-lookup"><span data-stu-id="1b6af-275">You can run the application now to see how you can add, delete, and update items in the shopping cart.</span></span> <span data-ttu-id="1b6af-276">O total do carrinho de compras refletirá o custo total de todos os itens no carrinho de compras.</span><span class="sxs-lookup"><span data-stu-id="1b6af-276">The shopping cart total will reflect the total cost of all items in the shopping cart.</span></span>

1. <span data-ttu-id="1b6af-277">No Solution Explorer, pressione **F5** para executar o aplicativo de exemplo Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="1b6af-277">In Solution Explorer, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="1b6af-278">O navegador é aberta e mostra a *default. aspx* página.</span><span class="sxs-lookup"><span data-stu-id="1b6af-278">The browser opens and shows the *Default.aspx* page.</span></span>
2. <span data-ttu-id="1b6af-279">Clique o **faça logon no** link na parte superior da página.</span><span class="sxs-lookup"><span data-stu-id="1b6af-279">Click the **Log in** link at the top of the page.</span></span> 

    ![Associação e administração - faça logon no Link](membership-and-administration/_static/image2.png)

   <span data-ttu-id="1b6af-281">O *login. aspx* página é exibida.</span><span class="sxs-lookup"><span data-stu-id="1b6af-281">The *Login.aspx* page is displayed.</span></span>
3. <span data-ttu-id="1b6af-282">Use o seguinte nome de usuário e senha:</span><span class="sxs-lookup"><span data-stu-id="1b6af-282">Use the following user name and password:</span></span>  
   <span data-ttu-id="1b6af-283">Nome de usuário: canEditUser@wingtiptoys.com</span><span class="sxs-lookup"><span data-stu-id="1b6af-283">User name: canEditUser@wingtiptoys.com</span></span>  
   <span data-ttu-id="1b6af-284">Senha: Pa$$word1</span><span class="sxs-lookup"><span data-stu-id="1b6af-284">Password: Pa$$word1</span></span> 

    ![Associação e administração - página de logon](membership-and-administration/_static/image3.png)
4. <span data-ttu-id="1b6af-286">Clique o **faça logon no** botão na parte inferior da página.</span><span class="sxs-lookup"><span data-stu-id="1b6af-286">Click the **Log in** button near the bottom of the page.</span></span>
5. <span data-ttu-id="1b6af-287">Na parte superior da página seguinte, selecione o **Admin** link para navegar até a *AdminPage.aspx* página.</span><span class="sxs-lookup"><span data-stu-id="1b6af-287">At the top of the next page, select the **Admin** link to navigate to the *AdminPage.aspx* page.</span></span> 

    ![Associação e administração - Link de administração](membership-and-administration/_static/image4.png)
6. <span data-ttu-id="1b6af-289">Para testar a validação de entrada, clique o **adicionar produto** botão sem adicionar qualquer detalhes do produto.</span><span class="sxs-lookup"><span data-stu-id="1b6af-289">To test the input validation, click the **Add Product** button without adding any product details.</span></span> 

    ![Associação e administração - página de administração](membership-and-administration/_static/image5.png)

   <span data-ttu-id="1b6af-291">Observe que as mensagens de campo obrigatório são exibidas.</span><span class="sxs-lookup"><span data-stu-id="1b6af-291">Notice that the required field messages are displayed.</span></span>
7. <span data-ttu-id="1b6af-292">Adicione os detalhes de um novo produto e, em seguida, clique no **adicionar produto** botão.</span><span class="sxs-lookup"><span data-stu-id="1b6af-292">Add the details for a new product, and then click the **Add Product** button.</span></span> 

    ![Associação e administração - adicionar produto](membership-and-administration/_static/image6.png)
8. <span data-ttu-id="1b6af-294">Selecione **produtos** no menu de navegação superior para exibir o novo produto que você adicionou.</span><span class="sxs-lookup"><span data-stu-id="1b6af-294">Select **Products** from the top navigation menu to view the new product you added.</span></span> 

    ![Associação e administração - Mostrar novo produto](membership-and-administration/_static/image7.png)
9. <span data-ttu-id="1b6af-296">Clique o **Admin** link para retornar à página de administração.</span><span class="sxs-lookup"><span data-stu-id="1b6af-296">Click the **Admin** link to return to the administration page.</span></span>
10. <span data-ttu-id="1b6af-297">No **Remover produto** seção da página, selecione o novo produto que você adicionou o **DropDownListBox**.</span><span class="sxs-lookup"><span data-stu-id="1b6af-297">In the **Remove Product** section of the page, select the new product you added in the **DropDownListBox**.</span></span>
11. <span data-ttu-id="1b6af-298">Clique o **Remover produto** botão para remover o novo produto do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b6af-298">Click the **Remove Product** button to remove the new product from the application.</span></span> 

    ![Associação e administração - Remover produto](membership-and-administration/_static/image8.png)
12. <span data-ttu-id="1b6af-300">Selecione **produtos** no menu de navegação superior para confirmar que o produto foi removido.</span><span class="sxs-lookup"><span data-stu-id="1b6af-300">Select **Products** from the top navigation menu to confirm that the product has been removed.</span></span>
13. <span data-ttu-id="1b6af-301">Clique em **fazer logoff** exista o modo de administração.</span><span class="sxs-lookup"><span data-stu-id="1b6af-301">Click **Log off** to exist administration mode.</span></span>   
    <span data-ttu-id="1b6af-302">Observe que não mostra o painel de navegação superior a **Admin** item de menu.</span><span class="sxs-lookup"><span data-stu-id="1b6af-302">Notice that the top navigation pane no longer shows the **Admin** menu item.</span></span>

## <a name="summary"></a><span data-ttu-id="1b6af-303">Resumo</span><span class="sxs-lookup"><span data-stu-id="1b6af-303">Summary</span></span>

<span data-ttu-id="1b6af-304">Neste tutorial, você adicionou uma função personalizada e um usuário que pertence à função personalizada, o acesso restrito para a pasta de administração e a página e forneceu a navegação para o usuário que pertencem à função personalizada.</span><span class="sxs-lookup"><span data-stu-id="1b6af-304">In this tutorial, you added a custom role and a user belonging to the custom role, restricted access to the administration folder and page, and provided navigation for the user belonging to the custom role.</span></span> <span data-ttu-id="1b6af-305">Associação de modelo é usado para preencher uma **DropDownList** controle com os dados.</span><span class="sxs-lookup"><span data-stu-id="1b6af-305">You used model binding to populate a **DropDownList** control with data.</span></span> <span data-ttu-id="1b6af-306">Você já implementou as **FileUpload** controle e controles de validação.</span><span class="sxs-lookup"><span data-stu-id="1b6af-306">You implemented the **FileUpload** control and validation controls.</span></span> <span data-ttu-id="1b6af-307">Além disso, você aprendeu a adicionar e remover os produtos de um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1b6af-307">Also, you have learned how to add and remove products from a database.</span></span> <span data-ttu-id="1b6af-308">No próximo tutorial, você aprenderá a implementar o roteamento do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1b6af-308">In the next tutorial, you'll learn how to implement ASP.NET routing.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="1b6af-309">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="1b6af-309">Additional Resources</span></span>

<span data-ttu-id="1b6af-310">[Web. config - autorização elemento](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="1b6af-310">[Web.config - authorization Element](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="1b6af-311">Identidade do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="1b6af-311">ASP.NET Identity</span></span>](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md)  
[<span data-ttu-id="1b6af-312">Implantar um aplicativo de formulários da Web do ASP.NET seguro com associação, OAuth e banco de dados SQL em um Site do Azure</span><span class="sxs-lookup"><span data-stu-id="1b6af-312">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to an Azure Web Site</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="1b6af-313">Microsoft Azure – avaliação gratuita</span><span class="sxs-lookup"><span data-stu-id="1b6af-313">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

> [!div class="step-by-step"]
> <span data-ttu-id="1b6af-314">[Anterior](checkout-and-payment-with-paypal.md)
> [Próximo](url-routing.md)</span><span class="sxs-lookup"><span data-stu-id="1b6af-314">[Previous](checkout-and-payment-with-paypal.md)
[Next](url-routing.md)</span></span>
